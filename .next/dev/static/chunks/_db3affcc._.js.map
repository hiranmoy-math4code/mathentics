{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/app/admin/courses/%5BcourseId%5D/builder/DeleteModuleDialog.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\n\r\ninterface DeleteModuleDialogProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    onConfirm: () => void;\r\n    moduleTitle: string;\r\n}\r\n\r\nexport function DeleteModuleDialog({ open, onOpenChange, onConfirm, moduleTitle }: DeleteModuleDialogProps) {\r\n    return (\r\n        <AlertDialog open={open} onOpenChange={onOpenChange}>\r\n            <AlertDialogContent className=\"dark:bg-[#161b22] dark:border-slate-800\">\r\n                <AlertDialogHeader>\r\n                    <AlertDialogTitle className=\"dark:text-white\">Delete Module</AlertDialogTitle>\r\n                    <AlertDialogDescription className=\"dark:text-slate-400\">\r\n                        Are you sure you want to delete \"{moduleTitle}\"? This will also delete all lessons within this module.\r\n                    </AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                <AlertDialogFooter>\r\n                    <AlertDialogCancel className=\"dark:bg-transparent dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800\">Cancel</AlertDialogCancel>\r\n                    <AlertDialogAction\r\n                        onClick={() => {\r\n                            onConfirm();\r\n                            onOpenChange(false);\r\n                        }}\r\n                        className=\"bg-red-600 hover:bg-red-700 text-white\"\r\n                    >\r\n                        Delete\r\n                    </AlertDialogAction>\r\n                </AlertDialogFooter>\r\n            </AlertDialogContent>\r\n        </AlertDialog>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAoBO,SAAS,mBAAmB,EAAE,IAAI,EAAE,YAAY,EAAE,SAAS,EAAE,WAAW,EAA2B;IACtG,qBACI,6LAAC,sJAAW;QAAC,MAAM;QAAM,cAAc;kBACnC,cAAA,6LAAC,6JAAkB;YAAC,WAAU;;8BAC1B,6LAAC,4JAAiB;;sCACd,6LAAC,2JAAgB;4BAAC,WAAU;sCAAkB;;;;;;sCAC9C,6LAAC,iKAAsB;4BAAC,WAAU;;gCAAsB;gCAClB;gCAAY;;;;;;;;;;;;;8BAGtD,6LAAC,4JAAiB;;sCACd,6LAAC,4JAAiB;4BAAC,WAAU;sCAAwF;;;;;;sCACrH,6LAAC,4JAAiB;4BACd,SAAS;gCACL;gCACA,aAAa;4BACjB;4BACA,WAAU;sCACb;;;;;;;;;;;;;;;;;;;;;;;AAOrB;KAzBgB"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/app/admin/courses/%5BcourseId%5D/builder/AddContentModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { createClient } from \"@/lib/supabase/client\";\r\nimport { Lesson } from \"@/lib/types\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Video, FileText, File, HelpCircle, Plus } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface AddContentModalProps {\r\n    moduleId: string;\r\n    lessonCount: number;\r\n    onAdd: (data: any) => Promise<Lesson>;\r\n    onSuccess?: (lesson: Lesson) => void;\r\n}\r\n\r\nexport function AddContentModal({ moduleId, lessonCount, onAdd, onSuccess }: AddContentModalProps) {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [step, setStep] = useState<\"select\" | \"details\">(\"select\");\r\n    const [selectedType, setSelectedType] = useState<string | null>(null);\r\n    const [title, setTitle] = useState(\"\");\r\n    const [pdfFile, setPdfFile] = useState<File | null>(null);\r\n    const [selectedExamId, setSelectedExamId] = useState<string>(\"\");\r\n    const [availableExams, setAvailableExams] = useState<any[]>([]);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [isLoadingExams, setIsLoadingExams] = useState(false);\r\n    const [isFreePreview, setIsFreePreview] = useState(false);\r\n    // Live class fields\r\n    const [meetingUrl, setMeetingUrl] = useState(\"\");\r\n    const [meetingDate, setMeetingDate] = useState(\"\");\r\n    const [meetingPlatform, setMeetingPlatform] = useState(\"google_meet\");\r\n    const supabase = createClient();\r\n\r\n    const contentOptions = [\r\n        { id: \"video\", label: \"Video\", icon: Video, description: \"Add YouTube or Vimeo video\" },\r\n        { id: \"live\", label: \"Live Class\", icon: Video, description: \"Schedule live class (Google Meet/Zoom)\" },\r\n        { id: \"text\", label: \"Text\", icon: FileText, description: \"Add text content\" },\r\n        { id: \"pdf\", label: \"PDF\", icon: File, description: \"Upload PDF file\" },\r\n        { id: \"quiz\", label: \"Quiz/Exam\", icon: HelpCircle, description: \"Add quiz or exam\" },\r\n    ];\r\n\r\n    const handleTypeSelect = async (typeId: string) => {\r\n        setSelectedType(typeId);\r\n        setStep(\"details\");\r\n\r\n        // Load available exams if quiz is selected\r\n        if (typeId === \"quiz\") {\r\n            setIsLoadingExams(true);\r\n            try {\r\n                const { data, error } = await supabase\r\n                    .from(\"exams\")\r\n                    .select(\"id, title, status\")\r\n                    .eq(\"status\", \"published\")\r\n                    .order(\"created_at\", { ascending: false });\r\n\r\n                if (error) throw error;\r\n                setAvailableExams(data || []);\r\n            } catch (error) {\r\n                console.error(\"Error loading exams:\", error);\r\n                toast.error(\"Failed to load exams\");\r\n            } finally {\r\n                setIsLoadingExams(false);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!selectedType) return;\r\n\r\n        // Exam selection is now optional - can create \"upcoming exam\" placeholder\r\n        // Admin can add exam later when ready\r\n\r\n        // Validation for live class\r\n        if (selectedType === \"live\") {\r\n            if (!meetingUrl) {\r\n                toast.error(\"Please enter a meeting URL\");\r\n                return;\r\n            }\r\n            if (!meetingDate) {\r\n                toast.error(\"Please select a date and time\");\r\n                return;\r\n            }\r\n        }\r\n\r\n        setIsLoading(true);\r\n        try {\r\n            let contentUrl = \"\";\r\n\r\n            // For video lessons, leave content_url empty - will be added via upload\r\n            if (selectedType === \"pdf\" && pdfFile) {\r\n                const fileName = `course-content/${Date.now()}-${pdfFile.name.replace(/\\s+/g, \"_\")}`;\r\n                const { error: uploadError } = await supabase.storage\r\n                    .from(\"uploads\")\r\n                    .upload(fileName, pdfFile);\r\n\r\n                if (uploadError) throw uploadError;\r\n\r\n                const { data } = supabase.storage.from(\"uploads\").getPublicUrl(fileName);\r\n                contentUrl = data.publicUrl;\r\n            }\r\n\r\n            const lessonData: any = {\r\n                module_id: moduleId,\r\n                title,\r\n                content_type: selectedType === \"live\" ? \"video\" : selectedType,\r\n                content_url: contentUrl,\r\n                lesson_order: lessonCount + 1,\r\n                is_free_preview: isFreePreview\r\n            };\r\n\r\n            // Add live class specific fields\r\n            if (selectedType === \"live\") {\r\n                lessonData.is_live = true;\r\n                lessonData.meeting_url = meetingUrl;\r\n                lessonData.meeting_date = new Date(meetingDate).toISOString();\r\n                lessonData.meeting_platform = meetingPlatform;\r\n            }\r\n\r\n            // Add exam_id for quiz type (only if exam is selected)\r\n            if (selectedType === \"quiz\" && selectedExamId) {\r\n                lessonData.exam_id = selectedExamId;\r\n            }\r\n\r\n            // Optimistic Update: Close dialog immediately without waiting for server\r\n            setIsOpen(false);\r\n            resetForm();\r\n            setIsLoading(false);\r\n            toast.info(\"Adding lesson in background...\");\r\n\r\n            // Trigger the actual mutation (fire and forget from UI perspective)\r\n            onAdd(lessonData).then((data) => {\r\n                // Once confirmed by server, we can select it or perform other actions\r\n                if (onSuccess) onSuccess(data);\r\n                toast.success(\"Lesson added successfully\");\r\n            }).catch((error) => {\r\n                console.error(\"Add lesson failed:\", error);\r\n                // Persist the data in a retry action\r\n                toast.error(\"Background save failed! Your work is preserved.\", {\r\n                    duration: Infinity, // Don't disappear\r\n                    action: {\r\n                        label: \"Retry Save\",\r\n                        onClick: () => {\r\n                            toast.info(\"Retrying save...\");\r\n                            onAdd(lessonData).then((d) => {\r\n                                if (onSuccess) onSuccess(d);\r\n                                toast.success(\"Retry successful!\");\r\n                            }).catch((e) => toast.error(\"Retry failed again. Please check connection.\"));\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        } catch (error: any) {\r\n            console.error(error);\r\n            toast.error(error.message || \"Failed to add lesson\");\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setStep(\"select\");\r\n        setSelectedType(null);\r\n        setTitle(\"\");\r\n        setPdfFile(null);\r\n        setSelectedExamId(\"\");\r\n        setAvailableExams([]);\r\n        // Reset live class fields\r\n        setMeetingUrl(\"\");\r\n        setMeetingDate(\"\");\r\n        setMeetingPlatform(\"google_meet\");\r\n        setIsFreePreview(false);\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={(open) => {\r\n            setIsOpen(open);\r\n            if (!open) resetForm();\r\n        }}>\r\n            <DialogTrigger asChild>\r\n                <button className=\"flex items-center text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium px-2 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-500/10 transition-colors w-full\">\r\n                    <Plus className=\"h-3 w-3 mr-2\" /> Add chapter item\r\n                </button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"max-w-2xl dark:bg-[#161b22] dark:border-slate-800\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"dark:text-white\">{step === \"select\" ? \"Add Content\" : `Add ${contentOptions.find(o => o.id === selectedType)?.label}`}</DialogTitle>\r\n                </DialogHeader>\r\n\r\n                {step === \"select\" ? (\r\n                    <div className=\"grid grid-cols-3 gap-4 py-4\">\r\n                        {contentOptions.map((option) => (\r\n                            <button\r\n                                key={option.id}\r\n                                onClick={() => handleTypeSelect(option.id)}\r\n                                className=\"flex flex-col items-start p-4 border dark:border-slate-700 rounded-lg hover:border-blue-500 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-500/10 transition-all text-left group\"\r\n                            >\r\n                                <div className=\"p-2 bg-slate-100 dark:bg-slate-800 rounded-md mb-3 group-hover:bg-white dark:group-hover:bg-slate-700 transition-colors\">\r\n                                    <option.icon className=\"h-5 w-5 text-slate-700 dark:text-slate-300\" />\r\n                                </div>\r\n                                <span className=\"font-semibold text-sm mb-1 dark:text-white\">{option.label}</span>\r\n                                <span className=\"text-xs text-slate-500 dark:text-slate-400 leading-tight\">{option.description}</span>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                ) : (\r\n                    <form onSubmit={handleSubmit} className=\"space-y-4 py-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"dark:text-slate-300\">Title</Label>\r\n                            <Input\r\n                                value={title}\r\n                                onChange={(e) => setTitle(e.target.value)}\r\n                                placeholder=\"Enter lesson title\"\r\n                                required\r\n                                autoFocus\r\n                                className=\"dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                            />\r\n                        </div>\r\n\r\n                        {selectedType === \"live\" && (\r\n                            <>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label className=\"dark:text-slate-300\">Meeting URL</Label>\r\n                                    <Input\r\n                                        value={meetingUrl}\r\n                                        onChange={(e) => setMeetingUrl(e.target.value)}\r\n                                        placeholder=\"https://meet.google.com/abc-defg-hij\"\r\n                                        required\r\n                                        className=\"dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                                    />\r\n                                    <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                        Paste your Google Meet, Zoom, or Teams link here\r\n                                    </p>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label className=\"dark:text-slate-300\">Class Date & Time</Label>\r\n                                    <Input\r\n                                        type=\"datetime-local\"\r\n                                        value={meetingDate}\r\n                                        onChange={(e) => setMeetingDate(e.target.value)}\r\n                                        required\r\n                                        className=\"dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                                    />\r\n                                    <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                        When will the live class start?\r\n                                    </p>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label className=\"dark:text-slate-300\">Platform</Label>\r\n                                    <select\r\n                                        className=\"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                                        value={meetingPlatform}\r\n                                        onChange={(e) => setMeetingPlatform(e.target.value)}\r\n                                    >\r\n                                        <option value=\"google_meet\">Google Meet</option>\r\n                                        <option value=\"zoom\">Zoom</option>\r\n                                        <option value=\"teams\">Microsoft Teams</option>\r\n                                        <option value=\"other\">Other</option>\r\n                                    </select>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n\r\n                        {selectedType === \"pdf\" && (\r\n                            <div className=\"space-y-2\">\r\n                                <Label className=\"dark:text-slate-300\">Upload PDF File</Label>\r\n                                <Input\r\n                                    type=\"file\"\r\n                                    accept=\".pdf\"\r\n                                    onChange={(e) => setPdfFile(e.target.files?.[0] || null)}\r\n                                    required\r\n                                    className=\"dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                                />\r\n                            </div>\r\n                        )}\r\n\r\n                        {selectedType === \"quiz\" && (\r\n                            <div className=\"space-y-2\">\r\n                                <Label className=\"dark:text-slate-300\">Select Exam/Quiz (Optional)</Label>\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400 mb-2\">\r\n                                    ðŸ’¡ You can create an \"Upcoming Exam\" placeholder without selecting an exam. Link the actual exam later when ready.\r\n                                </p>\r\n                                {isLoadingExams ? (\r\n                                    <div className=\"text-sm text-slate-500\">Loading exams...</div>\r\n                                ) : availableExams.length > 0 ? (\r\n                                    <select\r\n                                        className=\"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                                        value={selectedExamId}\r\n                                        onChange={(e) => setSelectedExamId(e.target.value)}\r\n                                    >\r\n                                        <option value=\"\">None - Create upcoming exam placeholder</option>\r\n                                        {availableExams.map((exam) => (\r\n                                            <option key={exam.id} value={exam.id}>\r\n                                                {exam.title}\r\n                                            </option>\r\n                                        ))}\r\n                                    </select>\r\n                                ) : (\r\n                                    <div className=\"text-sm text-slate-500\">\r\n                                        No published exams available. You can still create an upcoming exam placeholder.\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"flex items-center space-x-2 pt-2\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                id=\"is-free\"\r\n                                checked={isFreePreview}\r\n                                onChange={(e) => setIsFreePreview(e.target.checked)}\r\n                                className=\"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                            />\r\n                            <Label htmlFor=\"is-free\" className=\"dark:text-slate-300 cursor-pointer\">Free Preview (Available without purchase)</Label>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end gap-2 mt-4\">\r\n                            <Button type=\"button\" variant=\"ghost\" onClick={() => setStep(\"select\")} className=\"dark:text-slate-300 dark:hover:text-white dark:hover:bg-slate-800\">Back</Button>\r\n                            <Button type=\"submit\" disabled={isLoading}>\r\n                                {isLoading ? \"Adding...\" : \"Add Lesson\"}\r\n                            </Button>\r\n                        </div>\r\n                    </form>\r\n                )}\r\n            </DialogContent>\r\n        </Dialog >\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 732, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/app/admin/courses/%5BcourseId%5D/builder/ModuleList.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { ModuleWithLessons } from \"@/hooks/useCourseModules\";\r\nimport { Lesson } from \"@/lib/types\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n    ChevronDown, ChevronRight, Edit, Trash, Video, FileText, File, HelpCircle,\r\n    GripVertical\r\n} from \"lucide-react\";\r\nimport { AddContentModal } from \"./AddContentModal\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nimport {\r\n    DndContext,\r\n    closestCenter,\r\n    KeyboardSensor,\r\n    PointerSensor,\r\n    useSensor,\r\n    useSensors,\r\n    DragEndEvent,\r\n} from '@dnd-kit/core';\r\nimport {\r\n    arrayMove,\r\n    SortableContext,\r\n    sortableKeyboardCoordinates,\r\n    verticalListSortingStrategy,\r\n    useSortable,\r\n} from '@dnd-kit/sortable';\r\nimport { CSS } from '@dnd-kit/utilities';\r\n\r\ninterface ModuleListProps {\r\n    modules: ModuleWithLessons[];\r\n    expandedModules: Record<string, boolean>;\r\n    toggleModule: (id: string) => void;\r\n    editingModule: { id: string, title: string } | null;\r\n    setEditingModule: (m: { id: string, title: string } | null) => void;\r\n    handleUpdateModule: (id: string, title: string) => void;\r\n    handleDeleteModuleRequest: (id: string, title: string) => void;\r\n    selectedLesson: Lesson | null;\r\n    setSelectedLesson: (l: Lesson | null) => void;\r\n    addLesson: (data: any) => Promise<Lesson>;\r\n    reorderModules: (items: { id: string, module_order: number }[]) => Promise<void>;\r\n    reorderLessons: (items: { id: string, lesson_order: number, module_id: string }[]) => Promise<void>;\r\n}\r\n\r\nexport function ModuleList({\r\n    modules,\r\n    expandedModules,\r\n    toggleModule,\r\n    editingModule,\r\n    setEditingModule,\r\n    handleUpdateModule,\r\n    handleDeleteModuleRequest,\r\n    selectedLesson,\r\n    setSelectedLesson,\r\n    addLesson,\r\n    reorderModules,\r\n    reorderLessons\r\n}: ModuleListProps) {\r\n    const sensors = useSensors(\r\n        useSensor(PointerSensor, {\r\n            activationConstraint: {\r\n                distance: 8,\r\n            },\r\n        }),\r\n        useSensor(KeyboardSensor, {\r\n            coordinateGetter: sortableKeyboardCoordinates,\r\n        })\r\n    );\r\n\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    if (!mounted) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                {modules.map((module) => (\r\n                    <div key={module.id} className=\"border border-slate-200 dark:border-slate-800 rounded-lg overflow-hidden bg-white dark:bg-[#161b22] opacity-50\">\r\n                        <div className=\"p-3 bg-slate-50 dark:bg-slate-900 flex items-center justify-between\">\r\n                            <span className=\"font-semibold text-slate-700 dark:text-slate-200\">{module.title}</span>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const handleDragEnd = (event: DragEndEvent) => {\r\n        const { active, over } = event;\r\n\r\n        if (!over) return;\r\n        if (active.id === over.id) return;\r\n\r\n        const activeData = active.data.current;\r\n        const overData = over.data.current;\r\n\r\n        // Reordering Modules\r\n        if (activeData?.type === 'module') {\r\n            if (overData?.type !== 'module') return;\r\n\r\n            const oldIndex = modules.findIndex((m) => m.id === active.id);\r\n            const newIndex = modules.findIndex((m) => m.id === over.id);\r\n\r\n            if (oldIndex !== -1 && newIndex !== -1) {\r\n                const newModules = arrayMove(modules, oldIndex, newIndex);\r\n                // Update Order\r\n                const updates = newModules.map((m, index) => ({\r\n                    id: m.id,\r\n                    module_order: index + 1\r\n                }));\r\n                reorderModules(updates);\r\n            }\r\n        }\r\n\r\n        // Reordering Lessons\r\n        if (activeData?.type === 'lesson') {\r\n            if (overData?.type !== 'lesson') return;\r\n\r\n            const moduleId = activeData.moduleId;\r\n            const overModuleId = overData.moduleId;\r\n\r\n            // Only allow reorder within same module for now\r\n            if (moduleId === overModuleId) {\r\n                const module = modules.find(m => m.id === moduleId);\r\n                if (module) {\r\n                    const oldIndex = module.lessons.findIndex(l => l.id === active.id);\r\n                    const newIndex = module.lessons.findIndex(l => l.id === over.id);\r\n\r\n                    if (oldIndex !== -1 && newIndex !== -1) {\r\n                        const newLessons = arrayMove(module.lessons, oldIndex, newIndex);\r\n                        const updates = newLessons.map((l, index) => ({\r\n                            id: l.id,\r\n                            lesson_order: index + 1,\r\n                            module_id: moduleId\r\n                        }));\r\n                        reorderLessons(updates);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    if (modules.length === 0) {\r\n        return (\r\n            <div className=\"text-center py-12 px-4 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-xl\">\r\n                <p className=\"text-slate-500 dark:text-slate-400\">\r\n                    No modules yet. Start by creating a module to organize your course content.\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <DndContext\r\n            sensors={sensors}\r\n            collisionDetection={closestCenter}\r\n            onDragEnd={handleDragEnd}\r\n        >\r\n            <SortableContext\r\n                items={modules.map(m => m.id)}\r\n                strategy={verticalListSortingStrategy}\r\n            >\r\n                <div className=\"space-y-4\">\r\n                    {modules.map((module) => (\r\n                        <SortableModuleItem\r\n                            key={module.id}\r\n                            module={module}\r\n                            isExpanded={!!expandedModules[module.id]}\r\n                            onToggle={() => toggleModule(module.id)}\r\n                            isEditing={editingModule?.id === module.id}\r\n                            editingTitle={editingModule?.title || \"\"}\r\n                            onEditStart={() => setEditingModule({ id: module.id, title: module.title })}\r\n                            onEditChange={(title) => setEditingModule({ ...editingModule!, title })}\r\n                            onEditSave={() => handleUpdateModule(module.id, editingModule!.title)}\r\n                            onEditCancel={() => setEditingModule(null)}\r\n                            onDeleteRequest={() => handleDeleteModuleRequest(module.id, module.title)}\r\n                            selectedLessonId={selectedLesson?.id || null}\r\n                            onSelectLesson={setSelectedLesson}\r\n                            onAddLesson={addLesson}\r\n                        />\r\n                    ))}\r\n                </div>\r\n            </SortableContext>\r\n        </DndContext>\r\n    );\r\n}\r\n\r\ninterface SortableModuleItemProps {\r\n    module: ModuleWithLessons;\r\n    isExpanded: boolean;\r\n    onToggle: () => void;\r\n    isEditing: boolean;\r\n    editingTitle: string;\r\n    onEditStart: () => void;\r\n    onEditChange: (val: string) => void;\r\n    onEditSave: () => void;\r\n    onEditCancel: () => void;\r\n    onDeleteRequest: () => void;\r\n    selectedLessonId: string | null;\r\n    onSelectLesson: (l: Lesson) => void;\r\n    onAddLesson: (data: any) => Promise<Lesson>;\r\n}\r\n\r\nfunction SortableModuleItem({\r\n    module,\r\n    isExpanded,\r\n    onToggle,\r\n    isEditing,\r\n    editingTitle,\r\n    onEditStart,\r\n    onEditChange,\r\n    onEditSave,\r\n    onEditCancel,\r\n    onDeleteRequest,\r\n    selectedLessonId,\r\n    onSelectLesson,\r\n    onAddLesson\r\n}: SortableModuleItemProps) {\r\n    const {\r\n        attributes,\r\n        listeners,\r\n        setNodeRef,\r\n        transform,\r\n        transition,\r\n        isDragging\r\n    } = useSortable({\r\n        id: module.id,\r\n        data: {\r\n            type: 'module'\r\n        }\r\n    });\r\n\r\n    const style = {\r\n        transform: CSS.Translate.toString(transform),\r\n        transition,\r\n        opacity: isDragging ? 0.5 : 1,\r\n        zIndex: isDragging ? 100 : \"auto\",\r\n        position: isDragging ? \"relative\" as \"relative\" : undefined,\r\n    };\r\n\r\n    return (\r\n        <div ref={setNodeRef} style={style} className=\"border border-slate-200 dark:border-slate-800 rounded-lg overflow-hidden bg-white dark:bg-[#161b22]\">\r\n            <div\r\n                className=\"p-3 bg-slate-50 dark:bg-slate-900 flex items-center gap-2 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors\"\r\n                onClick={onToggle}\r\n            >\r\n                {/* Drag Handle */}\r\n                <button className=\"cursor-grab touch-none p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 shrink-0\" {...attributes} {...listeners}>\r\n                    <GripVertical className=\"h-4 w-4\" />\r\n                </button>\r\n\r\n                {/* Chevron */}\r\n                <div className=\"shrink-0\">\r\n                    {isExpanded ? (\r\n                        <ChevronDown className=\"h-4 w-4 text-slate-400\" />\r\n                    ) : (\r\n                        <ChevronRight className=\"h-4 w-4 text-slate-400\" />\r\n                    )}\r\n                </div>\r\n\r\n                {/* Module Title */}\r\n                <div className=\"flex items-center gap-2 group flex-1 min-w-0\">\r\n                    <span className=\"font-semibold text-slate-700 dark:text-slate-200 truncate\">{module.title}</span>\r\n                    <div className=\"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 shrink-0\">\r\n                        <button\r\n                            className=\"p-1 hover:bg-slate-200 dark:hover:bg-slate-700 rounded text-slate-400 hover:text-indigo-500\"\r\n                            onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                onEditStart();\r\n                            }}\r\n                        >\r\n                            <Edit className=\"h-3 w-3\" />\r\n                        </button>\r\n                        <button\r\n                            className=\"p-1 hover:bg-slate-200 dark:hover:bg-slate-700 rounded text-slate-400 hover:text-red-500\"\r\n                            onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                onDeleteRequest();\r\n                            }}\r\n                        >\r\n                            <Trash className=\"h-3 w-3\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Lesson Count */}\r\n                <div className=\"flex items-center gap-2 text-xs text-slate-500 shrink-0\">\r\n                    <span>{module.lessons.length} lessons</span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Edit Module Dialog */}\r\n            {isEditing && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\" onClick={onEditCancel}>\r\n                    <div className=\"bg-white dark:bg-slate-900 rounded-lg p-6 w-full max-w-md mx-4 shadow-xl\" onClick={(e) => e.stopPropagation()}>\r\n                        <h3 className=\"text-lg font-semibold mb-4 text-slate-900 dark:text-white\">Edit Module Name</h3>\r\n                        <Input\r\n                            value={editingTitle}\r\n                            onChange={(e) => onEditChange(e.target.value)}\r\n                            className=\"mb-4 dark:bg-slate-800 dark:text-white\"\r\n                            placeholder=\"Module name\"\r\n                            autoFocus\r\n                            onKeyDown={(e) => {\r\n                                if (e.key === \"Enter\") onEditSave();\r\n                                if (e.key === \"Escape\") onEditCancel();\r\n                            }}\r\n                        />\r\n                        <div className=\"flex justify-end gap-2\">\r\n                            <Button variant=\"ghost\" onClick={onEditCancel}>Cancel</Button>\r\n                            <Button onClick={onEditSave}>Save Changes</Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {isExpanded && (\r\n                <div className=\"p-2 space-y-2 border-t border-slate-200 dark:border-slate-800\">\r\n                    <SortableContext\r\n                        items={module.lessons.map(l => l.id)}\r\n                        strategy={verticalListSortingStrategy}\r\n                    >\r\n                        <div className=\"space-y-2\">\r\n                            {module.lessons.map((lesson) => (\r\n                                <SortableLessonItem\r\n                                    key={lesson.id}\r\n                                    lesson={lesson}\r\n                                    isSelected={selectedLessonId === lesson.id}\r\n                                    onSelect={(l) => onSelectLesson(l)}\r\n                                />\r\n                            ))}\r\n                        </div>\r\n                    </SortableContext>\r\n\r\n                    <div className=\"pt-2\">\r\n                        <AddContentModal\r\n                            moduleId={module.id}\r\n                            lessonCount={module.lessons.length}\r\n                            onAdd={onAddLesson}\r\n                            onSuccess={onSelectLesson}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction SortableLessonItem({ lesson, isSelected, onSelect }: { lesson: Lesson, isSelected: boolean, onSelect: (l: Lesson) => void }) {\r\n    const {\r\n        attributes,\r\n        listeners,\r\n        setNodeRef,\r\n        transform,\r\n        transition,\r\n        isDragging\r\n    } = useSortable({\r\n        id: lesson.id,\r\n        data: {\r\n            type: 'lesson',\r\n            moduleId: lesson.module_id\r\n        }\r\n    });\r\n\r\n    const style = {\r\n        transform: CSS.Translate.toString(transform),\r\n        transition,\r\n        opacity: isDragging ? 0.5 : 1,\r\n        zIndex: isDragging ? 10 : \"auto\",\r\n        position: isDragging ? \"relative\" as \"relative\" : undefined,\r\n    };\r\n\r\n    return (\r\n        <div\r\n            ref={setNodeRef}\r\n            style={style}\r\n            onClick={() => onSelect(lesson)}\r\n            className={cn(\r\n                \"flex items-center gap-3 p-2 rounded-md cursor-pointer transition-colors group\",\r\n                isSelected\r\n                    ? \"bg-indigo-50 dark:bg-indigo-500/10 text-indigo-700 dark:text-indigo-400\"\r\n                    : \"hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400\"\r\n            )}\r\n        >\r\n            <button className=\"cursor-grab touch-none p-1 text-slate-300 hover:text-slate-500\" {...attributes} {...listeners} onClick={(e) => e.stopPropagation()}>\r\n                <GripVertical className=\"h-3 w-3\" />\r\n            </button>\r\n\r\n            {lesson.content_type === \"video\" && <Video className=\"h-4 w-4 shrink-0\" />}\r\n            {lesson.content_type === \"text\" && <FileText className=\"h-4 w-4 shrink-0\" />}\r\n            {lesson.content_type === \"pdf\" && <File className=\"h-4 w-4 shrink-0\" />}\r\n            {lesson.content_type === \"quiz\" && <HelpCircle className=\"h-4 w-4 shrink-0\" />}\r\n            <span className=\"text-sm truncate flex-1\">{lesson.title}</span>\r\n            <div className=\"opacity-0 group-hover:opacity-100 text-xs text-slate-400\">\r\n                {lesson.is_free_preview ? \"Free\" : \"Paid\"}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1312, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ui/tabs.tsx"],"sourcesContent":["'use client'\r\n// Force recompile\r\n\r\nimport * as React from 'react'\r\nimport * as TabsPrimitive from '@radix-ui/react-tabs'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction Tabs({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.Root>) {\r\n  return (\r\n    <TabsPrimitive.Root\r\n      data-slot=\"tabs\"\r\n      className={cn('flex flex-col gap-2', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction TabsList({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.List>) {\r\n  return (\r\n    <TabsPrimitive.List\r\n      data-slot=\"tabs-list\"\r\n      className={cn(\r\n        'bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction TabsTrigger({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {\r\n  return (\r\n    <TabsPrimitive.Trigger\r\n      data-slot=\"tabs-trigger\"\r\n      className={cn(\r\n        \"data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction TabsContent({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.Content>) {\r\n  return (\r\n    <TabsPrimitive.Content\r\n      data-slot=\"tabs-content\"\r\n      className={cn('flex-1 outline-none', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\r\n"],"names":[],"mappings":";;;;;;;;;;;AAIA;AAEA;AANA;;;;AAQA,SAAS,KAAK,EACZ,SAAS,EACT,GAAG,OAC6C;IAChD,qBACE,6LAAC,2KAAkB;QACjB,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,SAAS,EAChB,SAAS,EACT,GAAG,OAC6C;IAChD,qBACE,6LAAC,2KAAkB;QACjB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,uGACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,6LAAC,8KAAqB;QACpB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,mqBACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,6LAAC,8KAAqB;QACpB,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf;MAXS"}},
    {"offset": {"line": 1390, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ui/progress.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from 'react'\r\nimport * as ProgressPrimitive from '@radix-ui/react-progress'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction Progress({\r\n  className,\r\n  value,\r\n  indicatorClassName,\r\n  ...props\r\n}: React.ComponentProps<typeof ProgressPrimitive.Root> & { indicatorClassName?: string }) {\r\n  return (\r\n    <ProgressPrimitive.Root\r\n      data-slot=\"progress\"\r\n      className={cn(\r\n        'bg-primary/20 relative h-2 w-full overflow-hidden rounded-full',\r\n        className,\r\n      )}\r\n      {...props}\r\n    >\r\n      <ProgressPrimitive.Indicator\r\n        data-slot=\"progress-indicator\"\r\n        className={cn(\"bg-primary h-full w-full flex-1 transition-all\", indicatorClassName)}\r\n        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\r\n      />\r\n    </ProgressPrimitive.Root>\r\n  )\r\n}\r\n\r\nexport { Progress }\r\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,SAAS,EAChB,SAAS,EACT,KAAK,EACL,kBAAkB,EAClB,GAAG,OACmF;IACtF,qBACE,6LAAC,+KAAsB;QACrB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,oLAA2B;YAC1B,aAAU;YACV,WAAW,IAAA,qHAAE,EAAC,kDAAkD;YAChE,OAAO;gBAAE,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;YAAC;;;;;;;;;;;AAIlE;KAtBS"}},
    {"offset": {"line": 1434, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ui/alert.tsx"],"sourcesContent":["import * as React from 'react'\r\nimport { cva, type VariantProps } from 'class-variance-authority'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst alertVariants = cva(\r\n  'relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current',\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: 'bg-card text-card-foreground',\r\n        destructive:\r\n          'text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90',\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: 'default',\r\n    },\r\n  },\r\n)\r\n\r\nfunction Alert({\r\n  className,\r\n  variant,\r\n  ...props\r\n}: React.ComponentProps<'div'> & VariantProps<typeof alertVariants>) {\r\n  return (\r\n    <div\r\n      data-slot=\"alert\"\r\n      role=\"alert\"\r\n      className={cn(alertVariants({ variant }), className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction AlertTitle({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"alert-title\"\r\n      className={cn(\r\n        'col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction AlertDescription({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"alert-description\"\r\n      className={cn(\r\n        'text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Alert, AlertTitle, AlertDescription }\r\n"],"names":[],"mappings":";;;;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,qOACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,GAAG,OAC8D;IACjE,qBACE,6LAAC;QACC,aAAU;QACV,MAAK;QACL,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;KAbS;AAeT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,+DACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,iBAAiB,EACxB,SAAS,EACT,GAAG,OACyB;IAC5B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kGACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS"}},
    {"offset": {"line": 1510, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/app/admin/courses/%5BcourseId%5D/builder/BunnyUploader.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useRef, useCallback } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Upload as UploadIcon, CheckCircle2, XCircle, Loader2, Video } from 'lucide-react';\r\n\r\ninterface BunnyUploaderProps {\r\n    lessonTitle: string;\r\n    courseId: string;\r\n    courseTitle: string;\r\n    onUploadComplete: (videoData: {\r\n        videoId: string;\r\n        guid: string;\r\n        libraryId: string;\r\n    }) => void;\r\n    onError?: (error: string) => void;\r\n}\r\n\r\nexport function BunnyUploader({ lessonTitle, courseId, courseTitle, onUploadComplete, onError }: BunnyUploaderProps) {\r\n    const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n    const [uploading, setUploading] = useState(false);\r\n    const [uploadProgress, setUploadProgress] = useState(0);\r\n    const [uploadStatus, setUploadStatus] = useState<'idle' | 'uploading' | 'processing' | 'success' | 'error'>('idle');\r\n    const [errorMessage, setErrorMessage] = useState<string>('');\r\n    const [videoData, setVideoData] = useState<any>(null);\r\n\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const handleFileSelect = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = event.target.files?.[0];\r\n        if (file) {\r\n            // Validate file type\r\n            if (!file.type.startsWith('video/')) {\r\n                setErrorMessage('Please select a valid video file');\r\n                setUploadStatus('error');\r\n                return;\r\n            }\r\n\r\n            // Validate file size (max 5GB for example)\r\n            const maxSize = 5 * 1024 * 1024 * 1024; // 5GB\r\n            if (file.size > maxSize) {\r\n                setErrorMessage('File size exceeds 5GB limit');\r\n                setUploadStatus('error');\r\n                return;\r\n            }\r\n\r\n            setSelectedFile(file);\r\n            setUploadStatus('idle');\r\n            setErrorMessage('');\r\n        }\r\n    }, []);\r\n\r\n    const startUpload = async () => {\r\n        if (!selectedFile) return;\r\n\r\n        setUploading(true);\r\n        setUploadStatus('uploading');\r\n        setUploadProgress(0);\r\n        setErrorMessage('');\r\n\r\n        try {\r\n            // 1. Get or create collection for this course\r\n            const collectionResponse = await fetch('/api/admin/bunny-collections', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    courseId,\r\n                    courseTitle\r\n                })\r\n            });\r\n\r\n            const collectionData = await collectionResponse.json();\r\n            const collectionId = collectionData?.collectionId;\r\n\r\n            // 2. Get upload signature from backend\r\n            const signResponse = await fetch('/api/bunny/sign', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    videoTitle: lessonTitle || selectedFile.name,\r\n                    collectionId // Pass collection ID to sign endpoint\r\n                })\r\n            });\r\n\r\n            if (!signResponse.ok) {\r\n                throw new Error('Failed to get upload signature');\r\n            }\r\n\r\n            const signData = await signResponse.json();\r\n            const { videoId, guid, libraryId, apiKey } = signData;\r\n\r\n            // 2. Upload directly to Bunny.net using their API\r\n            // Use XMLHttpRequest for progress tracking\r\n            const xhr = new XMLHttpRequest();\r\n\r\n            xhr.upload.addEventListener('progress', (e) => {\r\n                if (e.lengthComputable) {\r\n                    const percentage = Math.round((e.loaded / e.total) * 100);\r\n                    setUploadProgress(percentage);\r\n                }\r\n            });\r\n\r\n            xhr.addEventListener('load', async () => {\r\n                if (xhr.status === 200 || xhr.status === 201) {\r\n                    setUploadStatus('processing');\r\n\r\n                    // Store video data\r\n                    const data = { videoId, guid, libraryId };\r\n                    setVideoData(data);\r\n\r\n                    // Wait a bit for processing to start\r\n                    await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n                    // Check video status\r\n                    await checkVideoStatus(videoId, data);\r\n                } else {\r\n                    setErrorMessage(`Upload failed: ${xhr.status} ${xhr.statusText}`);\r\n                    setUploadStatus('error');\r\n                    setUploading(false);\r\n                    onError?.(`Upload failed: ${xhr.status}`);\r\n                }\r\n            });\r\n\r\n            xhr.addEventListener('error', () => {\r\n                setErrorMessage('Network error during upload');\r\n                setUploadStatus('error');\r\n                setUploading(false);\r\n                onError?.('Network error');\r\n            });\r\n\r\n            // Upload using Bunny.net's direct upload API\r\n            xhr.open('PUT', `https://video.bunnycdn.com/library/${libraryId}/videos/${videoId}`);\r\n            xhr.setRequestHeader('AccessKey', apiKey);\r\n            xhr.setRequestHeader('Content-Type', 'application/octet-stream');\r\n            xhr.send(selectedFile);\r\n\r\n        } catch (error: any) {\r\n            setErrorMessage(error.message || 'Failed to initialize upload');\r\n            setUploadStatus('error');\r\n            setUploading(false);\r\n            onError?.(error.message);\r\n        }\r\n    };\r\n\r\n    const checkVideoStatus = async (videoId: string, data: any) => {\r\n        try {\r\n            const response = await fetch('/api/bunny/video-info', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ videoId })\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (result.success && result.status === 'ready') {\r\n                setUploadStatus('success');\r\n                setUploading(false);\r\n                onUploadComplete(data);\r\n            } else if (result.status === 'error') {\r\n                setErrorMessage('Video processing failed');\r\n                setUploadStatus('error');\r\n                setUploading(false);\r\n            } else {\r\n                // Still processing, check again in 3 seconds\r\n                setTimeout(() => checkVideoStatus(videoId, data), 3000);\r\n            }\r\n        } catch (error) {\r\n\r\n            // Assume success if we can't check status\r\n            setUploadStatus('success');\r\n            setUploading(false);\r\n            onUploadComplete(data);\r\n        }\r\n    };\r\n\r\n    const cancelUpload = useCallback(() => {\r\n        setUploading(false);\r\n        setUploadStatus('idle');\r\n        setUploadProgress(0);\r\n    }, []);\r\n\r\n    const reset = useCallback(() => {\r\n        setSelectedFile(null);\r\n        setUploadStatus('idle');\r\n        setUploadProgress(0);\r\n        setErrorMessage('');\r\n        setVideoData(null);\r\n        if (fileInputRef.current) {\r\n            fileInputRef.current.value = '';\r\n        }\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {uploadStatus === 'idle' && !selectedFile && (\r\n                <div className=\"border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg p-8 text-center\">\r\n                    <input\r\n                        ref={fileInputRef}\r\n                        type=\"file\"\r\n                        accept=\"video/*\"\r\n                        onChange={handleFileSelect}\r\n                        className=\"hidden\"\r\n                        id=\"video-upload\"\r\n                    />\r\n                    <label htmlFor=\"video-upload\" className=\"cursor-pointer\">\r\n                        <Video className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">\r\n                            Click to select a video file or drag and drop\r\n                        </p>\r\n                        <p className=\"text-xs text-gray-500\">\r\n                            MP4, MOV, AVI, or any video format (Max 5GB)\r\n                        </p>\r\n                    </label>\r\n                </div>\r\n            )}\r\n\r\n            {selectedFile && uploadStatus === 'idle' && (\r\n                <div className=\"border border-gray-300 dark:border-gray-700 rounded-lg p-4\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <div className=\"flex items-center space-x-3\">\r\n                            <Video className=\"h-8 w-8 text-blue-500\" />\r\n                            <div>\r\n                                <p className=\"font-medium\">{selectedFile.name}</p>\r\n                                <p className=\"text-sm text-gray-500\">\r\n                                    {(selectedFile.size / (1024 * 1024)).toFixed(2)} MB\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        <Button variant=\"ghost\" size=\"sm\" onClick={reset}>\r\n                            Change\r\n                        </Button>\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                        <Button onClick={startUpload} className=\"flex-1\">\r\n                            <UploadIcon className=\"mr-2 h-4 w-4\" />\r\n                            Start Upload\r\n                        </Button>\r\n                        <Button variant=\"outline\" onClick={reset}>\r\n                            Cancel\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {uploadStatus === 'uploading' && (\r\n                <div className=\"border border-blue-300 dark:border-blue-700 rounded-lg p-4 bg-blue-50 dark:bg-blue-950\">\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                        <div className=\"flex items-center space-x-2\">\r\n                            <Loader2 className=\"h-4 w-4 animate-spin text-blue-600\" />\r\n                            <span className=\"font-medium\">Uploading...</span>\r\n                        </div>\r\n                        <span className=\"text-sm font-medium\">{uploadProgress}%</span>\r\n                    </div>\r\n                    <Progress value={uploadProgress} className=\"mb-2\" />\r\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                        {selectedFile?.name}\r\n                    </p>\r\n                    <Button variant=\"outline\" size=\"sm\" onClick={cancelUpload} className=\"mt-2\">\r\n                        Cancel Upload\r\n                    </Button>\r\n                </div>\r\n            )}\r\n\r\n            {uploadStatus === 'processing' && (\r\n                <Alert className=\"bg-yellow-50 border-yellow-200 dark:bg-yellow-950 dark:border-yellow-800\">\r\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                    <AlertDescription>\r\n                        <strong>Processing video...</strong>\r\n                        <p className=\"text-sm mt-1\">\r\n                            Your video is being encoded. This may take a few minutes.\r\n                        </p>\r\n                    </AlertDescription>\r\n                </Alert>\r\n            )}\r\n\r\n            {uploadStatus === 'success' && (\r\n                <Alert className=\"bg-green-50 border-green-200 dark:bg-green-950 dark:border-green-800\">\r\n                    <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\r\n                    <AlertDescription>\r\n                        <strong>Upload successful!</strong>\r\n                        <p className=\"text-sm mt-1\">\r\n                            Your video has been uploaded and is ready to use.\r\n                        </p>\r\n                    </AlertDescription>\r\n                </Alert>\r\n            )}\r\n\r\n            {uploadStatus === 'error' && (\r\n                <Alert className=\"bg-red-50 border-red-200 dark:bg-red-950 dark:border-red-800\">\r\n                    <XCircle className=\"h-4 w-4 text-red-600\" />\r\n                    <AlertDescription>\r\n                        <strong>Upload failed</strong>\r\n                        <p className=\"text-sm mt-1\">{errorMessage}</p>\r\n                        <Button variant=\"outline\" size=\"sm\" onClick={reset} className=\"mt-2\">\r\n                            Try Again\r\n                        </Button>\r\n                    </AlertDescription>\r\n                </Alert>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2088, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/BunnyPlayer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\n\r\ninterface BunnyPlayerProps {\r\n    videoId: string;\r\n    libraryId: string;\r\n    videoType: 'vod' | 'live';\r\n    videoStatus?: 'processing' | 'ready' | 'live' | 'ended' | 'error';\r\n    className?: string;\r\n    onComplete?: () => void;\r\n}\r\n\r\nexport function BunnyPlayer({\r\n    videoId,\r\n    libraryId,\r\n    videoType,\r\n    videoStatus = 'ready',\r\n    className = '',\r\n    onComplete\r\n}: BunnyPlayerProps) {\r\n    const [isLive, setIsLive] = useState(videoStatus === 'live');\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Poll for live status if it's a live stream\r\n    useEffect(() => {\r\n        if (videoType === 'live' && videoStatus !== 'live') {\r\n            const interval = setInterval(async () => {\r\n                try {\r\n                    // You can add an API call here to check live status\r\n                    // For now, we'll rely on the videoStatus prop\r\n                } catch (err) {\r\n                    console.error('Failed to check live status:', err);\r\n                }\r\n            }, 10000); // Check every 10 seconds\r\n\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [videoType, videoStatus]);\r\n\r\n    // Generate embed URL\r\n    const embedUrl = `https://iframe.mediadelivery.net/embed/${libraryId}/${videoId}?autoplay=false&preload=true`;\r\n\r\n    // Handle different states\r\n    if (videoStatus === 'processing') {\r\n        return (\r\n            <div className={`flex items-center justify-center bg-gray-900 text-white ${className}`}>\r\n                <div className=\"text-center p-8\">\r\n                    <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4\"></div>\r\n                    <p className=\"text-lg font-semibold\">Processing Video...</p>\r\n                    <p className=\"text-sm text-gray-400 mt-2\">This may take a few minutes</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (videoStatus === 'error') {\r\n        return (\r\n            <div className={`flex items-center justify-center bg-gray-900 text-white ${className}`}>\r\n                <div className=\"text-center p-8\">\r\n                    <svg className=\"w-16 h-16 text-red-500 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    <p className=\"text-lg font-semibold\">Video Error</p>\r\n                    <p className=\"text-sm text-gray-400 mt-2\">Failed to load video. Please try again later.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (videoType === 'live' && videoStatus !== 'live') {\r\n        return (\r\n            <div className={`flex items-center justify-center bg-linear-to-br from-gray-900 to-gray-800 text-white ${className}`}>\r\n                <div className=\"text-center p-8\">\r\n                    <div className=\"relative inline-block mb-4\">\r\n                        <svg className=\"w-20 h-20 text-gray-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                            <path d=\"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z\" />\r\n                        </svg>\r\n                        <span className=\"absolute -top-1 -right-1 flex h-6 w-6\">\r\n                            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\r\n                            <span className=\"relative inline-flex rounded-full h-6 w-6 bg-red-500 items-center justify-center text-xs font-bold\">\r\n                                LIVE\r\n                            </span>\r\n                        </span>\r\n                    </div>\r\n                    <p className=\"text-xl font-bold mb-2\">Stream Scheduled</p>\r\n                    <p className=\"text-gray-400\">Waiting for instructor to start the live session...</p>\r\n                    <div className=\"mt-4 flex items-center justify-center space-x-2\">\r\n                        <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }}></div>\r\n                        <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }}></div>\r\n                        <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }}></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Render the video player\r\n    return (\r\n        <div className={`relative ${className}`}>\r\n            {videoType === 'live' && videoStatus === 'live' && (\r\n                <div className=\"absolute top-4 left-4 z-10 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center space-x-2\">\r\n                    <span className=\"w-2 h-2 bg-white rounded-full animate-pulse\"></span>\r\n                    <span>LIVE</span>\r\n                </div>\r\n            )}\r\n            <iframe\r\n                src={embedUrl}\r\n                loading=\"lazy\"\r\n                style={{\r\n                    border: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0\r\n                }}\r\n                allow=\"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture; fullscreen\"\r\n                allowFullScreen\r\n                onError={() => setError('Failed to load video player')}\r\n            />\r\n            {error && (\r\n                <div className=\"absolute inset-0 flex items-center justify-center bg-gray-900 text-white\">\r\n                    <p>{error}</p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2423, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ExamSettingsDialog.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { createClient } from \"@/lib/supabase/client\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n    DialogDescription,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { toast } from \"sonner\";\r\nimport { Loader2, Calendar, Eye, EyeOff, Clock, Lock } from \"lucide-react\";\r\nimport { Exam } from \"@/lib/types\";\r\n\r\ninterface ExamSettingsDialogProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    examId: string;\r\n    onSettingsUpdated?: (exam: Exam) => void;\r\n}\r\n\r\nexport function ExamSettingsDialog({\r\n    open,\r\n    onOpenChange,\r\n    examId,\r\n    onSettingsUpdated\r\n}: ExamSettingsDialogProps) {\r\n    const [loading, setLoading] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n    const [exam, setExam] = useState<Exam | null>(null);\r\n\r\n    // Form state - Result visibility\r\n    const [resultVisibility, setResultVisibility] = useState<\"immediate\" | \"scheduled\" | \"manual\">(\"immediate\");\r\n    const [releaseDate, setReleaseDate] = useState(\"\");\r\n    const [releaseTime, setReleaseTime] = useState(\"\");\r\n    const [showAnswers, setShowAnswers] = useState(true);\r\n\r\n    // Form state - Exam scheduling\r\n    const [startDate, setStartDate] = useState(\"\");\r\n    const [startTime, setStartTime] = useState(\"\");\r\n    const [endDate, setEndDate] = useState(\"\");\r\n    const [endTime, setEndTime] = useState(\"\");\r\n\r\n    // Form state - Sequential access\r\n    const [sequentialUnlockEnabled, setSequentialUnlockEnabled] = useState(false);\r\n\r\n    // Form state - Exam scheduling toggle\r\n    const [isSchedulingEnabled, setIsSchedulingEnabled] = useState(false);\r\n\r\n    // Form state - Max attempts\r\n    const [maxAttempts, setMaxAttempts] = useState<number | null>(null);\r\n\r\n    const supabase = createClient();\r\n\r\n    useEffect(() => {\r\n        if (open && examId) {\r\n            fetchExamSettings();\r\n        }\r\n    }, [open, examId]);\r\n\r\n    const fetchExamSettings = async () => {\r\n        try {\r\n            setLoading(true);\r\n\r\n            // Fetch exam data\r\n            const { data, error } = await supabase\r\n                .from(\"exams\")\r\n                .select(\"*\")\r\n                .eq(\"id\", examId)\r\n                .single();\r\n\r\n            if (error) throw error;\r\n\r\n            // Set exam settings\r\n            setExam(data);\r\n            setResultVisibility((data as any).result_visibility || \"immediate\");\r\n            setShowAnswers((data as any).show_answers ?? true);\r\n\r\n            // Result release time\r\n            if ((data as any).result_release_time) {\r\n                const date = new Date((data as any).result_release_time);\r\n                setReleaseDate(date.toISOString().split('T')[0]);\r\n                const hours = date.getHours().toString().padStart(2, '0');\r\n                const minutes = date.getMinutes().toString().padStart(2, '0');\r\n                setReleaseTime(`${hours}:${minutes}`);\r\n            } else {\r\n                setReleaseDate(\"\");\r\n                setReleaseTime(\"\");\r\n            }\r\n\r\n            // Exam start time\r\n            if (data.start_time) {\r\n                const date = new Date(data.start_time);\r\n                setStartDate(date.toISOString().split('T')[0]);\r\n                const hours = date.getHours().toString().padStart(2, '0');\r\n                const minutes = date.getMinutes().toString().padStart(2, '0');\r\n                setStartTime(`${hours}:${minutes}`);\r\n            } else {\r\n                setStartDate(\"\");\r\n                setStartTime(\"\");\r\n            }\r\n\r\n            // Exam end time\r\n            if (data.end_time) {\r\n                const date = new Date(data.end_time);\r\n                setEndDate(date.toISOString().split('T')[0]);\r\n                const hours = date.getHours().toString().padStart(2, '0');\r\n                const minutes = date.getMinutes().toString().padStart(2, '0');\r\n                setEndTime(`${hours}:${minutes}`);\r\n            } else {\r\n                setEndDate(\"\");\r\n                setEndTime(\"\");\r\n            }\r\n\r\n            // Load sequential unlock from LESSONS table (not exams!)\r\n            const { data: lessonData } = await supabase\r\n                .from(\"lessons\")\r\n                .select(\"sequential_unlock_enabled\")\r\n                .eq(\"exam_id\", examId)\r\n                .eq(\"content_type\", \"quiz\")\r\n                .single();\r\n\r\n            setSequentialUnlockEnabled(lessonData?.sequential_unlock_enabled || false);\r\n\r\n            // Load max_attempts\r\n            setMaxAttempts(data.max_attempts ?? null);\r\n\r\n            // Set scheduling enabled if start or end time exists\r\n            setIsSchedulingEnabled(!!(data.start_time || data.end_time));\r\n\r\n        } catch (error) {\r\n            console.error(\"Error fetching exam settings:\", error);\r\n            toast.error(\"Failed to load exam settings\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setSaving(true);\r\n        try {\r\n            let releaseTimestamp = null;\r\n            let startTimestamp = null;\r\n            let endTimestamp = null;\r\n\r\n            // Validate result release time\r\n            if (resultVisibility === \"scheduled\") {\r\n                if (!releaseDate || !releaseTime) {\r\n                    toast.error(\"Please select both date and time for scheduled release\");\r\n                    setSaving(false);\r\n                    return;\r\n                }\r\n                releaseTimestamp = new Date(`${releaseDate}T${releaseTime}`).toISOString();\r\n            }\r\n\r\n            // Validate exam start/end time only if scheduling is enabled\r\n            if (isSchedulingEnabled) {\r\n                if (startDate && startTime) {\r\n                    startTimestamp = new Date(`${startDate}T${startTime}`).toISOString();\r\n                } else if (startDate || startTime) {\r\n                    toast.error(\"Please select both date and time for exam start\");\r\n                    setSaving(false);\r\n                    return;\r\n                }\r\n\r\n                if (endDate && endTime) {\r\n                    endTimestamp = new Date(`${endDate}T${endTime}`).toISOString();\r\n                } else if (endDate || endTime) {\r\n                    toast.error(\"Please select both date and time for exam end\");\r\n                    setSaving(false);\r\n                    return;\r\n                }\r\n\r\n                // Validate start time is before end time\r\n                if (startTimestamp && endTimestamp && new Date(startTimestamp) >= new Date(endTimestamp)) {\r\n                    toast.error(\"Exam start time must be before end time\");\r\n                    setSaving(false);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Handle sequential unlock for ALL lessons using this exam\r\n            // Find all lessons that use this exam\r\n            const { data: allLessonsWithExam, error: currentLessonError } = await supabase\r\n                .from(\"lessons\")\r\n                .select(\"id, title, lesson_order, module_id, modules(course_id, module_order, title)\")\r\n                .eq(\"exam_id\", examId)\r\n                .eq(\"content_type\", \"quiz\");\r\n\r\n            if (currentLessonError) {\r\n                console.error(\"Error fetching current lesson:\", currentLessonError);\r\n            }\r\n\r\n            if (!allLessonsWithExam || allLessonsWithExam.length === 0) {\r\n                toast.error(\"This exam is not linked to any lesson in a course\");\r\n                setSaving(false);\r\n                return;\r\n            }\r\n\r\n            // Process each lesson separately\r\n            for (const currentLesson of allLessonsWithExam) {\r\n                if (!(currentLesson as any).modules?.course_id) {\r\n                    console.warn(\"âš ï¸ Lesson has no course:\", currentLesson);\r\n                    continue;\r\n                }\r\n\r\n                const currentLessonId = currentLesson.id;\r\n                const courseId = (currentLesson as any).modules.course_id;\r\n                const courseName = (currentLesson as any).modules.title;\r\n                let prerequisiteLessonId: string | null = null;\r\n\r\n                if (sequentialUnlockEnabled) {\r\n                    // TOGGLE ON: Find previous quiz lesson\r\n                    const currentModuleOrder = (currentLesson as any).modules.module_order;\r\n                    const currentLessonOrder = currentLesson.lesson_order;\r\n\r\n                    // Get ALL quiz lessons in this course\r\n                    const { data: allQuizLessons, error: lessonsError } = await supabase\r\n                        .from(\"lessons\")\r\n                        .select(`\r\n                            id,\r\n                            exam_id,\r\n                            lesson_order,\r\n                            module_id,\r\n                            title,\r\n                            modules!inner(course_id, module_order)\r\n                        `)\r\n                        .eq(\"content_type\", \"quiz\")\r\n                        .not(\"exam_id\", \"is\", null)\r\n                        .eq(\"modules.course_id\", courseId);\r\n\r\n                    if (lessonsError) {\r\n                        console.error(\"Error fetching quiz lessons:\", lessonsError);\r\n                    }\r\n\r\n                    if (allQuizLessons && allQuizLessons.length > 1) {\r\n                        // Sort quiz lessons by module order, then lesson order\r\n                        const sortedLessons = allQuizLessons.sort((a: any, b: any) => {\r\n                            if (a.modules.module_order !== b.modules.module_order) {\r\n                                return a.modules.module_order - b.modules.module_order;\r\n                            }\r\n                            return a.lesson_order - b.lesson_order;\r\n                        });\r\n\r\n                        // Find current lesson index\r\n                        const currentIndex = sortedLessons.findIndex((l: any) => l.id === currentLessonId);\r\n\r\n                        // If there's a previous quiz lesson, use it as prerequisite\r\n                        if (currentIndex > 0) {\r\n                            prerequisiteLessonId = sortedLessons[currentIndex - 1].id;\r\n                        }\r\n                    }\r\n                } else {\r\n                    // TOGGLE OFF: Clear prerequisite\r\n                    prerequisiteLessonId = null;\r\n                }\r\n\r\n                // Update this specific lesson\r\n                const { error: lessonError } = await supabase\r\n                    .from(\"lessons\")\r\n                    .update({\r\n                        prerequisite_lesson_id: prerequisiteLessonId,\r\n                        sequential_unlock_enabled: sequentialUnlockEnabled,\r\n                    })\r\n                    .eq(\"id\", currentLessonId);\r\n\r\n                if (lessonError) {\r\n                    console.error(`Error updating lesson in ${courseName}:`, lessonError);\r\n                }\r\n            } // End of for loop\r\n\r\n\r\n            // Update EXAM settings (start/end time, result visibility, etc.)\r\n            const examUpdates: any = {\r\n                result_visibility: resultVisibility,\r\n                result_release_time: releaseTimestamp,\r\n                show_answers: showAnswers,\r\n                start_time: startTimestamp,\r\n                end_time: endTimestamp,\r\n                max_attempts: maxAttempts,\r\n                updated_at: new Date().toISOString(),\r\n            };\r\n\r\n            const { error: examError } = await supabase\r\n                .from(\"exams\")\r\n                .update(examUpdates)\r\n                .eq(\"id\", examId);\r\n\r\n            if (examError) throw examError;\r\n\r\n            toast.success(\"Exam settings updated\");\r\n            // Re-fetch the exam to get the updated lesson data for onSettingsUpdated\r\n            const { data: updatedExamData, error: fetchError } = await supabase\r\n                .from(\"exams\")\r\n                .select(\"*, lessons(prerequisite_lesson_id, sequential_unlock_enabled)\")\r\n                .eq(\"id\", examId)\r\n                .single();\r\n\r\n            if (fetchError) {\r\n                console.error(\"Error re-fetching exam after update:\", fetchError);\r\n                toast.error(\"Failed to re-fetch exam data after update.\");\r\n            } else if (onSettingsUpdated) {\r\n                onSettingsUpdated(updatedExamData as Exam);\r\n            }\r\n            onOpenChange(false);\r\n        } catch (error) {\r\n            console.error(\"Error saving exam settings:\", JSON.stringify(error, null, 2));\r\n            toast.error(\"Failed to save settings\");\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"sm:max-w-[520px] max-h-[85vh] p-0 gap-0 dark:bg-slate-900 dark:border-slate-800\">\r\n                {/* Header - Fixed */}\r\n                <DialogHeader className=\"px-6 pt-6 pb-4 border-b dark:border-slate-800\">\r\n                    <DialogTitle className=\"text-xl font-semibold dark:text-white\">Exam Settings</DialogTitle>\r\n                    <DialogDescription className=\"text-sm dark:text-slate-400 mt-1\">\r\n                        Configure scheduling, prerequisites, and visibility\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                {loading ? (\r\n                    <div className=\"flex justify-center py-12\">\r\n                        <Loader2 className=\"h-8 w-8 animate-spin text-slate-400\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Scrollable Content */}\r\n                        <div className=\"overflow-y-auto px-6 py-5 space-y-6 custom-scrollbar\" style={{ maxHeight: 'calc(85vh - 180px)' }}>\r\n\r\n                            {/* Exam Scheduling Section */}\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Clock className=\"h-4 w-4 text-blue-500\" />\r\n                                    <h3 className=\"text-sm font-semibold dark:text-white\">Exam Scheduling</h3>\r\n                                </div>\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                    Set when students can access this exam\r\n                                </p>\r\n\r\n                                {/* Scheduling Toggle */}\r\n                                <div className=\"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-900/50\">\r\n                                    <div className=\"flex-1\">\r\n                                        <Label className=\"text-sm font-medium dark:text-blue-300\">Enable Scheduling</Label>\r\n                                        <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\r\n                                            Set specific start and end times for this exam\r\n                                        </p>\r\n                                    </div>\r\n                                    <Switch\r\n                                        checked={isSchedulingEnabled}\r\n                                        onCheckedChange={(checked) => {\r\n                                            setIsSchedulingEnabled(checked);\r\n                                            if (!checked) {\r\n                                                // Clear dates when disabled\r\n                                                setStartDate(\"\");\r\n                                                setStartTime(\"\");\r\n                                                setEndDate(\"\");\r\n                                                setEndTime(\"\");\r\n                                            }\r\n                                        }}\r\n                                    />\r\n                                </div>\r\n\r\n                                {isSchedulingEnabled && (\r\n                                    <>\r\n                                        <div className=\"grid grid-cols-2 gap-3\">\r\n                                            <div className=\"space-y-1.5\">\r\n                                                <Label className=\"text-xs font-medium dark:text-slate-300\">Start Date</Label>\r\n                                                <Input\r\n                                                    type=\"date\"\r\n                                                    value={startDate}\r\n                                                    onChange={(e) => setStartDate(e.target.value)}\r\n                                                    className=\"h-9 text-sm dark:bg-slate-800 dark:border-slate-700 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"space-y-1.5\">\r\n                                                <Label className=\"text-xs font-medium dark:text-slate-300\">Start Time</Label>\r\n                                                <Input\r\n                                                    type=\"time\"\r\n                                                    value={startTime}\r\n                                                    onChange={(e) => setStartTime(e.target.value)}\r\n                                                    className=\"h-9 text-sm dark:bg-slate-800 dark:border-slate-700 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"space-y-1.5\">\r\n                                                <Label className=\"text-xs font-medium dark:text-slate-300\">End Date</Label>\r\n                                                <Input\r\n                                                    type=\"date\"\r\n                                                    value={endDate}\r\n                                                    onChange={(e) => setEndDate(e.target.value)}\r\n                                                    className=\"h-9 text-sm dark:bg-slate-800 dark:border-slate-700 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"space-y-1.5\">\r\n                                                <Label className=\"text-xs font-medium dark:text-slate-300\">End Time</Label>\r\n                                                <Input\r\n                                                    type=\"time\"\r\n                                                    value={endTime}\r\n                                                    onChange={(e) => setEndTime(e.target.value)}\r\n                                                    className=\"h-9 text-sm dark:bg-slate-800 dark:border-slate-700 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                        {(startDate || endDate) && (\r\n                                            <p className=\"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-950/30 px-3 py-2 rounded-md\">\r\n                                                {startDate && !endDate && \"Accessible from start date onwards\"}\r\n                                                {!startDate && endDate && \"Accessible until end date\"}\r\n                                                {startDate && endDate && \"Accessible between specified dates\"}\r\n                                            </p>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n\r\n                                {!isSchedulingEnabled && (\r\n                                    <p className=\"text-xs text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 px-3 py-2 rounded-md\">\r\n                                        Exam is accessible anytime without time restrictions\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Prerequisites Section */}\r\n                            <div className=\"space-y-3 pt-3 border-t dark:border-slate-800\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Lock className=\"h-4 w-4 text-purple-500\" />\r\n                                    <h3 className=\"text-sm font-semibold dark:text-white\">Sequential Access</h3>\r\n                                </div>\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                    Control exam access order for students\r\n                                </p>\r\n\r\n                                <div className=\"flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-950/20 rounded-lg border border-purple-200 dark:border-purple-900/50\">\r\n                                    <div className=\"flex-1\">\r\n                                        <Label className=\"text-sm font-medium dark:text-purple-300\">Require Previous Exam Completion</Label>\r\n                                        <p className=\"text-xs text-purple-600 dark:text-purple-400 mt-1\">\r\n                                            Students must complete the previous exam in this course before accessing this one\r\n                                        </p>\r\n                                    </div>\r\n                                    <Switch\r\n                                        checked={sequentialUnlockEnabled}\r\n                                        onCheckedChange={setSequentialUnlockEnabled}\r\n                                    />\r\n                                </div>\r\n\r\n                                {sequentialUnlockEnabled && (\r\n                                    <div className=\"p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-900/50\">\r\n                                        <p className=\"text-xs text-blue-700 dark:text-blue-300\">\r\n                                            â„¹ï¸ <strong>How it works:</strong> Students can only start this exam after successfully submitting the previous exam in the course lesson order.\r\n                                        </p>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {!sequentialUnlockEnabled && (\r\n                                    <div className=\"p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700\">\r\n                                        <p className=\"text-xs text-slate-600 dark:text-slate-400\">\r\n                                            Students can access this exam anytime, regardless of other exam completion.\r\n                                        </p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Result Visibility Section */}\r\n                            <div className=\"space-y-3 pt-3 border-t dark:border-slate-800\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Eye className=\"h-4 w-4 text-green-500\" />\r\n                                    <h3 className=\"text-sm font-semibold dark:text-white\">Result Visibility</h3>\r\n                                </div>\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                    Control when students see their results\r\n                                </p>\r\n\r\n                                <Select\r\n                                    value={resultVisibility}\r\n                                    onValueChange={(value: any) => setResultVisibility(value)}\r\n                                >\r\n                                    <SelectTrigger className=\"h-9 text-sm dark:bg-slate-800 dark:border-slate-700 dark:text-white\">\r\n                                        <SelectValue />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent className=\"dark:bg-slate-800 dark:border-slate-700\">\r\n                                        <SelectItem value=\"immediate\" className=\"text-sm\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <Eye className=\"h-3.5 w-3.5 text-green-500\" />\r\n                                                <span>Immediate</span>\r\n                                            </div>\r\n                                        </SelectItem>\r\n                                        <SelectItem value=\"scheduled\" className=\"text-sm\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <Clock className=\"h-3.5 w-3.5 text-blue-500\" />\r\n                                                <span>Scheduled</span>\r\n                                            </div>\r\n                                        </SelectItem>\r\n                                        <SelectItem value=\"manual\" className=\"text-sm\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <EyeOff className=\"h-3.5 w-3.5 text-orange-500\" />\r\n                                                <span>Manual Release</span>\r\n                                            </div>\r\n                                        </SelectItem>\r\n                                    </SelectContent>\r\n                                </Select>\r\n\r\n                                {resultVisibility === \"scheduled\" && (\r\n                                    <div className=\"grid grid-cols-2 gap-3 p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700\">\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <Label className=\"text-xs font-medium dark:text-slate-300\">Release Date</Label>\r\n                                            <Input\r\n                                                type=\"date\"\r\n                                                value={releaseDate}\r\n                                                onChange={(e) => setReleaseDate(e.target.value)}\r\n                                                className=\"h-9 text-sm dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <Label className=\"text-xs font-medium dark:text-slate-300\">Release Time</Label>\r\n                                            <Input\r\n                                                type=\"time\"\r\n                                                value={releaseTime}\r\n                                                onChange={(e) => setReleaseTime(e.target.value)}\r\n                                                className=\"h-9 text-sm dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 px-3 py-2 rounded-md\">\r\n                                    {resultVisibility === \"immediate\" && \"Results shown immediately after submission\"}\r\n                                    {resultVisibility === \"scheduled\" && \"Results hidden until specified date and time\"}\r\n                                    {resultVisibility === \"manual\" && \"Results hidden until manually released\"}\r\n                                </p>\r\n                            </div>\r\n\r\n                            {/* Show Answers Toggle */}\r\n                            <div className=\"flex items-center justify-between pt-3 border-t dark:border-slate-800\">\r\n                                <div className=\"flex-1\">\r\n                                    <Label className=\"text-sm font-medium dark:text-white\">Show Answers</Label>\r\n                                    <p className=\"text-xs text-slate-500 dark:text-slate-400 mt-0.5\">\r\n                                        Display correct answers to students\r\n                                    </p>\r\n                                </div>\r\n                                <Switch\r\n                                    checked={showAnswers}\r\n                                    onCheckedChange={setShowAnswers}\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Max Attempts */}\r\n                            <div className=\"space-y-2 pt-3 border-t dark:border-slate-800\">\r\n                                <Label className=\"text-sm font-medium dark:text-white\">Maximum Attempts</Label>\r\n                                <Input\r\n                                    type=\"number\"\r\n                                    min=\"1\"\r\n                                    value={maxAttempts ?? \"\"}\r\n                                    onChange={(e) => setMaxAttempts(e.target.value ? parseInt(e.target.value) : null)}\r\n                                    placeholder=\"Unlimited\"\r\n                                    className=\"h-9 text-sm dark:bg-slate-800 dark:border-slate-700 dark:text-white\"\r\n                                />\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                    Leave empty for unlimited attempts. Set a number to limit how many times students can take this exam.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Footer - Fixed */}\r\n                        <DialogFooter className=\"px-6 py-4 border-t dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50\">\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                onClick={() => onOpenChange(false)}\r\n                                className=\"dark:bg-transparent dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800\"\r\n                            >\r\n                                Cancel\r\n                            </Button>\r\n                            <Button\r\n                                onClick={handleSave}\r\n                                disabled={saving || loading}\r\n                                className=\"bg-primary hover:bg-primary/90\"\r\n                            >\r\n                                {saving ? (\r\n                                    <>\r\n                                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                        Saving...\r\n                                    </>\r\n                                ) : (\r\n                                    \"Save Settings\"\r\n                                )}\r\n                            </Button>\r\n                        </DialogFooter>\r\n                    </>\r\n                )}\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3474, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/app/admin/courses/%5BcourseId%5D/builder/LessonEditor.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { createClient } from \"@/lib/supabase/client\";\r\nimport { Lesson, Course } from \"@/lib/types\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Video, FileText, File, HelpCircle, Trash, Save, Copy, Loader2 } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport dynamic from \"next/dynamic\";\r\nimport { BunnyUploader } from \"./BunnyUploader\";\r\nimport { BunnyPlayer } from \"@/components/BunnyPlayer\";\r\nimport { ExamSettingsDialog } from \"@/components/ExamSettingsDialog\";\r\n\r\n// Code split RichTextEditor\r\nconst RichTextEditor = dynamic(\r\n    () => import(\"@/components/RichTextEditor\").then((mod) => ({ default: mod.RichTextEditor })),\r\n    {\r\n        loading: () => (\r\n            <div className=\"flex items-center justify-center p-8 bg-gray-50 rounded-lg border border-gray-200\">\r\n                <Loader2 className=\"w-6 h-6 animate-spin text-indigo-600\" />\r\n            </div>\r\n        ),\r\n        ssr: false,\r\n    }\r\n);\r\n\r\n// Lazy load VideoPlayer\r\nconst VideoPlayer = dynamic(() => import(\"@/components/VideoPlayer\"), {\r\n    loading: () => (\r\n        <div className=\"aspect-video bg-slate-100 rounded-lg flex items-center justify-center\">\r\n            <Loader2 className=\"w-6 h-6 animate-spin text-indigo-600\" />\r\n        </div>\r\n    ),\r\n    ssr: false,\r\n});\r\n\r\ninterface LessonEditorProps {\r\n    lesson: Lesson;\r\n    course: Course;\r\n    onUpdate: (updates: Partial<Lesson>) => Promise<any>;\r\n    onDelete: (id: string) => void;\r\n}\r\n\r\nexport function LessonEditor({ lesson, course, onUpdate, onDelete }: LessonEditorProps) {\r\n    const [title, setTitle] = useState(lesson.title);\r\n    const [contentUrl, setContentUrl] = useState(lesson.content_url || \"\");\r\n    const [contentText, setContentText] = useState(lesson.content_text || \"\");\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [pdfFile, setPdfFile] = useState<File | null>(null);\r\n    const [showDeleteDialog, setShowDeleteDialog] = useState(false);\r\n    const [showExamSettings, setShowExamSettings] = useState(false);\r\n    const [availableExams, setAvailableExams] = useState<any[]>([]);\r\n    const [selectedExamId, setSelectedExamId] = useState(lesson.exam_id || \"\");\r\n    const [isLoadingExams, setIsLoadingExams] = useState(false);\r\n    const supabase = createClient();\r\n\r\n    // Load available exams for quiz lessons\r\n    useEffect(() => {\r\n        if (lesson.content_type === \"quiz\") {\r\n            loadAvailableExams();\r\n        }\r\n    }, [lesson.content_type]);\r\n\r\n    const loadAvailableExams = async () => {\r\n        setIsLoadingExams(true);\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from(\"exams\")\r\n                .select(\"id, title, status\")\r\n                .eq(\"status\", \"published\")\r\n                .order(\"created_at\", { ascending: false });\r\n\r\n            if (error) throw error;\r\n            setAvailableExams(data || []);\r\n        } catch (error) {\r\n            console.error(\"Error loading exams:\", error);\r\n        } finally {\r\n            setIsLoadingExams(false);\r\n        }\r\n    };\r\n\r\n    const handleExamChange = async (newExamId: string) => {\r\n        try {\r\n            await onUpdate({ exam_id: newExamId || null });\r\n            setSelectedExamId(newExamId);\r\n            toast.success(newExamId ? \"Exam linked successfully\" : \"Exam unlinked\");\r\n        } catch (error) {\r\n            console.error(\"Error updating exam:\", error);\r\n            toast.error(\"Failed to update exam\");\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setIsSaving(true);\r\n        try {\r\n            let finalContentUrl = contentUrl;\r\n\r\n            // Handle PDF upload if new file selected\r\n            if (lesson.content_type === \"pdf\" && pdfFile) {\r\n                const fileName = `course-content/${Date.now()}-${pdfFile.name.replace(/\\s+/g, \"_\")}`;\r\n                const { error: uploadError } = await supabase.storage\r\n                    .from(\"uploads\")\r\n                    .upload(fileName, pdfFile);\r\n\r\n                if (uploadError) throw uploadError;\r\n\r\n                const { data } = supabase.storage.from(\"uploads\").getPublicUrl(fileName);\r\n                finalContentUrl = data.publicUrl;\r\n            }\r\n\r\n            // Convert video URL to embed format\r\n            if (lesson.content_type === \"video\") {\r\n                finalContentUrl = convertToEmbedUrl(contentUrl);\r\n            }\r\n\r\n            const updates = {\r\n                title,\r\n                content_url: finalContentUrl,\r\n                content_text: contentText,\r\n                is_downloadable: lesson.is_downloadable,\r\n            };\r\n\r\n            // Optimistic Update: Don't await the result\r\n            onUpdate(updates).catch((error) => {\r\n\r\n                toast.error(\"Background save failed! Your work is preserved.\", {\r\n                    duration: Infinity,\r\n                    action: {\r\n                        label: \"Retry Save\",\r\n                        onClick: () => {\r\n                            toast.info(\"Retrying save...\");\r\n                            onUpdate(updates).then(() => toast.success(\"Retry successful!\"))\r\n                                .catch(() => toast.error(\"Retry failed again.\"));\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            toast.success(\"Saved\");\r\n        } catch (error: any) {\r\n\r\n            toast.error(error.message || \"Failed to update lesson\");\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col bg-white dark:bg-[#161b22]\">\r\n            <div className=\"p-4 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2 flex-1\">\r\n                    {lesson.content_type === \"video\" && <Video className=\"h-5 w-5 text-blue-500 dark:text-blue-400\" />}\r\n                    {lesson.content_type === \"text\" && <FileText className=\"h-5 w-5 text-green-500 dark:text-green-400\" />}\r\n                    {lesson.content_type === \"pdf\" && <File className=\"h-5 w-5 text-red-500 dark:text-red-400\" />}\r\n                    {lesson.content_type === \"quiz\" && <HelpCircle className=\"h-5 w-5 text-purple-500 dark:text-purple-400\" />}\r\n                    <Input\r\n                        value={title}\r\n                        onChange={(e) => setTitle(e.target.value)}\r\n                        className=\"font-semibold text-lg border-none shadow-none focus-visible:ring-0 px-0 bg-transparent dark:text-white\"\r\n                        placeholder=\"Lesson Title\"\r\n                    />\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <Switch\r\n                            id=\"free-preview-toggle\"\r\n                            checked={lesson.is_free_preview}\r\n                            onCheckedChange={(checked) => onUpdate({ is_free_preview: checked })}\r\n                        />\r\n                        <Label htmlFor=\"free-preview-toggle\" className=\"text-sm font-medium dark:text-slate-300 whitespace-nowrap\">Free Preview</Label>\r\n                    </div>\r\n                    <Button variant=\"outline\" size=\"sm\" onClick={() => setShowDeleteDialog(true)} className=\"dark:bg-transparent dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800 dark:hover:text-red-400\">\r\n                        <Trash className=\"h-4 w-4 mr-2\" />\r\n                        Delete\r\n                    </Button>\r\n                    <Button onClick={handleSave} disabled={isSaving}>\r\n                        <Save className=\"h-4 w-4 mr-2\" />\r\n                        {isSaving ? \"Saving...\" : \"Save\"}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\r\n                <AlertDialogContent className=\"dark:bg-[#161b22] dark:border-slate-800\">\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle className=\"dark:text-white\">Delete Lesson</AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"dark:text-slate-400\">\r\n                            Are you sure you want to delete \"{title}\"?\r\n                            {lesson.video_provider === 'bunny' && lesson.bunny_video_id && (\r\n                                <span className=\"block mt-2 text-amber-600 dark:text-amber-500\">\r\n                                    âš ï¸ This will also delete the associated video from Bunny.net.\r\n                                </span>\r\n                            )}\r\n                            <span className=\"block mt-2\">\r\n                                This action cannot be undone.\r\n                            </span>\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel className=\"dark:bg-transparent dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800\">Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={() => {\r\n                                onDelete(lesson.id);\r\n                                setShowDeleteDialog(false);\r\n                            }}\r\n                            className=\"bg-red-600 hover:bg-red-700 text-white\"\r\n                        >\r\n                            Delete\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            <div className=\"flex-1 overflow-y-auto p-6\">\r\n                <div className=\"max-w-4xl mx-auto space-y-6\">\r\n                    {lesson.content_type === \"video\" && (\r\n                        <>\r\n                            {/* Live Class - Show simple join button */}\r\n                            {lesson.is_live && lesson.meeting_url ? (\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"p-6 border-2 border-blue-200 dark:border-blue-800 rounded-lg bg-blue-50 dark:bg-blue-950\">\r\n                                        <div className=\"flex items-center justify-between mb-4\">\r\n                                            <div>\r\n                                                <h3 className=\"text-lg font-semibold text-blue-900 dark:text-blue-100\">Live Class Meeting</h3>\r\n                                                <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n                                                    Scheduled for: {lesson.meeting_date ? new Date(lesson.meeting_date).toLocaleString() : 'Not scheduled'}\r\n                                                </p>\r\n                                            </div>\r\n                                            <div className=\"px-3 py-1 bg-blue-600 text-white text-xs font-semibold rounded-full\">\r\n                                                {lesson.meeting_platform?.toUpperCase() || 'GOOGLE MEET'}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"space-y-3\">\r\n                                            <div>\r\n                                                <Label className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">Meeting URL</Label>\r\n                                                <div className=\"flex gap-2 mt-1\">\r\n                                                    <Input\r\n                                                        value={lesson.meeting_url}\r\n                                                        readOnly\r\n                                                        className=\"bg-white dark:bg-slate-900 font-mono text-sm\"\r\n                                                    />\r\n                                                    <Button\r\n                                                        variant=\"outline\"\r\n                                                        size=\"sm\"\r\n                                                        onClick={() => {\r\n                                                            navigator.clipboard.writeText(lesson.meeting_url || '');\r\n                                                            toast.success('Meeting URL copied!');\r\n                                                        }}\r\n                                                    >\r\n                                                        <Copy className=\"h-4 w-4\" />\r\n                                                    </Button>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <Button\r\n                                                onClick={() => lesson.meeting_url && window.open(lesson.meeting_url, '_blank', 'noopener,noreferrer')}\r\n                                                className=\"w-full h-12 text-base font-semibold bg-blue-600 hover:bg-blue-700\"\r\n                                                size=\"lg\"\r\n                                            >\r\n                                                <Video className=\"mr-2 h-5 w-5\" />\r\n                                                Start Live Class\r\n                                            </Button>\r\n\r\n                                            <p className=\"text-xs text-center text-blue-600 dark:text-blue-400\">\r\n                                                This will open the meeting in a new tab\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800\">\r\n                                        <h4 className=\"font-medium mb-2 text-sm\">ðŸ“ Instructions</h4>\r\n                                        <ul className=\"text-sm text-gray-600 dark:text-gray-400 space-y-1\">\r\n                                            <li>â€¢ Click \"Start Live Class\" to join the meeting</li>\r\n                                            <li>â€¢ Students will see a countdown and join button</li>\r\n                                            <li>â€¢ The meeting link is: {lesson.meeting_platform || 'Google Meet'}</li>\r\n                                        </ul>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                /* Regular Video Lesson - Show 3 tabs */\r\n                                <Tabs defaultValue=\"youtube\" className=\"w-full\">\r\n                                    <TabsList className=\"grid w-full grid-cols-3\">\r\n                                        <TabsTrigger value=\"youtube\">YouTube</TabsTrigger>\r\n                                        <TabsTrigger value=\"upload\">Upload Video</TabsTrigger>\r\n                                        <TabsTrigger value=\"live\">Go Live</TabsTrigger>\r\n                                    </TabsList>\r\n\r\n                                    <TabsContent value=\"youtube\" className=\"space-y-4\">\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label className=\"dark:text-slate-300\">Video URL</Label>\r\n                                            <Input\r\n                                                value={contentUrl}\r\n                                                onChange={(e) => setContentUrl(e.target.value)}\r\n                                                placeholder=\"https://www.youtube.com/watch?v=...\"\r\n                                                className=\"dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                                            />\r\n                                            <p className=\"text-xs text-slate-500 dark:text-slate-400\">Paste a YouTube or Vimeo URL</p>\r\n                                        </div>\r\n\r\n                                        {contentUrl && (\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label className=\"dark:text-slate-300\">Preview</Label>\r\n                                                <div className=\"aspect-video bg-black rounded-lg overflow-hidden border border-slate-200 dark:border-slate-800\">\r\n                                                    <VideoPlayer url={convertToEmbedUrl(contentUrl)} />\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </TabsContent>\r\n\r\n                                    <TabsContent value=\"upload\" className=\"space-y-4\">\r\n                                        <BunnyUploader\r\n                                            lessonTitle={title}\r\n                                            courseId={course.id}\r\n                                            courseTitle={course.title}\r\n                                            onUploadComplete={async (videoData) => {\r\n\r\n                                                const updates: Partial<Lesson> = {\r\n                                                    video_provider: 'bunny',\r\n                                                    video_type: 'vod',\r\n                                                    bunny_video_id: videoData.videoId,\r\n                                                    bunny_guid: videoData.guid,\r\n                                                    bunny_library_id: videoData.libraryId,\r\n                                                    video_status: 'ready',\r\n                                                    content_url: `https://iframe.mediadelivery.net/embed/${videoData.libraryId}/${videoData.guid}`\r\n                                                };\r\n\r\n                                                onUpdate(updates).then(() => {\r\n                                                    toast.success('Video uploaded and saved successfully!');\r\n                                                }).catch((error) => {\r\n\r\n                                                    toast.error('Video uploaded but save failed! Your work is preserved.', {\r\n                                                        duration: Infinity,\r\n                                                        action: {\r\n                                                            label: \"Retry Save\",\r\n                                                            onClick: () => {\r\n                                                                toast.info(\"Retrying save...\");\r\n                                                                onUpdate(updates).then(() => toast.success(\"Retry successful!\"))\r\n                                                                    .catch(() => toast.error(\"Retry failed again.\"));\r\n                                                            }\r\n                                                        }\r\n                                                    });\r\n                                                });\r\n                                            }}\r\n                                            onError={(error) => {\r\n                                                toast.error(error);\r\n                                            }}\r\n                                        />\r\n\r\n                                        {lesson.bunny_video_id && lesson.bunny_library_id && (\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label className=\"dark:text-slate-300\">Uploaded Video Preview</Label>\r\n                                                <div className=\"aspect-video bg-black rounded-lg overflow-hidden border border-slate-200 dark:border-slate-800\">\r\n                                                    <BunnyPlayer\r\n                                                        videoId={lesson.bunny_video_id}\r\n                                                        libraryId={lesson.bunny_library_id}\r\n                                                        videoType=\"vod\"\r\n                                                        videoStatus={lesson.video_status}\r\n                                                        className=\"w-full h-full\"\r\n                                                    />\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </TabsContent>\r\n                                </Tabs>\r\n                            )}\r\n                        </>\r\n                    )}\r\n\r\n\r\n                    {lesson.content_type === \"pdf\" && (\r\n                        <>\r\n                            <div className=\"space-y-2\">\r\n                                <Label className=\"dark:text-slate-300\">Upload New PDF (Optional)</Label>\r\n                                <Input\r\n                                    type=\"file\"\r\n                                    accept=\".pdf\"\r\n                                    onChange={(e) => setPdfFile(e.target.files?.[0] || null)}\r\n                                    className=\"dark:bg-slate-900 dark:border-slate-700 dark:text-white\"\r\n                                />\r\n                                {contentUrl && !pdfFile && (\r\n                                    <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                        Current file: <a href={contentUrl} target=\"_blank\" rel=\"noreferrer\" className=\"text-blue-600 hover:underline dark:text-blue-400\">View PDF</a>\r\n                                    </p>\r\n                                )}\r\n                                <div className=\"flex items-center space-x-2 pt-2\">\r\n                                    <Switch\r\n                                        id=\"is-downloadable\"\r\n                                        checked={lesson.is_downloadable ?? true}\r\n                                        onCheckedChange={(checked) => onUpdate({ ...lesson, is_downloadable: checked })}\r\n                                    />\r\n                                    <Label htmlFor=\"is-downloadable\" className=\"dark:text-slate-300\">Allow Download</Label>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {contentUrl && (\r\n                                <div className=\"space-y-2\">\r\n                                    <Label className=\"dark:text-slate-300\">Preview</Label>\r\n                                    <div className=\"aspect-video bg-slate-100 dark:bg-slate-900 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-800\">\r\n                                        <iframe\r\n                                            src={contentUrl}\r\n                                            className=\"w-full h-full\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </>\r\n                    )}\r\n\r\n                    {lesson.content_type === \"text\" && (\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"dark:text-slate-300\">Content</Label>\r\n                            <RichTextEditor\r\n                                value={contentText}\r\n                                onChange={setContentText}\r\n                                placeholder=\"Enter your lesson content here...\"\r\n                                className=\"min-h-[400px] dark:bg-slate-900 dark:border-slate-700\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {lesson.content_type === \"quiz\" && (\r\n                        <div className=\"space-y-6\">\r\n                            {/* Exam Selection */}\r\n                            <div className=\"p-6 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800\">\r\n                                <div className=\"flex items-center gap-2 mb-4\">\r\n                                    <HelpCircle className=\"h-5 w-5 text-purple-500\" />\r\n                                    <h3 className=\"text-lg font-medium text-slate-900 dark:text-white\">Exam Configuration</h3>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label className=\"text-sm font-medium dark:text-slate-300\">Linked Exam</Label>\r\n                                        {isLoadingExams ? (\r\n                                            <div className=\"text-sm text-slate-500\">Loading exams...</div>\r\n                                        ) : (\r\n                                            <select\r\n                                                className=\"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 dark:bg-slate-800 dark:border-slate-700 dark:text-white\"\r\n                                                value={selectedExamId}\r\n                                                onChange={(e) => handleExamChange(e.target.value)}\r\n                                            >\r\n                                                <option value=\"\">None - Upcoming Exam Placeholder</option>\r\n                                                {availableExams.map((exam) => (\r\n                                                    <option key={exam.id} value={exam.id}>\r\n                                                        {exam.title}\r\n                                                    </option>\r\n                                                ))}\r\n                                            </select>\r\n                                        )}\r\n                                        <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                            {selectedExamId\r\n                                                ? \"Students will take this exam when they access this lesson.\"\r\n                                                : \"This is a placeholder. Link an exam when ready.\"}\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    {selectedExamId && (\r\n                                        <Button\r\n                                            variant=\"outline\"\r\n                                            onClick={() => setShowExamSettings(true)}\r\n                                            className=\"w-full dark:bg-transparent dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800\"\r\n                                        >\r\n                                            Manage Exam Settings\r\n                                        </Button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {selectedExamId && (\r\n                                <ExamSettingsDialog\r\n                                    open={showExamSettings}\r\n                                    onOpenChange={setShowExamSettings}\r\n                                    examId={selectedExamId}\r\n                                />\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n}\r\n\r\n// Helper function to convert YouTube/Vimeo URLs to embed format\r\nfunction convertToEmbedUrl(url: string): string {\r\n    if (!url) return \"\";\r\n\r\n    // YouTube\r\n    const youtubeRegex = /(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/\\s]{11})/;\r\n    const youtubeMatch = url.match(youtubeRegex);\r\n    if (youtubeMatch) {\r\n        return `https://www.youtube.com/embed/${youtubeMatch[1]}`;\r\n    }\r\n\r\n    // Vimeo\r\n    const vimeoRegex = /vimeo\\.com\\/(?:.*\\/)?(\\\\d+)/;\r\n    const vimeoMatch = url.match(vimeoRegex);\r\n    if (vimeoMatch) {\r\n        return `https://player.vimeo.com/video/${vimeoMatch[1]}`;\r\n    }\r\n\r\n    return url;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4610, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/admin/EditableTitle.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { Edit2, Check, X } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface EditableTitleProps {\r\n    value: string;\r\n    onSave: (newValue: string) => void;\r\n    isLoading?: boolean;\r\n    className?: string;\r\n    placeholder?: string;\r\n}\r\n\r\nexport function EditableTitle({\r\n    value,\r\n    onSave,\r\n    isLoading = false,\r\n    className,\r\n    placeholder = \"Enter title\"\r\n}: EditableTitleProps) {\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [editValue, setEditValue] = useState(value);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (isEditing && inputRef.current) {\r\n            inputRef.current.focus();\r\n            inputRef.current.select();\r\n        }\r\n    }, [isEditing]);\r\n\r\n    useEffect(() => {\r\n        setEditValue(value);\r\n    }, [value]);\r\n\r\n    const handleSave = () => {\r\n        const trimmedValue = editValue.trim();\r\n        if (trimmedValue && trimmedValue !== value) {\r\n            onSave(trimmedValue);\r\n        }\r\n        setIsEditing(false);\r\n    };\r\n\r\n    const handleCancel = () => {\r\n        setEditValue(value);\r\n        setIsEditing(false);\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter') {\r\n            handleSave();\r\n        } else if (e.key === 'Escape') {\r\n            handleCancel();\r\n        }\r\n    };\r\n\r\n    if (isEditing) {\r\n        return (\r\n            <div className=\"flex items-center gap-2\">\r\n                <Input\r\n                    ref={inputRef}\r\n                    value={editValue}\r\n                    onChange={(e) => setEditValue(e.target.value)}\r\n                    onKeyDown={handleKeyDown}\r\n                    placeholder={placeholder}\r\n                    className={cn(\"h-8 text-sm\", className)}\r\n                    disabled={isLoading}\r\n                />\r\n                <Button\r\n                    size=\"sm\"\r\n                    variant=\"ghost\"\r\n                    onClick={handleSave}\r\n                    disabled={isLoading || !editValue.trim()}\r\n                    className=\"h-8 w-8 p-0\"\r\n                >\r\n                    <Check className=\"h-4 w-4 text-green-600\" />\r\n                </Button>\r\n                <Button\r\n                    size=\"sm\"\r\n                    variant=\"ghost\"\r\n                    onClick={handleCancel}\r\n                    disabled={isLoading}\r\n                    className=\"h-8 w-8 p-0\"\r\n                >\r\n                    <X className=\"h-4 w-4 text-red-600\" />\r\n                </Button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"group flex items-center gap-2\">\r\n            <h2\r\n                className={cn(\r\n                    \"font-semibold text-lg truncate text-slate-900 dark:text-white cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors\",\r\n                    className\r\n                )}\r\n                onClick={() => setIsEditing(true)}\r\n                title={`${value} (Click to edit)`}\r\n            >\r\n                {value}\r\n            </h2>\r\n            <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                onClick={() => setIsEditing(true)}\r\n                className=\"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n            >\r\n                <Edit2 className=\"h-3 w-3 text-slate-400\" />\r\n            </Button>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;;;AANA;;;;;;AAgBO,SAAS,cAAc,EAC1B,KAAK,EACL,MAAM,EACN,YAAY,KAAK,EACjB,SAAS,EACT,cAAc,aAAa,EACV;;IACjB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,WAAW,IAAA,uKAAM,EAAmB;IAE1C,IAAA,0KAAS;mCAAC;YACN,IAAI,aAAa,SAAS,OAAO,EAAE;gBAC/B,SAAS,OAAO,CAAC,KAAK;gBACtB,SAAS,OAAO,CAAC,MAAM;YAC3B;QACJ;kCAAG;QAAC;KAAU;IAEd,IAAA,0KAAS;mCAAC;YACN,aAAa;QACjB;kCAAG;QAAC;KAAM;IAEV,MAAM,aAAa;QACf,MAAM,eAAe,UAAU,IAAI;QACnC,IAAI,gBAAgB,iBAAiB,OAAO;YACxC,OAAO;QACX;QACA,aAAa;IACjB;IAEA,MAAM,eAAe;QACjB,aAAa;QACb,aAAa;IACjB;IAEA,MAAM,gBAAgB,CAAC;QACnB,IAAI,EAAE,GAAG,KAAK,SAAS;YACnB;QACJ,OAAO,IAAI,EAAE,GAAG,KAAK,UAAU;YAC3B;QACJ;IACJ;IAEA,IAAI,WAAW;QACX,qBACI,6LAAC;YAAI,WAAU;;8BACX,6LAAC,sIAAK;oBACF,KAAK;oBACL,OAAO;oBACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;oBAC5C,WAAW;oBACX,aAAa;oBACb,WAAW,IAAA,qHAAE,EAAC,eAAe;oBAC7B,UAAU;;;;;;8BAEd,6LAAC,wIAAM;oBACH,MAAK;oBACL,SAAQ;oBACR,SAAS;oBACT,UAAU,aAAa,CAAC,UAAU,IAAI;oBACtC,WAAU;8BAEV,cAAA,6LAAC,gNAAK;wBAAC,WAAU;;;;;;;;;;;8BAErB,6LAAC,wIAAM;oBACH,MAAK;oBACL,SAAQ;oBACR,SAAS;oBACT,UAAU;oBACV,WAAU;8BAEV,cAAA,6LAAC,oMAAC;wBAAC,WAAU;;;;;;;;;;;;;;;;;IAI7B;IAEA,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBACG,WAAW,IAAA,qHAAE,EACT,+IACA;gBAEJ,SAAS,IAAM,aAAa;gBAC5B,OAAO,GAAG,MAAM,gBAAgB,CAAC;0BAEhC;;;;;;0BAEL,6LAAC,wIAAM;gBACH,MAAK;gBACL,SAAQ;gBACR,SAAS,IAAM,aAAa;gBAC5B,WAAU;0BAEV,cAAA,6LAAC,8MAAK;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAIjC;GAnGgB;KAAA"}},
    {"offset": {"line": 4778, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ui/image-upload.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useRef } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ImagePlus, X, Loader2 } from \"lucide-react\";\r\nimport Image from \"next/image\";\r\nimport { toast } from \"sonner\";\r\nimport { createClient } from \"@/lib/supabase/client\";\r\n\r\ninterface ImageUploadProps {\r\n    value: string;\r\n    onChange: (url: string) => void;\r\n    disabled?: boolean;\r\n    maxSizeMB?: number;\r\n    maxWidth?: number;\r\n    maxHeight?: number;\r\n}\r\n\r\nexport function ImageUpload({\r\n    value,\r\n    onChange,\r\n    disabled,\r\n    maxSizeMB = 0.3, // Default 300KB\r\n    maxWidth = 600,\r\n    maxHeight = 400\r\n}: ImageUploadProps) {\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const supabase = createClient();\r\n\r\n    const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        // 1. Validate File Size\r\n        if (file.size > maxSizeMB * 1024 * 1024) {\r\n            toast.error(`File size must be less than ${maxSizeMB * 1000}KB`);\r\n            return;\r\n        }\r\n\r\n        // 2. Validate Dimensions\r\n        const img = new window.Image();\r\n        img.src = URL.createObjectURL(file);\r\n\r\n        img.onload = async () => {\r\n            URL.revokeObjectURL(img.src);\r\n\r\n            // Allow some tolerance or strict check? User said \"should be 600x400\".\r\n            // Let's warn but maybe allow if it's close? Or strictly enforce?\r\n            // \"Note: cover size should be 600x400\" sounds like a requirement.\r\n            // But usually exact pixel match is annoying. Let's check aspect ratio or max dimensions.\r\n            // Re-reading: \"cover size should be 600x400\". I will enforce it strictly for now as requested.\r\n\r\n            if (img.width !== maxWidth || img.height !== maxHeight) {\r\n                toast.error(`Image dimensions must be exactly ${maxWidth}x${maxHeight}px`);\r\n                return;\r\n            }\r\n\r\n            // 3. Upload to Supabase\r\n            try {\r\n                setIsUploading(true);\r\n\r\n                const fileExt = file.name.split('.').pop();\r\n                const fileName = `${Math.random().toString(36).substring(2)}.${fileExt}`;\r\n                const filePath = `course-thumbnails/${fileName}`;\r\n\r\n                const { error: uploadError } = await supabase.storage\r\n                    .from('courses')\r\n                    .upload(filePath, file);\r\n\r\n                if (uploadError) {\r\n                    throw uploadError;\r\n                }\r\n\r\n                const { data: { publicUrl } } = supabase.storage\r\n                    .from('courses')\r\n                    .getPublicUrl(filePath);\r\n\r\n                onChange(publicUrl);\r\n                toast.success(\"Thumbnail uploaded successfully\");\r\n            } catch (error) {\r\n                console.error(\"Upload error:\", error);\r\n\r\n                // Debug: Check available buckets\r\n                const { data: buckets, error: bucketError } = await supabase.storage.listBuckets();\r\n                // Buckets available\r\n                if (bucketError) console.error(\"Error listing buckets:\", bucketError);\r\n\r\n                toast.error(\"Failed to upload image: \" + (error as any).message);\r\n            } finally {\r\n                setIsUploading(false);\r\n            }\r\n        };\r\n\r\n        img.onerror = () => {\r\n            toast.error(\"Invalid image file\");\r\n            URL.revokeObjectURL(img.src);\r\n        };\r\n    };\r\n\r\n    const handleRemove = () => {\r\n        onChange(\"\");\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4 w-full flex flex-col justify-center items-center\">\r\n            <div className=\"relative w-full h-[200px] md:w-[300px] md:h-[200px] border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl flex flex-col items-center justify-center overflow-hidden bg-slate-50 dark:bg-slate-900 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors\">\r\n                {value && value !== 'NULL' && value !== 'null' ? (\r\n                    <>\r\n                        <div className=\"relative w-full h-full\">\r\n                            <Image\r\n                                fill\r\n                                src={value}\r\n                                alt=\"Upload\"\r\n                                className=\"object-cover\"\r\n                            />\r\n                        </div>\r\n                        <button\r\n                            onClick={handleRemove}\r\n                            className=\"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-sm\"\r\n                            type=\"button\"\r\n                            disabled={disabled}\r\n                        >\r\n                            <X className=\"h-4 w-4\" />\r\n                        </button>\r\n                    </>\r\n                ) : (\r\n                    <div className=\"flex flex-col items-center justify-center text-slate-500 dark:text-slate-400 p-4 text-center\">\r\n                        <ImagePlus className=\"h-10 w-10 mb-2 opacity-50\" />\r\n                        <p className=\"text-sm font-medium\">Click to upload thumbnail</p>\r\n                        <p className=\"text-xs text-slate-400 mt-1\">\r\n                            {maxWidth}x{maxHeight}px, max {maxSizeMB * 1000}KB\r\n                        </p>\r\n                    </div>\r\n                )}\r\n\r\n                <input\r\n                    ref={fileInputRef}\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed\"\r\n                    onChange={handleFileSelect}\r\n                    disabled={disabled || isUploading}\r\n                />\r\n\r\n                {isUploading && (\r\n                    <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center z-10\">\r\n                        <Loader2 className=\"h-8 w-8 animate-spin text-white\" />\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4987, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/hooks/useCourseModules.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { createClient } from \"@/lib/supabase/client\";\r\nimport { Module, Lesson } from \"@/lib/types\";\r\nimport { toast } from \"sonner\";\r\n\r\nexport interface ModuleWithLessons extends Module {\r\n    lessons: Lesson[];\r\n}\r\n\r\nexport const useCourseModules = (courseId: string, initialData: ModuleWithLessons[]) => {\r\n    const supabase = createClient();\r\n    const queryClient = useQueryClient();\r\n    const queryKey = [\"course-modules\", courseId];\r\n\r\n    // Main Query\r\n    const { data: modules = initialData, isLoading, refetch } = useQuery({\r\n        queryKey,\r\n        queryFn: async () => {\r\n            // OPTIMIZED: Use RPC first\r\n            const { data, error } = await supabase\r\n                .rpc('get_course_structure', { target_course_id: courseId });\r\n\r\n            if (error) {\r\n                // Fallback to standard query if RPC fails\r\n                const { data: fallbackData, error: fallbackError } = await supabase\r\n                    .from(\"modules\")\r\n                    .select(\"*, lessons(*)\")\r\n                    .eq(\"course_id\", courseId)\r\n                    .order(\"module_order\", { ascending: true });\r\n\r\n                if (fallbackError) throw fallbackError;\r\n\r\n                // Sort lessons by order\r\n                return fallbackData.map((m: any) => ({\r\n                    ...m,\r\n                    lessons: (m.lessons || []).sort((a: any, b: any) => a.lesson_order - b.lesson_order)\r\n                })) as ModuleWithLessons[];\r\n            }\r\n\r\n            // RPC returns fully structured data\r\n            return data as ModuleWithLessons[];\r\n        },\r\n        initialData,\r\n        staleTime: 1000 * 60 * 5, // 5 minutes\r\n    });\r\n\r\n    // Helper to optimistically update cache\r\n    const updateCache = (updater: (old: ModuleWithLessons[]) => ModuleWithLessons[]) => {\r\n        queryClient.setQueryData(queryKey, (old: ModuleWithLessons[] | undefined) => {\r\n            return updater(old || []);\r\n        });\r\n    };\r\n\r\n    // --- Module Mutations ---\r\n\r\n    const addModuleMutation = useMutation({\r\n        mutationFn: async (title: string) => {\r\n            const currentModules = queryClient.getQueryData<ModuleWithLessons[]>(queryKey) || [];\r\n            const newOrder = currentModules.length > 0 ? currentModules[currentModules.length - 1].module_order + 1 : 1;\r\n\r\n            const { data, error } = await supabase\r\n                .from(\"modules\")\r\n                .insert({ course_id: courseId, title, module_order: newOrder })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            return { ...data, lessons: [] } as ModuleWithLessons;\r\n        },\r\n        onMutate: async (title) => {\r\n            await queryClient.cancelQueries({ queryKey });\r\n            const previousModules = queryClient.getQueryData<ModuleWithLessons[]>(queryKey);\r\n\r\n            // Optimistic update\r\n            const tempId = `temp-${Date.now()}`;\r\n            updateCache((old) => [\r\n                ...old,\r\n                {\r\n                    id: tempId,\r\n                    course_id: courseId,\r\n                    title,\r\n                    module_order: (old.length || 0) + 1,\r\n                    created_at: new Date().toISOString(),\r\n                    updated_at: new Date().toISOString(),\r\n                    lessons: []\r\n                } as unknown as ModuleWithLessons\r\n            ]);\r\n\r\n            return { previousModules };\r\n        },\r\n        onError: (err, title, context) => {\r\n            if (context?.previousModules) {\r\n                queryClient.setQueryData(queryKey, context.previousModules);\r\n            }\r\n            toast.error(\"Failed to add module\");\r\n        },\r\n        onSettled: () => {\r\n            queryClient.invalidateQueries({ queryKey });\r\n        },\r\n    });\r\n\r\n    const updateModuleMutation = useMutation({\r\n        mutationFn: async ({ id, title }: { id: string; title: string }) => {\r\n            const { error } = await supabase\r\n                .from(\"modules\")\r\n                .update({ title })\r\n                .eq(\"id\", id);\r\n            if (error) throw error;\r\n            return { id, title };\r\n        },\r\n        onMutate: async ({ id, title }) => {\r\n            await queryClient.cancelQueries({ queryKey });\r\n            const previousModules = queryClient.getQueryData<ModuleWithLessons[]>(queryKey);\r\n\r\n            updateCache((old) => old.map(m => m.id === id ? { ...m, title } : m));\r\n\r\n            return { previousModules };\r\n        },\r\n        onError: (err, vars, context) => {\r\n            if (context?.previousModules) {\r\n                queryClient.setQueryData(queryKey, context.previousModules);\r\n            }\r\n            toast.error(\"Failed to update module\");\r\n        },\r\n        onSettled: () => {\r\n            queryClient.invalidateQueries({ queryKey });\r\n        },\r\n    });\r\n\r\n    const deleteModuleMutation = useMutation({\r\n        mutationFn: async (moduleId: string) => {\r\n            const { error } = await supabase.from(\"modules\").delete().eq(\"id\", moduleId);\r\n            if (error) throw error;\r\n        },\r\n        onMutate: async (moduleId) => {\r\n            await queryClient.cancelQueries({ queryKey });\r\n            const previousModules = queryClient.getQueryData<ModuleWithLessons[]>(queryKey);\r\n\r\n            updateCache((old) => old.filter(m => m.id !== moduleId));\r\n            toast.success(\"Chapter deleted\"); // Instant feedback\r\n\r\n            return { previousModules };\r\n        },\r\n        onError: (err, moduleId, context) => {\r\n            if (context?.previousModules) {\r\n                queryClient.setQueryData(queryKey, context.previousModules);\r\n            }\r\n            toast.error(\"Failed to delete chapter\");\r\n        },\r\n        onSettled: () => {\r\n            queryClient.invalidateQueries({ queryKey });\r\n        },\r\n    });\r\n\r\n    // --- Lesson Mutations ---\r\n\r\n    const deleteLessonMutation = useMutation({\r\n        mutationFn: async (lesson: Lesson) => {\r\n            // Background Bunny.net deletion\r\n            if (lesson.video_provider === 'bunny' && lesson.bunny_video_id) {\r\n                // Non-blocking fetch - we catch errors but don't stop the flow\r\n                fetch('/api/bunny/delete', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ videoId: lesson.bunny_video_id })\r\n                }).catch(() => {\r\n                    // Silently fail - background deletion is not critical\r\n                });\r\n            }\r\n\r\n            const { error } = await supabase.from(\"lessons\").delete().eq(\"id\", lesson.id);\r\n            if (error) throw error;\r\n        },\r\n        onMutate: async (lesson) => {\r\n            await queryClient.cancelQueries({ queryKey });\r\n            const previousModules = queryClient.getQueryData<ModuleWithLessons[]>(queryKey);\r\n\r\n            // Optimistic Remove\r\n            updateCache((old) => old.map(m => ({\r\n                ...m,\r\n                lessons: m.lessons.filter(l => l.id !== lesson.id)\r\n            })));\r\n\r\n            toast.success(\"Lesson deleted\");\r\n\r\n            return { previousModules };\r\n        },\r\n        onError: (err, lesson, context) => {\r\n            if (context?.previousModules) {\r\n                queryClient.setQueryData(queryKey, context.previousModules);\r\n            }\r\n            toast.error(\"Failed to delete lesson\");\r\n        },\r\n        onSettled: () => {\r\n            queryClient.invalidateQueries({ queryKey });\r\n        },\r\n    });\r\n\r\n    const addLessonMutation = useMutation({\r\n        mutationFn: async (lessonData: Partial<Lesson>) => {\r\n            const { data, error } = await supabase\r\n                .from(\"lessons\")\r\n                .insert(lessonData)\r\n                .select()\r\n                .single();\r\n            if (error) throw error;\r\n            return data as Lesson;\r\n        },\r\n        onMutate: async (lessonData) => {\r\n            await queryClient.cancelQueries({ queryKey });\r\n            const previousModules = queryClient.getQueryData<ModuleWithLessons[]>(queryKey);\r\n\r\n            const tempId = `temp-${Date.now()}`;\r\n            const optimisticLesson = {\r\n                ...lessonData,\r\n                id: tempId,\r\n                created_at: new Date().toISOString(),\r\n                updated_at: new Date().toISOString(),\r\n                is_free_preview: false,\r\n                content_text: lessonData.content_type === \"text\" ? \"Upcoming content...\" : \"\",\r\n                content_url: \"\",\r\n            } as Lesson;\r\n\r\n            updateCache((old) => old.map(m => {\r\n                if (m.id === lessonData.module_id) {\r\n                    return {\r\n                        ...m,\r\n                        lessons: [...m.lessons, optimisticLesson]\r\n                    };\r\n                }\r\n                return m;\r\n            }));\r\n\r\n            return { previousModules };\r\n        },\r\n        onSuccess: () => {\r\n            // Invalidate to get the real ID\r\n            setTimeout(() => {\r\n                queryClient.invalidateQueries({ queryKey });\r\n            }, 100); // Small delay to smoothing transition if needed, or immediate\r\n        },\r\n        onError: (err, newLesson, context) => {\r\n            if (context?.previousModules) {\r\n                queryClient.setQueryData(queryKey, context.previousModules);\r\n            }\r\n            toast.error(\"Failed to add lesson: \" + err.message);\r\n        }\r\n    });\r\n\r\n    const updateLessonMutation = useMutation({\r\n        mutationFn: async (lesson: Partial<Lesson> & { id: string }) => {\r\n            const { data, error } = await supabase\r\n                .from(\"lessons\")\r\n                .update(lesson)\r\n                .eq(\"id\", lesson.id)\r\n                .select()\r\n                .single();\r\n            if (error) throw error;\r\n            return data as Lesson;\r\n        },\r\n        onMutate: async (updatedLesson) => {\r\n            await queryClient.cancelQueries({ queryKey });\r\n            const previousModules = queryClient.getQueryData<ModuleWithLessons[]>(queryKey);\r\n\r\n            updateCache((old) => old.map(m => ({\r\n                ...m,\r\n                lessons: m.lessons.map(l => l.id === updatedLesson.id ? { ...l, ...updatedLesson } as Lesson : l)\r\n            })));\r\n\r\n            return { previousModules };\r\n        },\r\n        onError: (err, vars, context) => {\r\n            if (context?.previousModules) {\r\n                queryClient.setQueryData(queryKey, context.previousModules);\r\n            }\r\n            toast.error(\"Failed to update lesson\");\r\n        },\r\n        onSettled: () => {\r\n            queryClient.invalidateQueries({ queryKey });\r\n        }\r\n    });\r\n\r\n    // --- Reorder Mutations ---\r\n\r\n    const reorderModulesMutation = useMutation({\r\n        mutationFn: async (orderedModules: { id: string; module_order: number }[]) => {\r\n            const updates = orderedModules.map((m) =>\r\n                supabase.from(\"modules\").update({ module_order: m.module_order }).eq(\"id\", m.id)\r\n            );\r\n            await Promise.all(updates);\r\n        },\r\n        onMutate: async (orderedModules) => {\r\n            await queryClient.cancelQueries({ queryKey });\r\n            const previousModules = queryClient.getQueryData<ModuleWithLessons[]>(queryKey);\r\n\r\n            updateCache((old) => {\r\n                const orderMap = new Map(orderedModules.map((m) => [m.id, m.module_order]));\r\n                const newModules = [...old].map((m) => ({\r\n                    ...m,\r\n                    module_order: orderMap.get(m.id) ?? m.module_order,\r\n                }));\r\n                return newModules.sort((a, b) => a.module_order - b.module_order);\r\n            });\r\n\r\n            return { previousModules };\r\n        },\r\n        onError: (err, _, context) => {\r\n            if (context?.previousModules) {\r\n                queryClient.setQueryData(queryKey, context.previousModules);\r\n            }\r\n            toast.error(\"Failed to reorder modules\");\r\n        },\r\n        onSettled: () => {\r\n            queryClient.invalidateQueries({ queryKey });\r\n        }\r\n    });\r\n\r\n    const reorderLessonsMutation = useMutation({\r\n        mutationFn: async (orderedLessons: { id: string; lesson_order: number; module_id: string }[]) => {\r\n            // Ensure all lessons belong to the correct module just in case\r\n            const updates = orderedLessons.map((l) =>\r\n                supabase.from(\"lessons\").update({ lesson_order: l.lesson_order, module_id: l.module_id }).eq(\"id\", l.id)\r\n            );\r\n            await Promise.all(updates);\r\n        },\r\n        onMutate: async (orderedLessons) => {\r\n            await queryClient.cancelQueries({ queryKey });\r\n            const previousModules = queryClient.getQueryData<ModuleWithLessons[]>(queryKey);\r\n\r\n            updateCache((old) => {\r\n                return old.map((m) => {\r\n                    const lessonsUpdateMap = new Map(orderedLessons.filter(l => l.module_id === m.id).map(l => [l.id, l.lesson_order]));\r\n\r\n                    const newLessons = m.lessons.map(l => {\r\n                        const newOrder = orderedLessons.find(ol => ol.id === l.id);\r\n                        if (newOrder) {\r\n                            return { ...l, lesson_order: newOrder.lesson_order, module_id: newOrder.module_id };\r\n                        }\r\n                        return l;\r\n                    });\r\n\r\n                    if (lessonsUpdateMap.size > 0) {\r\n                        return {\r\n                            ...m,\r\n                            lessons: newLessons.sort((a, b) => a.lesson_order - b.lesson_order)\r\n                        };\r\n                    }\r\n                    return m;\r\n                });\r\n            });\r\n\r\n            return { previousModules };\r\n        },\r\n        onError: (err, _, context) => {\r\n            if (context?.previousModules) {\r\n                queryClient.setQueryData(queryKey, context.previousModules);\r\n            }\r\n            toast.error(\"Failed to reorder lessons\");\r\n        },\r\n        onSettled: () => {\r\n            queryClient.invalidateQueries({ queryKey });\r\n        }\r\n    });\r\n\r\n    return {\r\n        modules,\r\n        isLoading,\r\n        refetch,\r\n        addModule: addModuleMutation.mutateAsync,\r\n        isAddingModule: addModuleMutation.isPending,\r\n        updateModule: updateModuleMutation.mutateAsync,\r\n        deleteModule: deleteModuleMutation.mutateAsync,\r\n        addLesson: addLessonMutation.mutateAsync,\r\n        isAddingLesson: addLessonMutation.isPending,\r\n        updateLesson: updateLessonMutation.mutateAsync,\r\n        reorderModules: reorderModulesMutation.mutateAsync,\r\n        reorderLessons: reorderLessonsMutation.mutateAsync,\r\n        deleteLesson: deleteLessonMutation.mutateAsync,\r\n    };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AAAA;AACA;AAEA;;;;;AAMO,MAAM,mBAAmB,CAAC,UAAkB;;IAC/C,MAAM,WAAW,IAAA,4IAAY;IAC7B,MAAM,cAAc,IAAA,2MAAc;IAClC,MAAM,WAAW;QAAC;QAAkB;KAAS;IAE7C,aAAa;IACb,MAAM,EAAE,MAAM,UAAU,WAAW,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,IAAA,0LAAQ,EAAC;QACjE;QACA,OAAO;yCAAE;gBACL,2BAA2B;gBAC3B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,GAAG,CAAC,wBAAwB;oBAAE,kBAAkB;gBAAS;gBAE9D,IAAI,OAAO;oBACP,0CAA0C;oBAC1C,MAAM,EAAE,MAAM,YAAY,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACtD,IAAI,CAAC,WACL,MAAM,CAAC,iBACP,EAAE,CAAC,aAAa,UAChB,KAAK,CAAC,gBAAgB;wBAAE,WAAW;oBAAK;oBAE7C,IAAI,eAAe,MAAM;oBAEzB,wBAAwB;oBACxB,OAAO,aAAa,GAAG;qDAAC,CAAC,IAAW,CAAC;gCACjC,GAAG,CAAC;gCACJ,SAAS,CAAC,EAAE,OAAO,IAAI,EAAE,EAAE,IAAI;iEAAC,CAAC,GAAQ,IAAW,EAAE,YAAY,GAAG,EAAE,YAAY;;4BACvF,CAAC;;gBACL;gBAEA,oCAAoC;gBACpC,OAAO;YACX;;QACA;QACA,WAAW,OAAO,KAAK;IAC3B;IAEA,wCAAwC;IACxC,MAAM,cAAc,CAAC;QACjB,YAAY,YAAY,CAAC,UAAU,CAAC;YAChC,OAAO,QAAQ,OAAO,EAAE;QAC5B;IACJ;IAEA,2BAA2B;IAE3B,MAAM,oBAAoB,IAAA,gMAAW,EAAC;QAClC,UAAU;+DAAE,OAAO;gBACf,MAAM,iBAAiB,YAAY,YAAY,CAAsB,aAAa,EAAE;gBACpF,MAAM,WAAW,eAAe,MAAM,GAAG,IAAI,cAAc,CAAC,eAAe,MAAM,GAAG,EAAE,CAAC,YAAY,GAAG,IAAI;gBAE1G,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,WACL,MAAM,CAAC;oBAAE,WAAW;oBAAU;oBAAO,cAAc;gBAAS,GAC5D,MAAM,GACN,MAAM;gBAEX,IAAI,OAAO,MAAM;gBACjB,OAAO;oBAAE,GAAG,IAAI;oBAAE,SAAS,EAAE;gBAAC;YAClC;;QACA,QAAQ;+DAAE,OAAO;gBACb,MAAM,YAAY,aAAa,CAAC;oBAAE;gBAAS;gBAC3C,MAAM,kBAAkB,YAAY,YAAY,CAAsB;gBAEtE,oBAAoB;gBACpB,MAAM,SAAS,CAAC,KAAK,EAAE,KAAK,GAAG,IAAI;gBACnC;uEAAY,CAAC,MAAQ;+BACd;4BACH;gCACI,IAAI;gCACJ,WAAW;gCACX;gCACA,cAAc,CAAC,IAAI,MAAM,IAAI,CAAC,IAAI;gCAClC,YAAY,IAAI,OAAO,WAAW;gCAClC,YAAY,IAAI,OAAO,WAAW;gCAClC,SAAS,EAAE;4BACf;yBACH;;gBAED,OAAO;oBAAE;gBAAgB;YAC7B;;QACA,OAAO;+DAAE,CAAC,KAAK,OAAO;gBAClB,IAAI,SAAS,iBAAiB;oBAC1B,YAAY,YAAY,CAAC,UAAU,QAAQ,eAAe;gBAC9D;gBACA,oJAAK,CAAC,KAAK,CAAC;YAChB;;QACA,SAAS;+DAAE;gBACP,YAAY,iBAAiB,CAAC;oBAAE;gBAAS;YAC7C;;IACJ;IAEA,MAAM,uBAAuB,IAAA,gMAAW,EAAC;QACrC,UAAU;kEAAE,OAAO,EAAE,EAAE,EAAE,KAAK,EAAiC;gBAC3D,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACnB,IAAI,CAAC,WACL,MAAM,CAAC;oBAAE;gBAAM,GACf,EAAE,CAAC,MAAM;gBACd,IAAI,OAAO,MAAM;gBACjB,OAAO;oBAAE;oBAAI;gBAAM;YACvB;;QACA,QAAQ;kEAAE,OAAO,EAAE,EAAE,EAAE,KAAK,EAAE;gBAC1B,MAAM,YAAY,aAAa,CAAC;oBAAE;gBAAS;gBAC3C,MAAM,kBAAkB,YAAY,YAAY,CAAsB;gBAEtE;0EAAY,CAAC,MAAQ,IAAI,GAAG;kFAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK;oCAAE,GAAG,CAAC;oCAAE;gCAAM,IAAI;;;gBAElE,OAAO;oBAAE;gBAAgB;YAC7B;;QACA,OAAO;kEAAE,CAAC,KAAK,MAAM;gBACjB,IAAI,SAAS,iBAAiB;oBAC1B,YAAY,YAAY,CAAC,UAAU,QAAQ,eAAe;gBAC9D;gBACA,oJAAK,CAAC,KAAK,CAAC;YAChB;;QACA,SAAS;kEAAE;gBACP,YAAY,iBAAiB,CAAC;oBAAE;gBAAS;YAC7C;;IACJ;IAEA,MAAM,uBAAuB,IAAA,gMAAW,EAAC;QACrC,UAAU;kEAAE,OAAO;gBACf,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,WAAW,MAAM,GAAG,EAAE,CAAC,MAAM;gBACnE,IAAI,OAAO,MAAM;YACrB;;QACA,QAAQ;kEAAE,OAAO;gBACb,MAAM,YAAY,aAAa,CAAC;oBAAE;gBAAS;gBAC3C,MAAM,kBAAkB,YAAY,YAAY,CAAsB;gBAEtE;0EAAY,CAAC,MAAQ,IAAI,MAAM;kFAAC,CAAA,IAAK,EAAE,EAAE,KAAK;;;gBAC9C,oJAAK,CAAC,OAAO,CAAC,oBAAoB,mBAAmB;gBAErD,OAAO;oBAAE;gBAAgB;YAC7B;;QACA,OAAO;kEAAE,CAAC,KAAK,UAAU;gBACrB,IAAI,SAAS,iBAAiB;oBAC1B,YAAY,YAAY,CAAC,UAAU,QAAQ,eAAe;gBAC9D;gBACA,oJAAK,CAAC,KAAK,CAAC;YAChB;;QACA,SAAS;kEAAE;gBACP,YAAY,iBAAiB,CAAC;oBAAE;gBAAS;YAC7C;;IACJ;IAEA,2BAA2B;IAE3B,MAAM,uBAAuB,IAAA,gMAAW,EAAC;QACrC,UAAU;kEAAE,OAAO;gBACf,gCAAgC;gBAChC,IAAI,OAAO,cAAc,KAAK,WAAW,OAAO,cAAc,EAAE;oBAC5D,+DAA+D;oBAC/D,MAAM,qBAAqB;wBACvB,QAAQ;wBACR,SAAS;4BAAE,gBAAgB;wBAAmB;wBAC9C,MAAM,KAAK,SAAS,CAAC;4BAAE,SAAS,OAAO,cAAc;wBAAC;oBAC1D,GAAG,KAAK;8EAAC;wBACL,sDAAsD;wBAC1D;;gBACJ;gBAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,WAAW,MAAM,GAAG,EAAE,CAAC,MAAM,OAAO,EAAE;gBAC5E,IAAI,OAAO,MAAM;YACrB;;QACA,QAAQ;kEAAE,OAAO;gBACb,MAAM,YAAY,aAAa,CAAC;oBAAE;gBAAS;gBAC3C,MAAM,kBAAkB,YAAY,YAAY,CAAsB;gBAEtE,oBAAoB;gBACpB;0EAAY,CAAC,MAAQ,IAAI,GAAG;kFAAC,CAAA,IAAK,CAAC;oCAC/B,GAAG,CAAC;oCACJ,SAAS,EAAE,OAAO,CAAC,MAAM;8FAAC,CAAA,IAAK,EAAE,EAAE,KAAK,OAAO,EAAE;;gCACrD,CAAC;;;gBAED,oJAAK,CAAC,OAAO,CAAC;gBAEd,OAAO;oBAAE;gBAAgB;YAC7B;;QACA,OAAO;kEAAE,CAAC,KAAK,QAAQ;gBACnB,IAAI,SAAS,iBAAiB;oBAC1B,YAAY,YAAY,CAAC,UAAU,QAAQ,eAAe;gBAC9D;gBACA,oJAAK,CAAC,KAAK,CAAC;YAChB;;QACA,SAAS;kEAAE;gBACP,YAAY,iBAAiB,CAAC;oBAAE;gBAAS;YAC7C;;IACJ;IAEA,MAAM,oBAAoB,IAAA,gMAAW,EAAC;QAClC,UAAU;+DAAE,OAAO;gBACf,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,WACL,MAAM,CAAC,YACP,MAAM,GACN,MAAM;gBACX,IAAI,OAAO,MAAM;gBACjB,OAAO;YACX;;QACA,QAAQ;+DAAE,OAAO;gBACb,MAAM,YAAY,aAAa,CAAC;oBAAE;gBAAS;gBAC3C,MAAM,kBAAkB,YAAY,YAAY,CAAsB;gBAEtE,MAAM,SAAS,CAAC,KAAK,EAAE,KAAK,GAAG,IAAI;gBACnC,MAAM,mBAAmB;oBACrB,GAAG,UAAU;oBACb,IAAI;oBACJ,YAAY,IAAI,OAAO,WAAW;oBAClC,YAAY,IAAI,OAAO,WAAW;oBAClC,iBAAiB;oBACjB,cAAc,WAAW,YAAY,KAAK,SAAS,wBAAwB;oBAC3E,aAAa;gBACjB;gBAEA;uEAAY,CAAC,MAAQ,IAAI,GAAG;+EAAC,CAAA;gCACzB,IAAI,EAAE,EAAE,KAAK,WAAW,SAAS,EAAE;oCAC/B,OAAO;wCACH,GAAG,CAAC;wCACJ,SAAS;+CAAI,EAAE,OAAO;4CAAE;yCAAiB;oCAC7C;gCACJ;gCACA,OAAO;4BACX;;;gBAEA,OAAO;oBAAE;gBAAgB;YAC7B;;QACA,SAAS;+DAAE;gBACP,gCAAgC;gBAChC;uEAAW;wBACP,YAAY,iBAAiB,CAAC;4BAAE;wBAAS;oBAC7C;sEAAG,MAAM,8DAA8D;YAC3E;;QACA,OAAO;+DAAE,CAAC,KAAK,WAAW;gBACtB,IAAI,SAAS,iBAAiB;oBAC1B,YAAY,YAAY,CAAC,UAAU,QAAQ,eAAe;gBAC9D;gBACA,oJAAK,CAAC,KAAK,CAAC,2BAA2B,IAAI,OAAO;YACtD;;IACJ;IAEA,MAAM,uBAAuB,IAAA,gMAAW,EAAC;QACrC,UAAU;kEAAE,OAAO;gBACf,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,WACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,OAAO,EAAE,EAClB,MAAM,GACN,MAAM;gBACX,IAAI,OAAO,MAAM;gBACjB,OAAO;YACX;;QACA,QAAQ;kEAAE,OAAO;gBACb,MAAM,YAAY,aAAa,CAAC;oBAAE;gBAAS;gBAC3C,MAAM,kBAAkB,YAAY,YAAY,CAAsB;gBAEtE;0EAAY,CAAC,MAAQ,IAAI,GAAG;kFAAC,CAAA,IAAK,CAAC;oCAC/B,GAAG,CAAC;oCACJ,SAAS,EAAE,OAAO,CAAC,GAAG;8FAAC,CAAA,IAAK,EAAE,EAAE,KAAK,cAAc,EAAE,GAAG;gDAAE,GAAG,CAAC;gDAAE,GAAG,aAAa;4CAAC,IAAc;;gCACnG,CAAC;;;gBAED,OAAO;oBAAE;gBAAgB;YAC7B;;QACA,OAAO;kEAAE,CAAC,KAAK,MAAM;gBACjB,IAAI,SAAS,iBAAiB;oBAC1B,YAAY,YAAY,CAAC,UAAU,QAAQ,eAAe;gBAC9D;gBACA,oJAAK,CAAC,KAAK,CAAC;YAChB;;QACA,SAAS;kEAAE;gBACP,YAAY,iBAAiB,CAAC;oBAAE;gBAAS;YAC7C;;IACJ;IAEA,4BAA4B;IAE5B,MAAM,yBAAyB,IAAA,gMAAW,EAAC;QACvC,UAAU;oEAAE,OAAO;gBACf,MAAM,UAAU,eAAe,GAAG;oFAAC,CAAC,IAChC,SAAS,IAAI,CAAC,WAAW,MAAM,CAAC;4BAAE,cAAc,EAAE,YAAY;wBAAC,GAAG,EAAE,CAAC,MAAM,EAAE,EAAE;;gBAEnF,MAAM,QAAQ,GAAG,CAAC;YACtB;;QACA,QAAQ;oEAAE,OAAO;gBACb,MAAM,YAAY,aAAa,CAAC;oBAAE;gBAAS;gBAC3C,MAAM,kBAAkB,YAAY,YAAY,CAAsB;gBAEtE;4EAAY,CAAC;wBACT,MAAM,WAAW,IAAI,IAAI,eAAe,GAAG;oFAAC,CAAC,IAAM;oCAAC,EAAE,EAAE;oCAAE,EAAE,YAAY;iCAAC;;wBACzE,MAAM,aAAa;+BAAI;yBAAI,CAAC,GAAG;+FAAC,CAAC,IAAM,CAAC;oCACpC,GAAG,CAAC;oCACJ,cAAc,SAAS,GAAG,CAAC,EAAE,EAAE,KAAK,EAAE,YAAY;gCACtD,CAAC;;wBACD,OAAO,WAAW,IAAI;oFAAC,CAAC,GAAG,IAAM,EAAE,YAAY,GAAG,EAAE,YAAY;;oBACpE;;gBAEA,OAAO;oBAAE;gBAAgB;YAC7B;;QACA,OAAO;oEAAE,CAAC,KAAK,GAAG;gBACd,IAAI,SAAS,iBAAiB;oBAC1B,YAAY,YAAY,CAAC,UAAU,QAAQ,eAAe;gBAC9D;gBACA,oJAAK,CAAC,KAAK,CAAC;YAChB;;QACA,SAAS;oEAAE;gBACP,YAAY,iBAAiB,CAAC;oBAAE;gBAAS;YAC7C;;IACJ;IAEA,MAAM,yBAAyB,IAAA,gMAAW,EAAC;QACvC,UAAU;oEAAE,OAAO;gBACf,+DAA+D;gBAC/D,MAAM,UAAU,eAAe,GAAG;oFAAC,CAAC,IAChC,SAAS,IAAI,CAAC,WAAW,MAAM,CAAC;4BAAE,cAAc,EAAE,YAAY;4BAAE,WAAW,EAAE,SAAS;wBAAC,GAAG,EAAE,CAAC,MAAM,EAAE,EAAE;;gBAE3G,MAAM,QAAQ,GAAG,CAAC;YACtB;;QACA,QAAQ;oEAAE,OAAO;gBACb,MAAM,YAAY,aAAa,CAAC;oBAAE;gBAAS;gBAC3C,MAAM,kBAAkB,YAAY,YAAY,CAAsB;gBAEtE;4EAAY,CAAC;wBACT,OAAO,IAAI,GAAG;oFAAC,CAAC;gCACZ,MAAM,mBAAmB,IAAI,IAAI,eAAe,MAAM;4FAAC,CAAA,IAAK,EAAE,SAAS,KAAK,EAAE,EAAE;2FAAE,GAAG;4FAAC,CAAA,IAAK;4CAAC,EAAE,EAAE;4CAAE,EAAE,YAAY;yCAAC;;gCAEjH,MAAM,aAAa,EAAE,OAAO,CAAC,GAAG;uGAAC,CAAA;wCAC7B,MAAM,WAAW,eAAe,IAAI;wHAAC,CAAA,KAAM,GAAG,EAAE,KAAK,EAAE,EAAE;;wCACzD,IAAI,UAAU;4CACV,OAAO;gDAAE,GAAG,CAAC;gDAAE,cAAc,SAAS,YAAY;gDAAE,WAAW,SAAS,SAAS;4CAAC;wCACtF;wCACA,OAAO;oCACX;;gCAEA,IAAI,iBAAiB,IAAI,GAAG,GAAG;oCAC3B,OAAO;wCACH,GAAG,CAAC;wCACJ,SAAS,WAAW,IAAI;oGAAC,CAAC,GAAG,IAAM,EAAE,YAAY,GAAG,EAAE,YAAY;;oCACtE;gCACJ;gCACA,OAAO;4BACX;;oBACJ;;gBAEA,OAAO;oBAAE;gBAAgB;YAC7B;;QACA,OAAO;oEAAE,CAAC,KAAK,GAAG;gBACd,IAAI,SAAS,iBAAiB;oBAC1B,YAAY,YAAY,CAAC,UAAU,QAAQ,eAAe;gBAC9D;gBACA,oJAAK,CAAC,KAAK,CAAC;YAChB;;QACA,SAAS;oEAAE;gBACP,YAAY,iBAAiB,CAAC;oBAAE;gBAAS;YAC7C;;IACJ;IAEA,OAAO;QACH;QACA;QACA;QACA,WAAW,kBAAkB,WAAW;QACxC,gBAAgB,kBAAkB,SAAS;QAC3C,cAAc,qBAAqB,WAAW;QAC9C,cAAc,qBAAqB,WAAW;QAC9C,WAAW,kBAAkB,WAAW;QACxC,gBAAgB,kBAAkB,SAAS;QAC3C,cAAc,qBAAqB,WAAW;QAC9C,gBAAgB,uBAAuB,WAAW;QAClD,gBAAgB,uBAAuB,WAAW;QAClD,cAAc,qBAAqB,WAAW;IAClD;AACJ;GAlXa;;QAEW,2MAAc;QAI0B,0LAAQ;QAwC1C,gMAAW;QA8CR,gMAAW;QA4BX,gMAAW;QA2BX,gMAAW;QA0Cd,gMAAW;QAmDR,gMAAW;QAmCT,gMAAW;QAiCX,gMAAW"}},
    {"offset": {"line": 5550, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/updateCourseMetadata.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createAdminClient } from '@/lib/supabase/admin';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Update course metadata (title and/or thumbnail_url)\r\n */\r\nexport async function updateCourseMetadata(data: {\r\n    courseId: string;\r\n    title?: string;\r\n    thumbnailUrl?: string;\r\n}) {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Check authentication\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            return { error: 'Unauthorized' };\r\n        }\r\n\r\n        // Check admin permission\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return { error: 'Admin access required' };\r\n        }\r\n\r\n        // Prepare update data\r\n        const updateData: any = {\r\n            updated_at: new Date().toISOString()\r\n        };\r\n\r\n        if (data.title !== undefined) {\r\n            updateData.title = data.title;\r\n        }\r\n\r\n        if (data.thumbnailUrl !== undefined) {\r\n            updateData.thumbnail_url = data.thumbnailUrl;\r\n        }\r\n\r\n        // Update course\r\n        const { data: course, error } = await supabase\r\n            .from('courses')\r\n            .update(updateData)\r\n            .eq('id', data.courseId)\r\n            .select()\r\n            .single();\r\n\r\n        if (error) {\r\n            console.error('Course update error:', error);\r\n            throw new Error(`Failed to update course: ${error.message}`);\r\n        }\r\n\r\n        // Revalidate relevant paths\r\n        revalidatePath('/admin/courses');\r\n        revalidatePath(`/admin/courses/${data.courseId}`);\r\n        revalidatePath(`/admin/courses/${data.courseId}/builder`);\r\n        revalidatePath(`/courses/${data.courseId}`);\r\n\r\n        return { success: true, data: course };\r\n    } catch (error: any) {\r\n        console.error('updateCourseMetadata error:', error);\r\n        return { error: error?.message || 'Failed to update course metadata' };\r\n    }\r\n}\r\n\r\n/**\r\n * Upload course thumbnail to Supabase Storage\r\n */\r\nexport async function uploadCourseThumbnail(data: {\r\n    courseId: string;\r\n    file: File;\r\n}) {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Check authentication\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            return { error: 'Unauthorized' };\r\n        }\r\n\r\n        // Check admin permission\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return { error: 'Admin access required' };\r\n        }\r\n\r\n        // Validate file type\r\n        const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n        if (!validTypes.includes(data.file.type)) {\r\n            return { error: 'Invalid file type. Please upload a JPG, PNG, or WebP image.' };\r\n        }\r\n\r\n        // Validate file size (5MB max)\r\n        const maxSize = 5 * 1024 * 1024; // 5MB\r\n        if (data.file.size > maxSize) {\r\n            return { error: 'File size too large. Maximum size is 5MB.' };\r\n        }\r\n\r\n        // Get current course to check for existing thumbnail\r\n        const { data: course } = await supabase\r\n            .from('courses')\r\n            .select('thumbnail_url')\r\n            .eq('id', data.courseId)\r\n            .single();\r\n\r\n        // Delete old thumbnail if exists\r\n        if (course?.thumbnail_url) {\r\n            const oldPath = course.thumbnail_url.split('/').pop();\r\n            if (oldPath) {\r\n                await supabase.storage\r\n                    .from('course-thumbnails')\r\n                    .remove([`${data.courseId}/${oldPath}`]);\r\n            }\r\n        }\r\n\r\n        // Generate unique filename\r\n        const fileExt = data.file.name.split('.').pop();\r\n        const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n        const filePath = `${data.courseId}/${fileName}`;\r\n\r\n        // Upload to Supabase Storage\r\n        const { data: uploadData, error: uploadError } = await supabase.storage\r\n            .from('course-thumbnails')\r\n            .upload(filePath, data.file, {\r\n                cacheControl: '3600',\r\n                upsert: false\r\n            });\r\n\r\n        if (uploadError) {\r\n            console.error('Upload error:', uploadError);\r\n            throw new Error(`Failed to upload file: ${uploadError.message}`);\r\n        }\r\n\r\n        // Get public URL\r\n        const { data: { publicUrl } } = supabase.storage\r\n            .from('course-thumbnails')\r\n            .getPublicUrl(filePath);\r\n\r\n        // Update course with new thumbnail URL\r\n        const { error: updateError } = await supabase\r\n            .from('courses')\r\n            .update({\r\n                thumbnail_url: publicUrl,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', data.courseId);\r\n\r\n        if (updateError) {\r\n            console.error('Course update error:', updateError);\r\n            // Try to clean up uploaded file\r\n            await supabase.storage\r\n                .from('course-thumbnails')\r\n                .remove([filePath]);\r\n            throw new Error(`Failed to update course: ${updateError.message}`);\r\n        }\r\n\r\n        // Revalidate relevant paths\r\n        revalidatePath('/admin/courses');\r\n        revalidatePath(`/admin/courses/${data.courseId}`);\r\n        revalidatePath(`/admin/courses/${data.courseId}/builder`);\r\n        revalidatePath(`/courses/${data.courseId}`);\r\n\r\n        return { success: true, data: { url: publicUrl } };\r\n    } catch (error: any) {\r\n        console.error('uploadCourseThumbnail error:', error);\r\n        return { error: error?.message || 'Failed to upload thumbnail' };\r\n    }\r\n}\r\n\r\n/**\r\n * Delete course thumbnail\r\n */\r\nexport async function deleteCourseThumbnail(courseId: string) {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Check authentication\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            return { error: 'Unauthorized' };\r\n        }\r\n\r\n        // Check admin permission\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return { error: 'Admin access required' };\r\n        }\r\n\r\n        // Get current course\r\n        const { data: course } = await supabase\r\n            .from('courses')\r\n            .select('thumbnail_url')\r\n            .eq('id', courseId)\r\n            .single();\r\n\r\n        // Delete thumbnail from storage\r\n        if (course?.thumbnail_url) {\r\n            const oldPath = course.thumbnail_url.split('/').pop();\r\n            if (oldPath) {\r\n                await supabase.storage\r\n                    .from('course-thumbnails')\r\n                    .remove([`${courseId}/${oldPath}`]);\r\n            }\r\n        }\r\n\r\n        // Update course to remove thumbnail URL\r\n        const { error: updateError } = await supabase\r\n            .from('courses')\r\n            .update({\r\n                thumbnail_url: null,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', courseId);\r\n\r\n        if (updateError) {\r\n            console.error('Course update error:', updateError);\r\n            throw new Error(`Failed to update course: ${updateError.message}`);\r\n        }\r\n\r\n        // Revalidate relevant paths\r\n        revalidatePath('/admin/courses');\r\n        revalidatePath(`/admin/courses/${courseId}`);\r\n        revalidatePath(`/admin/courses/${courseId}/builder`);\r\n        revalidatePath(`/courses/${courseId}`);\r\n\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('deleteCourseThumbnail error:', error);\r\n        return { error: error?.message || 'Failed to delete thumbnail' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IASsB,uBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 5565, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/updateCourseMetadata.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createAdminClient } from '@/lib/supabase/admin';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Update course metadata (title and/or thumbnail_url)\r\n */\r\nexport async function updateCourseMetadata(data: {\r\n    courseId: string;\r\n    title?: string;\r\n    thumbnailUrl?: string;\r\n}) {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Check authentication\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            return { error: 'Unauthorized' };\r\n        }\r\n\r\n        // Check admin permission\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return { error: 'Admin access required' };\r\n        }\r\n\r\n        // Prepare update data\r\n        const updateData: any = {\r\n            updated_at: new Date().toISOString()\r\n        };\r\n\r\n        if (data.title !== undefined) {\r\n            updateData.title = data.title;\r\n        }\r\n\r\n        if (data.thumbnailUrl !== undefined) {\r\n            updateData.thumbnail_url = data.thumbnailUrl;\r\n        }\r\n\r\n        // Update course\r\n        const { data: course, error } = await supabase\r\n            .from('courses')\r\n            .update(updateData)\r\n            .eq('id', data.courseId)\r\n            .select()\r\n            .single();\r\n\r\n        if (error) {\r\n            console.error('Course update error:', error);\r\n            throw new Error(`Failed to update course: ${error.message}`);\r\n        }\r\n\r\n        // Revalidate relevant paths\r\n        revalidatePath('/admin/courses');\r\n        revalidatePath(`/admin/courses/${data.courseId}`);\r\n        revalidatePath(`/admin/courses/${data.courseId}/builder`);\r\n        revalidatePath(`/courses/${data.courseId}`);\r\n\r\n        return { success: true, data: course };\r\n    } catch (error: any) {\r\n        console.error('updateCourseMetadata error:', error);\r\n        return { error: error?.message || 'Failed to update course metadata' };\r\n    }\r\n}\r\n\r\n/**\r\n * Upload course thumbnail to Supabase Storage\r\n */\r\nexport async function uploadCourseThumbnail(data: {\r\n    courseId: string;\r\n    file: File;\r\n}) {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Check authentication\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            return { error: 'Unauthorized' };\r\n        }\r\n\r\n        // Check admin permission\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return { error: 'Admin access required' };\r\n        }\r\n\r\n        // Validate file type\r\n        const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n        if (!validTypes.includes(data.file.type)) {\r\n            return { error: 'Invalid file type. Please upload a JPG, PNG, or WebP image.' };\r\n        }\r\n\r\n        // Validate file size (5MB max)\r\n        const maxSize = 5 * 1024 * 1024; // 5MB\r\n        if (data.file.size > maxSize) {\r\n            return { error: 'File size too large. Maximum size is 5MB.' };\r\n        }\r\n\r\n        // Get current course to check for existing thumbnail\r\n        const { data: course } = await supabase\r\n            .from('courses')\r\n            .select('thumbnail_url')\r\n            .eq('id', data.courseId)\r\n            .single();\r\n\r\n        // Delete old thumbnail if exists\r\n        if (course?.thumbnail_url) {\r\n            const oldPath = course.thumbnail_url.split('/').pop();\r\n            if (oldPath) {\r\n                await supabase.storage\r\n                    .from('course-thumbnails')\r\n                    .remove([`${data.courseId}/${oldPath}`]);\r\n            }\r\n        }\r\n\r\n        // Generate unique filename\r\n        const fileExt = data.file.name.split('.').pop();\r\n        const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n        const filePath = `${data.courseId}/${fileName}`;\r\n\r\n        // Upload to Supabase Storage\r\n        const { data: uploadData, error: uploadError } = await supabase.storage\r\n            .from('course-thumbnails')\r\n            .upload(filePath, data.file, {\r\n                cacheControl: '3600',\r\n                upsert: false\r\n            });\r\n\r\n        if (uploadError) {\r\n            console.error('Upload error:', uploadError);\r\n            throw new Error(`Failed to upload file: ${uploadError.message}`);\r\n        }\r\n\r\n        // Get public URL\r\n        const { data: { publicUrl } } = supabase.storage\r\n            .from('course-thumbnails')\r\n            .getPublicUrl(filePath);\r\n\r\n        // Update course with new thumbnail URL\r\n        const { error: updateError } = await supabase\r\n            .from('courses')\r\n            .update({\r\n                thumbnail_url: publicUrl,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', data.courseId);\r\n\r\n        if (updateError) {\r\n            console.error('Course update error:', updateError);\r\n            // Try to clean up uploaded file\r\n            await supabase.storage\r\n                .from('course-thumbnails')\r\n                .remove([filePath]);\r\n            throw new Error(`Failed to update course: ${updateError.message}`);\r\n        }\r\n\r\n        // Revalidate relevant paths\r\n        revalidatePath('/admin/courses');\r\n        revalidatePath(`/admin/courses/${data.courseId}`);\r\n        revalidatePath(`/admin/courses/${data.courseId}/builder`);\r\n        revalidatePath(`/courses/${data.courseId}`);\r\n\r\n        return { success: true, data: { url: publicUrl } };\r\n    } catch (error: any) {\r\n        console.error('uploadCourseThumbnail error:', error);\r\n        return { error: error?.message || 'Failed to upload thumbnail' };\r\n    }\r\n}\r\n\r\n/**\r\n * Delete course thumbnail\r\n */\r\nexport async function deleteCourseThumbnail(courseId: string) {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Check authentication\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            return { error: 'Unauthorized' };\r\n        }\r\n\r\n        // Check admin permission\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return { error: 'Admin access required' };\r\n        }\r\n\r\n        // Get current course\r\n        const { data: course } = await supabase\r\n            .from('courses')\r\n            .select('thumbnail_url')\r\n            .eq('id', courseId)\r\n            .single();\r\n\r\n        // Delete thumbnail from storage\r\n        if (course?.thumbnail_url) {\r\n            const oldPath = course.thumbnail_url.split('/').pop();\r\n            if (oldPath) {\r\n                await supabase.storage\r\n                    .from('course-thumbnails')\r\n                    .remove([`${courseId}/${oldPath}`]);\r\n            }\r\n        }\r\n\r\n        // Update course to remove thumbnail URL\r\n        const { error: updateError } = await supabase\r\n            .from('courses')\r\n            .update({\r\n                thumbnail_url: null,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', courseId);\r\n\r\n        if (updateError) {\r\n            console.error('Course update error:', updateError);\r\n            throw new Error(`Failed to update course: ${updateError.message}`);\r\n        }\r\n\r\n        // Revalidate relevant paths\r\n        revalidatePath('/admin/courses');\r\n        revalidatePath(`/admin/courses/${courseId}`);\r\n        revalidatePath(`/admin/courses/${courseId}/builder`);\r\n        revalidatePath(`/courses/${courseId}`);\r\n\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('deleteCourseThumbnail error:', error);\r\n        return { error: error?.message || 'Failed to delete thumbnail' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IA4EsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 5580, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/updateCourseMetadata.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createAdminClient } from '@/lib/supabase/admin';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Update course metadata (title and/or thumbnail_url)\r\n */\r\nexport async function updateCourseMetadata(data: {\r\n    courseId: string;\r\n    title?: string;\r\n    thumbnailUrl?: string;\r\n}) {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Check authentication\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            return { error: 'Unauthorized' };\r\n        }\r\n\r\n        // Check admin permission\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return { error: 'Admin access required' };\r\n        }\r\n\r\n        // Prepare update data\r\n        const updateData: any = {\r\n            updated_at: new Date().toISOString()\r\n        };\r\n\r\n        if (data.title !== undefined) {\r\n            updateData.title = data.title;\r\n        }\r\n\r\n        if (data.thumbnailUrl !== undefined) {\r\n            updateData.thumbnail_url = data.thumbnailUrl;\r\n        }\r\n\r\n        // Update course\r\n        const { data: course, error } = await supabase\r\n            .from('courses')\r\n            .update(updateData)\r\n            .eq('id', data.courseId)\r\n            .select()\r\n            .single();\r\n\r\n        if (error) {\r\n            console.error('Course update error:', error);\r\n            throw new Error(`Failed to update course: ${error.message}`);\r\n        }\r\n\r\n        // Revalidate relevant paths\r\n        revalidatePath('/admin/courses');\r\n        revalidatePath(`/admin/courses/${data.courseId}`);\r\n        revalidatePath(`/admin/courses/${data.courseId}/builder`);\r\n        revalidatePath(`/courses/${data.courseId}`);\r\n\r\n        return { success: true, data: course };\r\n    } catch (error: any) {\r\n        console.error('updateCourseMetadata error:', error);\r\n        return { error: error?.message || 'Failed to update course metadata' };\r\n    }\r\n}\r\n\r\n/**\r\n * Upload course thumbnail to Supabase Storage\r\n */\r\nexport async function uploadCourseThumbnail(data: {\r\n    courseId: string;\r\n    file: File;\r\n}) {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Check authentication\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            return { error: 'Unauthorized' };\r\n        }\r\n\r\n        // Check admin permission\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return { error: 'Admin access required' };\r\n        }\r\n\r\n        // Validate file type\r\n        const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n        if (!validTypes.includes(data.file.type)) {\r\n            return { error: 'Invalid file type. Please upload a JPG, PNG, or WebP image.' };\r\n        }\r\n\r\n        // Validate file size (5MB max)\r\n        const maxSize = 5 * 1024 * 1024; // 5MB\r\n        if (data.file.size > maxSize) {\r\n            return { error: 'File size too large. Maximum size is 5MB.' };\r\n        }\r\n\r\n        // Get current course to check for existing thumbnail\r\n        const { data: course } = await supabase\r\n            .from('courses')\r\n            .select('thumbnail_url')\r\n            .eq('id', data.courseId)\r\n            .single();\r\n\r\n        // Delete old thumbnail if exists\r\n        if (course?.thumbnail_url) {\r\n            const oldPath = course.thumbnail_url.split('/').pop();\r\n            if (oldPath) {\r\n                await supabase.storage\r\n                    .from('course-thumbnails')\r\n                    .remove([`${data.courseId}/${oldPath}`]);\r\n            }\r\n        }\r\n\r\n        // Generate unique filename\r\n        const fileExt = data.file.name.split('.').pop();\r\n        const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n        const filePath = `${data.courseId}/${fileName}`;\r\n\r\n        // Upload to Supabase Storage\r\n        const { data: uploadData, error: uploadError } = await supabase.storage\r\n            .from('course-thumbnails')\r\n            .upload(filePath, data.file, {\r\n                cacheControl: '3600',\r\n                upsert: false\r\n            });\r\n\r\n        if (uploadError) {\r\n            console.error('Upload error:', uploadError);\r\n            throw new Error(`Failed to upload file: ${uploadError.message}`);\r\n        }\r\n\r\n        // Get public URL\r\n        const { data: { publicUrl } } = supabase.storage\r\n            .from('course-thumbnails')\r\n            .getPublicUrl(filePath);\r\n\r\n        // Update course with new thumbnail URL\r\n        const { error: updateError } = await supabase\r\n            .from('courses')\r\n            .update({\r\n                thumbnail_url: publicUrl,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', data.courseId);\r\n\r\n        if (updateError) {\r\n            console.error('Course update error:', updateError);\r\n            // Try to clean up uploaded file\r\n            await supabase.storage\r\n                .from('course-thumbnails')\r\n                .remove([filePath]);\r\n            throw new Error(`Failed to update course: ${updateError.message}`);\r\n        }\r\n\r\n        // Revalidate relevant paths\r\n        revalidatePath('/admin/courses');\r\n        revalidatePath(`/admin/courses/${data.courseId}`);\r\n        revalidatePath(`/admin/courses/${data.courseId}/builder`);\r\n        revalidatePath(`/courses/${data.courseId}`);\r\n\r\n        return { success: true, data: { url: publicUrl } };\r\n    } catch (error: any) {\r\n        console.error('uploadCourseThumbnail error:', error);\r\n        return { error: error?.message || 'Failed to upload thumbnail' };\r\n    }\r\n}\r\n\r\n/**\r\n * Delete course thumbnail\r\n */\r\nexport async function deleteCourseThumbnail(courseId: string) {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Check authentication\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            return { error: 'Unauthorized' };\r\n        }\r\n\r\n        // Check admin permission\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return { error: 'Admin access required' };\r\n        }\r\n\r\n        // Get current course\r\n        const { data: course } = await supabase\r\n            .from('courses')\r\n            .select('thumbnail_url')\r\n            .eq('id', courseId)\r\n            .single();\r\n\r\n        // Delete thumbnail from storage\r\n        if (course?.thumbnail_url) {\r\n            const oldPath = course.thumbnail_url.split('/').pop();\r\n            if (oldPath) {\r\n                await supabase.storage\r\n                    .from('course-thumbnails')\r\n                    .remove([`${courseId}/${oldPath}`]);\r\n            }\r\n        }\r\n\r\n        // Update course to remove thumbnail URL\r\n        const { error: updateError } = await supabase\r\n            .from('courses')\r\n            .update({\r\n                thumbnail_url: null,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', courseId);\r\n\r\n        if (updateError) {\r\n            console.error('Course update error:', updateError);\r\n            throw new Error(`Failed to update course: ${updateError.message}`);\r\n        }\r\n\r\n        // Revalidate relevant paths\r\n        revalidatePath('/admin/courses');\r\n        revalidatePath(`/admin/courses/${courseId}`);\r\n        revalidatePath(`/admin/courses/${courseId}/builder`);\r\n        revalidatePath(`/courses/${courseId}`);\r\n\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('deleteCourseThumbnail error:', error);\r\n        return { error: error?.message || 'Failed to delete thumbnail' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IA0LsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 5595, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/hooks/admin/useCourseMetadata.ts"],"sourcesContent":["import { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { updateCourseMetadata, uploadCourseThumbnail, deleteCourseThumbnail } from '@/actions/admin/updateCourseMetadata';\r\nimport { toast } from 'sonner';\r\n\r\n/**\r\n * Hook for updating course title\r\n */\r\nexport function useUpdateCourseTitle() {\r\n    const queryClient = useQueryClient();\r\n\r\n    return useMutation({\r\n        mutationFn: async ({ courseId, title }: { courseId: string; title: string }) => {\r\n            const result = await updateCourseMetadata({ courseId, title });\r\n            if (result.error) throw new Error(result.error);\r\n            return result.data;\r\n        },\r\n        onSuccess: (data, variables) => {\r\n            toast.success('Course title updated successfully');\r\n            // Invalidate relevant queries\r\n            queryClient.invalidateQueries({ queryKey: ['course', variables.courseId] });\r\n            queryClient.invalidateQueries({ queryKey: ['courses'] });\r\n            queryClient.invalidateQueries({ queryKey: ['course-analytics', variables.courseId] });\r\n        },\r\n        onError: (error: Error) => {\r\n            toast.error(error.message || 'Failed to update course title');\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Hook for uploading course thumbnail\r\n */\r\nexport function useUploadCourseThumbnail() {\r\n    const queryClient = useQueryClient();\r\n\r\n    return useMutation({\r\n        mutationFn: async ({ courseId, file }: { courseId: string; file: File }) => {\r\n            const result = await uploadCourseThumbnail({ courseId, file });\r\n            if (result.error) throw new Error(result.error);\r\n            return result.data;\r\n        },\r\n        onSuccess: (data, variables) => {\r\n            toast.success('Thumbnail uploaded successfully');\r\n            // Invalidate relevant queries\r\n            queryClient.invalidateQueries({ queryKey: ['course', variables.courseId] });\r\n            queryClient.invalidateQueries({ queryKey: ['courses'] });\r\n            queryClient.invalidateQueries({ queryKey: ['course-analytics', variables.courseId] });\r\n        },\r\n        onError: (error: Error) => {\r\n            toast.error(error.message || 'Failed to upload thumbnail');\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Hook for deleting course thumbnail\r\n */\r\nexport function useDeleteCourseThumbnail() {\r\n    const queryClient = useQueryClient();\r\n\r\n    return useMutation({\r\n        mutationFn: async (courseId: string) => {\r\n            const result = await deleteCourseThumbnail(courseId);\r\n            if (result.error) throw new Error(result.error);\r\n            return result;\r\n        },\r\n        onSuccess: (data, courseId) => {\r\n            toast.success('Thumbnail removed successfully');\r\n            // Invalidate relevant queries\r\n            queryClient.invalidateQueries({ queryKey: ['course', courseId] });\r\n            queryClient.invalidateQueries({ queryKey: ['courses'] });\r\n            queryClient.invalidateQueries({ queryKey: ['course-analytics', courseId] });\r\n        },\r\n        onError: (error: Error) => {\r\n            toast.error(error.message || 'Failed to remove thumbnail');\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Combined hook for all course metadata operations\r\n */\r\nexport function useCourseMetadata() {\r\n    return {\r\n        updateTitle: useUpdateCourseTitle(),\r\n        uploadThumbnail: useUploadCourseThumbnail(),\r\n        deleteThumbnail: useDeleteCourseThumbnail()\r\n    };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AACA;AAAA;AAAA;AACA;;;;;AAKO,SAAS;;IACZ,MAAM,cAAc,IAAA,2MAAc;IAElC,OAAO,IAAA,gMAAW,EAAC;QACf,UAAU;gDAAE,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAuC;gBACvE,MAAM,SAAS,MAAM,IAAA,mLAAoB,EAAC;oBAAE;oBAAU;gBAAM;gBAC5D,IAAI,OAAO,KAAK,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;gBAC9C,OAAO,OAAO,IAAI;YACtB;;QACA,SAAS;gDAAE,CAAC,MAAM;gBACd,oJAAK,CAAC,OAAO,CAAC;gBACd,8BAA8B;gBAC9B,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;wBAAU,UAAU,QAAQ;qBAAC;gBAAC;gBACzE,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;qBAAU;gBAAC;gBACtD,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;wBAAoB,UAAU,QAAQ;qBAAC;gBAAC;YACvF;;QACA,OAAO;gDAAE,CAAC;gBACN,oJAAK,CAAC,KAAK,CAAC,MAAM,OAAO,IAAI;YACjC;;IACJ;AACJ;GApBgB;;QACQ,2MAAc;QAE3B,gMAAW;;;AAsBf,SAAS;;IACZ,MAAM,cAAc,IAAA,2MAAc;IAElC,OAAO,IAAA,gMAAW,EAAC;QACf,UAAU;oDAAE,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAoC;gBACnE,MAAM,SAAS,MAAM,IAAA,oLAAqB,EAAC;oBAAE;oBAAU;gBAAK;gBAC5D,IAAI,OAAO,KAAK,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;gBAC9C,OAAO,OAAO,IAAI;YACtB;;QACA,SAAS;oDAAE,CAAC,MAAM;gBACd,oJAAK,CAAC,OAAO,CAAC;gBACd,8BAA8B;gBAC9B,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;wBAAU,UAAU,QAAQ;qBAAC;gBAAC;gBACzE,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;qBAAU;gBAAC;gBACtD,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;wBAAoB,UAAU,QAAQ;qBAAC;gBAAC;YACvF;;QACA,OAAO;oDAAE,CAAC;gBACN,oJAAK,CAAC,KAAK,CAAC,MAAM,OAAO,IAAI;YACjC;;IACJ;AACJ;IApBgB;;QACQ,2MAAc;QAE3B,gMAAW;;;AAsBf,SAAS;;IACZ,MAAM,cAAc,IAAA,2MAAc;IAElC,OAAO,IAAA,gMAAW,EAAC;QACf,UAAU;oDAAE,OAAO;gBACf,MAAM,SAAS,MAAM,IAAA,oLAAqB,EAAC;gBAC3C,IAAI,OAAO,KAAK,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;gBAC9C,OAAO;YACX;;QACA,SAAS;oDAAE,CAAC,MAAM;gBACd,oJAAK,CAAC,OAAO,CAAC;gBACd,8BAA8B;gBAC9B,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;wBAAU;qBAAS;gBAAC;gBAC/D,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;qBAAU;gBAAC;gBACtD,YAAY,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;wBAAoB;qBAAS;gBAAC;YAC7E;;QACA,OAAO;oDAAE,CAAC;gBACN,oJAAK,CAAC,KAAK,CAAC,MAAM,OAAO,IAAI;YACjC;;IACJ;AACJ;IApBgB;;QACQ,2MAAc;QAE3B,gMAAW;;;AAsBf,SAAS;;IACZ,OAAO;QACH,aAAa;QACb,iBAAiB;QACjB,iBAAiB;IACrB;AACJ;IANgB;;QAEK;QACI;QACA"}},
    {"offset": {"line": 5784, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/app/admin/courses/%5BcourseId%5D/builder/CourseBuilder.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { createClient } from \"@/lib/supabase/client\";\r\nimport { Course, Module, Lesson } from \"@/lib/types\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n    DialogDescription,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport {\r\n    Plus, Trash, Edit, Sparkles, Eye, ChevronDown, ChevronRight\r\n} from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nimport { DeleteModuleDialog } from \"./DeleteModuleDialog\";\r\nimport { ModuleList } from \"./ModuleList\";\r\nimport { LessonEditor } from \"./LessonEditor\";\r\nimport { EditableTitle } from \"@/components/admin/EditableTitle\";\r\nimport { ImageUpload } from \"@/components/ui/image-upload\";\r\nimport { useCourseModules, ModuleWithLessons } from \"@/hooks/useCourseModules\";\r\nimport { useCourseMetadata } from \"@/hooks/admin/useCourseMetadata\";\r\n\r\ninterface CourseBuilderProps {\r\n    course: Course;\r\n    initialModules: ModuleWithLessons[];\r\n}\r\n\r\nexport default function CourseBuilder({ course, initialModules }: CourseBuilderProps) {\r\n    const {\r\n        modules,\r\n        addModule,\r\n        updateModule,\r\n        deleteModule,\r\n        addLesson,\r\n        updateLesson,\r\n        deleteLesson,\r\n        reorderModules,\r\n        reorderLessons,\r\n        isAddingModule\r\n    } = useCourseModules(course.id, initialModules);\r\n\r\n    // Course metadata hooks\r\n    const { updateTitle, uploadThumbnail, deleteThumbnail } = useCourseMetadata();\r\n    const [localCourse, setLocalCourse] = useState(course);\r\n\r\n    const [expandedModules, setExpandedModules] = useState<Record<string, boolean>>(\r\n        initialModules.reduce((acc, m) => ({ ...acc, [m.id]: true }), {})\r\n    );\r\n    const [selectedLesson, setSelectedLesson] = useState<Lesson | null>(null);\r\n    const [isCreatingModule, setIsCreatingModule] = useState(false);\r\n    const [newModuleTitle, setNewModuleTitle] = useState(\"\");\r\n    const [editingModule, setEditingModule] = useState<{ id: string, title: string } | null>(null);\r\n    const [deletingModule, setDeletingModule] = useState<{ id: string, title: string } | null>(null);\r\n    const [isPublished, setIsPublished] = useState(course.is_published);\r\n    const supabase = createClient();\r\n    const router = useRouter();\r\n\r\n    const togglePublish = async () => {\r\n        try {\r\n            const { error } = await supabase\r\n                .from(\"courses\")\r\n                .update({ is_published: !isPublished })\r\n                .eq(\"id\", course.id);\r\n\r\n            if (error) throw error;\r\n\r\n            setIsPublished(!isPublished);\r\n            toast.success(!isPublished ? \"Course published\" : \"Course unpublished\");\r\n            router.refresh();\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Failed to update course status\");\r\n        }\r\n    };\r\n\r\n    // Course metadata handlers\r\n    const handleTitleUpdate = (newTitle: string) => {\r\n        updateTitle.mutate(\r\n            { courseId: course.id, title: newTitle },\r\n            {\r\n                onSuccess: () => {\r\n                    setLocalCourse(prev => ({ ...prev, title: newTitle }));\r\n                    router.refresh();\r\n                }\r\n            }\r\n        );\r\n    };\r\n\r\n    const handleThumbnailChange = async (url: string) => {\r\n        setLocalCourse(prev => ({ ...prev, thumbnail_url: url }));\r\n\r\n        // Update the course in the database\r\n        try {\r\n            const { error } = await supabase\r\n                .from('courses')\r\n                .update({ thumbnail_url: url })\r\n                .eq('id', course.id);\r\n\r\n            if (error) throw error;\r\n\r\n            toast.success('Thumbnail updated successfully');\r\n            router.refresh();\r\n        } catch (error) {\r\n            console.error('Error updating thumbnail:', error);\r\n            toast.error('Failed to update thumbnail');\r\n        }\r\n    };\r\n\r\n    const toggleModule = (moduleId: string) => {\r\n        setExpandedModules(prev => ({ ...prev, [moduleId]: !prev[moduleId] }));\r\n    };\r\n\r\n    const handleCreateModule = () => {\r\n        const titleToSave = newModuleTitle.trim();\r\n        if (!titleToSave) return;\r\n\r\n        setNewModuleTitle(\"\");\r\n        setIsCreatingModule(false);\r\n\r\n        addModule(titleToSave, {\r\n            onError: () => {\r\n                toast.error(`Failed to add '${titleToSave}'!`, {\r\n                    duration: Infinity,\r\n                    action: {\r\n                        label: \"Retry\",\r\n                        onClick: () => {\r\n                            toast.info(\"Retrying...\");\r\n                            addModule(titleToSave);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleUpdateModule = (moduleId: string, newTitle: string) => {\r\n        setEditingModule(null);\r\n        updateModule({ id: moduleId, title: newTitle }, {\r\n            onError: () => {\r\n                toast.error(`Rename to '${newTitle}' failed!`, {\r\n                    duration: Infinity,\r\n                    action: {\r\n                        label: \"Retry\",\r\n                        onClick: () => {\r\n                            toast.info(\"Retrying...\");\r\n                            updateModule({ id: moduleId, title: newTitle });\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleDeleteModule = (moduleId: string) => {\r\n        deleteModule(moduleId);\r\n        setDeletingModule(null);\r\n        if (selectedLesson && modules.find(m => m.id === moduleId)?.lessons.some(l => l.id === selectedLesson.id)) {\r\n            setSelectedLesson(null);\r\n        }\r\n    };\r\n\r\n    const handleDeleteLesson = (lessonId: string) => {\r\n        const lesson = modules.flatMap(m => m.lessons).find(l => l.id === lessonId);\r\n        if (!lesson) return;\r\n\r\n        deleteLesson(lesson);\r\n        if (selectedLesson?.id === lessonId) setSelectedLesson(null);\r\n    };\r\n\r\n    // AI Outline Generation States\r\n    const [isGenerating, setIsGenerating] = useState(false);\r\n    const [showOutlinePreview, setShowOutlinePreview] = useState(false);\r\n    const [generatedOutline, setGeneratedOutline] = useState<any>(null);\r\n    const [editingOutlineItem, setEditingOutlineItem] = useState<{ type: 'module' | 'lesson', mIndex: number, lIndex?: number, title: string } | null>(null);\r\n    const [deletingOutlineItem, setDeletingOutlineItem] = useState<{ type: 'module' | 'lesson', mIndex: number, lIndex?: number } | null>(null);\r\n\r\n    const handleGenerateOutline = async () => {\r\n        setIsGenerating(true);\r\n        try {\r\n            const response = await fetch('/api/generate-outline', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ courseTitle: course.title })\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (result.success) {\r\n                setGeneratedOutline(result.outline);\r\n                setShowOutlinePreview(true);\r\n            } else {\r\n                toast.error(result.error || 'Failed to generate outline');\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Failed to generate outline\");\r\n        } finally {\r\n            setIsGenerating(false);\r\n        }\r\n    };\r\n\r\n    const confirmDeleteOutlineItem = () => {\r\n        if (!deletingOutlineItem) return;\r\n        const { type, mIndex, lIndex } = deletingOutlineItem;\r\n        const newModules = [...generatedOutline.modules];\r\n\r\n        if (type === 'module') {\r\n            newModules.splice(mIndex, 1);\r\n        } else if (type === 'lesson' && typeof lIndex === 'number') {\r\n            newModules[mIndex].lessons.splice(lIndex, 1);\r\n        }\r\n\r\n        setGeneratedOutline({ ...generatedOutline, modules: newModules });\r\n        setDeletingOutlineItem(null);\r\n    };\r\n\r\n    const saveOutlineItemEdit = () => {\r\n        if (!editingOutlineItem || !editingOutlineItem.title.trim()) return;\r\n        const { type, mIndex, lIndex, title } = editingOutlineItem;\r\n        const newModules = [...generatedOutline.modules];\r\n\r\n        if (type === 'module') {\r\n            newModules[mIndex].title = title;\r\n        } else if (type === 'lesson' && typeof lIndex === 'number') {\r\n            newModules[mIndex].lessons[lIndex].title = title;\r\n        }\r\n\r\n        setGeneratedOutline({ ...generatedOutline, modules: newModules });\r\n        setEditingOutlineItem(null);\r\n    };\r\n\r\n    const handleApplyOutline = async () => {\r\n        if (!generatedOutline) return;\r\n        setIsGenerating(true);\r\n        const toastId = toast.loading(\"Creating course structure...\");\r\n\r\n        try {\r\n            // Get current max module order\r\n            let currentOrder = modules.length > 0 ? Math.max(...modules.map(m => m.module_order)) : 0;\r\n\r\n            // Cast modules to any[] to avoid implicit any errors on loop variable\r\n            const modulesList = generatedOutline.modules as any[];\r\n            for (const moduleData of modulesList) {\r\n                currentOrder++;\r\n                // Create module\r\n                const { data: module, error: moduleError } = await supabase\r\n                    .from(\"modules\")\r\n                    .insert({\r\n                        course_id: course.id,\r\n                        title: moduleData.title,\r\n                        module_order: currentOrder,\r\n                    })\r\n                    .select()\r\n                    .single();\r\n\r\n                if (moduleError) throw moduleError;\r\n\r\n                // Create lessons\r\n                if (moduleData.lessons && moduleData.lessons.length > 0) {\r\n                    const lessonsToInsert = moduleData.lessons.map((lesson: any, index: number) => ({\r\n                        module_id: module.id,\r\n                        title: lesson.title,\r\n                        content_type: lesson.content_type || \"text\",\r\n                        lesson_order: index + 1,\r\n                        is_free_preview: false,\r\n                        content_text: lesson.content_type === \"text\" ? \"Upcoming content...\" : \"\",\r\n                        content_url: (lesson.content_type === \"video\" || lesson.content_type === \"pdf\") ? \"https://placeholder.com/upcoming\" : \"\",\r\n                    }));\r\n\r\n                    const { error: lessonsError } = await supabase\r\n                        .from(\"lessons\")\r\n                        .insert(lessonsToInsert);\r\n\r\n                    if (lessonsError) throw lessonsError;\r\n                }\r\n            }\r\n\r\n            toast.success(\"Course structure created successfully\", { id: toastId });\r\n            setShowOutlinePreview(false);\r\n            setGeneratedOutline(null);\r\n            router.refresh(); // Refresh to show new modules\r\n\r\n            // Reload window to ensure full state sync (simpler than manual state update for complex nested data)\r\n            window.location.reload();\r\n\r\n        } catch (error: any) {\r\n            console.error(error);\r\n            toast.error(\"Failed to apply outline: \" + error.message, { id: toastId });\r\n        } finally {\r\n            setIsGenerating(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex h-screen bg-slate-50 dark:bg-[#0f1117]\">\r\n            {/* Left Sidebar */}\r\n            <div className=\"w-80 border-r border-slate-200 dark:border-slate-800 bg-white dark:bg-[#161b22] flex flex-col overflow-hidden\">\r\n                <div className=\"p-4 border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-[#161b22] sticky top-0 z-10 space-y-4\">\r\n                    {/* Editable Title */}\r\n                    <EditableTitle\r\n                        value={localCourse.title}\r\n                        onSave={handleTitleUpdate}\r\n                        isLoading={updateTitle.isPending}\r\n                        placeholder=\"Course Title\"\r\n                    />\r\n\r\n                    {/* Thumbnail Upload */}\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider\">\r\n                            Course Thumbnail\r\n                        </label>\r\n                        <ImageUpload\r\n                            value={localCourse.thumbnail_url || \"\"}\r\n                            onChange={handleThumbnailChange}\r\n                            maxSizeMB={0.3}\r\n                            maxWidth={600}\r\n                            maxHeight={400}\r\n                        />\r\n                        <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                            Recommended: 600x400px, max 300KB\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Action Buttons */}\r\n                    <div className=\"flex gap-2\">\r\n                        <Button size=\"sm\" variant=\"outline\" onClick={() => router.push(\"/admin/courses\")} className=\"dark:bg-transparent dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800 dark:hover:text-white\">\r\n                            Back\r\n                        </Button>\r\n                        <Button size=\"sm\" variant=\"outline\" onClick={() => router.push(`/courses/${course.id}`)} className=\"dark:bg-transparent dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800 dark:hover:text-white\">\r\n                            <Eye className=\"h-4 w-4 mr-1\" /> Preview\r\n                        </Button>\r\n                        <Button\r\n                            size=\"sm\"\r\n                            variant={isPublished ? \"secondary\" : \"default\"}\r\n                            onClick={togglePublish}\r\n                            className={cn(\r\n                                isPublished\r\n                                    ? \"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-400 dark:hover:bg-green-900/50\"\r\n                                    : \"bg-blue-600 hover:bg-blue-700 text-white\"\r\n                            )}\r\n                        >\r\n                            {isPublished ? \"Published\" : \"Publish\"}\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar\">\r\n                    {/* Module List Component */}\r\n                    <div className=\"space-y-4\">\r\n                        <ModuleList\r\n                            modules={modules}\r\n                            expandedModules={expandedModules}\r\n                            toggleModule={toggleModule}\r\n                            editingModule={editingModule}\r\n                            setEditingModule={setEditingModule}\r\n                            handleUpdateModule={handleUpdateModule}\r\n                            handleDeleteModuleRequest={(id, title) => setDeletingModule({ id, title })}\r\n                            selectedLesson={selectedLesson}\r\n                            setSelectedLesson={setSelectedLesson}\r\n                            addLesson={addLesson}\r\n                            reorderModules={reorderModules}\r\n                            reorderLessons={reorderLessons}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"mt-4 px-2\">\r\n                        {isCreatingModule ? (\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Input\r\n                                    autoFocus\r\n                                    placeholder=\"Chapter Title\"\r\n                                    value={newModuleTitle}\r\n                                    onChange={(e) => setNewModuleTitle(e.target.value)}\r\n                                    className=\"h-8 text-sm bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700\"\r\n                                    onKeyDown={(e) => e.key === 'Enter' && handleCreateModule()}\r\n                                />\r\n                                <Button size=\"sm\" onClick={handleCreateModule} disabled={!newModuleTitle.trim()}>Add</Button>\r\n                                <Button size=\"sm\" variant=\"ghost\" onClick={() => setIsCreatingModule(false)}>X</Button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-2\">\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    className=\"w-full justify-start text-blue-600 hover:text-blue-700 hover:bg-blue-50 dark:text-blue-400 dark:hover:text-blue-300 dark:hover:bg-blue-500/10\"\r\n                                    onClick={() => setIsCreatingModule(true)}\r\n                                >\r\n                                    <Plus className=\"h-4 w-4 mr-2\" /> Add new chapter\r\n                                </Button>\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    className=\"w-full justify-start text-purple-600 hover:text-purple-700 hover:bg-purple-50 dark:text-purple-400 dark:hover:text-purple-300 dark:hover:bg-purple-500/10\"\r\n                                    onClick={handleGenerateOutline}\r\n                                    disabled={isGenerating}\r\n                                >\r\n                                    <Sparkles className=\"h-4 w-4 mr-2\" />\r\n                                    {isGenerating ? \"Generating...\" : \"Generate with AI\"}\r\n                                </Button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* AI Outline Preview Dialog */}\r\n            <Dialog open={showOutlinePreview} onOpenChange={setShowOutlinePreview}>\r\n                <DialogContent className=\"max-w-3xl max-h-[80vh] overflow-y-auto dark:bg-[#161b22] dark:border-slate-800\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"dark:text-white flex items-center gap-2\">\r\n                            <Sparkles className=\"h-5 w-5 text-purple-500\" />\r\n                            AI Generated Outline\r\n                        </DialogTitle>\r\n                        <DialogDescription>\r\n                            Review the generated structure below. Click \"Apply\" to add these chapters and lessons to your course.\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"space-y-4 py-4\">\r\n                        {generatedOutline?.modules.map((module: any, mIndex: number) => (\r\n                            <div key={mIndex} className=\"border dark:border-slate-700 rounded-lg p-4 bg-slate-50 dark:bg-slate-900/50\">\r\n                                <div className=\"flex items-center justify-between mb-2\">\r\n                                    <h3 className=\"font-semibold text-lg dark:text-white\">{module.title}</h3>\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setEditingOutlineItem({ type: 'module', mIndex, title: module.title })} className=\"h-8 w-8 p-0\">\r\n                                            <Edit className=\"h-4 w-4 text-blue-500\" />\r\n                                        </Button>\r\n                                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setDeletingOutlineItem({ type: 'module', mIndex })} className=\"h-8 w-8 p-0\">\r\n                                            <Trash className=\"h-4 w-4 text-red-500\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </div>\r\n                                <ul className=\"space-y-2 pl-4 text-slate-600 dark:text-slate-400\">\r\n                                    {module.lessons.map((lesson: any, lIndex: number) => (\r\n                                        <li key={lIndex} className=\"flex items-center justify-between group bg-white dark:bg-slate-800 p-2 rounded border border-transparent hover:border-slate-200 dark:hover:border-slate-700\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <span className=\"w-1.5 h-1.5 rounded-full bg-slate-400\" />\r\n                                                <span>{lesson.title}</span>\r\n                                                <span className=\"text-xs px-2 py-0.5 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-500\">\r\n                                                    {lesson.content_type}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                                <Button variant=\"ghost\" size=\"sm\" onClick={() => setEditingOutlineItem({ type: 'lesson', mIndex, lIndex, title: lesson.title })} className=\"h-6 w-6 p-0\">\r\n                                                    <Edit className=\"h-3 w-3 text-blue-500\" />\r\n                                                </Button>\r\n                                                <Button variant=\"ghost\" size=\"sm\" onClick={() => setDeletingOutlineItem({ type: 'lesson', mIndex, lIndex })} className=\"h-6 w-6 p-0\">\r\n                                                    <Trash className=\"h-3 w-3 text-red-500\" />\r\n                                                </Button>\r\n                                            </div>\r\n                                        </li>\r\n                                    ))}\r\n                                </ul>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <DialogFooter>\r\n                        <Button variant=\"outline\" onClick={() => setShowOutlinePreview(false)} className=\"dark:bg-transparent dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800\">Cancel</Button>\r\n                        <Button onClick={handleApplyOutline} disabled={isGenerating} className=\"bg-purple-600 hover:bg-purple-700 text-white\">\r\n                            {isGenerating ? \"Creating...\" : \"Apply Outline\"}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Edit Outline Item Dialog */}\r\n            <Dialog open={!!editingOutlineItem} onOpenChange={(open) => !open && setEditingOutlineItem(null)}>\r\n                <DialogContent className=\"dark:bg-[#161b22] dark:border-slate-800\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"dark:text-white\">Edit {editingOutlineItem?.type === 'module' ? 'Chapter' : 'Lesson'} Title</DialogTitle>\r\n                    </DialogHeader>\r\n                    <div className=\"py-4\">\r\n                        <Input\r\n                            value={editingOutlineItem?.title || \"\"}\r\n                            onChange={(e) => setEditingOutlineItem(prev => prev ? { ...prev, title: e.target.value } : null)}\r\n                            placeholder=\"Enter title\"\r\n                            className=\"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700\"\r\n                            onKeyDown={(e) => e.key === 'Enter' && saveOutlineItemEdit()}\r\n                        />\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button variant=\"ghost\" onClick={() => setEditingOutlineItem(null)}>Cancel</Button>\r\n                        <Button onClick={saveOutlineItemEdit}>Save</Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Delete Confirmation Dialog for Outline */}\r\n            <AlertDialog open={!!deletingOutlineItem} onOpenChange={(open) => !open && setDeletingOutlineItem(null)}>\r\n                <AlertDialogContent className=\"dark:bg-[#161b22] dark:border-slate-800\">\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle className=\"dark:text-white\">Are you sure?</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            This will permanently delete this {deletingOutlineItem?.type === 'module' ? 'chapter and all its lessons' : 'lesson'} from the generated outline.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel className=\"dark:bg-transparent dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800\">Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction onClick={confirmDeleteOutlineItem} className=\"bg-red-600 hover:bg-red-700 text-white\">Delete</AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Delete Module Dialog (from sidebar) */}\r\n            <DeleteModuleDialog\r\n                open={!!deletingModule}\r\n                onOpenChange={(open) => !open && setDeletingModule(null)}\r\n                onConfirm={() => deletingModule && handleDeleteModule(deletingModule.id)}\r\n                moduleTitle={deletingModule?.title || \"\"}\r\n            />\r\n\r\n            {/* Right Content Area */}\r\n            <div className=\"flex-1 overflow-hidden bg-slate-50 dark:bg-[#0f1117]\">\r\n                {selectedLesson ? (\r\n                    <LessonEditor\r\n                        key={selectedLesson.id}\r\n                        lesson={selectedLesson}\r\n                        course={course}\r\n                        onUpdate={(updates) => updateLesson({ id: selectedLesson.id, ...updates })}\r\n                        onDelete={handleDeleteLesson}\r\n                    />\r\n                ) : (\r\n                    <div className=\"h-full flex items-center justify-center text-slate-400 dark:text-slate-600 bg-slate-50 dark:bg-[#0f1117]\">\r\n                        <div className=\"text-center\">\r\n                            <Sparkles className=\"h-12 w-12 mx-auto mb-4 text-slate-300 dark:text-slate-700\" />\r\n                            <h3 className=\"text-lg font-medium text-slate-600 dark:text-slate-400\">Select a lesson to edit</h3>\r\n                            <p className=\"text-sm mt-1 text-slate-500 dark:text-slate-600\">Click on a lesson in the sidebar to edit its content.</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}