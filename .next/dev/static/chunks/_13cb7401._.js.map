{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/students.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createAdminClient } from '@/lib/supabase/admin';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Add a new student manually (admin only)\r\n * Returns student info if already exists, or creates an invitation\r\n */\r\nexport async function addStudent(data: {\r\n    email: string;\r\n    fullName: string;\r\n    sendInvite?: boolean;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    // Check admin permission\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if student already exists in profiles\r\n        const { data: existing } = await supabase\r\n            .from('profiles')\r\n            .select('id, email, full_name')\r\n            .eq('email', data.email)\r\n            .single();\r\n\r\n        if (existing) {\r\n            return {\r\n                success: true,\r\n                data: existing,\r\n                message: 'Student already exists in the system'\r\n            };\r\n        }\r\n\r\n        // Send invitation email using Supabase Admin\r\n        if (data.sendInvite) {\r\n            const adminClient = createAdminClient();\r\n\r\n            // Invite user via Supabase Auth\r\n            const { data: inviteData, error: inviteError } = await adminClient.auth.admin.inviteUserByEmail(\r\n                data.email,\r\n                {\r\n                    data: {\r\n                        full_name: data.fullName,\r\n                        role: 'student'\r\n                    },\r\n                    redirectTo: `${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/auth/callback`\r\n                }\r\n            );\r\n\r\n            if (inviteError) {\r\n                console.error('Invitation error:', inviteError);\r\n                throw new Error(`Failed to send invitation: ${inviteError.message}`);\r\n            }\r\n\r\n            console.log(`✅ Invitation sent to ${data.email}`, inviteData);\r\n\r\n            // Create profile entry for the invited user\r\n            if (inviteData.user) {\r\n                const { error: profileError } = await adminClient\r\n                    .from('profiles')\r\n                    .insert({\r\n                        id: inviteData.user.id,\r\n                        email: data.email,\r\n                        full_name: data.fullName,\r\n                        role: 'student'\r\n                    });\r\n\r\n                if (profileError) {\r\n                    console.error('Profile creation error:', profileError);\r\n                    // Don't fail the whole operation if profile creation fails\r\n                    // The profile will be created on first login via callback\r\n                }\r\n            }\r\n\r\n            revalidatePath('/admin/students');\r\n            return {\r\n                success: true,\r\n                data: { email: data.email, full_name: data.fullName },\r\n                message: 'Invitation sent successfully! Student will receive an email to join.'\r\n            };\r\n        }\r\n\r\n        // If not sending invite, just return success\r\n        revalidatePath('/admin/students');\r\n        return {\r\n            success: true,\r\n            data: { email: data.email, full_name: data.fullName },\r\n            message: 'Student information saved. They can sign up normally.'\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Add student error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Search students by name or email\r\n */\r\nexport async function searchStudents(query: string) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('profiles')\r\n            .select('id, email, full_name, avatar_url, created_at')\r\n            .eq('role', 'student')\r\n            .or(`full_name.ilike.%${query}%,email.ilike.%${query}%`)\r\n            .order('full_name', { ascending: true })\r\n            .limit(20);\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get all students with their enrollments and expiry info\r\n */\r\nexport async function getStudentsWithEnrollments(filters?: {\r\n    status?: 'all' | 'active' | 'expired';\r\n    expiringWithinDays?: number;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        // Get all students\r\n        const { data: students, error: studentsError } = await supabase\r\n            .from('profiles')\r\n            .select(`\r\n        id,\r\n        email,\r\n        full_name,\r\n        avatar_url,\r\n        created_at\r\n      `)\r\n            .eq('role', 'student')\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (studentsError) throw studentsError;\r\n\r\n        // Get enrollments for each student\r\n        const { data: enrollments, error: enrollmentsError } = await supabase\r\n            .from('enrollments')\r\n            .select(`\r\n        id,\r\n        user_id,\r\n        course_id,\r\n        status,\r\n        expires_at,\r\n        granted_by,\r\n        grant_type,\r\n        courses (\r\n          id,\r\n          title,\r\n          thumbnail_url\r\n        )\r\n      `);\r\n\r\n        if (enrollmentsError) throw enrollmentsError;\r\n\r\n\r\n\r\n        // Combine data\r\n        const studentsWithEnrollments = students?.map(student => {\r\n            const courseEnrollments = enrollments?.filter(e => e.user_id === student.id) || [];\r\n\r\n            // Check expiry status\r\n            const now = new Date();\r\n            const expiringSoon = courseEnrollments.filter(e => {\r\n                if (!e.expires_at) return false;\r\n                const expiryDate = new Date(e.expires_at);\r\n                const daysUntilExpiry = (expiryDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24);\r\n                return daysUntilExpiry > 0 && daysUntilExpiry <= (filters?.expiringWithinDays || 7);\r\n            });\r\n\r\n            return {\r\n                ...student,\r\n                enrollments: courseEnrollments,\r\n                totalEnrollments: courseEnrollments.length,\r\n                expiringSoonCount: expiringSoon.length\r\n            };\r\n        });\r\n\r\n        // Apply filters\r\n        let filtered = studentsWithEnrollments;\r\n        if (filters?.status === 'active') {\r\n            filtered = filtered?.filter(s => s.totalEnrollments > 0);\r\n        } else if (filters?.status === 'expired') {\r\n            filtered = filtered?.filter(s => {\r\n                const hasExpired = (s.enrollments || []).some(e => {\r\n                    if (!e.expires_at) return false;\r\n                    return new Date(e.expires_at) < new Date();\r\n                });\r\n                return hasExpired;\r\n            });\r\n        }\r\n\r\n        return { success: true, data: filtered };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get exam attempts for a specific student\r\n */\r\nexport async function getStudentAttempts(userId: string) {\r\n    const supabase = createAdminClient();\r\n\r\n    try {\r\n        const { data: rawData, error } = await supabase\r\n            .from('exam_attempts')\r\n            .select(`\r\n                *,\r\n                exams (\r\n                    id,\r\n                    title,\r\n                    total_marks\r\n                ),\r\n                results (*)\r\n            `)\r\n            .eq('student_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        // Flatten results\r\n        const data = rawData?.map(att => ({\r\n            ...att,\r\n            results: Array.isArray(att.results) ? att.results[0] : att.results\r\n        })) || [];\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get detailed info for a single student with stats\r\n */\r\nexport async function getStudentDetails(userId: string) {\r\n    try {\r\n        const supabase = createAdminClient();\r\n\r\n        // Get student profile\r\n        const { data: student, error: studentError } = await supabase\r\n            .from('profiles')\r\n            .select('*')\r\n            .eq('id', userId)\r\n            .single();\r\n\r\n        if (studentError) {\r\n            console.error('Student fetch error:', studentError);\r\n            throw new Error(`Failed to fetch student profile: ${studentError.message}`);\r\n        }\r\n\r\n        if (!student) {\r\n            return { error: 'Student not found' };\r\n        }\r\n\r\n        // Get active sessions count\r\n        // Note: Accessing auth schema may require special permissions\r\n        let activeSessions = 0;\r\n        try {\r\n            const { count, error: sessionsError } = await supabase\r\n                .schema('auth')\r\n                .from('sessions')\r\n                .select('*', { count: 'exact', head: true })\r\n                .eq('user_id', userId);\r\n\r\n            if (sessionsError) {\r\n                console.error('Session count error:', sessionsError);\r\n            } else {\r\n                activeSessions = count || 0;\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to fetch session count:', err);\r\n            // Fallback: activeSessions remains 0\r\n        }\r\n\r\n        // Get enrollments\r\n        const { data: enrollments, error: enrollmentsError } = await supabase\r\n            .from('enrollments')\r\n            .select(`\r\n                *,\r\n                courses (\r\n                    id,\r\n                    title,\r\n                    thumbnail_url,\r\n                    price,\r\n                    course_type\r\n                ),\r\n                granted_by_profile:profiles!enrollments_granted_by_fkey (\r\n                    id,\r\n                    full_name\r\n                )\r\n            `)\r\n            .eq('user_id', userId);\r\n\r\n        if (enrollmentsError) {\r\n            console.error('Enrollments fetch error:', enrollmentsError);\r\n            // Don't throw, just log and continue with empty array\r\n        }\r\n\r\n\r\n\r\n        const { data: rawAttempts, error: attemptsError } = await supabase\r\n            .from('exam_attempts')\r\n            .select(`\r\n                *,\r\n                exams (id, title, total_marks),\r\n                results (percentage, obtained_marks)\r\n            `)\r\n            .eq('student_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (attemptsError) {\r\n            console.error('Exam attempts fetch error:', attemptsError);\r\n            // Don't throw, just log and continue with empty array\r\n        }\r\n\r\n        // Transform attempts to handle singular results object\r\n        const attempts = rawAttempts?.map(att => ({\r\n            ...att,\r\n            results: Array.isArray(att.results) ? att.results[0] : att.results\r\n        })) || [];\r\n\r\n        // Get enrollment logs\r\n        const enrollmentIds = enrollments?.map(e => e.id) || [];\r\n\r\n        let logs: any[] = [];\r\n        if (enrollmentIds.length > 0) {\r\n            const { data: logData, error: logsError } = await supabase\r\n                .from('enrollment_logs')\r\n                .select(`\r\n                    *,\r\n                    performed_by_profile:profiles!enrollment_logs_performed_by_fkey (\r\n                        id,\r\n                        full_name\r\n                    )\r\n                `)\r\n                .in('enrollment_id', enrollmentIds)\r\n                .order('created_at', { ascending: false })\r\n                .limit(50);\r\n\r\n            if (logsError) {\r\n                console.error('Enrollment logs fetch error:', logsError);\r\n                // Don't throw, just log and continue with empty array\r\n            } else {\r\n                logs = logData || [];\r\n            }\r\n        }\r\n\r\n        // Calculate Stats\r\n        const submittedAttempts = attempts.filter(a => a.status === 'submitted');\r\n        const avgPercentage = submittedAttempts.length > 0\r\n            ? submittedAttempts.reduce((acc, curr) => acc + (curr.results?.percentage || 0), 0) / submittedAttempts.length\r\n            : 0;\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                student,\r\n                enrollments: enrollments || [],\r\n                attempts: attempts || [],\r\n                logs,\r\n                activeSessions,\r\n                stats: {\r\n                    totalEnrollments: enrollments?.length || 0,\r\n                    totalAttempts: attempts?.length || 0,\r\n                    avgPercentage: Math.round(avgPercentage * 10) / 10\r\n                }\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('getStudentDetails error:', error);\r\n        return { error: error?.message || 'An unexpected error occurred while fetching student details' };\r\n    }\r\n}\r\n\r\n/**\r\n * Reset all active sessions for a student (admin only)\r\n */\r\nexport async function resetStudentSessions(userId: string) {\r\n    const supabase = createAdminClient();\r\n\r\n    try {\r\n        // Delete all sessions for this user\r\n        const { error: sessionError } = await supabase\r\n            .schema('auth')\r\n            .from('sessions')\r\n            .delete()\r\n            .eq('user_id', userId);\r\n\r\n        if (sessionError) throw sessionError;\r\n\r\n        // Also delete refresh tokens to ensure they can't get a new session\r\n        const { error: tokenError } = await supabase\r\n            .schema('auth')\r\n            .from('refresh_tokens')\r\n            .delete()\r\n            .eq('user_id', userId);\r\n\r\n        // Note: tokenError might happen if they have no tokens, we can be lenient or log it\r\n\r\n        revalidatePath(`/admin/students/${userId}`);\r\n        return { success: true, message: 'All active sessions have been reset' };\r\n    } catch (error: any) {\r\n        console.error('Reset sessions error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IA0IsB,6BAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/students.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createAdminClient } from '@/lib/supabase/admin';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Add a new student manually (admin only)\r\n * Returns student info if already exists, or creates an invitation\r\n */\r\nexport async function addStudent(data: {\r\n    email: string;\r\n    fullName: string;\r\n    sendInvite?: boolean;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    // Check admin permission\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if student already exists in profiles\r\n        const { data: existing } = await supabase\r\n            .from('profiles')\r\n            .select('id, email, full_name')\r\n            .eq('email', data.email)\r\n            .single();\r\n\r\n        if (existing) {\r\n            return {\r\n                success: true,\r\n                data: existing,\r\n                message: 'Student already exists in the system'\r\n            };\r\n        }\r\n\r\n        // Send invitation email using Supabase Admin\r\n        if (data.sendInvite) {\r\n            const adminClient = createAdminClient();\r\n\r\n            // Invite user via Supabase Auth\r\n            const { data: inviteData, error: inviteError } = await adminClient.auth.admin.inviteUserByEmail(\r\n                data.email,\r\n                {\r\n                    data: {\r\n                        full_name: data.fullName,\r\n                        role: 'student'\r\n                    },\r\n                    redirectTo: `${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/auth/callback`\r\n                }\r\n            );\r\n\r\n            if (inviteError) {\r\n                console.error('Invitation error:', inviteError);\r\n                throw new Error(`Failed to send invitation: ${inviteError.message}`);\r\n            }\r\n\r\n            console.log(`✅ Invitation sent to ${data.email}`, inviteData);\r\n\r\n            // Create profile entry for the invited user\r\n            if (inviteData.user) {\r\n                const { error: profileError } = await adminClient\r\n                    .from('profiles')\r\n                    .insert({\r\n                        id: inviteData.user.id,\r\n                        email: data.email,\r\n                        full_name: data.fullName,\r\n                        role: 'student'\r\n                    });\r\n\r\n                if (profileError) {\r\n                    console.error('Profile creation error:', profileError);\r\n                    // Don't fail the whole operation if profile creation fails\r\n                    // The profile will be created on first login via callback\r\n                }\r\n            }\r\n\r\n            revalidatePath('/admin/students');\r\n            return {\r\n                success: true,\r\n                data: { email: data.email, full_name: data.fullName },\r\n                message: 'Invitation sent successfully! Student will receive an email to join.'\r\n            };\r\n        }\r\n\r\n        // If not sending invite, just return success\r\n        revalidatePath('/admin/students');\r\n        return {\r\n            success: true,\r\n            data: { email: data.email, full_name: data.fullName },\r\n            message: 'Student information saved. They can sign up normally.'\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Add student error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Search students by name or email\r\n */\r\nexport async function searchStudents(query: string) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('profiles')\r\n            .select('id, email, full_name, avatar_url, created_at')\r\n            .eq('role', 'student')\r\n            .or(`full_name.ilike.%${query}%,email.ilike.%${query}%`)\r\n            .order('full_name', { ascending: true })\r\n            .limit(20);\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get all students with their enrollments and expiry info\r\n */\r\nexport async function getStudentsWithEnrollments(filters?: {\r\n    status?: 'all' | 'active' | 'expired';\r\n    expiringWithinDays?: number;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        // Get all students\r\n        const { data: students, error: studentsError } = await supabase\r\n            .from('profiles')\r\n            .select(`\r\n        id,\r\n        email,\r\n        full_name,\r\n        avatar_url,\r\n        created_at\r\n      `)\r\n            .eq('role', 'student')\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (studentsError) throw studentsError;\r\n\r\n        // Get enrollments for each student\r\n        const { data: enrollments, error: enrollmentsError } = await supabase\r\n            .from('enrollments')\r\n            .select(`\r\n        id,\r\n        user_id,\r\n        course_id,\r\n        status,\r\n        expires_at,\r\n        granted_by,\r\n        grant_type,\r\n        courses (\r\n          id,\r\n          title,\r\n          thumbnail_url\r\n        )\r\n      `);\r\n\r\n        if (enrollmentsError) throw enrollmentsError;\r\n\r\n\r\n\r\n        // Combine data\r\n        const studentsWithEnrollments = students?.map(student => {\r\n            const courseEnrollments = enrollments?.filter(e => e.user_id === student.id) || [];\r\n\r\n            // Check expiry status\r\n            const now = new Date();\r\n            const expiringSoon = courseEnrollments.filter(e => {\r\n                if (!e.expires_at) return false;\r\n                const expiryDate = new Date(e.expires_at);\r\n                const daysUntilExpiry = (expiryDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24);\r\n                return daysUntilExpiry > 0 && daysUntilExpiry <= (filters?.expiringWithinDays || 7);\r\n            });\r\n\r\n            return {\r\n                ...student,\r\n                enrollments: courseEnrollments,\r\n                totalEnrollments: courseEnrollments.length,\r\n                expiringSoonCount: expiringSoon.length\r\n            };\r\n        });\r\n\r\n        // Apply filters\r\n        let filtered = studentsWithEnrollments;\r\n        if (filters?.status === 'active') {\r\n            filtered = filtered?.filter(s => s.totalEnrollments > 0);\r\n        } else if (filters?.status === 'expired') {\r\n            filtered = filtered?.filter(s => {\r\n                const hasExpired = (s.enrollments || []).some(e => {\r\n                    if (!e.expires_at) return false;\r\n                    return new Date(e.expires_at) < new Date();\r\n                });\r\n                return hasExpired;\r\n            });\r\n        }\r\n\r\n        return { success: true, data: filtered };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get exam attempts for a specific student\r\n */\r\nexport async function getStudentAttempts(userId: string) {\r\n    const supabase = createAdminClient();\r\n\r\n    try {\r\n        const { data: rawData, error } = await supabase\r\n            .from('exam_attempts')\r\n            .select(`\r\n                *,\r\n                exams (\r\n                    id,\r\n                    title,\r\n                    total_marks\r\n                ),\r\n                results (*)\r\n            `)\r\n            .eq('student_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        // Flatten results\r\n        const data = rawData?.map(att => ({\r\n            ...att,\r\n            results: Array.isArray(att.results) ? att.results[0] : att.results\r\n        })) || [];\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get detailed info for a single student with stats\r\n */\r\nexport async function getStudentDetails(userId: string) {\r\n    try {\r\n        const supabase = createAdminClient();\r\n\r\n        // Get student profile\r\n        const { data: student, error: studentError } = await supabase\r\n            .from('profiles')\r\n            .select('*')\r\n            .eq('id', userId)\r\n            .single();\r\n\r\n        if (studentError) {\r\n            console.error('Student fetch error:', studentError);\r\n            throw new Error(`Failed to fetch student profile: ${studentError.message}`);\r\n        }\r\n\r\n        if (!student) {\r\n            return { error: 'Student not found' };\r\n        }\r\n\r\n        // Get active sessions count\r\n        // Note: Accessing auth schema may require special permissions\r\n        let activeSessions = 0;\r\n        try {\r\n            const { count, error: sessionsError } = await supabase\r\n                .schema('auth')\r\n                .from('sessions')\r\n                .select('*', { count: 'exact', head: true })\r\n                .eq('user_id', userId);\r\n\r\n            if (sessionsError) {\r\n                console.error('Session count error:', sessionsError);\r\n            } else {\r\n                activeSessions = count || 0;\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to fetch session count:', err);\r\n            // Fallback: activeSessions remains 0\r\n        }\r\n\r\n        // Get enrollments\r\n        const { data: enrollments, error: enrollmentsError } = await supabase\r\n            .from('enrollments')\r\n            .select(`\r\n                *,\r\n                courses (\r\n                    id,\r\n                    title,\r\n                    thumbnail_url,\r\n                    price,\r\n                    course_type\r\n                ),\r\n                granted_by_profile:profiles!enrollments_granted_by_fkey (\r\n                    id,\r\n                    full_name\r\n                )\r\n            `)\r\n            .eq('user_id', userId);\r\n\r\n        if (enrollmentsError) {\r\n            console.error('Enrollments fetch error:', enrollmentsError);\r\n            // Don't throw, just log and continue with empty array\r\n        }\r\n\r\n\r\n\r\n        const { data: rawAttempts, error: attemptsError } = await supabase\r\n            .from('exam_attempts')\r\n            .select(`\r\n                *,\r\n                exams (id, title, total_marks),\r\n                results (percentage, obtained_marks)\r\n            `)\r\n            .eq('student_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (attemptsError) {\r\n            console.error('Exam attempts fetch error:', attemptsError);\r\n            // Don't throw, just log and continue with empty array\r\n        }\r\n\r\n        // Transform attempts to handle singular results object\r\n        const attempts = rawAttempts?.map(att => ({\r\n            ...att,\r\n            results: Array.isArray(att.results) ? att.results[0] : att.results\r\n        })) || [];\r\n\r\n        // Get enrollment logs\r\n        const enrollmentIds = enrollments?.map(e => e.id) || [];\r\n\r\n        let logs: any[] = [];\r\n        if (enrollmentIds.length > 0) {\r\n            const { data: logData, error: logsError } = await supabase\r\n                .from('enrollment_logs')\r\n                .select(`\r\n                    *,\r\n                    performed_by_profile:profiles!enrollment_logs_performed_by_fkey (\r\n                        id,\r\n                        full_name\r\n                    )\r\n                `)\r\n                .in('enrollment_id', enrollmentIds)\r\n                .order('created_at', { ascending: false })\r\n                .limit(50);\r\n\r\n            if (logsError) {\r\n                console.error('Enrollment logs fetch error:', logsError);\r\n                // Don't throw, just log and continue with empty array\r\n            } else {\r\n                logs = logData || [];\r\n            }\r\n        }\r\n\r\n        // Calculate Stats\r\n        const submittedAttempts = attempts.filter(a => a.status === 'submitted');\r\n        const avgPercentage = submittedAttempts.length > 0\r\n            ? submittedAttempts.reduce((acc, curr) => acc + (curr.results?.percentage || 0), 0) / submittedAttempts.length\r\n            : 0;\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                student,\r\n                enrollments: enrollments || [],\r\n                attempts: attempts || [],\r\n                logs,\r\n                activeSessions,\r\n                stats: {\r\n                    totalEnrollments: enrollments?.length || 0,\r\n                    totalAttempts: attempts?.length || 0,\r\n                    avgPercentage: Math.round(avgPercentage * 10) / 10\r\n                }\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('getStudentDetails error:', error);\r\n        return { error: error?.message || 'An unexpected error occurred while fetching student details' };\r\n    }\r\n}\r\n\r\n/**\r\n * Reset all active sessions for a student (admin only)\r\n */\r\nexport async function resetStudentSessions(userId: string) {\r\n    const supabase = createAdminClient();\r\n\r\n    try {\r\n        // Delete all sessions for this user\r\n        const { error: sessionError } = await supabase\r\n            .schema('auth')\r\n            .from('sessions')\r\n            .delete()\r\n            .eq('user_id', userId);\r\n\r\n        if (sessionError) throw sessionError;\r\n\r\n        // Also delete refresh tokens to ensure they can't get a new session\r\n        const { error: tokenError } = await supabase\r\n            .schema('auth')\r\n            .from('refresh_tokens')\r\n            .delete()\r\n            .eq('user_id', userId);\r\n\r\n        // Note: tokenError might happen if they have no tokens, we can be lenient or log it\r\n\r\n        revalidatePath(`/admin/students/${userId}`);\r\n        return { success: true, message: 'All active sessions have been reset' };\r\n    } catch (error: any) {\r\n        console.error('Reset sessions error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAUsB,aAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/students.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createAdminClient } from '@/lib/supabase/admin';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Add a new student manually (admin only)\r\n * Returns student info if already exists, or creates an invitation\r\n */\r\nexport async function addStudent(data: {\r\n    email: string;\r\n    fullName: string;\r\n    sendInvite?: boolean;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    // Check admin permission\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if student already exists in profiles\r\n        const { data: existing } = await supabase\r\n            .from('profiles')\r\n            .select('id, email, full_name')\r\n            .eq('email', data.email)\r\n            .single();\r\n\r\n        if (existing) {\r\n            return {\r\n                success: true,\r\n                data: existing,\r\n                message: 'Student already exists in the system'\r\n            };\r\n        }\r\n\r\n        // Send invitation email using Supabase Admin\r\n        if (data.sendInvite) {\r\n            const adminClient = createAdminClient();\r\n\r\n            // Invite user via Supabase Auth\r\n            const { data: inviteData, error: inviteError } = await adminClient.auth.admin.inviteUserByEmail(\r\n                data.email,\r\n                {\r\n                    data: {\r\n                        full_name: data.fullName,\r\n                        role: 'student'\r\n                    },\r\n                    redirectTo: `${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/auth/callback`\r\n                }\r\n            );\r\n\r\n            if (inviteError) {\r\n                console.error('Invitation error:', inviteError);\r\n                throw new Error(`Failed to send invitation: ${inviteError.message}`);\r\n            }\r\n\r\n            console.log(`✅ Invitation sent to ${data.email}`, inviteData);\r\n\r\n            // Create profile entry for the invited user\r\n            if (inviteData.user) {\r\n                const { error: profileError } = await adminClient\r\n                    .from('profiles')\r\n                    .insert({\r\n                        id: inviteData.user.id,\r\n                        email: data.email,\r\n                        full_name: data.fullName,\r\n                        role: 'student'\r\n                    });\r\n\r\n                if (profileError) {\r\n                    console.error('Profile creation error:', profileError);\r\n                    // Don't fail the whole operation if profile creation fails\r\n                    // The profile will be created on first login via callback\r\n                }\r\n            }\r\n\r\n            revalidatePath('/admin/students');\r\n            return {\r\n                success: true,\r\n                data: { email: data.email, full_name: data.fullName },\r\n                message: 'Invitation sent successfully! Student will receive an email to join.'\r\n            };\r\n        }\r\n\r\n        // If not sending invite, just return success\r\n        revalidatePath('/admin/students');\r\n        return {\r\n            success: true,\r\n            data: { email: data.email, full_name: data.fullName },\r\n            message: 'Student information saved. They can sign up normally.'\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Add student error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Search students by name or email\r\n */\r\nexport async function searchStudents(query: string) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('profiles')\r\n            .select('id, email, full_name, avatar_url, created_at')\r\n            .eq('role', 'student')\r\n            .or(`full_name.ilike.%${query}%,email.ilike.%${query}%`)\r\n            .order('full_name', { ascending: true })\r\n            .limit(20);\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get all students with their enrollments and expiry info\r\n */\r\nexport async function getStudentsWithEnrollments(filters?: {\r\n    status?: 'all' | 'active' | 'expired';\r\n    expiringWithinDays?: number;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        // Get all students\r\n        const { data: students, error: studentsError } = await supabase\r\n            .from('profiles')\r\n            .select(`\r\n        id,\r\n        email,\r\n        full_name,\r\n        avatar_url,\r\n        created_at\r\n      `)\r\n            .eq('role', 'student')\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (studentsError) throw studentsError;\r\n\r\n        // Get enrollments for each student\r\n        const { data: enrollments, error: enrollmentsError } = await supabase\r\n            .from('enrollments')\r\n            .select(`\r\n        id,\r\n        user_id,\r\n        course_id,\r\n        status,\r\n        expires_at,\r\n        granted_by,\r\n        grant_type,\r\n        courses (\r\n          id,\r\n          title,\r\n          thumbnail_url\r\n        )\r\n      `);\r\n\r\n        if (enrollmentsError) throw enrollmentsError;\r\n\r\n\r\n\r\n        // Combine data\r\n        const studentsWithEnrollments = students?.map(student => {\r\n            const courseEnrollments = enrollments?.filter(e => e.user_id === student.id) || [];\r\n\r\n            // Check expiry status\r\n            const now = new Date();\r\n            const expiringSoon = courseEnrollments.filter(e => {\r\n                if (!e.expires_at) return false;\r\n                const expiryDate = new Date(e.expires_at);\r\n                const daysUntilExpiry = (expiryDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24);\r\n                return daysUntilExpiry > 0 && daysUntilExpiry <= (filters?.expiringWithinDays || 7);\r\n            });\r\n\r\n            return {\r\n                ...student,\r\n                enrollments: courseEnrollments,\r\n                totalEnrollments: courseEnrollments.length,\r\n                expiringSoonCount: expiringSoon.length\r\n            };\r\n        });\r\n\r\n        // Apply filters\r\n        let filtered = studentsWithEnrollments;\r\n        if (filters?.status === 'active') {\r\n            filtered = filtered?.filter(s => s.totalEnrollments > 0);\r\n        } else if (filters?.status === 'expired') {\r\n            filtered = filtered?.filter(s => {\r\n                const hasExpired = (s.enrollments || []).some(e => {\r\n                    if (!e.expires_at) return false;\r\n                    return new Date(e.expires_at) < new Date();\r\n                });\r\n                return hasExpired;\r\n            });\r\n        }\r\n\r\n        return { success: true, data: filtered };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get exam attempts for a specific student\r\n */\r\nexport async function getStudentAttempts(userId: string) {\r\n    const supabase = createAdminClient();\r\n\r\n    try {\r\n        const { data: rawData, error } = await supabase\r\n            .from('exam_attempts')\r\n            .select(`\r\n                *,\r\n                exams (\r\n                    id,\r\n                    title,\r\n                    total_marks\r\n                ),\r\n                results (*)\r\n            `)\r\n            .eq('student_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        // Flatten results\r\n        const data = rawData?.map(att => ({\r\n            ...att,\r\n            results: Array.isArray(att.results) ? att.results[0] : att.results\r\n        })) || [];\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get detailed info for a single student with stats\r\n */\r\nexport async function getStudentDetails(userId: string) {\r\n    try {\r\n        const supabase = createAdminClient();\r\n\r\n        // Get student profile\r\n        const { data: student, error: studentError } = await supabase\r\n            .from('profiles')\r\n            .select('*')\r\n            .eq('id', userId)\r\n            .single();\r\n\r\n        if (studentError) {\r\n            console.error('Student fetch error:', studentError);\r\n            throw new Error(`Failed to fetch student profile: ${studentError.message}`);\r\n        }\r\n\r\n        if (!student) {\r\n            return { error: 'Student not found' };\r\n        }\r\n\r\n        // Get active sessions count\r\n        // Note: Accessing auth schema may require special permissions\r\n        let activeSessions = 0;\r\n        try {\r\n            const { count, error: sessionsError } = await supabase\r\n                .schema('auth')\r\n                .from('sessions')\r\n                .select('*', { count: 'exact', head: true })\r\n                .eq('user_id', userId);\r\n\r\n            if (sessionsError) {\r\n                console.error('Session count error:', sessionsError);\r\n            } else {\r\n                activeSessions = count || 0;\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to fetch session count:', err);\r\n            // Fallback: activeSessions remains 0\r\n        }\r\n\r\n        // Get enrollments\r\n        const { data: enrollments, error: enrollmentsError } = await supabase\r\n            .from('enrollments')\r\n            .select(`\r\n                *,\r\n                courses (\r\n                    id,\r\n                    title,\r\n                    thumbnail_url,\r\n                    price,\r\n                    course_type\r\n                ),\r\n                granted_by_profile:profiles!enrollments_granted_by_fkey (\r\n                    id,\r\n                    full_name\r\n                )\r\n            `)\r\n            .eq('user_id', userId);\r\n\r\n        if (enrollmentsError) {\r\n            console.error('Enrollments fetch error:', enrollmentsError);\r\n            // Don't throw, just log and continue with empty array\r\n        }\r\n\r\n\r\n\r\n        const { data: rawAttempts, error: attemptsError } = await supabase\r\n            .from('exam_attempts')\r\n            .select(`\r\n                *,\r\n                exams (id, title, total_marks),\r\n                results (percentage, obtained_marks)\r\n            `)\r\n            .eq('student_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (attemptsError) {\r\n            console.error('Exam attempts fetch error:', attemptsError);\r\n            // Don't throw, just log and continue with empty array\r\n        }\r\n\r\n        // Transform attempts to handle singular results object\r\n        const attempts = rawAttempts?.map(att => ({\r\n            ...att,\r\n            results: Array.isArray(att.results) ? att.results[0] : att.results\r\n        })) || [];\r\n\r\n        // Get enrollment logs\r\n        const enrollmentIds = enrollments?.map(e => e.id) || [];\r\n\r\n        let logs: any[] = [];\r\n        if (enrollmentIds.length > 0) {\r\n            const { data: logData, error: logsError } = await supabase\r\n                .from('enrollment_logs')\r\n                .select(`\r\n                    *,\r\n                    performed_by_profile:profiles!enrollment_logs_performed_by_fkey (\r\n                        id,\r\n                        full_name\r\n                    )\r\n                `)\r\n                .in('enrollment_id', enrollmentIds)\r\n                .order('created_at', { ascending: false })\r\n                .limit(50);\r\n\r\n            if (logsError) {\r\n                console.error('Enrollment logs fetch error:', logsError);\r\n                // Don't throw, just log and continue with empty array\r\n            } else {\r\n                logs = logData || [];\r\n            }\r\n        }\r\n\r\n        // Calculate Stats\r\n        const submittedAttempts = attempts.filter(a => a.status === 'submitted');\r\n        const avgPercentage = submittedAttempts.length > 0\r\n            ? submittedAttempts.reduce((acc, curr) => acc + (curr.results?.percentage || 0), 0) / submittedAttempts.length\r\n            : 0;\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                student,\r\n                enrollments: enrollments || [],\r\n                attempts: attempts || [],\r\n                logs,\r\n                activeSessions,\r\n                stats: {\r\n                    totalEnrollments: enrollments?.length || 0,\r\n                    totalAttempts: attempts?.length || 0,\r\n                    avgPercentage: Math.round(avgPercentage * 10) / 10\r\n                }\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('getStudentDetails error:', error);\r\n        return { error: error?.message || 'An unexpected error occurred while fetching student details' };\r\n    }\r\n}\r\n\r\n/**\r\n * Reset all active sessions for a student (admin only)\r\n */\r\nexport async function resetStudentSessions(userId: string) {\r\n    const supabase = createAdminClient();\r\n\r\n    try {\r\n        // Delete all sessions for this user\r\n        const { error: sessionError } = await supabase\r\n            .schema('auth')\r\n            .from('sessions')\r\n            .delete()\r\n            .eq('user_id', userId);\r\n\r\n        if (sessionError) throw sessionError;\r\n\r\n        // Also delete refresh tokens to ensure they can't get a new session\r\n        const { error: tokenError } = await supabase\r\n            .schema('auth')\r\n            .from('refresh_tokens')\r\n            .delete()\r\n            .eq('user_id', userId);\r\n\r\n        // Note: tokenError might happen if they have no tokens, we can be lenient or log it\r\n\r\n        revalidatePath(`/admin/students/${userId}`);\r\n        return { success: true, message: 'All active sessions have been reset' };\r\n    } catch (error: any) {\r\n        console.error('Reset sessions error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAuZsB,uBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/hooks/admin/useAdminStudents.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { getStudentsWithEnrollments, addStudent, resetStudentSessions } from '@/actions/admin/students';\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport { toast } from 'sonner';\r\n\r\nexport function useAdminStudents(filters?: { status?: 'all' | 'active' | 'expired'; expiringWithinDays?: number }) {\r\n    return useQuery({\r\n        queryKey: ['admin-students', filters],\r\n        queryFn: async () => {\r\n            const res = await getStudentsWithEnrollments(filters);\r\n            if (res.error) throw new Error(res.error);\r\n            return res.data || [];\r\n        },\r\n        staleTime: 1000 * 60 * 10, // 10 minutes\r\n        gcTime: 1000 * 60 * 30,    // 30 minutes\r\n    });\r\n}\r\n\r\nexport function useStudentDetails(userId: string) {\r\n    return useQuery({\r\n        queryKey: ['admin-student-details', userId],\r\n        queryFn: async () => {\r\n            if (!userId) return null;\r\n\r\n            const supabase = createClient();\r\n\r\n            // Get student profile\r\n            const { data: student, error: studentError } = await supabase\r\n                .from('profiles')\r\n                .select('*')\r\n                .eq('id', userId)\r\n                .single();\r\n\r\n            if (studentError) throw new Error(`Failed to fetch student: ${studentError.message}`);\r\n            if (!student) throw new Error('Student not found');\r\n\r\n            // Get enrollments\r\n            const { data: enrollments } = await supabase\r\n                .from('enrollments')\r\n                .select(`\r\n                    *,\r\n                    courses (\r\n                        id,\r\n                        title,\r\n                        thumbnail_url,\r\n                        price,\r\n                        course_type\r\n                    ),\r\n                    granted_by_profile:profiles!enrollments_granted_by_fkey (\r\n                        id,\r\n                        full_name\r\n                    )\r\n                `)\r\n                .eq('user_id', userId);\r\n\r\n            // Get exam attempts\r\n            const { data: rawAttempts, error } = await supabase\r\n                .from('exam_attempts')\r\n                .select(`\r\n                    *,\r\n                    exams (id, title, total_marks),\r\n                    results (percentage, obtained_marks)\r\n                `)\r\n                .eq('student_id', userId)\r\n                .order('created_at', { ascending: false });\r\n            const attempts = rawAttempts?.map((attempt: any) => ({\r\n                ...attempt,\r\n                exam_title: attempt.exams?.title,\r\n                total_marks: attempt.exams?.total_marks,\r\n                percentage: attempt.results?.[0]?.percentage,\r\n                obtained_marks: attempt.results?.[0]?.obtained_marks\r\n            })) || [];\r\n\r\n\r\n            // Get activity logs\r\n            const { data: logs } = await supabase\r\n                .from('enrollment_logs')\r\n                .select('*')\r\n                .eq('user_id', userId)\r\n                .order('created_at', { ascending: false })\r\n                .limit(50);\r\n\r\n            // Calculate stats\r\n            const stats = {\r\n                totalEnrollments: enrollments?.length || 0,\r\n                activeEnrollments: enrollments?.filter((e: any) => e.status === 'active').length || 0,\r\n                totalAttempts: attempts.length,\r\n                averageScore: attempts.length > 0\r\n                    ? Math.round(attempts.reduce((sum: number, a: any) => sum + (a.percentage || 0), 0) / attempts.length)\r\n                    : 0,\r\n                avgPercentage: attempts.length > 0\r\n                    ? Math.round(attempts.reduce((sum: number, a: any) => sum + (a.percentage || 0), 0) / attempts.length)\r\n                    : 0,\r\n                activeSessions: 0 // Will be populated from device_sessions if needed\r\n            };\r\n\r\n            return {\r\n                student,\r\n                enrollments: enrollments || [],\r\n                attempts,\r\n                logs: logs || [],\r\n                stats\r\n            };\r\n        },\r\n        enabled: !!userId,\r\n        staleTime: 1000 * 60 * 5, // 5 minutes\r\n    });\r\n}\r\n\r\nexport function useAddStudent() {\r\n    const queryClient = useQueryClient();\r\n    return useMutation({\r\n        mutationFn: addStudent,\r\n        onSuccess: (res) => {\r\n            if (res.success) {\r\n                toast.success(res.message || 'Student added successfully');\r\n                queryClient.invalidateQueries({ queryKey: ['admin-students'] });\r\n            } else if (res.error) {\r\n                toast.error(res.error);\r\n            }\r\n        },\r\n        onError: (error: any) => {\r\n            toast.error(error.message || 'Failed to add student');\r\n        }\r\n    });\r\n}\r\n\r\nexport function useResetSessions() {\r\n    const queryClient = useQueryClient();\r\n    return useMutation({\r\n        mutationFn: resetStudentSessions,\r\n        onSuccess: (res, userId) => {\r\n            if (res.success) {\r\n                toast.success(res.message);\r\n                queryClient.invalidateQueries({ queryKey: ['admin-student-details', userId] });\r\n            } else if (res.error) {\r\n                toast.error(res.error);\r\n            }\r\n        },\r\n        onError: (error: any) => {\r\n            toast.error(error.message || 'Failed to reset sessions');\r\n        }\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;;;;;;AAEO,SAAS,iBAAiB,OAAgF;;IAC7G,OAAO,IAAA,0LAAQ,EAAC;QACZ,UAAU;YAAC;YAAkB;SAAQ;QACrC,OAAO;yCAAE;gBACL,MAAM,MAAM,MAAM,IAAA,yLAA0B,EAAC;gBAC7C,IAAI,IAAI,KAAK,EAAE,MAAM,IAAI,MAAM,IAAI,KAAK;gBACxC,OAAO,IAAI,IAAI,IAAI,EAAE;YACzB;;QACA,WAAW,OAAO,KAAK;QACvB,QAAQ,OAAO,KAAK;IACxB;AACJ;GAXgB;;QACL,0LAAQ;;;AAYZ,SAAS,kBAAkB,MAAc;;IAC5C,OAAO,IAAA,0LAAQ,EAAC;QACZ,UAAU;YAAC;YAAyB;SAAO;QAC3C,OAAO;0CAAE;gBACL,IAAI,CAAC,QAAQ,OAAO;gBAEpB,MAAM,WAAW,IAAA,4IAAY;gBAE7B,sBAAsB;gBACtB,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAChD,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,QACT,MAAM;gBAEX,IAAI,cAAc,MAAM,IAAI,MAAM,CAAC,yBAAyB,EAAE,aAAa,OAAO,EAAE;gBACpF,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;gBAE9B,kBAAkB;gBAClB,MAAM,EAAE,MAAM,WAAW,EAAE,GAAG,MAAM,SAC/B,IAAI,CAAC,eACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;gBAaT,CAAC,EACA,EAAE,CAAC,WAAW;gBAEnB,oBAAoB;gBACpB,MAAM,EAAE,MAAM,WAAW,EAAE,KAAK,EAAE,GAAG,MAAM,SACtC,IAAI,CAAC,iBACL,MAAM,CAAC,CAAC;;;;gBAIT,CAAC,EACA,EAAE,CAAC,cAAc,QACjB,KAAK,CAAC,cAAc;oBAAE,WAAW;gBAAM;gBAC5C,MAAM,WAAW,aAAa;kDAAI,CAAC,UAAiB,CAAC;4BACjD,GAAG,OAAO;4BACV,YAAY,QAAQ,KAAK,EAAE;4BAC3B,aAAa,QAAQ,KAAK,EAAE;4BAC5B,YAAY,QAAQ,OAAO,EAAE,CAAC,EAAE,EAAE;4BAClC,gBAAgB,QAAQ,OAAO,EAAE,CAAC,EAAE,EAAE;wBAC1C,CAAC;oDAAM,EAAE;gBAGT,oBAAoB;gBACpB,MAAM,EAAE,MAAM,IAAI,EAAE,GAAG,MAAM,SACxB,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,cAAc;oBAAE,WAAW;gBAAM,GACvC,KAAK,CAAC;gBAEX,kBAAkB;gBAClB,MAAM,QAAQ;oBACV,kBAAkB,aAAa,UAAU;oBACzC,mBAAmB,aAAa;sDAAO,CAAC,IAAW,EAAE,MAAM,KAAK;qDAAU,UAAU;oBACpF,eAAe,SAAS,MAAM;oBAC9B,cAAc,SAAS,MAAM,GAAG,IAC1B,KAAK,KAAK,CAAC,SAAS,MAAM;sDAAC,CAAC,KAAa,IAAW,MAAM,CAAC,EAAE,UAAU,IAAI,CAAC;qDAAG,KAAK,SAAS,MAAM,IACnG;oBACN,eAAe,SAAS,MAAM,GAAG,IAC3B,KAAK,KAAK,CAAC,SAAS,MAAM;sDAAC,CAAC,KAAa,IAAW,MAAM,CAAC,EAAE,UAAU,IAAI,CAAC;qDAAG,KAAK,SAAS,MAAM,IACnG;oBACN,gBAAgB,EAAE,mDAAmD;gBACzE;gBAEA,OAAO;oBACH;oBACA,aAAa,eAAe,EAAE;oBAC9B;oBACA,MAAM,QAAQ,EAAE;oBAChB;gBACJ;YACJ;;QACA,SAAS,CAAC,CAAC;QACX,WAAW,OAAO,KAAK;IAC3B;AACJ;IAzFgB;;QACL,0LAAQ;;;AA0FZ,SAAS;;IACZ,MAAM,cAAc,IAAA,2MAAc;IAClC,OAAO,IAAA,gMAAW,EAAC;QACf,YAAY,yKAAU;QACtB,SAAS;yCAAE,CAAC;gBACR,IAAI,IAAI,OAAO,EAAE;oBACb,oJAAK,CAAC,OAAO,CAAC,IAAI,OAAO,IAAI;oBAC7B,YAAY,iBAAiB,CAAC;wBAAE,UAAU;4BAAC;yBAAiB;oBAAC;gBACjE,OAAO,IAAI,IAAI,KAAK,EAAE;oBAClB,oJAAK,CAAC,KAAK,CAAC,IAAI,KAAK;gBACzB;YACJ;;QACA,OAAO;yCAAE,CAAC;gBACN,oJAAK,CAAC,KAAK,CAAC,MAAM,OAAO,IAAI;YACjC;;IACJ;AACJ;IAhBgB;;QACQ,2MAAc;QAC3B,gMAAW;;;AAgBf,SAAS;;IACZ,MAAM,cAAc,IAAA,2MAAc;IAClC,OAAO,IAAA,gMAAW,EAAC;QACf,YAAY,mLAAoB;QAChC,SAAS;4CAAE,CAAC,KAAK;gBACb,IAAI,IAAI,OAAO,EAAE;oBACb,oJAAK,CAAC,OAAO,CAAC,IAAI,OAAO;oBACzB,YAAY,iBAAiB,CAAC;wBAAE,UAAU;4BAAC;4BAAyB;yBAAO;oBAAC;gBAChF,OAAO,IAAI,IAAI,KAAK,EAAE;oBAClB,oJAAK,CAAC,KAAK,CAAC,IAAI,KAAK;gBACzB;YACJ;;QACA,OAAO;4CAAE,CAAC;gBACN,oJAAK,CAAC,KAAK,CAAC,MAAM,OAAO,IAAI;YACjC;;IACJ;AACJ;IAhBgB;;QACQ,2MAAc;QAC3B,gMAAW"}},
    {"offset": {"line": 251, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/hooks/admin/useUserActions.ts"],"sourcesContent":["import { useState } from 'react';\r\nimport { toast } from 'sonner';\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\r\n// import { toggleUserBlock, deleteUserChatHistory, checkUserBanStatus } from '@/actions/admin/userActions';\r\nimport { createClient } from '@/lib/supabase/client';\r\n\r\ninterface UserActionsParams {\r\n    userId: string;\r\n    userName: string;\r\n}\r\n\r\nexport function useUserActions({ userId, userName }: UserActionsParams) {\r\n    const queryClient = useQueryClient();\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [isBanned, setIsBanned] = useState<boolean | null>(null);\r\n\r\n    // Confirmation dialog states\r\n    const [blockDialogOpen, setBlockDialogOpen] = useState(false);\r\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n    const [editProfileOpen, setEditProfileOpen] = useState(false);\r\n    const [confirmAction, setConfirmAction] = useState<'block' | 'unblock' | null>(null);\r\n\r\n    // Prepare Supabase client for RPC calls\r\n    const supabase = createClient();\r\n\r\n    // Block/Unblock user mutation using RPC\r\n    const toggleBlockMutation = useMutation({\r\n        mutationFn: async () => {\r\n            // Using RPC instead of Server Action to avoid Cloudflare 404s\r\n            const { data, error } = await supabase.rpc('toggle_user_ban', {\r\n                target_user_id: userId\r\n            });\r\n\r\n            if (error) throw error;\r\n\r\n            // Check formatted response from RPC\r\n            // Expected: { success: true, action: 'blocked' | 'unblocked' }\r\n            const result = data as any;\r\n            if (!result.success) throw new Error(result.error || 'Failed to toggle ban');\r\n\r\n            return result;\r\n        },\r\n        onSuccess: (data: any) => {\r\n            toast.success(`User ${data.action} successfully`);\r\n            setIsBanned(data.action === 'blocked');\r\n            queryClient.invalidateQueries({ queryKey: ['student-details', userId] });\r\n        },\r\n        onError: (error: any) => {\r\n            toast.error('Failed to update user status: ' + error.message);\r\n        }\r\n    });\r\n\r\n    // Delete chat history mutation - Now using RPC\r\n    const deleteChatMutation = useMutation({\r\n        mutationFn: async () => {\r\n            const { data, error } = await supabase.rpc('delete_user_chat_history', {\r\n                target_user_id: userId\r\n            });\r\n\r\n            if (error) throw error;\r\n\r\n            const result = data as any;\r\n            if (!result.success) throw new Error(result.error || 'Failed to delete chat history');\r\n\r\n            return result;\r\n        },\r\n        onSuccess: () => {\r\n            toast.success('Chat history deleted successfully');\r\n        },\r\n        onError: (error: any) => {\r\n            toast.error('Failed to delete chat history: ' + error.message);\r\n        }\r\n    });\r\n\r\n    // Block/Unblock handler - opens confirmation dialog\r\n    const handleToggleBlock = async () => {\r\n        try {\r\n            setIsLoading(true);\r\n\r\n            // Check current ban status via RPC\r\n            const { data, error } = await supabase.rpc('check_user_ban_status', {\r\n                target_user_id: userId\r\n            });\r\n\r\n            if (error) throw error;\r\n\r\n            const result = data as any;\r\n            if (!result.success) throw new Error(result.error);\r\n\r\n            const currentlyBanned = result.isBanned ?? false;\r\n            setIsBanned(currentlyBanned);\r\n            setConfirmAction(currentlyBanned ? 'unblock' : 'block');\r\n            setBlockDialogOpen(true);\r\n        } catch (error: any) {\r\n            console.error('Ban status check failed:', error);\r\n            // Fallback: If RPC fails (e.g. not created yet), default to 'block' logic but warn\r\n            // toast.error('Failed to check status: ' + error.message);\r\n            // For smoother UX before SQL is applied, we might assume unblocked\r\n            toast.error(`Error checking status: ${error.message}. ensure admin_rpc_functions.sql is applied.`);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Confirm block/unblock action\r\n    const confirmToggleBlock = async () => {\r\n        await toggleBlockMutation.mutateAsync();\r\n    };\r\n\r\n    // Delete chat handler - opens confirmation dialog\r\n    const handleDeleteChat = () => {\r\n        setDeleteDialogOpen(true);\r\n    };\r\n\r\n    // Confirm delete chat action\r\n    const confirmDeleteChat = async () => {\r\n        await deleteChatMutation.mutateAsync();\r\n    };\r\n\r\n    // Edit profile handler - opens edit dialog\r\n    const handleEditProfile = () => {\r\n        setEditProfileOpen(true);\r\n    };\r\n\r\n    return {\r\n        handleToggleBlock,\r\n        handleDeleteChat,\r\n        handleEditProfile,\r\n        confirmToggleBlock,\r\n        confirmDeleteChat,\r\n        isLoading: isLoading || toggleBlockMutation.isPending || deleteChatMutation.isPending,\r\n        isBlocking: toggleBlockMutation.isPending,\r\n        isDeleting: deleteChatMutation.isPending,\r\n        isBanned,\r\n        // Dialog states\r\n        blockDialogOpen,\r\n        setBlockDialogOpen,\r\n        deleteDialogOpen,\r\n        setDeleteDialogOpen,\r\n        editProfileOpen,\r\n        setEditProfileOpen,\r\n        confirmAction,\r\n        userName,\r\n    };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 412, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ui/tabs.tsx"],"sourcesContent":["'use client'\r\n// Force recompile\r\n\r\nimport * as React from 'react'\r\nimport * as TabsPrimitive from '@radix-ui/react-tabs'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction Tabs({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.Root>) {\r\n  return (\r\n    <TabsPrimitive.Root\r\n      data-slot=\"tabs\"\r\n      className={cn('flex flex-col gap-2', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction TabsList({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.List>) {\r\n  return (\r\n    <TabsPrimitive.List\r\n      data-slot=\"tabs-list\"\r\n      className={cn(\r\n        'bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction TabsTrigger({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {\r\n  return (\r\n    <TabsPrimitive.Trigger\r\n      data-slot=\"tabs-trigger\"\r\n      className={cn(\r\n        \"data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction TabsContent({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.Content>) {\r\n  return (\r\n    <TabsPrimitive.Content\r\n      data-slot=\"tabs-content\"\r\n      className={cn('flex-1 outline-none', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\r\n"],"names":[],"mappings":";;;;;;;;;;;AAIA;AAEA;AANA;;;;AAQA,SAAS,KAAK,EACZ,SAAS,EACT,GAAG,OAC6C;IAChD,qBACE,6LAAC,2KAAkB;QACjB,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,SAAS,EAChB,SAAS,EACT,GAAG,OAC6C;IAChD,qBACE,6LAAC,2KAAkB;QACjB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,uGACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,6LAAC,8KAAqB;QACpB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,mqBACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,6LAAC,8KAAqB;QACpB,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf;MAXS"}},
    {"offset": {"line": 490, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ui/progress.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from 'react'\r\nimport * as ProgressPrimitive from '@radix-ui/react-progress'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction Progress({\r\n  className,\r\n  value,\r\n  indicatorClassName,\r\n  ...props\r\n}: React.ComponentProps<typeof ProgressPrimitive.Root> & { indicatorClassName?: string }) {\r\n  return (\r\n    <ProgressPrimitive.Root\r\n      data-slot=\"progress\"\r\n      className={cn(\r\n        'bg-primary/20 relative h-2 w-full overflow-hidden rounded-full',\r\n        className,\r\n      )}\r\n      {...props}\r\n    >\r\n      <ProgressPrimitive.Indicator\r\n        data-slot=\"progress-indicator\"\r\n        className={cn(\"bg-primary h-full w-full flex-1 transition-all\", indicatorClassName)}\r\n        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\r\n      />\r\n    </ProgressPrimitive.Root>\r\n  )\r\n}\r\n\r\nexport { Progress }\r\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,SAAS,EAChB,SAAS,EACT,KAAK,EACL,kBAAkB,EAClB,GAAG,OACmF;IACtF,qBACE,6LAAC,+KAAsB;QACrB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,oLAA2B;YAC1B,aAAU;YACV,WAAW,IAAA,qHAAE,EAAC,kDAAkD;YAChE,OAAO;gBAAE,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;YAAC;;;;;;;;;;;AAIlE;KAtBS"}},
    {"offset": {"line": 534, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ui/skeleton.tsx"],"sourcesContent":["import { cn } from '@/lib/utils'\r\n\r\nfunction Skeleton({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"skeleton\"\r\n      className={cn('bg-accent animate-pulse rounded-md', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Skeleton }\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAEA,SAAS,SAAS,EAAE,SAAS,EAAE,GAAG,OAAoC;IACpE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,sCAAsC;QACnD,GAAG,KAAK;;;;;;AAGf;KARS"}},
    {"offset": {"line": 564, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ui/dropdown-menu.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from 'react'\r\nimport * as DropdownMenuPrimitive from '@radix-ui/react-dropdown-menu'\r\nimport { CheckIcon, ChevronRightIcon, CircleIcon } from 'lucide-react'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction DropdownMenu({\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {\r\n  return <DropdownMenuPrimitive.Root data-slot=\"dropdown-menu\" {...props} />\r\n}\r\n\r\nfunction DropdownMenuPortal({\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {\r\n  return (\r\n    <DropdownMenuPrimitive.Portal data-slot=\"dropdown-menu-portal\" {...props} />\r\n  )\r\n}\r\n\r\nfunction DropdownMenuTrigger({\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {\r\n  return (\r\n    <DropdownMenuPrimitive.Trigger\r\n      data-slot=\"dropdown-menu-trigger\"\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DropdownMenuContent({\r\n  className,\r\n  sideOffset = 4,\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {\r\n  return (\r\n    <DropdownMenuPrimitive.Portal>\r\n      <DropdownMenuPrimitive.Content\r\n        data-slot=\"dropdown-menu-content\"\r\n        sideOffset={sideOffset}\r\n        className={cn(\r\n          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md',\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    </DropdownMenuPrimitive.Portal>\r\n  )\r\n}\r\n\r\nfunction DropdownMenuGroup({\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {\r\n  return (\r\n    <DropdownMenuPrimitive.Group data-slot=\"dropdown-menu-group\" {...props} />\r\n  )\r\n}\r\n\r\nfunction DropdownMenuItem({\r\n  className,\r\n  inset,\r\n  variant = 'default',\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {\r\n  inset?: boolean\r\n  variant?: 'default' | 'destructive'\r\n}) {\r\n  return (\r\n    <DropdownMenuPrimitive.Item\r\n      data-slot=\"dropdown-menu-item\"\r\n      data-inset={inset}\r\n      data-variant={variant}\r\n      className={cn(\r\n        \"focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DropdownMenuCheckboxItem({\r\n  className,\r\n  children,\r\n  checked,\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {\r\n  return (\r\n    <DropdownMenuPrimitive.CheckboxItem\r\n      data-slot=\"dropdown-menu-checkbox-item\"\r\n      className={cn(\r\n        \"focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\r\n        className,\r\n      )}\r\n      checked={checked}\r\n      {...props}\r\n    >\r\n      <span className=\"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center\">\r\n        <DropdownMenuPrimitive.ItemIndicator>\r\n          <CheckIcon className=\"size-4\" />\r\n        </DropdownMenuPrimitive.ItemIndicator>\r\n      </span>\r\n      {children}\r\n    </DropdownMenuPrimitive.CheckboxItem>\r\n  )\r\n}\r\n\r\nfunction DropdownMenuRadioGroup({\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {\r\n  return (\r\n    <DropdownMenuPrimitive.RadioGroup\r\n      data-slot=\"dropdown-menu-radio-group\"\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DropdownMenuRadioItem({\r\n  className,\r\n  children,\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {\r\n  return (\r\n    <DropdownMenuPrimitive.RadioItem\r\n      data-slot=\"dropdown-menu-radio-item\"\r\n      className={cn(\r\n        \"focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    >\r\n      <span className=\"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center\">\r\n        <DropdownMenuPrimitive.ItemIndicator>\r\n          <CircleIcon className=\"size-2 fill-current\" />\r\n        </DropdownMenuPrimitive.ItemIndicator>\r\n      </span>\r\n      {children}\r\n    </DropdownMenuPrimitive.RadioItem>\r\n  )\r\n}\r\n\r\nfunction DropdownMenuLabel({\r\n  className,\r\n  inset,\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {\r\n  inset?: boolean\r\n}) {\r\n  return (\r\n    <DropdownMenuPrimitive.Label\r\n      data-slot=\"dropdown-menu-label\"\r\n      data-inset={inset}\r\n      className={cn(\r\n        'px-2 py-1.5 text-sm font-medium data-[inset]:pl-8',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DropdownMenuSeparator({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {\r\n  return (\r\n    <DropdownMenuPrimitive.Separator\r\n      data-slot=\"dropdown-menu-separator\"\r\n      className={cn('bg-border -mx-1 my-1 h-px', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DropdownMenuShortcut({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<'span'>) {\r\n  return (\r\n    <span\r\n      data-slot=\"dropdown-menu-shortcut\"\r\n      className={cn(\r\n        'text-muted-foreground ml-auto text-xs tracking-widest',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DropdownMenuSub({\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {\r\n  return <DropdownMenuPrimitive.Sub data-slot=\"dropdown-menu-sub\" {...props} />\r\n}\r\n\r\nfunction DropdownMenuSubTrigger({\r\n  className,\r\n  inset,\r\n  children,\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {\r\n  inset?: boolean\r\n}) {\r\n  return (\r\n    <DropdownMenuPrimitive.SubTrigger\r\n      data-slot=\"dropdown-menu-sub-trigger\"\r\n      data-inset={inset}\r\n      className={cn(\r\n        \"focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    >\r\n      {children}\r\n      <ChevronRightIcon className=\"ml-auto size-4\" />\r\n    </DropdownMenuPrimitive.SubTrigger>\r\n  )\r\n}\r\n\r\nfunction DropdownMenuSubContent({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {\r\n  return (\r\n    <DropdownMenuPrimitive.SubContent\r\n      data-slot=\"dropdown-menu-sub-content\"\r\n      className={cn(\r\n        'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport {\r\n  DropdownMenu,\r\n  DropdownMenuPortal,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuContent,\r\n  DropdownMenuGroup,\r\n  DropdownMenuLabel,\r\n  DropdownMenuItem,\r\n  DropdownMenuCheckboxItem,\r\n  DropdownMenuRadioGroup,\r\n  DropdownMenuRadioItem,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuShortcut,\r\n  DropdownMenuSub,\r\n  DropdownMenuSubTrigger,\r\n  DropdownMenuSubContent,\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 873, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/admin/StatusBadges.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface StatusBadgeProps {\r\n    status: 'active' | 'expired' | 'draft' | 'published' | 'archived' | 'pending' | 'completed' | 'refunded';\r\n    className?: string;\r\n    size?: 'sm' | 'md' | 'lg';\r\n}\r\n\r\nconst statusConfig = {\r\n    active: {\r\n        label: 'Active',\r\n        bg: 'bg-emerald-50 dark:bg-emerald-500/10',\r\n        border: 'border-emerald-200 dark:border-emerald-500/20',\r\n        text: 'text-emerald-700 dark:text-emerald-400',\r\n        dot: 'bg-emerald-500'\r\n    },\r\n    expired: {\r\n        label: 'Expired',\r\n        bg: 'bg-red-50 dark:bg-red-500/10',\r\n        border: 'border-red-200 dark:border-red-500/20',\r\n        text: 'text-red-700 dark:text-red-400',\r\n        dot: 'bg-red-500'\r\n    },\r\n    draft: {\r\n        label: 'Draft',\r\n        bg: 'bg-slate-50 dark:bg-slate-500/10',\r\n        border: 'border-slate-200 dark:border-slate-500/20',\r\n        text: 'text-slate-700 dark:text-slate-400',\r\n        dot: 'bg-slate-500'\r\n    },\r\n    published: {\r\n        label: 'Published',\r\n        bg: 'bg-blue-50 dark:bg-blue-500/10',\r\n        border: 'border-blue-200 dark:border-blue-500/20',\r\n        text: 'text-blue-700 dark:text-blue-400',\r\n        dot: 'bg-blue-500'\r\n    },\r\n    archived: {\r\n        label: 'Archived',\r\n        bg: 'bg-amber-50 dark:bg-amber-500/10',\r\n        border: 'border-amber-200 dark:border-amber-500/20',\r\n        text: 'text-amber-700 dark:text-amber-400',\r\n        dot: 'bg-amber-500'\r\n    },\r\n    pending: {\r\n        label: 'Pending',\r\n        bg: 'bg-yellow-50 dark:bg-yellow-500/10',\r\n        border: 'border-yellow-200 dark:border-yellow-500/20',\r\n        text: 'text-yellow-700 dark:text-yellow-400',\r\n        dot: 'bg-yellow-500'\r\n    },\r\n    completed: {\r\n        label: 'Completed',\r\n        bg: 'bg-purple-50 dark:bg-purple-500/10',\r\n        border: 'border-purple-200 dark:border-purple-500/20',\r\n        text: 'text-purple-700 dark:text-purple-400',\r\n        dot: 'bg-purple-500'\r\n    },\r\n    refunded: {\r\n        label: 'Revoked',\r\n        bg: 'bg-orange-50 dark:bg-orange-500/10',\r\n        border: 'border-orange-200 dark:border-orange-500/20',\r\n        text: 'text-orange-700 dark:text-orange-400',\r\n        dot: 'bg-orange-500'\r\n    }\r\n};\r\n\r\nconst sizeConfig = {\r\n    sm: 'text-[10px] px-2 py-0.5 gap-1',\r\n    md: 'text-xs px-3 py-1 gap-1.5',\r\n    lg: 'text-sm px-4 py-1.5 gap-2'\r\n};\r\n\r\nexport function StatusBadge({ status, className, size = 'md' }: StatusBadgeProps) {\r\n    const config = statusConfig[status];\r\n\r\n    return (\r\n        <div className={cn(\r\n            \"inline-flex items-center font-bold uppercase tracking-wider rounded-full border transition-colors\",\r\n            config.bg,\r\n            config.border,\r\n            config.text,\r\n            sizeConfig[size],\r\n            className\r\n        )}>\r\n            <div className={cn(\"w-1.5 h-1.5 rounded-full animate-pulse\", config.dot)} />\r\n            {config.label}\r\n        </div>\r\n    );\r\n}\r\n\r\ninterface ExpiryBadgeProps {\r\n    expiresAt: string | Date | null;\r\n    className?: string;\r\n}\r\n\r\nexport function ExpiryBadge({ expiresAt, className }: ExpiryBadgeProps) {\r\n    if (!expiresAt) {\r\n        return (\r\n            <div className={cn(\r\n                \"inline-flex items-center text-[10px] font-black uppercase tracking-widest px-2.5 py-1 rounded-full\",\r\n                \"bg-indigo-50 dark:bg-indigo-500/10 border border-indigo-200 dark:border-indigo-500/20\",\r\n                \"text-indigo-700 dark:text-indigo-400\",\r\n                className\r\n            )}>\r\n                ∞ Lifetime\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const expiryDate = new Date(expiresAt);\r\n    const now = new Date();\r\n    const daysUntilExpiry = Math.ceil((expiryDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\r\n\r\n    if (daysUntilExpiry < 0) {\r\n        return <StatusBadge status=\"expired\" size=\"sm\" className={className} />;\r\n    }\r\n\r\n    if (daysUntilExpiry <= 3) {\r\n        return (\r\n            <div className={cn(\r\n                \"inline-flex items-center text-[10px] font-black uppercase tracking-widest px-2.5 py-1 rounded-full gap-1\",\r\n                \"bg-red-50 dark:bg-red-500/10 border border-red-200 dark:border-red-500/20\",\r\n                \"text-red-700 dark:text-red-400 animate-pulse\",\r\n                className\r\n            )}>\r\n                <span className=\"relative flex h-2 w-2\">\r\n                    <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\r\n                    <span className=\"relative inline-flex rounded-full h-2 w-2 bg-red-500\"></span>\r\n                </span>\r\n                {daysUntilExpiry}d left\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (daysUntilExpiry <= 7) {\r\n        return (\r\n            <div className={cn(\r\n                \"inline-flex items-center text-[10px] font-black uppercase tracking-widest px-2.5 py-1 rounded-full gap-1\",\r\n                \"bg-amber-50 dark:bg-amber-500/10 border border-amber-200 dark:border-amber-500/20\",\r\n                \"text-amber-700 dark:text-amber-400\",\r\n                className\r\n            )}>\r\n                <div className=\"w-1.5 h-1.5 rounded-full bg-amber-500\" />\r\n                {daysUntilExpiry}d left\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (daysUntilExpiry <= 30) {\r\n        return (\r\n            <div className={cn(\r\n                \"inline-flex items-center text-[10px] font-bold uppercase tracking-wider px-2.5 py-1 rounded-full\",\r\n                \"bg-green-50 dark:bg-green-500/10 border border-green-200 dark:border-green-500/20\",\r\n                \"text-green-700 dark:text-green-400\",\r\n                className\r\n            )}>\r\n                {daysUntilExpiry}d\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={cn(\r\n            \"inline-flex items-center text-[10px] font-bold uppercase tracking-wider px-2.5 py-1 rounded-full\",\r\n            \"bg-slate-50 dark:bg-slate-500/10 border border-slate-200 dark:border-slate-500/20\",\r\n            \"text-slate-600 dark:text-slate-400\",\r\n            className\r\n        )}>\r\n            {expiryDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n        </div>\r\n    );\r\n}\r\n\r\ninterface GrantTypeBadgeProps {\r\n    grantType: 'manual' | 'payment' | 'free';\r\n    className?: string;\r\n}\r\n\r\nexport function GrantTypeBadge({ grantType, className }: GrantTypeBadgeProps) {\r\n    const config = {\r\n        manual: {\r\n            label: '👤 Admin',\r\n            bg: 'bg-violet-50 dark:bg-violet-500/10',\r\n            border: 'border-violet-200 dark:border-violet-500/20',\r\n            text: 'text-violet-700 dark:text-violet-400'\r\n        },\r\n        payment: {\r\n            label: '💳 Paid',\r\n            bg: 'bg-emerald-50 dark:bg-emerald-500/10',\r\n            border: 'border-emerald-200 dark:border-emerald-500/20',\r\n            text: 'text-emerald-700 dark:text-emerald-400'\r\n        },\r\n        free: {\r\n            label: '🎁 Free',\r\n            bg: 'bg-sky-50 dark:bg-sky-500/10',\r\n            border: 'border-sky-200 dark:border-sky-500/20',\r\n            text: 'text-sky-700 dark:text-sky-400'\r\n        }\r\n    };\r\n\r\n    const c = config[grantType];\r\n\r\n    return (\r\n        <div className={cn(\r\n            \"inline-flex items-center text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-md border\",\r\n            c.bg,\r\n            c.border,\r\n            c.text,\r\n            className\r\n        )}>\r\n            {c.label}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1120, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/grantAccess.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Grant course access to a student with optional expiry\r\n */\r\nexport async function grantCourseAccess(data: {\r\n    userId: string;\r\n    courseId: string;\r\n    expiresAt?: Date | null;\r\n    notes?: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    // Get admin user\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if enrollment already exists\r\n        const { data: existing } = await supabase\r\n            .from('enrollments')\r\n            .select('id, status, expires_at')\r\n            .eq('user_id', data.userId)\r\n            .eq('course_id', data.courseId)\r\n            .single();\r\n\r\n        let enrollment;\r\n\r\n        if (existing) {\r\n            // Update existing enrollment\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    status: 'active',\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual'\r\n                })\r\n                .eq('id', existing.id)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = updated;\r\n\r\n            // Log the modification\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'modified',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: existing.id,\r\n                p_previous_expiry: existing.expires_at,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Access modified by admin'\r\n            });\r\n        } else {\r\n            // Create new enrollment\r\n            const { data: newEnrollment, error } = await supabase\r\n                .from('enrollments')\r\n                .insert({\r\n                    user_id: data.userId,\r\n                    course_id: data.courseId,\r\n                    status: 'active',\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual'\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = newEnrollment;\r\n\r\n            // Log the grant\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'granted',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: newEnrollment.id,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Access granted by admin'\r\n            });\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true, data: enrollment };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Grant test series access to a student\r\n */\r\nexport async function grantTestSeriesAccess(data: {\r\n    userId: string;\r\n    testSeriesId: string;\r\n    expiresAt?: Date | null;\r\n    notes?: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if enrollment already exists\r\n        const { data: existing } = await supabase\r\n            .from('enrollments')\r\n            .select('id, expires_at')\r\n            .eq('user_id', data.userId)\r\n            .eq('course_id', data.testSeriesId)\r\n            .single();\r\n\r\n        let enrollment;\r\n\r\n        if (existing) {\r\n            // Update existing\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual'\r\n                })\r\n                .eq('id', existing.id)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = updated;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'modified',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: existing.id,\r\n                p_previous_expiry: existing.expires_at,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Test series access modified'\r\n            });\r\n        } else {\r\n            // Create new\r\n            const { data: newEnrollment, error } = await supabase\r\n                .from('enrollments')\r\n                .insert({\r\n                    user_id: data.userId,\r\n                    course_id: data.testSeriesId,\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual',\r\n                    status: 'active'\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = newEnrollment;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'granted',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: newEnrollment.id,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Test series access granted'\r\n            });\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true, data: enrollment };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Revoke course or test series access\r\n */\r\nexport async function revokeAccess(data: {\r\n    enrollmentId: string;\r\n    type: 'course';\r\n    reason: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        if (data.type === 'course') {\r\n            const { error } = await supabase\r\n                .from('enrollments')\r\n                .update({ status: 'refunded' }) // Using 'refunded' to indicate revoked\r\n                .eq('id', data.enrollmentId);\r\n\r\n            if (error) throw error;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'revoked',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_notes: data.reason\r\n            });\r\n        } else {\r\n            const { error } = await supabase\r\n                .from('enrollments')\r\n                .update({ status: 'refunded' })\r\n                .eq('id', data.enrollmentId);\r\n\r\n            if (error) throw error;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'revoked',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_notes: data.reason\r\n            });\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Extend access expiry date\r\n */\r\nexport async function extendAccess(data: {\r\n    enrollmentId: string;\r\n    type: 'course';\r\n    newExpiryDate: Date;\r\n    notes?: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    console.log('[extendAccess] Starting update:', {\r\n        enrollmentId: data.enrollmentId,\r\n        type: data.type,\r\n        newExpiryDate: data.newExpiryDate,\r\n        isoDate: data.newExpiryDate.toISOString()\r\n    });\r\n\r\n    try {\r\n        let previousExpiry;\r\n        let updateError;\r\n\r\n        if (data.type === 'course') {\r\n            // Get current enrollment\r\n            const { data: existing, error: fetchError } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at, user_id')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            if (fetchError) {\r\n                console.error('[extendAccess] Error fetching enrollment:', fetchError);\r\n                throw new Error(`Failed to find enrollment: ${fetchError.message}`);\r\n            }\r\n\r\n            console.log('[extendAccess] Current enrollment:', existing);\r\n            previousExpiry = existing?.expires_at;\r\n\r\n            // Update the expiry date\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    expires_at: data.newExpiryDate.toISOString(),\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', data.enrollmentId)\r\n                .select();\r\n\r\n            updateError = error;\r\n            console.log('[extendAccess] Update result:', { updated, error });\r\n\r\n            if (error) throw error;\r\n\r\n            if (!updated || updated.length === 0) {\r\n                throw new Error('No rows were updated. Enrollment may not exist.');\r\n            }\r\n\r\n            // Verify the update\r\n            const { data: verified } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            console.log('[extendAccess] Verified expiry after update:', verified);\r\n\r\n            if (!verified?.expires_at) {\r\n                throw new Error('Update succeeded but expires_at is still null');\r\n            }\r\n\r\n            // Log the action\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'extended',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_previous_expiry: previousExpiry,\r\n                p_new_expiry: data.newExpiryDate.toISOString(),\r\n                p_notes: data.notes || 'Access period extended'\r\n            });\r\n        } else {\r\n            // Test series enrollment\r\n            const { data: existing, error: fetchError } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at, user_id')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            if (fetchError) {\r\n                console.error('[extendAccess] Error fetching test series enrollment:', fetchError);\r\n                throw new Error(`Failed to find test series enrollment: ${fetchError.message}`);\r\n            }\r\n\r\n            console.log('[extendAccess] Current test series enrollment:', existing);\r\n            previousExpiry = existing?.expires_at;\r\n\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    expires_at: data.newExpiryDate.toISOString(),\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', data.enrollmentId)\r\n                .select();\r\n\r\n            updateError = error;\r\n            console.log('[extendAccess] Test series update result:', { updated, error });\r\n\r\n            if (error) throw error;\r\n\r\n            if (!updated || updated.length === 0) {\r\n                throw new Error('No rows were updated. Test series enrollment may not exist.');\r\n            }\r\n\r\n            // Verify the update\r\n            const { data: verified } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            console.log('[extendAccess] Verified test series expiry after update:', verified);\r\n\r\n            if (!verified?.expires_at) {\r\n                throw new Error('Update succeeded but expires_at is still null');\r\n            }\r\n\r\n            // Log the action\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'extended',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_previous_expiry: previousExpiry,\r\n                p_new_expiry: data.newExpiryDate.toISOString(),\r\n                p_notes: data.notes || 'Access period extended'\r\n            });\r\n        }\r\n\r\n        console.log('[extendAccess] Update completed successfully');\r\n        revalidatePath('/admin/students');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('[extendAccess] Error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get expiring subscriptions (within specified days)\r\n */\r\nexport async function getExpiringSubscriptions(daysAhead: number = 7) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('expiring_enrollments_view')\r\n            .select('*')\r\n            .lte('days_until_expiry', daysAhead)\r\n            .order('days_until_expiry', { ascending: true });\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get recent enrollment logs\r\n */\r\nexport async function getRecentAccessLogs(limit: number = 50) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('enrollment_logs')\r\n            .select(`\r\n        *,\r\n        performed_by_profile:profiles!enrollment_logs_performed_by_fkey (\r\n          id,\r\n          full_name,\r\n          email\r\n        )\r\n      `)\r\n            .order('created_at', { ascending: false })\r\n            .limit(limit);\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAiQsB,eAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 1135, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/admin/EditExpiryDialog.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { extendAccess } from '@/actions/admin/grantAccess';\r\nimport { toast } from 'sonner';\r\nimport { Loader2, Calendar, AlertCircle } from 'lucide-react';\r\n\r\ninterface EditExpiryDialogProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    onSuccess?: () => void;\r\n    enrollment: {\r\n        id: string;\r\n        type: 'course';\r\n        studentName: string;\r\n        courseName: string;\r\n        currentExpiry: string | null;\r\n    } | null;\r\n}\r\n\r\nexport function EditExpiryDialog({ open, onOpenChange, onSuccess, enrollment }: EditExpiryDialogProps) {\r\n    const [loading, setLoading] = useState(false);\r\n    const [formData, setFormData] = useState({\r\n        newExpiryDate: '',\r\n        notes: ''\r\n    });\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (!enrollment || !formData.newExpiryDate) {\r\n            toast.error('Please select an expiry date');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n\r\n        try {\r\n            const result = await extendAccess({\r\n                enrollmentId: enrollment.id,\r\n                type: enrollment.type,\r\n                newExpiryDate: new Date(formData.newExpiryDate),\r\n                notes: formData.notes || 'Expiry date updated by admin'\r\n            });\r\n\r\n            if (result.error) {\r\n                toast.error(result.error);\r\n            } else {\r\n                toast.success('Expiry date updated successfully! 🎉');\r\n                onOpenChange(false);\r\n                setFormData({ newExpiryDate: '', notes: '' });\r\n\r\n                // Reload student data for instant UI update\r\n                onSuccess?.();\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.message || 'Failed to update expiry date');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"sm:max-w-[500px] bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800\">\r\n                {/* Decorative gradient header */}\r\n                <div className=\"absolute top-0 left-0 right-0 h-1 bg-linear-to-r from-amber-500 via-orange-500 to-red-500\" />\r\n\r\n                <DialogHeader className=\"space-y-3 pt-2\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2.5 rounded-xl bg-linear-to-br from-amber-500 to-orange-600 shadow-lg shadow-amber-200 dark:shadow-none\">\r\n                            <Calendar className=\"w-5 h-5 text-white\" />\r\n                        </div>\r\n                        <div>\r\n                            <DialogTitle className=\"text-2xl font-bold tracking-tight text-slate-900 dark:text-white\">\r\n                                Edit Expiry Date\r\n                            </DialogTitle>\r\n                            <DialogDescription className=\"text-sm text-slate-500 dark:text-slate-400\">\r\n                                Update subscription expiry for enrolled student\r\n                            </DialogDescription>\r\n                        </div>\r\n                    </div>\r\n                </DialogHeader>\r\n\r\n                {enrollment && (\r\n                    <form onSubmit={handleSubmit} className=\"space-y-5 mt-4\">\r\n                        {/* Student Info */}\r\n                        <div className=\"p-4 rounded-lg bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700\">\r\n                            <div className=\"space-y-1\">\r\n                                <p className=\"text-sm font-semibold text-slate-900 dark:text-white\">\r\n                                    {enrollment.studentName}\r\n                                </p>\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                    {enrollment.courseName}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Current Expiry */}\r\n                        {enrollment.currentExpiry && (\r\n                            <div className=\"flex items-center gap-2 p-3 rounded-lg bg-amber-50 dark:bg-amber-500/10 border border-amber-200 dark:border-amber-500/20\">\r\n                                <AlertCircle className=\"w-4 h-4 text-amber-600 dark:text-amber-400\" />\r\n                                <div className=\"flex-1\">\r\n                                    <p className=\"text-xs font-semibold text-amber-900 dark:text-amber-100\">Current Expiry</p>\r\n                                    <p className=\"text-xs text-amber-600 dark:text-amber-400\">\r\n                                        {new Date(enrollment.currentExpiry).toLocaleDateString('en-US', {\r\n                                            year: 'numeric',\r\n                                            month: 'long',\r\n                                            day: 'numeric'\r\n                                        })}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* New Expiry Date */}\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"newExpiryDate\" className=\"text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center gap-2\">\r\n                                <Calendar className=\"w-4 h-4 text-amber-500\" />\r\n                                New Expiry Date\r\n                            </Label>\r\n                            <Input\r\n                                id=\"newExpiryDate\"\r\n                                type=\"date\"\r\n                                value={formData.newExpiryDate}\r\n                                onChange={(e) => setFormData({ ...formData, newExpiryDate: e.target.value })}\r\n                                min={new Date().toISOString().split('T')[0]}\r\n                                required\r\n                                className=\"h-11 bg-slate-50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700\"\r\n                            />\r\n                            <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                                Select a future date or clear for lifetime access\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Notes */}\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"notes\" className=\"text-sm font-semibold text-slate-700 dark:text-slate-300\">\r\n                                Notes (Optional)\r\n                            </Label>\r\n                            <Textarea\r\n                                id=\"notes\"\r\n                                value={formData.notes}\r\n                                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                                placeholder=\"Reason for updating expiry date...\"\r\n                                className=\"min-h-[80px] bg-slate-50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700\"\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Action Buttons */}\r\n                        <div className=\"flex gap-3 pt-2\">\r\n                            <Button\r\n                                type=\"button\"\r\n                                variant=\"outline\"\r\n                                onClick={() => onOpenChange(false)}\r\n                                className=\"flex-1 h-11 border-slate-200 dark:border-slate-700\"\r\n                                disabled={loading}\r\n                            >\r\n                                Cancel\r\n                            </Button>\r\n                            <Button\r\n                                type=\"submit\"\r\n                                disabled={loading}\r\n                                className=\"flex-1 h-11 bg-linear-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white shadow-lg shadow-amber-200 dark:shadow-none transition-all\"\r\n                            >\r\n                                {loading ? (\r\n                                    <>\r\n                                        <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                                        Updating...\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <Calendar className=\"w-4 h-4 mr-2\" />\r\n                                        Update Expiry\r\n                                    </>\r\n                                )}\r\n                            </Button>\r\n                        </div>\r\n                    </form>\r\n                )}\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1515, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/students.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { createAdminClient } from '@/lib/supabase/admin';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Add a new student manually (admin only)\r\n * Returns student info if already exists, or creates an invitation\r\n */\r\nexport async function addStudent(data: {\r\n    email: string;\r\n    fullName: string;\r\n    sendInvite?: boolean;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    // Check admin permission\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if student already exists in profiles\r\n        const { data: existing } = await supabase\r\n            .from('profiles')\r\n            .select('id, email, full_name')\r\n            .eq('email', data.email)\r\n            .single();\r\n\r\n        if (existing) {\r\n            return {\r\n                success: true,\r\n                data: existing,\r\n                message: 'Student already exists in the system'\r\n            };\r\n        }\r\n\r\n        // Send invitation email using Supabase Admin\r\n        if (data.sendInvite) {\r\n            const adminClient = createAdminClient();\r\n\r\n            // Invite user via Supabase Auth\r\n            const { data: inviteData, error: inviteError } = await adminClient.auth.admin.inviteUserByEmail(\r\n                data.email,\r\n                {\r\n                    data: {\r\n                        full_name: data.fullName,\r\n                        role: 'student'\r\n                    },\r\n                    redirectTo: `${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/auth/callback`\r\n                }\r\n            );\r\n\r\n            if (inviteError) {\r\n                console.error('Invitation error:', inviteError);\r\n                throw new Error(`Failed to send invitation: ${inviteError.message}`);\r\n            }\r\n\r\n            console.log(`✅ Invitation sent to ${data.email}`, inviteData);\r\n\r\n            // Create profile entry for the invited user\r\n            if (inviteData.user) {\r\n                const { error: profileError } = await adminClient\r\n                    .from('profiles')\r\n                    .insert({\r\n                        id: inviteData.user.id,\r\n                        email: data.email,\r\n                        full_name: data.fullName,\r\n                        role: 'student'\r\n                    });\r\n\r\n                if (profileError) {\r\n                    console.error('Profile creation error:', profileError);\r\n                    // Don't fail the whole operation if profile creation fails\r\n                    // The profile will be created on first login via callback\r\n                }\r\n            }\r\n\r\n            revalidatePath('/admin/students');\r\n            return {\r\n                success: true,\r\n                data: { email: data.email, full_name: data.fullName },\r\n                message: 'Invitation sent successfully! Student will receive an email to join.'\r\n            };\r\n        }\r\n\r\n        // If not sending invite, just return success\r\n        revalidatePath('/admin/students');\r\n        return {\r\n            success: true,\r\n            data: { email: data.email, full_name: data.fullName },\r\n            message: 'Student information saved. They can sign up normally.'\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Add student error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Search students by name or email\r\n */\r\nexport async function searchStudents(query: string) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('profiles')\r\n            .select('id, email, full_name, avatar_url, created_at')\r\n            .eq('role', 'student')\r\n            .or(`full_name.ilike.%${query}%,email.ilike.%${query}%`)\r\n            .order('full_name', { ascending: true })\r\n            .limit(20);\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get all students with their enrollments and expiry info\r\n */\r\nexport async function getStudentsWithEnrollments(filters?: {\r\n    status?: 'all' | 'active' | 'expired';\r\n    expiringWithinDays?: number;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        // Get all students\r\n        const { data: students, error: studentsError } = await supabase\r\n            .from('profiles')\r\n            .select(`\r\n        id,\r\n        email,\r\n        full_name,\r\n        avatar_url,\r\n        created_at\r\n      `)\r\n            .eq('role', 'student')\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (studentsError) throw studentsError;\r\n\r\n        // Get enrollments for each student\r\n        const { data: enrollments, error: enrollmentsError } = await supabase\r\n            .from('enrollments')\r\n            .select(`\r\n        id,\r\n        user_id,\r\n        course_id,\r\n        status,\r\n        expires_at,\r\n        granted_by,\r\n        grant_type,\r\n        courses (\r\n          id,\r\n          title,\r\n          thumbnail_url\r\n        )\r\n      `);\r\n\r\n        if (enrollmentsError) throw enrollmentsError;\r\n\r\n\r\n\r\n        // Combine data\r\n        const studentsWithEnrollments = students?.map(student => {\r\n            const courseEnrollments = enrollments?.filter(e => e.user_id === student.id) || [];\r\n\r\n            // Check expiry status\r\n            const now = new Date();\r\n            const expiringSoon = courseEnrollments.filter(e => {\r\n                if (!e.expires_at) return false;\r\n                const expiryDate = new Date(e.expires_at);\r\n                const daysUntilExpiry = (expiryDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24);\r\n                return daysUntilExpiry > 0 && daysUntilExpiry <= (filters?.expiringWithinDays || 7);\r\n            });\r\n\r\n            return {\r\n                ...student,\r\n                enrollments: courseEnrollments,\r\n                totalEnrollments: courseEnrollments.length,\r\n                expiringSoonCount: expiringSoon.length\r\n            };\r\n        });\r\n\r\n        // Apply filters\r\n        let filtered = studentsWithEnrollments;\r\n        if (filters?.status === 'active') {\r\n            filtered = filtered?.filter(s => s.totalEnrollments > 0);\r\n        } else if (filters?.status === 'expired') {\r\n            filtered = filtered?.filter(s => {\r\n                const hasExpired = (s.enrollments || []).some(e => {\r\n                    if (!e.expires_at) return false;\r\n                    return new Date(e.expires_at) < new Date();\r\n                });\r\n                return hasExpired;\r\n            });\r\n        }\r\n\r\n        return { success: true, data: filtered };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get exam attempts for a specific student\r\n */\r\nexport async function getStudentAttempts(userId: string) {\r\n    const supabase = createAdminClient();\r\n\r\n    try {\r\n        const { data: rawData, error } = await supabase\r\n            .from('exam_attempts')\r\n            .select(`\r\n                *,\r\n                exams (\r\n                    id,\r\n                    title,\r\n                    total_marks\r\n                ),\r\n                results (*)\r\n            `)\r\n            .eq('student_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        // Flatten results\r\n        const data = rawData?.map(att => ({\r\n            ...att,\r\n            results: Array.isArray(att.results) ? att.results[0] : att.results\r\n        })) || [];\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get detailed info for a single student with stats\r\n */\r\nexport async function getStudentDetails(userId: string) {\r\n    try {\r\n        const supabase = createAdminClient();\r\n\r\n        // Get student profile\r\n        const { data: student, error: studentError } = await supabase\r\n            .from('profiles')\r\n            .select('*')\r\n            .eq('id', userId)\r\n            .single();\r\n\r\n        if (studentError) {\r\n            console.error('Student fetch error:', studentError);\r\n            throw new Error(`Failed to fetch student profile: ${studentError.message}`);\r\n        }\r\n\r\n        if (!student) {\r\n            return { error: 'Student not found' };\r\n        }\r\n\r\n        // Get active sessions count\r\n        // Note: Accessing auth schema may require special permissions\r\n        let activeSessions = 0;\r\n        try {\r\n            const { count, error: sessionsError } = await supabase\r\n                .schema('auth')\r\n                .from('sessions')\r\n                .select('*', { count: 'exact', head: true })\r\n                .eq('user_id', userId);\r\n\r\n            if (sessionsError) {\r\n                console.error('Session count error:', sessionsError);\r\n            } else {\r\n                activeSessions = count || 0;\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to fetch session count:', err);\r\n            // Fallback: activeSessions remains 0\r\n        }\r\n\r\n        // Get enrollments\r\n        const { data: enrollments, error: enrollmentsError } = await supabase\r\n            .from('enrollments')\r\n            .select(`\r\n                *,\r\n                courses (\r\n                    id,\r\n                    title,\r\n                    thumbnail_url,\r\n                    price,\r\n                    course_type\r\n                ),\r\n                granted_by_profile:profiles!enrollments_granted_by_fkey (\r\n                    id,\r\n                    full_name\r\n                )\r\n            `)\r\n            .eq('user_id', userId);\r\n\r\n        if (enrollmentsError) {\r\n            console.error('Enrollments fetch error:', enrollmentsError);\r\n            // Don't throw, just log and continue with empty array\r\n        }\r\n\r\n\r\n\r\n        const { data: rawAttempts, error: attemptsError } = await supabase\r\n            .from('exam_attempts')\r\n            .select(`\r\n                *,\r\n                exams (id, title, total_marks),\r\n                results (percentage, obtained_marks)\r\n            `)\r\n            .eq('student_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (attemptsError) {\r\n            console.error('Exam attempts fetch error:', attemptsError);\r\n            // Don't throw, just log and continue with empty array\r\n        }\r\n\r\n        // Transform attempts to handle singular results object\r\n        const attempts = rawAttempts?.map(att => ({\r\n            ...att,\r\n            results: Array.isArray(att.results) ? att.results[0] : att.results\r\n        })) || [];\r\n\r\n        // Get enrollment logs\r\n        const enrollmentIds = enrollments?.map(e => e.id) || [];\r\n\r\n        let logs: any[] = [];\r\n        if (enrollmentIds.length > 0) {\r\n            const { data: logData, error: logsError } = await supabase\r\n                .from('enrollment_logs')\r\n                .select(`\r\n                    *,\r\n                    performed_by_profile:profiles!enrollment_logs_performed_by_fkey (\r\n                        id,\r\n                        full_name\r\n                    )\r\n                `)\r\n                .in('enrollment_id', enrollmentIds)\r\n                .order('created_at', { ascending: false })\r\n                .limit(50);\r\n\r\n            if (logsError) {\r\n                console.error('Enrollment logs fetch error:', logsError);\r\n                // Don't throw, just log and continue with empty array\r\n            } else {\r\n                logs = logData || [];\r\n            }\r\n        }\r\n\r\n        // Calculate Stats\r\n        const submittedAttempts = attempts.filter(a => a.status === 'submitted');\r\n        const avgPercentage = submittedAttempts.length > 0\r\n            ? submittedAttempts.reduce((acc, curr) => acc + (curr.results?.percentage || 0), 0) / submittedAttempts.length\r\n            : 0;\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                student,\r\n                enrollments: enrollments || [],\r\n                attempts: attempts || [],\r\n                logs,\r\n                activeSessions,\r\n                stats: {\r\n                    totalEnrollments: enrollments?.length || 0,\r\n                    totalAttempts: attempts?.length || 0,\r\n                    avgPercentage: Math.round(avgPercentage * 10) / 10\r\n                }\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('getStudentDetails error:', error);\r\n        return { error: error?.message || 'An unexpected error occurred while fetching student details' };\r\n    }\r\n}\r\n\r\n/**\r\n * Reset all active sessions for a student (admin only)\r\n */\r\nexport async function resetStudentSessions(userId: string) {\r\n    const supabase = createAdminClient();\r\n\r\n    try {\r\n        // Delete all sessions for this user\r\n        const { error: sessionError } = await supabase\r\n            .schema('auth')\r\n            .from('sessions')\r\n            .delete()\r\n            .eq('user_id', userId);\r\n\r\n        if (sessionError) throw sessionError;\r\n\r\n        // Also delete refresh tokens to ensure they can't get a new session\r\n        const { error: tokenError } = await supabase\r\n            .schema('auth')\r\n            .from('refresh_tokens')\r\n            .delete()\r\n            .eq('user_id', userId);\r\n\r\n        // Note: tokenError might happen if they have no tokens, we can be lenient or log it\r\n\r\n        revalidatePath(`/admin/students/${userId}`);\r\n        return { success: true, message: 'All active sessions have been reset' };\r\n    } catch (error: any) {\r\n        console.error('Reset sessions error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAgHsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 1530, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/grantAccess.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Grant course access to a student with optional expiry\r\n */\r\nexport async function grantCourseAccess(data: {\r\n    userId: string;\r\n    courseId: string;\r\n    expiresAt?: Date | null;\r\n    notes?: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    // Get admin user\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if enrollment already exists\r\n        const { data: existing } = await supabase\r\n            .from('enrollments')\r\n            .select('id, status, expires_at')\r\n            .eq('user_id', data.userId)\r\n            .eq('course_id', data.courseId)\r\n            .single();\r\n\r\n        let enrollment;\r\n\r\n        if (existing) {\r\n            // Update existing enrollment\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    status: 'active',\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual'\r\n                })\r\n                .eq('id', existing.id)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = updated;\r\n\r\n            // Log the modification\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'modified',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: existing.id,\r\n                p_previous_expiry: existing.expires_at,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Access modified by admin'\r\n            });\r\n        } else {\r\n            // Create new enrollment\r\n            const { data: newEnrollment, error } = await supabase\r\n                .from('enrollments')\r\n                .insert({\r\n                    user_id: data.userId,\r\n                    course_id: data.courseId,\r\n                    status: 'active',\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual'\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = newEnrollment;\r\n\r\n            // Log the grant\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'granted',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: newEnrollment.id,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Access granted by admin'\r\n            });\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true, data: enrollment };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Grant test series access to a student\r\n */\r\nexport async function grantTestSeriesAccess(data: {\r\n    userId: string;\r\n    testSeriesId: string;\r\n    expiresAt?: Date | null;\r\n    notes?: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if enrollment already exists\r\n        const { data: existing } = await supabase\r\n            .from('enrollments')\r\n            .select('id, expires_at')\r\n            .eq('user_id', data.userId)\r\n            .eq('course_id', data.testSeriesId)\r\n            .single();\r\n\r\n        let enrollment;\r\n\r\n        if (existing) {\r\n            // Update existing\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual'\r\n                })\r\n                .eq('id', existing.id)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = updated;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'modified',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: existing.id,\r\n                p_previous_expiry: existing.expires_at,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Test series access modified'\r\n            });\r\n        } else {\r\n            // Create new\r\n            const { data: newEnrollment, error } = await supabase\r\n                .from('enrollments')\r\n                .insert({\r\n                    user_id: data.userId,\r\n                    course_id: data.testSeriesId,\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual',\r\n                    status: 'active'\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = newEnrollment;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'granted',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: newEnrollment.id,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Test series access granted'\r\n            });\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true, data: enrollment };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Revoke course or test series access\r\n */\r\nexport async function revokeAccess(data: {\r\n    enrollmentId: string;\r\n    type: 'course';\r\n    reason: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        if (data.type === 'course') {\r\n            const { error } = await supabase\r\n                .from('enrollments')\r\n                .update({ status: 'refunded' }) // Using 'refunded' to indicate revoked\r\n                .eq('id', data.enrollmentId);\r\n\r\n            if (error) throw error;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'revoked',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_notes: data.reason\r\n            });\r\n        } else {\r\n            const { error } = await supabase\r\n                .from('enrollments')\r\n                .update({ status: 'refunded' })\r\n                .eq('id', data.enrollmentId);\r\n\r\n            if (error) throw error;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'revoked',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_notes: data.reason\r\n            });\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Extend access expiry date\r\n */\r\nexport async function extendAccess(data: {\r\n    enrollmentId: string;\r\n    type: 'course';\r\n    newExpiryDate: Date;\r\n    notes?: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    console.log('[extendAccess] Starting update:', {\r\n        enrollmentId: data.enrollmentId,\r\n        type: data.type,\r\n        newExpiryDate: data.newExpiryDate,\r\n        isoDate: data.newExpiryDate.toISOString()\r\n    });\r\n\r\n    try {\r\n        let previousExpiry;\r\n        let updateError;\r\n\r\n        if (data.type === 'course') {\r\n            // Get current enrollment\r\n            const { data: existing, error: fetchError } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at, user_id')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            if (fetchError) {\r\n                console.error('[extendAccess] Error fetching enrollment:', fetchError);\r\n                throw new Error(`Failed to find enrollment: ${fetchError.message}`);\r\n            }\r\n\r\n            console.log('[extendAccess] Current enrollment:', existing);\r\n            previousExpiry = existing?.expires_at;\r\n\r\n            // Update the expiry date\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    expires_at: data.newExpiryDate.toISOString(),\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', data.enrollmentId)\r\n                .select();\r\n\r\n            updateError = error;\r\n            console.log('[extendAccess] Update result:', { updated, error });\r\n\r\n            if (error) throw error;\r\n\r\n            if (!updated || updated.length === 0) {\r\n                throw new Error('No rows were updated. Enrollment may not exist.');\r\n            }\r\n\r\n            // Verify the update\r\n            const { data: verified } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            console.log('[extendAccess] Verified expiry after update:', verified);\r\n\r\n            if (!verified?.expires_at) {\r\n                throw new Error('Update succeeded but expires_at is still null');\r\n            }\r\n\r\n            // Log the action\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'extended',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_previous_expiry: previousExpiry,\r\n                p_new_expiry: data.newExpiryDate.toISOString(),\r\n                p_notes: data.notes || 'Access period extended'\r\n            });\r\n        } else {\r\n            // Test series enrollment\r\n            const { data: existing, error: fetchError } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at, user_id')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            if (fetchError) {\r\n                console.error('[extendAccess] Error fetching test series enrollment:', fetchError);\r\n                throw new Error(`Failed to find test series enrollment: ${fetchError.message}`);\r\n            }\r\n\r\n            console.log('[extendAccess] Current test series enrollment:', existing);\r\n            previousExpiry = existing?.expires_at;\r\n\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    expires_at: data.newExpiryDate.toISOString(),\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', data.enrollmentId)\r\n                .select();\r\n\r\n            updateError = error;\r\n            console.log('[extendAccess] Test series update result:', { updated, error });\r\n\r\n            if (error) throw error;\r\n\r\n            if (!updated || updated.length === 0) {\r\n                throw new Error('No rows were updated. Test series enrollment may not exist.');\r\n            }\r\n\r\n            // Verify the update\r\n            const { data: verified } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            console.log('[extendAccess] Verified test series expiry after update:', verified);\r\n\r\n            if (!verified?.expires_at) {\r\n                throw new Error('Update succeeded but expires_at is still null');\r\n            }\r\n\r\n            // Log the action\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'extended',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_previous_expiry: previousExpiry,\r\n                p_new_expiry: data.newExpiryDate.toISOString(),\r\n                p_notes: data.notes || 'Access period extended'\r\n            });\r\n        }\r\n\r\n        console.log('[extendAccess] Update completed successfully');\r\n        revalidatePath('/admin/students');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('[extendAccess] Error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get expiring subscriptions (within specified days)\r\n */\r\nexport async function getExpiringSubscriptions(daysAhead: number = 7) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('expiring_enrollments_view')\r\n            .select('*')\r\n            .lte('days_until_expiry', daysAhead)\r\n            .order('days_until_expiry', { ascending: true });\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get recent enrollment logs\r\n */\r\nexport async function getRecentAccessLogs(limit: number = 50) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('enrollment_logs')\r\n            .select(`\r\n        *,\r\n        performed_by_profile:profiles!enrollment_logs_performed_by_fkey (\r\n          id,\r\n          full_name,\r\n          email\r\n        )\r\n      `)\r\n            .order('created_at', { ascending: false })\r\n            .limit(limit);\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAQsB,oBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 1545, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/grantAccess.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Grant course access to a student with optional expiry\r\n */\r\nexport async function grantCourseAccess(data: {\r\n    userId: string;\r\n    courseId: string;\r\n    expiresAt?: Date | null;\r\n    notes?: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    // Get admin user\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if enrollment already exists\r\n        const { data: existing } = await supabase\r\n            .from('enrollments')\r\n            .select('id, status, expires_at')\r\n            .eq('user_id', data.userId)\r\n            .eq('course_id', data.courseId)\r\n            .single();\r\n\r\n        let enrollment;\r\n\r\n        if (existing) {\r\n            // Update existing enrollment\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    status: 'active',\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual'\r\n                })\r\n                .eq('id', existing.id)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = updated;\r\n\r\n            // Log the modification\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'modified',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: existing.id,\r\n                p_previous_expiry: existing.expires_at,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Access modified by admin'\r\n            });\r\n        } else {\r\n            // Create new enrollment\r\n            const { data: newEnrollment, error } = await supabase\r\n                .from('enrollments')\r\n                .insert({\r\n                    user_id: data.userId,\r\n                    course_id: data.courseId,\r\n                    status: 'active',\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual'\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = newEnrollment;\r\n\r\n            // Log the grant\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'granted',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: newEnrollment.id,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Access granted by admin'\r\n            });\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true, data: enrollment };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Grant test series access to a student\r\n */\r\nexport async function grantTestSeriesAccess(data: {\r\n    userId: string;\r\n    testSeriesId: string;\r\n    expiresAt?: Date | null;\r\n    notes?: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', user.id)\r\n        .single();\r\n\r\n    if (profile?.role !== 'admin') {\r\n        return { error: 'Admin access required' };\r\n    }\r\n\r\n    try {\r\n        // Check if enrollment already exists\r\n        const { data: existing } = await supabase\r\n            .from('enrollments')\r\n            .select('id, expires_at')\r\n            .eq('user_id', data.userId)\r\n            .eq('course_id', data.testSeriesId)\r\n            .single();\r\n\r\n        let enrollment;\r\n\r\n        if (existing) {\r\n            // Update existing\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual'\r\n                })\r\n                .eq('id', existing.id)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = updated;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'modified',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: existing.id,\r\n                p_previous_expiry: existing.expires_at,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Test series access modified'\r\n            });\r\n        } else {\r\n            // Create new\r\n            const { data: newEnrollment, error } = await supabase\r\n                .from('enrollments')\r\n                .insert({\r\n                    user_id: data.userId,\r\n                    course_id: data.testSeriesId,\r\n                    expires_at: data.expiresAt || null,\r\n                    granted_by: user.id,\r\n                    granted_at: new Date().toISOString(),\r\n                    grant_type: 'manual',\r\n                    status: 'active'\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            enrollment = newEnrollment;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'granted',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: newEnrollment.id,\r\n                p_new_expiry: data.expiresAt || null,\r\n                p_notes: data.notes || 'Test series access granted'\r\n            });\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true, data: enrollment };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Revoke course or test series access\r\n */\r\nexport async function revokeAccess(data: {\r\n    enrollmentId: string;\r\n    type: 'course';\r\n    reason: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        if (data.type === 'course') {\r\n            const { error } = await supabase\r\n                .from('enrollments')\r\n                .update({ status: 'refunded' }) // Using 'refunded' to indicate revoked\r\n                .eq('id', data.enrollmentId);\r\n\r\n            if (error) throw error;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'revoked',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_notes: data.reason\r\n            });\r\n        } else {\r\n            const { error } = await supabase\r\n                .from('enrollments')\r\n                .update({ status: 'refunded' })\r\n                .eq('id', data.enrollmentId);\r\n\r\n            if (error) throw error;\r\n\r\n            // Log\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'revoked',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_notes: data.reason\r\n            });\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Extend access expiry date\r\n */\r\nexport async function extendAccess(data: {\r\n    enrollmentId: string;\r\n    type: 'course';\r\n    newExpiryDate: Date;\r\n    notes?: string;\r\n}) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    console.log('[extendAccess] Starting update:', {\r\n        enrollmentId: data.enrollmentId,\r\n        type: data.type,\r\n        newExpiryDate: data.newExpiryDate,\r\n        isoDate: data.newExpiryDate.toISOString()\r\n    });\r\n\r\n    try {\r\n        let previousExpiry;\r\n        let updateError;\r\n\r\n        if (data.type === 'course') {\r\n            // Get current enrollment\r\n            const { data: existing, error: fetchError } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at, user_id')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            if (fetchError) {\r\n                console.error('[extendAccess] Error fetching enrollment:', fetchError);\r\n                throw new Error(`Failed to find enrollment: ${fetchError.message}`);\r\n            }\r\n\r\n            console.log('[extendAccess] Current enrollment:', existing);\r\n            previousExpiry = existing?.expires_at;\r\n\r\n            // Update the expiry date\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    expires_at: data.newExpiryDate.toISOString(),\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', data.enrollmentId)\r\n                .select();\r\n\r\n            updateError = error;\r\n            console.log('[extendAccess] Update result:', { updated, error });\r\n\r\n            if (error) throw error;\r\n\r\n            if (!updated || updated.length === 0) {\r\n                throw new Error('No rows were updated. Enrollment may not exist.');\r\n            }\r\n\r\n            // Verify the update\r\n            const { data: verified } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            console.log('[extendAccess] Verified expiry after update:', verified);\r\n\r\n            if (!verified?.expires_at) {\r\n                throw new Error('Update succeeded but expires_at is still null');\r\n            }\r\n\r\n            // Log the action\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'extended',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_previous_expiry: previousExpiry,\r\n                p_new_expiry: data.newExpiryDate.toISOString(),\r\n                p_notes: data.notes || 'Access period extended'\r\n            });\r\n        } else {\r\n            // Test series enrollment\r\n            const { data: existing, error: fetchError } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at, user_id')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            if (fetchError) {\r\n                console.error('[extendAccess] Error fetching test series enrollment:', fetchError);\r\n                throw new Error(`Failed to find test series enrollment: ${fetchError.message}`);\r\n            }\r\n\r\n            console.log('[extendAccess] Current test series enrollment:', existing);\r\n            previousExpiry = existing?.expires_at;\r\n\r\n            const { data: updated, error } = await supabase\r\n                .from('enrollments')\r\n                .update({\r\n                    expires_at: data.newExpiryDate.toISOString(),\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', data.enrollmentId)\r\n                .select();\r\n\r\n            updateError = error;\r\n            console.log('[extendAccess] Test series update result:', { updated, error });\r\n\r\n            if (error) throw error;\r\n\r\n            if (!updated || updated.length === 0) {\r\n                throw new Error('No rows were updated. Test series enrollment may not exist.');\r\n            }\r\n\r\n            // Verify the update\r\n            const { data: verified } = await supabase\r\n                .from('enrollments')\r\n                .select('expires_at')\r\n                .eq('id', data.enrollmentId)\r\n                .single();\r\n\r\n            console.log('[extendAccess] Verified test series expiry after update:', verified);\r\n\r\n            if (!verified?.expires_at) {\r\n                throw new Error('Update succeeded but expires_at is still null');\r\n            }\r\n\r\n            // Log the action\r\n            await supabase.rpc('log_enrollment_action', {\r\n                p_action: 'extended',\r\n                p_performed_by: user.id,\r\n                p_enrollment_id: data.enrollmentId,\r\n                p_previous_expiry: previousExpiry,\r\n                p_new_expiry: data.newExpiryDate.toISOString(),\r\n                p_notes: data.notes || 'Access period extended'\r\n            });\r\n        }\r\n\r\n        console.log('[extendAccess] Update completed successfully');\r\n        revalidatePath('/admin/students');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('[extendAccess] Error:', error);\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get expiring subscriptions (within specified days)\r\n */\r\nexport async function getExpiringSubscriptions(daysAhead: number = 7) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('expiring_enrollments_view')\r\n            .select('*')\r\n            .lte('days_until_expiry', daysAhead)\r\n            .order('days_until_expiry', { ascending: true });\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Get recent enrollment logs\r\n */\r\nexport async function getRecentAccessLogs(limit: number = 50) {\r\n    const supabase = await createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return { error: 'Unauthorized' };\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('enrollment_logs')\r\n            .select(`\r\n        *,\r\n        performed_by_profile:profiles!enrollment_logs_performed_by_fkey (\r\n          id,\r\n          full_name,\r\n          email\r\n        )\r\n      `)\r\n            .order('created_at', { ascending: false })\r\n            .limit(limit);\r\n\r\n        if (error) throw error;\r\n\r\n        return { success: true, data };\r\n    } catch (error: any) {\r\n        return { error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IA2GsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 1560, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/admin/GrantAccessDialog.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { searchStudents } from '@/actions/admin/students';\r\nimport { grantCourseAccess, grantTestSeriesAccess } from '@/actions/admin/grantAccess';\r\nimport { toast } from 'sonner';\r\nimport { Loader2, Gift, Search, Calendar, BookOpen, Trophy, Sparkles } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface GrantAccessDialogProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    onSuccess?: () => void;\r\n    courses?: Array<{ id: string; title: string; thumbnail_url?: string }>;\r\n    testSeries?: Array<{ id: string; title: string }>;\r\n}\r\n\r\nexport function GrantAccessDialog({ open, onOpenChange, onSuccess, courses = [], testSeries = [] }: GrantAccessDialogProps) {\r\n    const [loading, setLoading] = useState(false);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [searchResults, setSearchResults] = useState<any[]>([]);\r\n    const [searching, setSearching] = useState(false);\r\n\r\n    const [formData, setFormData] = useState({\r\n        selectedStudent: null as any,\r\n        accessType: 'course' as 'course' | 'test_series',\r\n        selectedCourse: '',\r\n        selectedTestSeries: '',\r\n        expiryDate: '',\r\n        notes: ''\r\n    });\r\n\r\n    // Search students as user types\r\n    useEffect(() => {\r\n        const searchDebounce = setTimeout(async () => {\r\n            if (searchQuery.length >= 2) {\r\n                setSearching(true);\r\n                const result = await searchStudents(searchQuery);\r\n                if (result.success) {\r\n                    setSearchResults(result.data || []);\r\n                }\r\n                setSearching(false);\r\n            } else {\r\n                setSearchResults([]);\r\n            }\r\n        }, 300);\r\n\r\n        return () => clearTimeout(searchDebounce);\r\n    }, [searchQuery]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (!formData.selectedStudent) {\r\n            toast.error('Please select a student');\r\n            return;\r\n        }\r\n\r\n        if (formData.accessType === 'course' && !formData.selectedCourse) {\r\n            toast.error('Please select a course');\r\n            return;\r\n        }\r\n\r\n        if (formData.accessType === 'test_series' && !formData.selectedTestSeries) {\r\n            toast.error('Please select a test series');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n\r\n        try {\r\n            const expiryDate = formData.expiryDate ? new Date(formData.expiryDate) : null;\r\n\r\n            let result;\r\n            if (formData.accessType === 'course') {\r\n                result = await grantCourseAccess({\r\n                    userId: formData.selectedStudent.id,\r\n                    courseId: formData.selectedCourse,\r\n                    expiresAt: expiryDate,\r\n                    notes: formData.notes\r\n                });\r\n            } else {\r\n                result = await grantTestSeriesAccess({\r\n                    userId: formData.selectedStudent.id,\r\n                    testSeriesId: formData.selectedTestSeries,\r\n                    expiresAt: expiryDate,\r\n                    notes: formData.notes\r\n                });\r\n            }\r\n\r\n            if (result.error) {\r\n                toast.error(result.error);\r\n            } else {\r\n                toast.success('Access granted successfully! 🎉');\r\n                onOpenChange(false);\r\n                resetForm();\r\n                onSuccess?.();\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.message || 'Failed to grant access');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            selectedStudent: null,\r\n            accessType: 'course',\r\n            selectedCourse: '',\r\n            selectedTestSeries: '',\r\n            expiryDate: '',\r\n            notes: ''\r\n        });\r\n        setSearchQuery('');\r\n        setSearchResults([]);\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={(open) => { onOpenChange(open); if (!open) resetForm(); }}>\r\n            <DialogContent className=\"sm:max-w-[600px] max-h-[85vh] flex flex-col bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 p-0 gap-0\">\r\n                {/* Decorative gradient header */}\r\n                <div className=\"absolute top-0 left-0 right-0 h-1 bg-linear-to-r from-emerald-500 via-teal-500 to-cyan-500 rounded-t-lg\" />\r\n\r\n                {/* Fixed Header */}\r\n                <DialogHeader className=\"space-y-3 pt-6 px-6 pb-4 shrink-0\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2.5 rounded-xl bg-linear-to-br from-emerald-500 to-teal-600 shadow-lg shadow-emerald-200 dark:shadow-none\">\r\n                            <Gift className=\"w-5 h-5 text-white\" />\r\n                        </div>\r\n                        <div>\r\n                            <DialogTitle className=\"text-2xl font-bold tracking-tight text-slate-900 dark:text-white\">\r\n                                Grant Access\r\n                            </DialogTitle>\r\n                            <DialogDescription className=\"text-sm text-slate-500 dark:text-slate-400\">\r\n                                Assign a course or test series to a student\r\n                            </DialogDescription>\r\n                        </div>\r\n                    </div>\r\n                </DialogHeader>\r\n\r\n                {/* Scrollable Form Content */}\r\n                <div className=\"flex-1 overflow-y-auto px-6 min-h-0\">\r\n                    <form id=\"grantAccessForm\" onSubmit={handleSubmit} className=\"space-y-4 pb-4\">\r\n                        {/* Student Search */}\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"studentSearch\" className=\"text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center gap-2\">\r\n                                <Search className=\"w-4 h-4 text-emerald-500\" />\r\n                                Search Student\r\n                            </Label>\r\n                            <div className=\"relative\">\r\n                                <Input\r\n                                    id=\"studentSearch\"\r\n                                    type=\"text\"\r\n                                    placeholder=\"Type name or email...\"\r\n                                    value={searchQuery}\r\n                                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                                    className=\"h-11 bg-slate-50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700 pr-10\"\r\n                                />\r\n                                {searching && (\r\n                                    <Loader2 className=\"absolute right-3 top-3 w-5 h-5 animate-spin text-slate-400\" />\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Search Results */}\r\n                            {searchResults.length > 0 && (\r\n                                <div className=\"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden bg-white dark:bg-slate-800 shadow-lg max-h-48 overflow-y-auto\">\r\n                                    {searchResults.map((student) => (\r\n                                        <button\r\n                                            key={student.id}\r\n                                            type=\"button\"\r\n                                            onClick={() => {\r\n                                                setFormData({ ...formData, selectedStudent: student });\r\n                                                setSearchQuery(student.full_name || student.email);\r\n                                                setSearchResults([]);\r\n                                            }}\r\n                                            className={cn(\r\n                                                \"w-full text-left px-4 py-3 hover:bg-emerald-50 dark:hover:bg-emerald-500/10 transition-colors border-b border-slate-100 dark:border-slate-700 last:border-0\",\r\n                                                formData.selectedStudent?.id === student.id && \"bg-emerald-50 dark:bg-emerald-500/10\"\r\n                                            )}\r\n                                        >\r\n                                            <div className=\"font-medium text-slate-900 dark:text-white\">{student.full_name || 'No name'}</div>\r\n                                            <div className=\"text-sm text-slate-500 dark:text-slate-400\">{student.email}</div>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Selected Student Display */}\r\n                            {formData.selectedStudent && searchResults.length === 0 && (\r\n                                <div className=\"p-3 rounded-lg bg-emerald-50 dark:bg-emerald-500/10 border border-emerald-200 dark:border-emerald-500/20\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <Sparkles className=\"w-4 h-4 text-emerald-600 dark:text-emerald-400\" />\r\n                                        <div className=\"flex-1\">\r\n                                            <div className=\"font-semibold text-emerald-900 dark:text-emerald-100\">{formData.selectedStudent.full_name}</div>\r\n                                            <div className=\"text-xs text-emerald-600 dark:text-emerald-400\">{formData.selectedStudent.email}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Access Type */}\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-sm font-semibold text-slate-700 dark:text-slate-300\">Access Type</Label>\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setFormData({ ...formData, accessType: 'course', selectedTestSeries: '' })}\r\n                                    className={cn(\r\n                                        \"p-4 rounded-xl border-2 transition-all text-left\",\r\n                                        formData.accessType === 'course'\r\n                                            ? \"border-blue-500 bg-blue-50 dark:bg-blue-500/10\"\r\n                                            : \"border-slate-200 dark:border-slate-700 hover:border-blue-300\"\r\n                                    )}\r\n                                >\r\n                                    <BookOpen className={cn(\"w-5 h-5 mb-2\", formData.accessType === 'course' ? \"text-blue-500\" : \"text-slate-400\")} />\r\n                                    <div className=\"font-semibold text-sm text-slate-900 dark:text-white\">Course</div>\r\n                                    <div className=\"text-xs text-slate-500 dark:text-slate-400\">Grant course enrollment</div>\r\n                                </button>\r\n\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setFormData({ ...formData, accessType: 'test_series', selectedCourse: '' })}\r\n                                    className={cn(\r\n                                        \"p-4 rounded-xl border-2 transition-all text-left\",\r\n                                        formData.accessType === 'test_series'\r\n                                            ? \"border-purple-500 bg-purple-50 dark:bg-purple-500/10\"\r\n                                            : \"border-slate-200 dark:border-slate-700 hover:border-purple-300\"\r\n                                    )}\r\n                                >\r\n                                    <Trophy className={cn(\"w-5 h-5 mb-2\", formData.accessType === 'test_series' ? \"text-purple-500\" : \"text-slate-400\")} />\r\n                                    <div className=\"font-semibold text-sm text-slate-900 dark:text-white\">Test Series</div>\r\n                                    <div className=\"text-xs text-slate-500 dark:text-slate-400\">Grant test series access</div>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Course/Test Series Selection */}\r\n                        {formData.accessType === 'course' ? (\r\n                            <div className=\"space-y-2\">\r\n                                <Label className=\"text-sm font-semibold text-slate-700 dark:text-slate-300\">Select Course</Label>\r\n                                <Select value={formData.selectedCourse} onValueChange={(value) => setFormData({ ...formData, selectedCourse: value })}>\r\n                                    <SelectTrigger className=\"h-11 bg-slate-50 dark:bg-slate-800/50\">\r\n                                        <SelectValue placeholder=\"Choose a course...\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        {courses.map((course) => (\r\n                                            <SelectItem key={course.id} value={course.id}>\r\n                                                {course.title}\r\n                                            </SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-2\">\r\n                                <Label className=\"text-sm font-semibold text-slate-700 dark:text-slate-300\">Select Test Series</Label>\r\n                                <Select value={formData.selectedTestSeries} onValueChange={(value) => setFormData({ ...formData, selectedTestSeries: value })}>\r\n                                    <SelectTrigger className=\"h-11 bg-slate-50 dark:bg-slate-800/50\">\r\n                                        <SelectValue placeholder=\"Choose a test series...\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        {testSeries.map((series) => (\r\n                                            <SelectItem key={series.id} value={series.id}>\r\n                                                {series.title}\r\n                                            </SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Expiry Date */}\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"expiryDate\" className=\"text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center gap-2\">\r\n                                <Calendar className=\"w-4 h-4 text-amber-500\" />\r\n                                Expiry Date (Optional)\r\n                            </Label>\r\n                            <Input\r\n                                id=\"expiryDate\"\r\n                                type=\"date\"\r\n                                value={formData.expiryDate}\r\n                                onChange={(e) => setFormData({ ...formData, expiryDate: e.target.value })}\r\n                                min={new Date().toISOString().split('T')[0]}\r\n                                className=\"h-11 bg-slate-50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700\"\r\n                            />\r\n                            <p className=\"text-xs text-slate-500 dark:text-slate-400\">Leave empty for lifetime access</p>\r\n                        </div>\r\n\r\n                        {/* Notes */}\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"notes\" className=\"text-sm font-semibold text-slate-700 dark:text-slate-300\">Notes (Optional)</Label>\r\n                            <Textarea\r\n                                id=\"notes\"\r\n                                value={formData.notes}\r\n                                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                                placeholder=\"Reason for granting access...\"\r\n                                className=\"min-h-[80px] bg-slate-50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700\"\r\n                            />\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n\r\n                {/* Sticky Footer with Buttons */}\r\n                <div className=\"border-t border-slate-200 dark:border-slate-800 px-6 py-4 bg-slate-50 dark:bg-slate-900/50 shrink-0\">\r\n                    <div className=\"flex gap-3\">\r\n                        <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            onClick={() => onOpenChange(false)}\r\n                            className=\"flex-1 h-11 border-slate-200 dark:border-slate-700\"\r\n                            disabled={loading}\r\n                        >\r\n                            Cancel\r\n                        </Button>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            form=\"grantAccessForm\"\r\n                            disabled={loading || !formData.selectedStudent}\r\n                            className=\"flex-1 h-11 bg-linear-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white shadow-lg shadow-emerald-200 dark:shadow-none transition-all\"\r\n                        >\r\n                            {loading ? (\r\n                                <>\r\n                                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                                    Granting...\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <Gift className=\"w-4 h-4 mr-2\" />\r\n                                    Grant Access\r\n                                </>\r\n                            )}\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2311, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/ui/confirm-dialog.tsx"],"sourcesContent":["import {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\n\r\ninterface ConfirmDialogProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    title: string;\r\n    description: string;\r\n    confirmText?: string;\r\n    cancelText?: string;\r\n    onConfirm: () => void;\r\n    variant?: 'default' | 'destructive';\r\n}\r\n\r\nexport function ConfirmDialog({\r\n    open,\r\n    onOpenChange,\r\n    title,\r\n    description,\r\n    confirmText = \"Continue\",\r\n    cancelText = \"Cancel\",\r\n    onConfirm,\r\n    variant = 'default'\r\n}: ConfirmDialogProps) {\r\n    const handleConfirm = () => {\r\n        onConfirm();\r\n        onOpenChange(false);\r\n    };\r\n\r\n    return (\r\n        <AlertDialog open={open} onOpenChange={onOpenChange}>\r\n            <AlertDialogContent>\r\n                <AlertDialogHeader>\r\n                    <AlertDialogTitle>{title}</AlertDialogTitle>\r\n                    <AlertDialogDescription>{description}</AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                <AlertDialogFooter>\r\n                    <AlertDialogCancel>{cancelText}</AlertDialogCancel>\r\n                    <AlertDialogAction\r\n                        onClick={handleConfirm}\r\n                        className={variant === 'destructive' ? 'bg-rose-600 hover:bg-rose-700' : ''}\r\n                    >\r\n                        {confirmText}\r\n                    </AlertDialogAction>\r\n                </AlertDialogFooter>\r\n            </AlertDialogContent>\r\n        </AlertDialog>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAsBO,SAAS,cAAc,EAC1B,IAAI,EACJ,YAAY,EACZ,KAAK,EACL,WAAW,EACX,cAAc,UAAU,EACxB,aAAa,QAAQ,EACrB,SAAS,EACT,UAAU,SAAS,EACF;IACjB,MAAM,gBAAgB;QAClB;QACA,aAAa;IACjB;IAEA,qBACI,6LAAC,sJAAW;QAAC,MAAM;QAAM,cAAc;kBACnC,cAAA,6LAAC,6JAAkB;;8BACf,6LAAC,4JAAiB;;sCACd,6LAAC,2JAAgB;sCAAE;;;;;;sCACnB,6LAAC,iKAAsB;sCAAE;;;;;;;;;;;;8BAE7B,6LAAC,4JAAiB;;sCACd,6LAAC,4JAAiB;sCAAE;;;;;;sCACpB,6LAAC,4JAAiB;4BACd,SAAS;4BACT,WAAW,YAAY,gBAAgB,kCAAkC;sCAExE;;;;;;;;;;;;;;;;;;;;;;;AAMzB;KAlCgB"}},
    {"offset": {"line": 2397, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/actions/admin/updateProfile.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createAdminClient } from '@/lib/supabase/admin';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\ninterface UpdateProfileData {\r\n    userId: string;\r\n    fullName?: string;\r\n    email?: string;\r\n    phone?: string;\r\n}\r\n\r\n/**\r\n * Update user profile information\r\n */\r\nexport async function updateUserProfile(data: UpdateProfileData) {\r\n    const supabase = createAdminClient();\r\n\r\n    try {\r\n        // Update profile in profiles table\r\n        const profileUpdate: any = {};\r\n        if (data.fullName !== undefined) profileUpdate.full_name = data.fullName;\r\n        if (data.phone !== undefined) profileUpdate.phone = data.phone;\r\n\r\n        if (Object.keys(profileUpdate).length > 0) {\r\n            profileUpdate.updated_at = new Date().toISOString();\r\n\r\n            const { error: profileError } = await supabase\r\n                .from('profiles')\r\n                .update(profileUpdate)\r\n                .eq('id', data.userId);\r\n\r\n            if (profileError) throw profileError;\r\n        }\r\n\r\n        // Update email in auth.users if provided\r\n        if (data.email) {\r\n            const { error: emailError } = await supabase.auth.admin.updateUserById(\r\n                data.userId,\r\n                { email: data.email }\r\n            );\r\n\r\n            if (emailError) throw emailError;\r\n        }\r\n\r\n        revalidatePath('/admin/students');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAesB,oBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 2412, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/admin/EditProfileDialog.tsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { useForm } from 'react-hook-form';\r\nimport { toast } from 'sonner';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { updateUserProfile } from '@/actions/admin/updateProfile';\r\nimport { Loader2 } from 'lucide-react';\r\n\r\ninterface EditProfileDialogProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    userId: string;\r\n    currentData: {\r\n        fullName: string;\r\n        email: string;\r\n        phone?: string;\r\n    };\r\n    onSuccess: () => void;\r\n}\r\n\r\ninterface FormData {\r\n    fullName: string;\r\n    email: string;\r\n    phone: string;\r\n}\r\n\r\nexport function EditProfileDialog({\r\n    open,\r\n    onOpenChange,\r\n    userId,\r\n    currentData,\r\n    onSuccess\r\n}: EditProfileDialogProps) {\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    const { register, handleSubmit, formState: { errors } } = useForm<FormData>({\r\n        defaultValues: {\r\n            fullName: currentData.fullName,\r\n            email: currentData.email,\r\n            phone: currentData.phone || ''\r\n        }\r\n    });\r\n\r\n    const onSubmit = async (data: FormData) => {\r\n        setIsSubmitting(true);\r\n\r\n        try {\r\n            const result = await updateUserProfile({\r\n                userId,\r\n                fullName: data.fullName,\r\n                email: data.email,\r\n                phone: data.phone\r\n            });\r\n\r\n            if (!result.success) {\r\n                throw new Error(result.error);\r\n            }\r\n\r\n            toast.success('Profile updated successfully');\r\n            onSuccess();\r\n            onOpenChange(false);\r\n        } catch (error: any) {\r\n            toast.error('Failed to update profile: ' + error.message);\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"sm:max-w-[500px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Edit Profile</DialogTitle>\r\n                    <DialogDescription>\r\n                        Update student profile information\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"fullName\">Full Name</Label>\r\n                        <Input\r\n                            id=\"fullName\"\r\n                            {...register('fullName', { required: 'Name is required' })}\r\n                            placeholder=\"Enter full name\"\r\n                        />\r\n                        {errors.fullName && (\r\n                            <p className=\"text-sm text-rose-600\">{errors.fullName.message}</p>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"email\">Email</Label>\r\n                        <Input\r\n                            id=\"email\"\r\n                            type=\"email\"\r\n                            {...register('email', {\r\n                                required: 'Email is required',\r\n                                pattern: {\r\n                                    value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i,\r\n                                    message: 'Invalid email address'\r\n                                }\r\n                            })}\r\n                            placeholder=\"Enter email\"\r\n                        />\r\n                        {errors.email && (\r\n                            <p className=\"text-sm text-rose-600\">{errors.email.message}</p>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"phone\">Phone (Optional)</Label>\r\n                        <Input\r\n                            id=\"phone\"\r\n                            type=\"tel\"\r\n                            {...register('phone')}\r\n                            placeholder=\"Enter phone number\"\r\n                        />\r\n                    </div>\r\n\r\n                    <DialogFooter>\r\n                        <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            onClick={() => onOpenChange(false)}\r\n                            disabled={isSubmitting}\r\n                        >\r\n                            Cancel\r\n                        </Button>\r\n                        <Button type=\"submit\" disabled={isSubmitting}>\r\n                            {isSubmitting && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\r\n                            Save Changes\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AAoBO,SAAS,kBAAkB,EAC9B,IAAI,EACJ,YAAY,EACZ,MAAM,EACN,WAAW,EACX,SAAS,EACY;;IACrB,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IAEjD,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,WAAW,EAAE,MAAM,EAAE,EAAE,GAAG,IAAA,4KAAO,EAAW;QACxE,eAAe;YACX,UAAU,YAAY,QAAQ;YAC9B,OAAO,YAAY,KAAK;YACxB,OAAO,YAAY,KAAK,IAAI;QAChC;IACJ;IAEA,MAAM,WAAW,OAAO;QACpB,gBAAgB;QAEhB,IAAI;YACA,MAAM,SAAS,MAAM,IAAA,gLAAiB,EAAC;gBACnC;gBACA,UAAU,KAAK,QAAQ;gBACvB,OAAO,KAAK,KAAK;gBACjB,OAAO,KAAK,KAAK;YACrB;YAEA,IAAI,CAAC,OAAO,OAAO,EAAE;gBACjB,MAAM,IAAI,MAAM,OAAO,KAAK;YAChC;YAEA,oJAAK,CAAC,OAAO,CAAC;YACd;YACA,aAAa;QACjB,EAAE,OAAO,OAAY;YACjB,oJAAK,CAAC,KAAK,CAAC,+BAA+B,MAAM,OAAO;QAC5D,SAAU;YACN,gBAAgB;QACpB;IACJ;IAEA,qBACI,6LAAC,wIAAM;QAAC,MAAM;QAAM,cAAc;kBAC9B,cAAA,6LAAC,+IAAa;YAAC,WAAU;;8BACrB,6LAAC,8IAAY;;sCACT,6LAAC,6IAAW;sCAAC;;;;;;sCACb,6LAAC,mJAAiB;sCAAC;;;;;;;;;;;;8BAKvB,6LAAC;oBAAK,UAAU,aAAa;oBAAW,WAAU;;sCAC9C,6LAAC;4BAAI,WAAU;;8CACX,6LAAC,sIAAK;oCAAC,SAAQ;8CAAW;;;;;;8CAC1B,6LAAC,sIAAK;oCACF,IAAG;oCACF,GAAG,SAAS,YAAY;wCAAE,UAAU;oCAAmB,EAAE;oCAC1D,aAAY;;;;;;gCAEf,OAAO,QAAQ,kBACZ,6LAAC;oCAAE,WAAU;8CAAyB,OAAO,QAAQ,CAAC,OAAO;;;;;;;;;;;;sCAIrE,6LAAC;4BAAI,WAAU;;8CACX,6LAAC,sIAAK;oCAAC,SAAQ;8CAAQ;;;;;;8CACvB,6LAAC,sIAAK;oCACF,IAAG;oCACH,MAAK;oCACJ,GAAG,SAAS,SAAS;wCAClB,UAAU;wCACV,SAAS;4CACL,OAAO;4CACP,SAAS;wCACb;oCACJ,EAAE;oCACF,aAAY;;;;;;gCAEf,OAAO,KAAK,kBACT,6LAAC;oCAAE,WAAU;8CAAyB,OAAO,KAAK,CAAC,OAAO;;;;;;;;;;;;sCAIlE,6LAAC;4BAAI,WAAU;;8CACX,6LAAC,sIAAK;oCAAC,SAAQ;8CAAQ;;;;;;8CACvB,6LAAC,sIAAK;oCACF,IAAG;oCACH,MAAK;oCACJ,GAAG,SAAS,QAAQ;oCACrB,aAAY;;;;;;;;;;;;sCAIpB,6LAAC,8IAAY;;8CACT,6LAAC,wIAAM;oCACH,MAAK;oCACL,SAAQ;oCACR,SAAS,IAAM,aAAa;oCAC5B,UAAU;8CACb;;;;;;8CAGD,6LAAC,wIAAM;oCAAC,MAAK;oCAAS,UAAU;;wCAC3B,8BAAgB,6LAAC,+NAAO;4CAAC,WAAU;;;;;;wCAA+B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ/F;GAhHgB;;QAS8C,4KAAO;;;KATrD"}},
    {"offset": {"line": 2674, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/components/admin/StudentProfile.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n    User, Mail, Calendar, BookOpen, Trophy,\r\n    FileText, History, ArrowLeft, RefreshCw,\r\n    TrendingUp, Target, Award, Clock,\r\n    ChevronRight, ExternalLink, MoreVertical,\r\n    IdCard, ShieldCheck, Monitor, UserX, Edit, Trash2\r\n} from 'lucide-react';\r\nimport { useStudentDetails, useResetSessions } from '@/hooks/admin/useAdminStudents';\r\nimport { useUserActions } from '@/hooks/admin/useUserActions';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuLabel,\r\n    DropdownMenuSeparator,\r\n    DropdownMenuTrigger,\r\n} from '@/components/ui/dropdown-menu';\r\nimport { StatusBadge, ExpiryBadge, GrantTypeBadge } from './StatusBadges';\r\nimport { formatDistanceToNow, format } from 'date-fns';\r\nimport { EditExpiryDialog } from './EditExpiryDialog';\r\nimport { GrantAccessDialog } from './GrantAccessDialog';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport Link from 'next/link';\r\nimport { toast } from 'sonner';\r\nimport { ConfirmDialog } from '@/components/ui/confirm-dialog';\r\nimport { EditProfileDialog } from '@/components/admin/EditProfileDialog';\r\n\r\ninterface StudentProfileProps {\r\n    studentId: string;\r\n}\r\n\r\nexport function StudentProfile({ studentId }: StudentProfileProps) {\r\n    const { data: details, isLoading, error, refetch } = useStudentDetails(studentId);\r\n    const { mutate: resetSessions, isPending: isResetting } = useResetSessions();\r\n    const [activeTab, setActiveTab] = useState('overview');\r\n\r\n    // Management Dialog States\r\n    const [editExpiryOpen, setEditExpiryOpen] = useState(false);\r\n    const [grantAccessOpen, setGrantAccessOpen] = useState(false);\r\n    const [selectedEnrollment, setSelectedEnrollment] = useState<any>(null);\r\n\r\n    // User actions hook - MUST be before conditional returns\r\n    const {\r\n        handleToggleBlock,\r\n        handleDeleteChat,\r\n        handleEditProfile,\r\n        confirmToggleBlock,\r\n        confirmDeleteChat,\r\n        isBlocking,\r\n        isDeleting,\r\n        isBanned,\r\n        blockDialogOpen,\r\n        setBlockDialogOpen,\r\n        deleteDialogOpen,\r\n        setDeleteDialogOpen,\r\n        editProfileOpen,\r\n        setEditProfileOpen,\r\n        confirmAction,\r\n        userName\r\n    } = useUserActions({\r\n        userId: studentId,\r\n        userName: details?.student?.full_name || details?.student?.email || 'User'\r\n    });\r\n\r\n    // Fetch resources for GrantAccessDialog\r\n    const supabase = createClient();\r\n    const { data: resources } = useQuery({\r\n        queryKey: ['admin-resources'],\r\n        queryFn: async () => {\r\n            const [coursesRes, seriesRes] = await Promise.all([\r\n                supabase.from('courses').select('id, title').eq('course_type', 'course').eq('is_published', true),\r\n                supabase.from('courses').select('id, title').eq('course_type', 'test_series').eq('is_published', true)\r\n            ]);\r\n            return {\r\n                courses: coursesRes.data || [],\r\n                testSeries: seriesRes.data || []\r\n            };\r\n        }\r\n    });\r\n\r\n    if (isLoading) return <StudentProfileSkeleton />;\r\n    if (error) return <StudentProfileError message={error.message} />;\r\n    if (!details) return null;\r\n\r\n    const { student, enrollments, attempts, logs, stats } = details;\r\n\r\n    // Separate enrollments by course_type\r\n    const courseEnrollments = enrollments?.filter((e: any) => e.courses?.course_type === 'course') || [];\r\n    const testSeriesEnrollments = enrollments?.filter((e: any) => e.courses?.course_type === 'test_series') || [];\r\n\r\n    return (\r\n        <div className=\"space-y-6 max-w-7xl mx-auto pb-12\">\r\n            {/* 🔝 Top Header */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link href=\"/admin/students\">\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"rounded-full\">\r\n                            <ArrowLeft className=\"w-5 h-5\" />\r\n                        </Button>\r\n                    </Link>\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white\">Student Profile</h1>\r\n                        <p className=\"text-sm text-slate-500 dark:text-slate-400\">View and manage student activity</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"gap-2\"\r\n                        onClick={() => setGrantAccessOpen(true)}\r\n                    >\r\n                        <Award className=\"w-4 h-4 text-emerald-500\" />\r\n                        Grant Access\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"gap-2\"\r\n                        onClick={() => refetch()}\r\n                    >\r\n                        <RefreshCw className=\"w-4 h-4\" />\r\n                        Refresh\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"gap-2 text-rose-600 border-rose-200 hover:bg-rose-50 dark:border-rose-900/50\"\r\n                        onClick={() => {\r\n                            if (window.confirm('Are you sure you want to reset all active sessions for this student? This will sign them out of all devices.')) {\r\n                                resetSessions(studentId);\r\n                            }\r\n                        }}\r\n                        disabled={isResetting}\r\n                    >\r\n                        <ShieldCheck className={`w-4 h-4 ${isResetting ? 'animate-spin' : ''}`} />\r\n                        {isResetting ? 'Resetting...' : 'Reset Session'}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* 👤 Profile Overview Card */}\r\n            <Card className=\"overflow-hidden border-none shadow-xl shadow-slate-200/50 dark:shadow-none bg-white/70 dark:bg-slate-900/50 backdrop-blur-xl\">\r\n                <div className=\"h-24 bg-linear-to-r from-indigo-500 via-purple-500 to-pink-500 opacity-20 dark:opacity-40\" />\r\n                <CardContent className=\"relative pt-0 px-6 pb-6\">\r\n                    <div className=\"flex flex-col md:flex-row gap-6 -mt-12 md:items-end\">\r\n                        <Avatar className=\"w-24 h-24 border-4 border-white dark:border-slate-800 shadow-xl\">\r\n                            <AvatarImage src={student.avatar_url} />\r\n                            <AvatarFallback className=\"text-2xl bg-linear-to-br from-indigo-500 to-purple-600 text-white font-bold\">\r\n                                {student.full_name?.charAt(0) || student.email.charAt(0).toUpperCase()}\r\n                            </AvatarFallback>\r\n                        </Avatar>\r\n\r\n                        <div className=\"flex-1 space-y-1\">\r\n                            <div className=\"flex flex-wrap items-center gap-2\">\r\n                                <h2 className=\"text-2xl font-black text-slate-900 dark:text-white\">\r\n                                    {student.full_name || 'No Name'}\r\n                                </h2>\r\n                                <Badge variant=\"secondary\" className=\"bg-indigo-50 text-indigo-700 dark:bg-indigo-500/10 dark:text-indigo-400 border-none\">\r\n                                    Student ID: {student.id.slice(0, 8)}...\r\n                                </Badge>\r\n                                {isBanned && (\r\n                                    <Badge variant=\"destructive\" className=\"bg-rose-100 text-rose-700 dark:bg-rose-500/10 dark:text-rose-400 border border-rose-200 dark:border-rose-800\">\r\n                                        <UserX className=\"w-3 h-3 mr-1\" />\r\n                                        Blocked\r\n                                    </Badge>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"flex flex-wrap items-center gap-4 text-sm text-slate-500 dark:text-slate-400\">\r\n                                <div className=\"flex items-center gap-1.5\">\r\n                                    <Mail className=\"w-4 h-4\" />\r\n                                    {student.email}\r\n                                </div>\r\n                                <div className=\"flex items-center gap-1.5\">\r\n                                    <Calendar className=\"w-4 h-4\" />\r\n                                    Joined {format(new Date(student.created_at), 'MMMM yyyy')}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Button variant=\"default\" className=\"bg-indigo-600 hover:bg-indigo-700 shadow-lg shadow-indigo-500/20\">\r\n                                Send Message\r\n                            </Button>\r\n                            <DropdownMenu modal={false}>\r\n                                <DropdownMenuTrigger asChild>\r\n                                    <Button variant=\"outline\" size=\"icon\">\r\n                                        <MoreVertical className=\"w-5 h-5\" />\r\n                                    </Button>\r\n                                </DropdownMenuTrigger>\r\n                                <DropdownMenuContent align=\"end\" className=\"w-48\">\r\n                                    <DropdownMenuLabel>User Actions</DropdownMenuLabel>\r\n                                    <DropdownMenuSeparator />\r\n                                    <DropdownMenuItem\r\n                                        onClick={handleEditProfile}\r\n                                        className=\"cursor-pointer\"\r\n                                    >\r\n                                        <Edit className=\"w-4 h-4 mr-2\" />\r\n                                        Edit Profile\r\n                                    </DropdownMenuItem>\r\n                                    <DropdownMenuItem\r\n                                        onClick={handleToggleBlock}\r\n                                        disabled={isBlocking}\r\n                                        className=\"cursor-pointer text-orange-600 focus:text-orange-600\"\r\n                                    >\r\n                                        <UserX className=\"w-4 h-4 mr-2\" />\r\n                                        {isBlocking ? 'Processing...' : isBanned ? 'Unblock User' : 'Block User'}\r\n                                    </DropdownMenuItem>\r\n                                    <DropdownMenuSeparator />\r\n                                    <DropdownMenuItem\r\n                                        onClick={handleDeleteChat}\r\n                                        disabled={isDeleting}\r\n                                        className=\"cursor-pointer text-rose-600 focus:text-rose-600\"\r\n                                    >\r\n                                        <Trash2 className=\"w-4 h-4 mr-2\" />\r\n                                        {isDeleting ? 'Deleting...' : 'Delete Chat History'}\r\n                                    </DropdownMenuItem>\r\n                                </DropdownMenuContent>\r\n                            </DropdownMenu>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Quick Stats Grid */}\r\n                    <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mt-8 pt-8 border-t border-slate-100 dark:border-slate-800\">\r\n                        <div className=\"p-4 rounded-2xl bg-slate-50/50 dark:bg-slate-800/30 border border-slate-100/50 dark:border-slate-800/50\">\r\n                            <div className=\"text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider mb-1\">Total Enrollments</div>\r\n                            <div className=\"flex items-end gap-2\">\r\n                                <div className=\"text-2xl font-black text-slate-900 dark:text-white\">{stats.totalEnrollments}</div>\r\n                                <BookOpen className=\"w-5 h-5 text-indigo-500 mb-1\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-4 rounded-2xl bg-slate-50/50 dark:bg-slate-800/30 border border-slate-100/50 dark:border-slate-800/50\">\r\n                            <div className=\"text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider mb-1\">Exam Attempts</div>\r\n                            <div className=\"flex items-end gap-2\">\r\n                                <div className=\"text-2xl font-black text-slate-900 dark:text-white\">{stats.totalAttempts}</div>\r\n                                <FileText className=\"w-5 h-5 text-purple-500 mb-1\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-4 rounded-2xl bg-slate-50/50 dark:bg-slate-800/30 border border-slate-100/50 dark:border-slate-800/50\">\r\n                            <div className=\"text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider mb-1\">Avg. Score</div>\r\n                            <div className=\"flex items-end gap-2\">\r\n                                <div className=\"text-2xl font-black text-slate-900 dark:text-white\">{stats.avgPercentage}%</div>\r\n                                <Target className=\"w-5 h-5 text-emerald-500 mb-1\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-4 rounded-2xl bg-slate-50/50 dark:bg-slate-800/30 border border-slate-100/50 dark:border-slate-800/50\">\r\n                            <div className=\"text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider mb-1\">Active Devices</div>\r\n                            <div className=\"flex items-end gap-2\">\r\n                                <div className=\"text-2xl font-black text-slate-900 dark:text-white\">{stats.activeSessions || 0}</div>\r\n                                <Monitor className=\"w-5 h-5 text-blue-500 mb-1\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-4 rounded-2xl bg-slate-50/50 dark:bg-slate-800/30 border border-slate-100/50 dark:border-slate-800/50\">\r\n                            <div className=\"text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider mb-1\">Status</div>\r\n                            <div className=\"flex items-end gap-2\">\r\n                                <StatusBadge status={enrollments.length > 0 ? 'active' : 'pending'} size=\"sm\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* 📊 Detailed Content Tabs */}\r\n            <Tabs defaultValue=\"courses\" onValueChange={setActiveTab} className=\"w-full\">\r\n                <div className=\"flex items-center justify-between mb-2 overflow-x-auto\">\r\n                    <TabsList className=\"bg-slate-100 dark:bg-slate-800/50 p-1 rounded-xl h-11 inline-flex flex-nowrap min-w-max\">\r\n                        <TabsTrigger value=\"courses\" className=\"rounded-lg px-4 font-semibold data-[state=active]:bg-white dark:data-[state=active]:bg-slate-700 data-[state=active]:shadow-sm whitespace-nowrap\">\r\n                            <BookOpen className=\"w-4 h-4 mr-2\" />\r\n                            Courses\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"test-series\" className=\"rounded-lg px-4 font-semibold data-[state=active]:bg-white dark:data-[state=active]:bg-slate-700 data-[state=active]:shadow-sm whitespace-nowrap\">\r\n                            <Trophy className=\"w-4 h-4 mr-2\" />\r\n                            Test Series\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"attempts\" className=\"rounded-lg px-4 font-semibold data-[state=active]:bg-white dark:data-[state=active]:bg-slate-700 data-[state=active]:shadow-sm whitespace-nowrap\">\r\n                            <FileText className=\"w-4 h-4 mr-2\" />\r\n                            Exam Attempts\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"logs\" className=\"rounded-lg px-4 font-semibold data-[state=active]:bg-white dark:data-[state=active]:bg-slate-700 data-[state=active]:shadow-sm whitespace-nowrap\">\r\n                            <History className=\"w-4 h-4 mr-2\" />\r\n                            Activity Logs\r\n                        </TabsTrigger>\r\n                    </TabsList>\r\n                </div>\r\n\r\n                <AnimatePresence mode=\"wait\">\r\n                    <motion.div\r\n                        key={activeTab}\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: -10 }}\r\n                        transition={{ duration: 0.2 }}\r\n                    >\r\n                        <TabsContent value=\"courses\" className=\"mt-0\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                {courseEnrollments.length === 0 ? (\r\n                                    <EmptyState label=\"No courses enrolled\" icon={BookOpen} />\r\n                                ) : (\r\n                                    courseEnrollments.map((en: any) => (\r\n                                        <Card key={en.id} className=\"group overflow-hidden border-none shadow-md hover:shadow-xl transition-all duration-300\">\r\n                                            <CardContent className=\"p-0\">\r\n                                                <div className=\"flex h-32\">\r\n                                                    <div className=\"w-32 h-full bg-slate-100 dark:bg-slate-800 relative shrink-0 overflow-hidden\">\r\n                                                        <img\r\n                                                            src={en.courses.thumbnail_url || '/placeholder-course.png'}\r\n                                                            alt={en.courses.title}\r\n                                                            className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500\"\r\n                                                        />\r\n                                                    </div>\r\n                                                    <div className=\"flex-1 p-4 flex flex-col justify-between min-w-0\">\r\n                                                        <div>\r\n                                                            <h3 className=\"font-bold text-slate-900 dark:text-white truncate\" title={en.courses.title}>\r\n                                                                {en.courses.title}\r\n                                                            </h3>\r\n                                                            <div className=\"flex items-center gap-2 mt-1\">\r\n                                                                <ExpiryBadge expiresAt={en.expires_at} />\r\n                                                                <GrantTypeBadge grantType={en.grant_type} />\r\n                                                                <Button\r\n                                                                    variant=\"ghost\"\r\n                                                                    size=\"icon\"\r\n                                                                    className=\"w-6 h-6 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800\"\r\n                                                                    onClick={() => {\r\n                                                                        setSelectedEnrollment({\r\n                                                                            id: en.id,\r\n                                                                            type: 'course',\r\n                                                                            studentName: student.full_name || student.email,\r\n                                                                            courseName: en.courses.title,\r\n                                                                            currentExpiry: en.expires_at\r\n                                                                        });\r\n                                                                        setEditExpiryOpen(true);\r\n                                                                    }}\r\n                                                                >\r\n                                                                    <Clock className=\"w-3 h-3 text-slate-400\" />\r\n                                                                </Button>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                        <div className=\"space-y-1.5\">\r\n                                                            <div className=\"flex justify-between text-[10px] font-bold uppercase tracking-wider text-slate-500\">\r\n                                                                <span>Progress</span>\r\n                                                                <span>{en.progress_percentage || 0}%</span>\r\n                                                            </div>\r\n                                                            <Progress value={en.progress_percentage || 0} className=\"h-1.5\" />\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </CardContent>\r\n                                        </Card>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </TabsContent>\r\n\r\n                        <TabsContent value=\"test-series\" className=\"mt-0\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                {testSeriesEnrollments.length === 0 ? (\r\n                                    <EmptyState label=\"No test series enrolled\" icon={Trophy} />\r\n                                ) : (\r\n                                    testSeriesEnrollments.map((en: any) => (\r\n                                        <Card key={en.id} className=\"group overflow-hidden border-none shadow-md hover:shadow-xl transition-all duration-300\">\r\n                                            <CardContent className=\"p-0\">\r\n                                                <div className=\"flex h-32\">\r\n                                                    <div className=\"w-32 h-full bg-slate-100 dark:bg-slate-800 relative shrink-0 overflow-hidden\">\r\n                                                        <img\r\n                                                            src={en.courses.thumbnail_url || '/placeholder-course.png'}\r\n                                                            alt={en.courses.title}\r\n                                                            className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500\"\r\n                                                        />\r\n                                                    </div>\r\n                                                    <div className=\"flex-1 p-4 flex flex-col justify-between min-w-0\">\r\n                                                        <div>\r\n                                                            <h3 className=\"font-bold text-slate-900 dark:text-white truncate\" title={en.courses.title}>\r\n                                                                {en.courses.title}\r\n                                                            </h3>\r\n                                                            <div className=\"flex items-center gap-2 mt-1\">\r\n                                                                <ExpiryBadge expiresAt={en.expires_at} />\r\n                                                                <GrantTypeBadge grantType={en.grant_type} />\r\n                                                                <Button\r\n                                                                    variant=\"ghost\"\r\n                                                                    size=\"icon\"\r\n                                                                    className=\"w-6 h-6 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800\"\r\n                                                                    onClick={() => {\r\n                                                                        setSelectedEnrollment({\r\n                                                                            id: en.id,\r\n                                                                            type: 'test_series',\r\n                                                                            studentName: student.full_name || student.email,\r\n                                                                            courseName: en.courses.title,\r\n                                                                            currentExpiry: en.expires_at\r\n                                                                        });\r\n                                                                        setEditExpiryOpen(true);\r\n                                                                    }}\r\n                                                                >\r\n                                                                    <Clock className=\"w-3 h-3 text-slate-400\" />\r\n                                                                </Button>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                        <div className=\"space-y-1.5\">\r\n                                                            <div className=\"flex justify-between text-[10px] font-bold uppercase tracking-wider text-slate-500\">\r\n                                                                <span>Progress</span>\r\n                                                                <span>{en.progress_percentage || 0}%</span>\r\n                                                            </div>\r\n                                                            <Progress value={en.progress_percentage || 0} className=\"h-1.5\" />\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </CardContent>\r\n                                        </Card>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </TabsContent>\r\n\r\n                        <TabsContent value=\"attempts\" className=\"mt-0\">\r\n                            <Card className=\"border-none shadow-xl bg-white/50 dark:bg-slate-900/50 backdrop-blur-xl rounded-2xl overflow-hidden\">\r\n                                <div className=\"overflow-x-auto\">\r\n                                    <table className=\"w-full text-left\">\r\n                                        <thead className=\"bg-slate-50/50 dark:bg-slate-800/50 border-b border-slate-100 dark:border-slate-800\">\r\n                                            <tr>\r\n                                                <th className=\"px-6 py-4 text-xs font-black uppercase tracking-wider text-slate-500\">Exam</th>\r\n                                                <th className=\"px-6 py-4 text-xs font-black uppercase tracking-wider text-slate-500\">Date</th>\r\n                                                <th className=\"px-6 py-4 text-xs font-black uppercase tracking-wider text-slate-500\">Score</th>\r\n                                                <th className=\"px-6 py-4 text-xs font-black uppercase tracking-wider text-slate-500 text-right\">Action</th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800\">\r\n                                            {attempts.length === 0 ? (\r\n                                                <tr>\r\n                                                    <td colSpan={4} className=\"px-6 py-12 text-center text-slate-500\">\r\n                                                        No exam attempts found\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ) : (\r\n                                                attempts.map((att: any) => (\r\n                                                    <tr key={att.id} className=\"hover:bg-slate-50/50 dark:hover:bg-slate-800/30 transition-colors\">\r\n                                                        <td className=\"px-6 py-4\">\r\n                                                            <div>\r\n                                                                <p className=\"font-bold text-slate-900 dark:text-white truncate max-w-xs\">{att.exams.title}</p>\r\n                                                                <div className=\"flex items-center gap-2 mt-1\">\r\n                                                                    <StatusBadge status={att.status === 'submitted' ? 'completed' : 'pending'} size=\"sm\" />\r\n                                                                    <span className=\"text-[10px] text-slate-400 font-medium\">#{att.id.slice(0, 8)}</span>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-sm text-slate-500 dark:text-slate-400\">\r\n                                                            {format(new Date(att.created_at), 'MMM d, p')}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4\">\r\n                                                            {att.status === 'submitted' && att.results ? (\r\n                                                                <div className=\"space-y-1\">\r\n                                                                    <div className=\"font-bold text-emerald-600 dark:text-emerald-400\">{att.percentage}%</div>\r\n                                                                    <div className=\"text-[10px] text-slate-400\">{att.obtained_marks} / {att.total_marks}</div>\r\n                                                                </div>\r\n                                                            ) : (\r\n                                                                <span className=\"text-slate-400 text-sm italic\">N/A</span>\r\n                                                            )}\r\n                                                        </td>\r\n                                                        <td className=\"px-6 py-4 text-right\">\r\n                                                            <Link href={`/admin/students/review/${att.id}`}>\r\n                                                                <Button variant=\"ghost\" size=\"sm\" className=\"h-8 px-2\" disabled={att.status !== 'submitted'}>\r\n                                                                    <ExternalLink className=\"w-4 h-4 mr-1.5\" />\r\n                                                                    Review\r\n                                                                </Button>\r\n                                                            </Link>\r\n                                                        </td>\r\n                                                    </tr>\r\n                                                ))\r\n                                            )}\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                            </Card>\r\n                        </TabsContent>\r\n\r\n                        <TabsContent value=\"logs\" className=\"mt-0\">\r\n                            <div className=\"space-y-4\">\r\n                                {logs.length === 0 ? (\r\n                                    <EmptyState label=\"No administrative logs\" icon={History} />\r\n                                ) : (\r\n                                    logs.map((log: any) => (\r\n                                        <div key={log.id} className=\"flex gap-4 group\">\r\n                                            <div className=\"flex flex-col items-center shrink-0\">\r\n                                                <div className=\"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500\">\r\n                                                    <History className=\"w-5 h-5\" />\r\n                                                </div>\r\n                                                <div className=\"w-px flex-1 bg-slate-100 dark:bg-slate-800 group-last:hidden\" />\r\n                                            </div>\r\n                                            <div className=\"pb-8 flex-1\">\r\n                                                <div className=\"p-4 rounded-2xl bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 shadow-sm\">\r\n                                                    <div className=\"flex justify-between items-start mb-2\">\r\n                                                        <p className=\"font-bold text-slate-900 dark:text-white uppercase text-xs tracking-wider\">\r\n                                                            {log.action_type}\r\n                                                        </p>\r\n                                                        <span className=\"text-[10px] text-slate-400 font-medium\">\r\n                                                            {formatDistanceToNow(new Date(log.created_at), { addSuffix: true })}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <p className=\"text-sm text-slate-600 dark:text-slate-400 leading-relaxed\">\r\n                                                        {log.details || `Admin granted access to the content.`}\r\n                                                    </p>\r\n                                                    <div className=\"mt-3 pt-3 border-t border-slate-50 dark:border-slate-800 flex items-center justify-between\">\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <div className=\"w-5 h-5 rounded-full bg-indigo-500 flex items-center justify-center text-[10px] text-white font-bold\">\r\n                                                                {log.performed_by_profile?.full_name?.charAt(0) || 'A'}\r\n                                                            </div>\r\n                                                            <span className=\"text-xs font-semibold text-slate-500\">\r\n                                                                {log.performed_by_profile?.full_name || 'System Admin'}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                        <Badge variant=\"outline\" className=\"text-[9px] uppercase tracking-tighter\">\r\n                                                            IP: {log.ip_address || 'Internal'}\r\n                                                        </Badge>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </TabsContent>\r\n                    </motion.div>\r\n                </AnimatePresence>\r\n            </Tabs>\r\n\r\n            {/* Management Dialogs */}\r\n            <EditExpiryDialog\r\n                open={editExpiryOpen}\r\n                onOpenChange={setEditExpiryOpen}\r\n                onSuccess={() => refetch()}\r\n                enrollment={selectedEnrollment}\r\n            />\r\n            <GrantAccessDialog\r\n                open={grantAccessOpen}\r\n                onOpenChange={setGrantAccessOpen}\r\n                onSuccess={() => refetch()}\r\n                courses={resources?.courses || []}\r\n                testSeries={resources?.testSeries || []}\r\n            />\r\n\r\n            {/* User Action Confirmation Dialogs */}\r\n            <ConfirmDialog\r\n                open={blockDialogOpen}\r\n                onOpenChange={setBlockDialogOpen}\r\n                title={confirmAction === 'block' ? 'Block User' : 'Unblock User'}\r\n                description={\r\n                    confirmAction === 'block'\r\n                        ? `Are you sure you want to block ${userName}? They will not be able to access the platform.`\r\n                        : `Are you sure you want to unblock ${userName}? They will regain access to the platform.`\r\n                }\r\n                confirmText={confirmAction === 'block' ? 'Block User' : 'Unblock User'}\r\n                variant={confirmAction === 'block' ? 'destructive' : 'default'}\r\n                onConfirm={confirmToggleBlock}\r\n            />\r\n            <ConfirmDialog\r\n                open={deleteDialogOpen}\r\n                onOpenChange={setDeleteDialogOpen}\r\n                title=\"Delete Chat History\"\r\n                description={`Are you sure you want to delete all chat history for ${userName}? This action cannot be undone.`}\r\n                confirmText=\"Delete\"\r\n                variant=\"destructive\"\r\n                onConfirm={confirmDeleteChat}\r\n            />\r\n            <EditProfileDialog\r\n                open={editProfileOpen}\r\n                onOpenChange={setEditProfileOpen}\r\n                userId={studentId}\r\n                currentData={{\r\n                    fullName: student.full_name || '',\r\n                    email: student.email,\r\n                    phone: student.phone || ''\r\n                }}\r\n                onSuccess={() => refetch()}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction EmptyState({ label, icon: Icon }: { label: string; icon: any }) {\r\n    return (\r\n        <Card className=\"p-12 border-2 border-dashed border-slate-200 dark:border-slate-800 bg-transparent flex flex-col items-center justify-center text-center\">\r\n            <div className=\"w-16 h-16 rounded-full bg-slate-50 dark:bg-slate-800 flex items-center justify-center mb-4 text-slate-400\">\r\n                <Icon className=\"w-8 h-8 opacity-20\" />\r\n            </div>\r\n            <p className=\"text-slate-500 font-semibold\">{label}</p>\r\n        </Card>\r\n    );\r\n}\r\n\r\nfunction StudentProfileSkeleton() {\r\n    return (\r\n        <div className=\"space-y-6 max-w-7xl mx-auto pb-12 animate-pulse\">\r\n            <div className=\"flex items-center gap-3\">\r\n                <Skeleton className=\"w-10 h-10 rounded-full\" />\r\n                <div className=\"space-y-2\">\r\n                    <Skeleton className=\"w-48 h-6\" />\r\n                    <Skeleton className=\"w-32 h-4\" />\r\n                </div>\r\n            </div>\r\n            <Skeleton className=\"w-full h-48 rounded-2xl\" />\r\n            <div className=\"grid grid-cols-4 gap-4\">\r\n                {[...Array(4)].map((_, i) => <Skeleton key={i} className=\"h-24 rounded-2xl\" />)}\r\n            </div>\r\n            <Skeleton className=\"w-full h-96 rounded-2xl\" />\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction StudentProfileError({ message }: { message: string }) {\r\n    return (\r\n        <div className=\"p-8 text-center max-w-md mx-auto\">\r\n            <div className=\"w-20 h-20 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                <ShieldCheck className=\"w-10 h-10 text-rose-500 opacity-50\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-bold text-slate-900 mb-2\">Failed to load student</h3>\r\n            <p className=\"text-slate-500 mb-6\">{message}</p>\r\n            <Link href=\"/admin/students\">\r\n                <Button className=\"w-full\">Back to Student List</Button>\r\n            </Link>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4590, "column": 0}, "map": {"version":3,"sources":["file:///E:/PROJECT%202025%20-%20October/math4code-website/app/admin/students/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Suspense } from \"react\";\r\nimport { StudentProfile } from \"@/components/admin/StudentProfile\";\r\nimport { useParams } from \"next/navigation\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\n\r\nfunction StudentProfileSkeleton() {\r\n    return (\r\n        <div className=\"p-4 md:p-6 lg:p-8 space-y-6 animate-pulse\">\r\n            <Skeleton className=\"h-32 w-full rounded-xl\" />\r\n            <Skeleton className=\"h-64 w-full rounded-xl\" />\r\n            <Skeleton className=\"h-96 w-full rounded-xl\" />\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction StudentProfileContent() {\r\n    const params = useParams();\r\n    const userId = params.id as string;\r\n\r\n    if (!userId) {\r\n        return <div className=\"p-8 text-center\">Invalid student ID</div>;\r\n    }\r\n\r\n    return <StudentProfile studentId={userId} />;\r\n}\r\n\r\nexport default function StudentProfilePageWrapper() {\r\n    return (\r\n        <div className=\"p-4 md:p-6 lg:p-8\">\r\n            <Suspense fallback={<StudentProfileSkeleton />}>\r\n                <StudentProfileContent />\r\n            </Suspense>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAOA,SAAS;IACL,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC,4IAAQ;gBAAC,WAAU;;;;;;0BACpB,6LAAC,4IAAQ;gBAAC,WAAU;;;;;;0BACpB,6LAAC,4IAAQ;gBAAC,WAAU;;;;;;;;;;;;AAGhC;KARS;AAUT,SAAS;;IACL,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,SAAS,OAAO,EAAE;IAExB,IAAI,CAAC,QAAQ;QACT,qBAAO,6LAAC;YAAI,WAAU;sBAAkB;;;;;;IAC5C;IAEA,qBAAO,6LAAC,2JAAc;QAAC,WAAW;;;;;;AACtC;GATS;;QACU,kJAAS;;;MADnB;AAWM,SAAS;IACpB,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC,yKAAQ;YAAC,wBAAU,6LAAC;;;;;sBACjB,cAAA,6LAAC;;;;;;;;;;;;;;;AAIjB;MARwB"}}]
}