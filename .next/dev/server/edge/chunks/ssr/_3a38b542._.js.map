{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/hooks/useLessonData.ts"],"sourcesContent":["\r\nimport { useQuery, keepPreviousData } from \"@tanstack/react-query\";\r\nimport { createClient } from \"@/lib/supabase/client\";\r\n\r\nexport function useLessonData(lessonId: string, courseId: string) {\r\n    return useQuery({\r\n        queryKey: ['lesson', lessonId, courseId],\r\n        queryFn: async () => {\r\n            const supabase = createClient();\r\n\r\n            // Get authenticated user\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) throw new Error(\"Not authenticated\");\r\n\r\n            // Fetch lesson data\r\n            const { data: lesson, error: lessonError } = await supabase\r\n                .from(\"lessons\")\r\n                .select(\"*\")\r\n                .eq(\"id\", lessonId)\r\n                .single();\r\n\r\n            if (lessonError || !lesson) {\r\n                throw new Error(\"Lesson not found\");\r\n            }\r\n\r\n            const result: any = { lesson };\r\n\r\n            // Fetch quiz/exam data if lesson is a quiz\r\n            if (lesson.content_type === 'quiz' && lesson.exam_id) {\r\n                const [examResult, sectionsResult, attemptsResult] = await Promise.all([\r\n                    supabase\r\n                        .from(\"exams\")\r\n                        .select(\"*\")\r\n                        .eq(\"id\", lesson.exam_id)\r\n                        .single(),\r\n                    supabase\r\n                        .from(\"sections\")\r\n                        .select(\"id, questions:questions(id)\")\r\n                        .eq(\"exam_id\", lesson.exam_id),\r\n                    supabase\r\n                        .from(\"exam_attempts\")\r\n                        .select(\"*\")\r\n                        .eq(\"exam_id\", lesson.exam_id)\r\n                        .eq(\"student_id\", user.id)\r\n                ]);\r\n\r\n                result.exam = examResult.data;\r\n\r\n                // Calculate question count\r\n                const sections = sectionsResult.data || [];\r\n                result.questionsCount = sections.reduce(\r\n                    (acc: number, section: any) => acc + (section.questions?.length || 0),\r\n                    0\r\n                );\r\n\r\n                result.attempts = attemptsResult.data || [];\r\n            }\r\n\r\n            // Fetch course/author context (optional)\r\n            try {\r\n                const { data: course } = await supabase\r\n                    .from(\"courses\")\r\n                    .select(\"creator_id\")\r\n                    .eq(\"id\", courseId)\r\n                    .single();\r\n\r\n                if (course?.creator_id) {\r\n                    const { data: author } = await supabase\r\n                        .from(\"profiles\")\r\n                        .select(\"*\")\r\n                        .eq(\"id\", course.creator_id)\r\n                        .single();\r\n                    result.author = author;\r\n                }\r\n            } catch (authorError) {\r\n                // Ignore author fetch errors - not critical\r\n                console.warn(\"Could not fetch author:\", authorError);\r\n            }\r\n\r\n            return result;\r\n        },\r\n        staleTime: 1000 * 60 * 10, // 10 minutes - Data remains \"fresh\" and won't re-fetch on revisit\r\n        gcTime: 1000 * 60 * 30,    // 30 minutes - Keep data in memory for 30 mins even if unused\r\n        refetchOnWindowFocus: false, // Don't re-fetch when switching tabs\r\n        placeholderData: keepPreviousData, // âš¡ INSTANT RECALL: Show previous lesson while fetching new one\r\n        enabled: !!lessonId,\r\n        retry: 1,\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AAAA;AACA;;;AAEO,SAAS,cAAc,QAAgB,EAAE,QAAgB;IAC5D,OAAO,IAAA,+LAAQ,EAAC;QACZ,UAAU;YAAC;YAAU;YAAU;SAAS;QACxC,SAAS;YACL,MAAM,WAAW,IAAA,iJAAY;YAE7B,yBAAyB;YACzB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;YACtD,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;YAE3B,oBAAoB;YACpB,MAAM,EAAE,MAAM,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAC9C,IAAI,CAAC,WACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,UACT,MAAM;YAEX,IAAI,eAAe,CAAC,QAAQ;gBACxB,MAAM,IAAI,MAAM;YACpB;YAEA,MAAM,SAAc;gBAAE;YAAO;YAE7B,2CAA2C;YAC3C,IAAI,OAAO,YAAY,KAAK,UAAU,OAAO,OAAO,EAAE;gBAClD,MAAM,CAAC,YAAY,gBAAgB,eAAe,GAAG,MAAM,QAAQ,GAAG,CAAC;oBACnE,SACK,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,OAAO,OAAO,EACvB,MAAM;oBACX,SACK,IAAI,CAAC,YACL,MAAM,CAAC,+BACP,EAAE,CAAC,WAAW,OAAO,OAAO;oBACjC,SACK,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,OAAO,OAAO,EAC5B,EAAE,CAAC,cAAc,KAAK,EAAE;iBAChC;gBAED,OAAO,IAAI,GAAG,WAAW,IAAI;gBAE7B,2BAA2B;gBAC3B,MAAM,WAAW,eAAe,IAAI,IAAI,EAAE;gBAC1C,OAAO,cAAc,GAAG,SAAS,MAAM,CACnC,CAAC,KAAa,UAAiB,MAAM,CAAC,QAAQ,SAAS,EAAE,UAAU,CAAC,GACpE;gBAGJ,OAAO,QAAQ,GAAG,eAAe,IAAI,IAAI,EAAE;YAC/C;YAEA,yCAAyC;YACzC,IAAI;gBACA,MAAM,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,SAC1B,IAAI,CAAC,WACL,MAAM,CAAC,cACP,EAAE,CAAC,MAAM,UACT,MAAM;gBAEX,IAAI,QAAQ,YAAY;oBACpB,MAAM,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,SAC1B,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,OAAO,UAAU,EAC1B,MAAM;oBACX,OAAO,MAAM,GAAG;gBACpB;YACJ,EAAE,OAAO,aAAa;gBAClB,4CAA4C;gBAC5C,QAAQ,IAAI,CAAC,2BAA2B;YAC5C;YAEA,OAAO;QACX;QACA,WAAW,OAAO,KAAK;QACvB,QAAQ,OAAO,KAAK;QACpB,sBAAsB;QACtB,iBAAiB,mMAAgB;QACjC,SAAS,CAAC,CAAC;QACX,OAAO;IACX;AACJ"}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/context/LessonContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext } from \"react\";\r\n\r\ninterface LessonContextType {\r\n    markComplete: () => void;\r\n    isCompleted: boolean;\r\n}\r\n\r\nconst LessonContext = createContext<LessonContextType | undefined>(undefined);\r\n\r\nexport function useLessonContext() {\r\n    const context = useContext(LessonContext);\r\n    if (!context) {\r\n        throw new Error(\"useLessonContext must be used within a LessonTracker (Provider)\");\r\n    }\r\n    return context;\r\n}\r\n\r\nexport default LessonContext;\r\n"],"names":[],"mappings":";;;;;;AAEA;AAFA;;AASA,MAAM,8BAAgB,IAAA,mLAAa,EAAgC;AAE5D,SAAS;IACZ,MAAM,UAAU,IAAA,gLAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACV,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX;uCAEe"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/VideoPlayer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport dynamic from \"next/dynamic\";\r\nimport {\r\n    Play, Pause, RotateCcw, RotateCw, Volume2, VolumeX,\r\n    Maximize, Minimize, PlayCircle, Loader2, Settings, Info\r\n} from \"lucide-react\";\r\nimport { awardCoins } from \"@/app/actions/rewardActions\";\r\nimport { createClient } from \"@/lib/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { useLessonContext } from \"@/context/LessonContext\";\r\n\r\n// Dynamically import ReactPlayer to avoid hydration errors\r\nconst ReactPlayer = dynamic(() => import(\"react-player\"), { ssr: false }) as any;\r\n\r\ninterface VideoPlayerProps {\r\n    url: string;\r\n    className?: string;\r\n    thumbUrl?: string;\r\n}\r\n\r\nconst extractYouTubeId = (s?: string | null) => {\r\n    if (!s) return null;\r\n    const str = s.trim();\r\n    const idMatch = str.match(/^[\\w-]{11}$/);\r\n    if (idMatch) return idMatch[0];\r\n    const qMatch = str.match(/[?&]v=([\\w-]{11})/);\r\n    if (qMatch) return qMatch[1];\r\n    const shortMatch = str.match(/youtu\\.be\\/([\\w-]{11})/);\r\n    if (shortMatch) return shortMatch[1];\r\n    const embMatch = str.match(/embed\\/([\\w-]{11})/);\r\n    if (embMatch) return embMatch[1];\r\n    return null;\r\n};\r\n\r\nconst formatTime = (seconds: number): string => {\r\n    const hrs = Math.floor(seconds / 3600);\r\n    const mins = Math.floor((seconds % 3600) / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n\r\n    if (hrs > 0) {\r\n        return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n    }\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n};\r\n\r\nfunction loadYouTubeIframeAPI(): Promise<void> {\r\n    return new Promise((resolve) => {\r\n        if ((window as any).YT && (window as any).YT.Player) return resolve();\r\n        if (document.getElementById(\"youtube-iframe-api\")) {\r\n            const interval = setInterval(() => {\r\n                if ((window as any).YT && (window as any).YT.Player) {\r\n                    clearInterval(interval);\r\n                    resolve();\r\n                }\r\n            }, 100);\r\n            return;\r\n        }\r\n        const tag = document.createElement(\"script\");\r\n        tag.id = \"youtube-iframe-api\";\r\n        tag.src = \"https://www.youtube.com/iframe_api\";\r\n        document.body.appendChild(tag);\r\n        (window as any).onYouTubeIframeAPIReady = () => resolve();\r\n    });\r\n}\r\n\r\nexport default function VideoPlayer({ url, className = \"\", thumbUrl }: VideoPlayerProps) {\r\n    const wrapperRef = useRef<HTMLDivElement | null>(null);\r\n    const containerRef = useRef<HTMLDivElement | null>(null);\r\n    const progressContainerRef = useRef<HTMLDivElement | null>(null);\r\n    const ytRef = useRef<any>(null);\r\n    const rpRef = useRef<any>(null);\r\n    const controlsTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n    const [mounted, setMounted] = useState(false);\r\n    const [usingYouTube, setUsingYouTube] = useState(false);\r\n    const [youtubeId, setYoutubeId] = useState<string | null>(null);\r\n\r\n    const [isReady, setIsReady] = useState(false);\r\n    const [isPlayingState, setIsPlayingState] = useState(false);\r\n    const [showCover, setShowCover] = useState(true);\r\n    const [muted, setMuted] = useState(false);\r\n    const [duration, setDuration] = useState<number | null>(null);\r\n    const [currentTime, setCurrentTime] = useState<number>(0);\r\n    const [sliderValue, setSliderValue] = useState<number>(0);\r\n    const [seeking, setSeeking] = useState(false);\r\n    const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n    const [rewarded, setRewarded] = useState(false);\r\n    const [userId, setUserId] = useState<string | null>(null);\r\n\r\n    // Make lesson context optional - it may not exist in admin builder\r\n    let markComplete: (() => void) | null = null;\r\n    try {\r\n        const context = useLessonContext();\r\n        markComplete = context.markComplete;\r\n    } catch (error) {\r\n        // Context not available (e.g., in admin builder), that's okay\r\n        markComplete = null;\r\n    }\r\n\r\n    // Missing state variables\r\n    const [showControls, setShowControls] = useState(true);\r\n    const [showQualityModal, setShowQualityModal] = useState(false);\r\n    const [showSpeedMenu, setShowSpeedMenu] = useState(false);\r\n    const [isFullScreen, setIsFullScreen] = useState(false);\r\n    const [isPaused, setIsPaused] = useState(true);\r\n    const [playbackRate, setPlaybackRate] = useState(1);\r\n    const [selectedQuality, setSelectedQuality] = useState(\"auto\");\r\n    const [qualityOptions, setQualityOptions] = useState<string[]>([]);\r\n    const speedOptions = [0.5, 0.75, 1, 1.25, 1.5, 2];\r\n\r\n    const updateQualityOptions = (target: any) => {\r\n        try {\r\n            if (typeof target.getAvailableQualityLevels === 'function') {\r\n                const levels = target.getAvailableQualityLevels();\r\n                if (levels && levels.length > 0) {\r\n                    setQualityOptions(levels);\r\n                }\r\n            }\r\n        } catch (e) { }\r\n    };\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n        const yId = extractYouTubeId(url);\r\n        if (yId) {\r\n            setUsingYouTube(true);\r\n            setYoutubeId(yId);\r\n        } else {\r\n            setUsingYouTube(false);\r\n            setYoutubeId(null);\r\n        }\r\n    }, [url]);\r\n\r\n    useEffect(() => {\r\n        const getUser = async () => {\r\n            const supabase = await createClient();\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (user) setUserId(user.id);\r\n        };\r\n        getUser();\r\n    }, []);\r\n\r\n    const startHideControlsTimer = useCallback(() => {\r\n        if (controlsTimeoutRef.current) clearTimeout(controlsTimeoutRef.current);\r\n        if (isPlayingState && !showQualityModal && !showSpeedMenu) {\r\n            controlsTimeoutRef.current = setTimeout(() => {\r\n                setShowControls(false);\r\n                setShowSpeedMenu(false); setShowQualityModal(false);\r\n            }, 3000);\r\n        }\r\n    }, [isPlayingState, showQualityModal, showSpeedMenu]);\r\n\r\n    const handleMouseMove = () => { setShowControls(true); startHideControlsTimer(); };\r\n    const handleMouseLeave = () => { if (isPlayingState && !showQualityModal && !showSpeedMenu) setShowControls(false); };\r\n\r\n    useEffect(() => {\r\n        if (isPlayingState) startHideControlsTimer();\r\n        else { setShowControls(true); if (controlsTimeoutRef.current) clearTimeout(controlsTimeoutRef.current); }\r\n    }, [isPlayingState, startHideControlsTimer]);\r\n\r\n    useEffect(() => {\r\n        let pollTimer: number | null = null;\r\n        const initYT = async () => {\r\n            if (!usingYouTube || !youtubeId || !containerRef.current) return;\r\n            try { await loadYouTubeIframeAPI(); } catch { setErrorMsg(\"Load Error\"); return; }\r\n            if (ytRef.current) { try { ytRef.current.destroy(); } catch { } ytRef.current = null; }\r\n\r\n            containerRef.current.innerHTML = \"\";\r\n            const el = document.createElement(\"div\");\r\n            el.id = `yt - player - ${youtubeId} -${Date.now()} `;\r\n            el.style.width = \"100%\"; el.style.height = \"100%\";\r\n            el.style.pointerEvents = \"none\";\r\n            containerRef.current.appendChild(el);\r\n\r\n            ytRef.current = new (window as any).YT.Player(el.id, {\r\n                videoId: youtubeId,\r\n                playerVars: {\r\n                    controls: 0, modestbranding: 1, rel: 0, disablekb: 1,\r\n                    iv_load_policy: 3, showinfo: 0, playsinline: 1, enablejsapi: 1,\r\n                    origin: typeof window !== \"undefined\" ? window.location.origin : undefined,\r\n                },\r\n                events: {\r\n                    onReady: (ev: any) => {\r\n                        setIsReady(true);\r\n                        try { const d = ev.target.getDuration(); if (d > 0) setDuration(d); } catch { }\r\n                        updateQualityOptions(ev.target);\r\n                        pollTimer = window.setInterval(() => {\r\n                            if (seeking) return;\r\n                            try {\r\n                                const t = ev.target.getCurrentTime?.() || 0;\r\n                                const d = ev.target.getDuration?.() || duration || 0;\r\n                                setCurrentTime(t);\r\n                                if (d > 0) { setDuration(d); setSliderValue(t / d); }\r\n                            } catch { }\r\n                        }, 250) as unknown as number;\r\n                    },\r\n                    onStateChange: (e: any) => {\r\n                        const s = e.data;\r\n                        if (s === 1) {\r\n                            setIsPlayingState(true); setIsPaused(false); setShowCover(false);\r\n                            updateQualityOptions(e.target);\r\n                        } else if (s === 2 || s === 0) {\r\n                            setIsPlayingState(false); setIsPaused(true);\r\n                        }\r\n                    },\r\n                    onError: () => { setErrorMsg(\"Error\"); setIsReady(true); }\r\n                },\r\n            });\r\n        };\r\n        if (usingYouTube) initYT();\r\n        return () => { if (pollTimer) clearInterval(pollTimer); if (ytRef.current) { try { ytRef.current.destroy(); } catch { } } };\r\n    }, [usingYouTube, youtubeId]);\r\n\r\n    const onRPReady = () => { setIsReady(true); try { const d = rpRef.current?.getDuration(); if (d > 0) setDuration(d); } catch { } };\r\n\r\n    const onRPProgress = async (state: any) => {\r\n        if (!seeking) {\r\n            setSliderValue(state.played);\r\n            setCurrentTime(state.playedSeconds);\r\n\r\n            // Reward Logic\r\n            if (!rewarded && userId && state.played > 0.8) {\r\n                setRewarded(true);\r\n                const res = await awardCoins(userId, 'video_watch', url, `Watched video: ${url} `);\r\n                if (res.success && res.message) {\r\n                    toast.success(res.message, { icon: \"ðŸª™\" });\r\n                }\r\n                // Mark lesson complete via context (if available)\r\n                if (markComplete) {\r\n                    markComplete();\r\n                }\r\n            }\r\n        }\r\n    };\r\n    const onRPPause = () => { setIsPlayingState(false); setIsPaused(true); };\r\n    const onRPPlay = () => { setIsPlayingState(true); setIsPaused(false); setShowCover(false); };\r\n\r\n    const sendYTCommand = useCallback((func: string, args: any[] = []) => {\r\n        if (!usingYouTube) return;\r\n        try { if (ytRef.current && typeof ytRef.current[func] === 'function') return ytRef.current[func](...args); } catch { }\r\n        try { const iframe = containerRef.current?.querySelector(\"iframe\"); iframe?.contentWindow?.postMessage(JSON.stringify({ event: \"command\", func, args }), \"*\"); } catch { }\r\n    }, [usingYouTube]);\r\n\r\n    const handlePlay = useCallback(() => {\r\n        if (usingYouTube) sendYTCommand(\"playVideo\"); else setIsPlayingState(true);\r\n        setIsPaused(false); setShowQualityModal(false); setShowSpeedMenu(false);\r\n    }, [usingYouTube, sendYTCommand]);\r\n\r\n    const handlePause = useCallback(() => {\r\n        if (usingYouTube) sendYTCommand(\"pauseVideo\"); else setIsPlayingState(false);\r\n        setIsPaused(true);\r\n    }, [usingYouTube, sendYTCommand]);\r\n\r\n    const togglePlay = useCallback(() => isPlayingState ? handlePause() : handlePlay(), [isPlayingState, handlePause, handlePlay]);\r\n\r\n    const seekToFraction = useCallback((fraction: number) => {\r\n        const d = duration || (usingYouTube ? ytRef.current?.getDuration() : rpRef.current?.getDuration()) || 0;\r\n        if (d <= 0) return;\r\n        const secs = fraction * d;\r\n        if (usingYouTube) sendYTCommand(\"seekTo\", [secs, true]);\r\n        else rpRef.current?.seekTo(fraction, \"fraction\");\r\n\r\n        setCurrentTime(secs);\r\n        setSliderValue(fraction);\r\n        handlePlay();\r\n        startHideControlsTimer();\r\n    }, [duration, usingYouTube, sendYTCommand, handlePlay, startHideControlsTimer]);\r\n\r\n    /* --- CLICK-TO-SEEK LOGIC --- */\r\n    const handleProgressBarClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        if (!progressContainerRef.current) return;\r\n        const rect = progressContainerRef.current.getBoundingClientRect();\r\n        const clickX = e.clientX - rect.left;\r\n        const fraction = Math.max(0, Math.min(1, clickX / rect.width));\r\n\r\n        setSeeking(false);\r\n        seekToFraction(fraction);\r\n    };\r\n\r\n    const handleSliderChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        setSliderValue(parseFloat(e.target.value));\r\n        startHideControlsTimer();\r\n    };\r\n\r\n    const handleSliderEnd = (e: React.MouseEvent | React.TouchEvent) => {\r\n        setSeeking(false);\r\n        seekToFraction(parseFloat((e.currentTarget as HTMLInputElement).value));\r\n    };\r\n\r\n    const toggleMute = useCallback(() => { if (usingYouTube) sendYTCommand(muted ? \"unMute\" : \"mute\"); setMuted(p => !p); }, [usingYouTube, sendYTCommand, muted]);\r\n    const rewind = useCallback(() => { const d = duration || 1; const t = Math.max(0, currentTime - 10); seekToFraction(t / d); setShowControls(true); }, [currentTime, duration, seekToFraction]);\r\n    const fastForward = useCallback(() => { const d = duration || 1; const t = Math.min(d, currentTime + 10); seekToFraction(t / d); setShowControls(true); }, [currentTime, duration, seekToFraction]);\r\n\r\n    const handleFullScreen = useCallback(async () => {\r\n        if (!wrapperRef.current) return;\r\n        try {\r\n            if (document.fullscreenElement) { await document.exitFullscreen(); setIsFullScreen(false); }\r\n            else { await (wrapperRef.current as any).requestFullscreen(); setIsFullScreen(true); }\r\n        } catch { }\r\n    }, []);\r\n\r\n    // --- KEYBOARD SHORTCUTS ---\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if ((e.target as HTMLElement).tagName === 'INPUT') return;\r\n            setShowControls(true); startHideControlsTimer();\r\n            switch (e.key) {\r\n                case ' ': case 'k': case 'K': e.preventDefault(); togglePlay(); break;\r\n                case 'ArrowRight': case 'l': case 'L': e.preventDefault(); fastForward(); break;\r\n                case 'ArrowLeft': case 'j': case 'J': e.preventDefault(); rewind(); break;\r\n                case 'f': case 'F': e.preventDefault(); handleFullScreen(); break;\r\n                case 'm': case 'M': e.preventDefault(); toggleMute(); break;\r\n            }\r\n        };\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [togglePlay, fastForward, rewind, handleFullScreen, toggleMute, startHideControlsTimer]);\r\n\r\n    useEffect(() => {\r\n        const onFullscreenChange = () => setIsFullScreen(!!document.fullscreenElement);\r\n        document.addEventListener('fullscreenchange', onFullscreenChange);\r\n        return () => document.removeEventListener('fullscreenchange', onFullscreenChange);\r\n    }, []);\r\n\r\n    const changeQuality = (q: string) => { setSelectedQuality(q); setShowQualityModal(false); if (usingYouTube) { sendYTCommand(\"setPlaybackQuality\", [q]); sendYTCommand(\"setPlaybackQualityRange\", [q]); } };\r\n    const changeSpeed = (s: number) => { setPlaybackRate(s); setShowSpeedMenu(false); if (usingYouTube) sendYTCommand(\"setPlaybackRate\", [s]); };\r\n\r\n    if (!mounted) return <div className=\"aspect-video bg-slate-900 rounded-xl\"></div>;\r\n\r\n    return (\r\n        <div\r\n            ref={wrapperRef}\r\n            className={`relative w-full h-full bg-black group overflow-hidden rounded-xl shadow-2xl border border-slate-900 ${className} ${isFullScreen ? 'rounded-none border-none cursor-none' : ''} ${showControls ? 'cursor-auto' : ''} `}\r\n            onMouseMove={handleMouseMove}\r\n            onMouseLeave={handleMouseLeave}\r\n        >\r\n            <div className=\"w-full h-full relative\">\r\n                <div ref={containerRef} className=\"w-full h-full bg-black\" />\r\n                {!usingYouTube && (\r\n                    <ReactPlayer ref={rpRef} url={url} width=\"100%\" height=\"100%\" playing={isPlayingState} muted={muted} playbackRate={playbackRate} controls={false} onReady={onRPReady} onProgress={onRPProgress} onPause={onRPPause} onPlay={onRPPlay} config={{ file: { attributes: { controlsList: \"nodownload\" } } }} playsinline />\r\n                )}\r\n            </div>\r\n\r\n            {!showCover && (<div className=\"absolute inset-0 z-10 cursor-pointer\" onClick={togglePlay} onContextMenu={e => e.preventDefault()} />)}\r\n\r\n            {/* BRANDING */}\r\n            {usingYouTube && !showCover && (\r\n                <>\r\n                    <div className={`absolute top-0 left-0 right-0 h-24 bg-linear-to-b from-black/90 via-black/40 to-transparent z-20 pointer-events-none transition-opacity duration-300 ${showControls ? 'opacity-100' : 'opacity-0'} `} />\r\n                    <div className={`absolute top-4 left-4 z-30 pointer-events-none flex items-center gap-2 transition-opacity duration-300 ${showControls ? 'opacity-100' : 'opacity-0'} `}>\r\n                        <div className=\"bg-blue-600 w-2 h-6 rounded-full\"></div>\r\n                        <span className=\"text-white font-bold tracking-wider text-sm shadow-black drop-shadow-md\">math4code</span>\r\n                    </div>\r\n                    <div className={`absolute top-4 right-4 z-30 pointer-events-none transition-opacity duration-300 ${showControls ? 'opacity-100' : 'opacity-0'} `}>\r\n                        <div className=\"bg-white/10 p-2 rounded-full backdrop-blur-md\"><Info size={20} className=\"text-white/80\" /></div>\r\n                    </div>\r\n                </>\r\n            )}\r\n\r\n            {/* INITIAL COVER */}\r\n            {showCover && (\r\n                <div className=\"absolute inset-0 z-50 flex items-center justify-center bg-black cursor-pointer\" style={{ backgroundImage: thumbUrl ? `url(${thumbUrl})` : 'none', backgroundSize: 'cover', backgroundPosition: 'center' }} onClick={handlePlay}>\r\n                    <div className={`absolute inset-0 ${thumbUrl ? 'bg-black/40' : 'bg-slate-900'} `}></div>\r\n                    <div className=\"relative z-10 bg-white/10 p-5 rounded-full backdrop-blur-md border border-white/20 hover:scale-110 transition-transform shadow-2xl\">\r\n                        {(!isReady && youtubeId) ? <Loader2 className=\"w-16 h-16 text-white animate-spin\" /> : <PlayCircle className=\"w-20 h-20 text-white\" />}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* PAUSE OVERLAY */}\r\n            {!showCover && isPaused && (\r\n                <div className=\"absolute inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur-md transition-all duration-300 pointer-events-none\">\r\n                    <div className=\"bg-white/10 p-5 rounded-full backdrop-blur-md shadow-2xl animate-in zoom-in-50\"><Play className=\"w-12 h-12 text-white fill-white\" /></div>\r\n                </div>\r\n            )}\r\n\r\n            {errorMsg && <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-red-900/90 text-white px-4 py-2 rounded-lg z-50 backdrop-blur-md\">{errorMsg}</div>}\r\n\r\n            {/* === CONTROLS === */}\r\n            <div className={`absolute bottom-0 left-0 right-0 bg-linear-to-t from-black/90 via-black/80 to-transparent pt-12 pb-4 px-3 sm:px-5 z-50 transition-all duration-300 pointer-events-auto ${showControls || !isPlayingState ? \"opacity-100 translate-y-0\" : \"opacity-0 translate-y-4\"} `}\r\n                onMouseEnter={() => { if (controlsTimeoutRef.current) clearTimeout(controlsTimeoutRef.current); setShowControls(true); }}\r\n                onMouseLeave={startHideControlsTimer}\r\n            >\r\n                {/* SEEK BAR (Enhanced Hit Area) */}\r\n                <div\r\n                    ref={progressContainerRef}\r\n                    className=\"relative group/slider h-6 flex items-center mb-1 cursor-pointer\"\r\n                    onClick={handleProgressBarClick}\r\n                >\r\n                    {/* Background Line */}\r\n                    <div className=\"absolute inset-0 h-1 top-2.5 bg-white/20 rounded-full group-hover/slider:h-1.5 transition-all pointer-events-none\"></div>\r\n                    {/* Progress Line */}\r\n                    <div className=\"absolute left-0 top-2.5 h-1 bg-blue-500 rounded-full group-hover/slider:h-1.5 transition-all pointer-events-none\" style={{ width: `${sliderValue * 100}% ` }}></div>\r\n\r\n                    {/* Invisible Range Input for Dragging Only */}\r\n                    <input\r\n                        type=\"range\" min={0} max={0.999999} step=\"any\"\r\n                        value={seeking ? sliderValue : (duration ? currentTime / duration : 0)}\r\n                        onMouseDown={() => setSeeking(true)}\r\n                        onTouchStart={() => setSeeking(true)}\r\n                        onChange={handleSliderChange}\r\n                        onMouseUp={handleSliderEnd}\r\n                        onTouchEnd={handleSliderEnd}\r\n                        className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20\"\r\n                    />\r\n\r\n                    {/* Thumb */}\r\n                    <div className=\"absolute h-3.5 w-3.5 top-2.5 bg-white border-2 border-blue-500 rounded-full -ml-1.5 -mt-[4px] shadow-lg scale-0 group-hover/slider:scale-100 transition-transform pointer-events-none\" style={{ left: `${sliderValue * 100}% ` }}></div>\r\n                </div>\r\n\r\n                {/* BUTTONS ROW */}\r\n                <div className=\"flex items-center justify-between text-white\">\r\n                    {/* LEFT SIDE CONTROLS */}\r\n                    <div className=\"flex items-center gap-2 sm:gap-5\">\r\n                        <button onClick={togglePlay} className=\"hover:text-blue-400 transition-colors transform active:scale-90\" title=\"Space\">\r\n                            {isPlayingState ? <Pause size={24} className=\"sm:w-7 sm:h-7\" fill=\"currentColor\" /> : <Play size={24} className=\"sm:w-7 sm:h-7\" fill=\"currentColor\" />}\r\n                        </button>\r\n\r\n                        {/* Hide Rewind/Forward on very small mobile screens to save space */}\r\n                        <div className=\"hidden sm:flex items-center gap-3 text-white/80\">\r\n                            <button onClick={rewind} className=\"hover:text-white transition-colors hover:bg-white/10 p-1 rounded-full\"><RotateCcw size={20} /></button>\r\n                            <button onClick={fastForward} className=\"hover:text-white transition-colors hover:bg-white/10 p-1 rounded-full\"><RotateCw size={20} /></button>\r\n                        </div>\r\n\r\n                        <button onClick={toggleMute} className=\"hover:text-white transition-colors ml-0 sm:ml-2\">\r\n                            {muted ? <VolumeX size={20} className=\"sm:w-6 sm:h-6\" /> : <Volume2 size={20} className=\"sm:w-6 sm:h-6\" />}\r\n                        </button>\r\n\r\n                        <div className=\"text-[10px] sm:text-xs font-mono text-white/60 whitespace-nowrap\">\r\n                            {formatTime(currentTime)} / {duration ? formatTime(duration) : \"0:00\"}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* RIGHT SIDE CONTROLS */}\r\n                    <div className=\"flex items-center gap-2 sm:gap-3 relative\">\r\n                        {/* Quality Button - Text hidden on mobile */}\r\n                        <button onClick={() => { setShowQualityModal(s => !s); setShowSpeedMenu(false); }} className=\"hover:text-white flex items-center gap-1 bg-white/10 hover:bg-white/20 border border-white/5 px-2 py-1 sm:px-3 sm:py-1.5 rounded-lg transition-all backdrop-blur-sm text-[10px] sm:text-xs font-semibold tracking-wide\">\r\n                            <Settings size={14} />\r\n                            <span className=\"hidden sm:inline\">{selectedQuality === 'auto' ? 'AUTO' : selectedQuality.toUpperCase()}</span>\r\n                        </button>\r\n\r\n                        {/* Speed Button */}\r\n                        <button onClick={() => { setShowSpeedMenu(s => !s); setShowQualityModal(false); }} className=\"hover:text-white bg-white/10 hover:bg-white/20 border border-white/5 px-2 py-1 sm:px-3 sm:py-1.5 rounded-lg transition-all backdrop-blur-sm text-[10px] sm:text-xs font-bold min-w-[2.5rem] sm:min-w-[3rem]\">\r\n                            {playbackRate}x\r\n                        </button>\r\n\r\n                        <button onClick={handleFullScreen} className=\"hover:text-white transition-colors hover:bg-white/20 p-1.5 sm:p-2 rounded-lg\">\r\n                            {isFullScreen ? <Minimize size={18} className=\"sm:w-5 sm:h-5\" /> : <Maximize size={18} className=\"sm:w-5 sm:h-5\" />}\r\n                        </button>\r\n\r\n                        {/* Popups (Speed/Quality) - Adjusted positioning */}\r\n                        {(showQualityModal || showSpeedMenu) && (\r\n                            <div className=\"absolute bottom-full mb-4 right-0 bg-slate-900/95 border border-white/10 text-white rounded-xl shadow-2xl p-2 w-28 sm:w-32 backdrop-blur-xl z-50 overflow-hidden animate-in fade-in slide-in-from-bottom-2 origin-bottom-right\">\r\n                                <div className=\"max-h-[150px] sm:max-h-[200px] overflow-y-auto thin-scrollbar flex flex-col gap-1\">\r\n                                    {showQualityModal && (<><button className={`modal-btn ${selectedQuality === \"auto\" ? \"active\" : \"\"} `} onClick={() => changeQuality(\"auto\")}>Auto</button>{qualityOptions.map(q => <button key={q} className={`modal-btn ${selectedQuality === q ? \"active\" : \"\"} `} onClick={() => changeQuality(q)}>{q.toUpperCase()}</button>)}</>)}\r\n                                    {showSpeedMenu && speedOptions.map(s => (<button key={s} className={`modal-btn ${playbackRate === s ? \"active\" : \"\"} `} onClick={() => changeSpeed(s)}>{s}x</button>))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <style jsx>{` .modal-btn { @apply w-full text-left px-3 py-2 text-xs font-medium rounded-md transition-all hover:bg-white/10 text-white/70 hover:text-white; } .modal-btn.active { @apply bg-blue-600 text-white shadow-md; } .thin-scrollbar::-webkit-scrollbar { width: 3px; } .thin-scrollbar::-webkit-scrollbar-thumb { @apply bg-white/20 rounded-full; } `}</style>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1118, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/BunnyPlayer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\n\r\ninterface BunnyPlayerProps {\r\n    videoId: string;\r\n    libraryId: string;\r\n    videoType: 'vod' | 'live';\r\n    videoStatus?: 'processing' | 'ready' | 'live' | 'ended' | 'error';\r\n    className?: string;\r\n    onComplete?: () => void;\r\n}\r\n\r\nexport function BunnyPlayer({\r\n    videoId,\r\n    libraryId,\r\n    videoType,\r\n    videoStatus = 'ready',\r\n    className = '',\r\n    onComplete\r\n}: BunnyPlayerProps) {\r\n    const [isLive, setIsLive] = useState(videoStatus === 'live');\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Poll for live status if it's a live stream\r\n    useEffect(() => {\r\n        if (videoType === 'live' && videoStatus !== 'live') {\r\n            const interval = setInterval(async () => {\r\n                try {\r\n                    // You can add an API call here to check live status\r\n                    // For now, we'll rely on the videoStatus prop\r\n                } catch (err) {\r\n                    console.error('Failed to check live status:', err);\r\n                }\r\n            }, 10000); // Check every 10 seconds\r\n\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [videoType, videoStatus]);\r\n\r\n    // Generate embed URL\r\n    const embedUrl = `https://iframe.mediadelivery.net/embed/${libraryId}/${videoId}?autoplay=false&preload=true`;\r\n\r\n    // Handle different states\r\n    if (videoStatus === 'processing') {\r\n        return (\r\n            <div className={`flex items-center justify-center bg-gray-900 text-white ${className}`}>\r\n                <div className=\"text-center p-8\">\r\n                    <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4\"></div>\r\n                    <p className=\"text-lg font-semibold\">Processing Video...</p>\r\n                    <p className=\"text-sm text-gray-400 mt-2\">This may take a few minutes</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (videoStatus === 'error') {\r\n        return (\r\n            <div className={`flex items-center justify-center bg-gray-900 text-white ${className}`}>\r\n                <div className=\"text-center p-8\">\r\n                    <svg className=\"w-16 h-16 text-red-500 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                    <p className=\"text-lg font-semibold\">Video Error</p>\r\n                    <p className=\"text-sm text-gray-400 mt-2\">Failed to load video. Please try again later.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (videoType === 'live' && videoStatus !== 'live') {\r\n        return (\r\n            <div className={`flex items-center justify-center bg-linear-to-br from-gray-900 to-gray-800 text-white ${className}`}>\r\n                <div className=\"text-center p-8\">\r\n                    <div className=\"relative inline-block mb-4\">\r\n                        <svg className=\"w-20 h-20 text-gray-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                            <path d=\"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z\" />\r\n                        </svg>\r\n                        <span className=\"absolute -top-1 -right-1 flex h-6 w-6\">\r\n                            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\r\n                            <span className=\"relative inline-flex rounded-full h-6 w-6 bg-red-500 items-center justify-center text-xs font-bold\">\r\n                                LIVE\r\n                            </span>\r\n                        </span>\r\n                    </div>\r\n                    <p className=\"text-xl font-bold mb-2\">Stream Scheduled</p>\r\n                    <p className=\"text-gray-400\">Waiting for instructor to start the live session...</p>\r\n                    <div className=\"mt-4 flex items-center justify-center space-x-2\">\r\n                        <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }}></div>\r\n                        <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }}></div>\r\n                        <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }}></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Render the video player\r\n    return (\r\n        <div className={`relative ${className}`}>\r\n            {videoType === 'live' && videoStatus === 'live' && (\r\n                <div className=\"absolute top-4 left-4 z-10 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center space-x-2\">\r\n                    <span className=\"w-2 h-2 bg-white rounded-full animate-pulse\"></span>\r\n                    <span>LIVE</span>\r\n                </div>\r\n            )}\r\n            <iframe\r\n                src={embedUrl}\r\n                loading=\"lazy\"\r\n                style={{\r\n                    border: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0\r\n                }}\r\n                allow=\"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture; fullscreen\"\r\n                allowFullScreen\r\n                onError={() => setError('Failed to load video player')}\r\n            />\r\n            {error && (\r\n                <div className=\"absolute inset-0 flex items-center justify-center bg-gray-900 text-white\">\r\n                    <p>{error}</p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1438, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/ui/tabs.tsx"],"sourcesContent":["'use client'\r\n// Force recompile\r\n\r\nimport * as React from 'react'\r\nimport * as TabsPrimitive from '@radix-ui/react-tabs'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction Tabs({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.Root>) {\r\n  return (\r\n    <TabsPrimitive.Root\r\n      data-slot=\"tabs\"\r\n      className={cn('flex flex-col gap-2', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction TabsList({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.List>) {\r\n  return (\r\n    <TabsPrimitive.List\r\n      data-slot=\"tabs-list\"\r\n      className={cn(\r\n        'bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction TabsTrigger({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {\r\n  return (\r\n    <TabsPrimitive.Trigger\r\n      data-slot=\"tabs-trigger\"\r\n      className={cn(\r\n        \"data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction TabsContent({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof TabsPrimitive.Content>) {\r\n  return (\r\n    <TabsPrimitive.Content\r\n      data-slot=\"tabs-content\"\r\n      className={cn('flex-1 outline-none', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\r\n"],"names":[],"mappings":";;;;;;;;;;;AAIA;AAEA;AANA;;;;AAQA,SAAS,KAAK,EACZ,SAAS,EACT,GAAG,OAC6C;IAChD,qBACE,kMAAC,gLAAkB;QACjB,aAAU;QACV,WAAW,IAAA,0HAAE,EAAC,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,SAAS,EAChB,SAAS,EACT,GAAG,OAC6C;IAChD,qBACE,kMAAC,gLAAkB;QACjB,aAAU;QACV,WAAW,IAAA,0HAAE,EACX,uGACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,kMAAC,mLAAqB;QACpB,aAAU;QACV,WAAW,IAAA,0HAAE,EACX,mqBACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,kMAAC,mLAAqB;QACpB,aAAU;QACV,WAAW,IAAA,0HAAE,EAAC,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1504, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/hooks/student/useExamSession.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\"\r\nimport { createClient } from \"@/lib/supabase/client\"\r\nimport { toast } from \"sonner\"\r\n\r\nexport type Option = { id: string; option_text: string; is_correct?: boolean }\r\nexport type Question = {\r\n    id: string\r\n    question_text: string\r\n    question_type: \"MCQ\" | \"MSQ\" | \"NAT\"\r\n    marks: number\r\n    negative_marks: number\r\n    correct_answer?: string\r\n    options?: Option[]\r\n    section_id: string\r\n}\r\nexport type Section = {\r\n    id: string;\r\n    title: string;\r\n    questions: Question[];\r\n    required_attempts?: number;\r\n    max_questions_to_attempt?: number;\r\n}\r\nexport type Exam = { id: string; title: string; duration_minutes: number; total_marks?: number }\r\nexport type Attempt = { id: string; status: string; exam_id: string; student_id: string; total_time_spent?: number }\r\n\r\nexport function useExamSession(examId: string, userId: string | null, retakeAttempt: number = 0, enabled: boolean = true) {\r\n    const supabase = createClient()\r\n\r\n    return useQuery({\r\n        queryKey: [\"exam-session\", examId, userId, retakeAttempt],\r\n        queryFn: async () => {\r\n            if (!userId) throw new Error(\"User not logged in\")\r\n\r\n            // 1. Fetch Exam Details\r\n            const { data: exam, error: examError } = await supabase\r\n                .from(\"exams\")\r\n                .select(\"*\")\r\n                .eq(\"id\", examId)\r\n                .single()\r\n\r\n            if (examError) throw examError\r\n            if (!exam) throw new Error(\"Exam not found\")\r\n\r\n            // 2. Check exam scheduling (start_time and end_time)\r\n            const now = new Date()\r\n            const examData = exam as any\r\n\r\n            if (examData.start_time) {\r\n                const startTime = new Date(examData.start_time)\r\n                if (now < startTime) {\r\n                    throw new Error(`This exam is not yet available. It will start on ${startTime.toLocaleString()}.`)\r\n                }\r\n            }\r\n\r\n            if (examData.end_time) {\r\n                const endTime = new Date(examData.end_time)\r\n                if (now > endTime) {\r\n                    throw new Error(`This exam has ended. It was available until ${endTime.toLocaleString()}.`)\r\n                }\r\n            }\r\n\r\n            // 3. Check LESSON-based prerequisite (quiz lessons only)\r\n            const { data: currentLesson } = await supabase\r\n                .from(\"lessons\")\r\n                .select(\"id, title, prerequisite_lesson_id, sequential_unlock_enabled\")\r\n                .eq(\"exam_id\", examId)\r\n                .eq(\"content_type\", \"quiz\")\r\n                .single()\r\n\r\n            if (currentLesson?.sequential_unlock_enabled && currentLesson.prerequisite_lesson_id) {\r\n                // Get the prerequisite lesson and its exam\r\n                const { data: prereqLesson } = await supabase\r\n                    .from(\"lessons\")\r\n                    .select(\"id, title, exam_id\")\r\n                    .eq(\"id\", currentLesson.prerequisite_lesson_id)\r\n                    .single()\r\n\r\n                if (prereqLesson?.exam_id) {\r\n                    // Check if student has completed the prerequisite lesson's exam\r\n                    const { data: prerequisiteAttempts, error: prereqError } = await supabase\r\n                        .from(\"exam_attempts\")\r\n                        .select(\"id, status\")\r\n                        .eq(\"exam_id\", prereqLesson.exam_id)\r\n                        .eq(\"student_id\", userId)\r\n                        .eq(\"status\", \"submitted\")\r\n\r\n                    if (prereqError) throw prereqError\r\n\r\n                    if (!prerequisiteAttempts || prerequisiteAttempts.length === 0) {\r\n                        const prereqTitle = prereqLesson.title || \"the previous quiz\"\r\n                        throw new Error(`You must complete ${prereqTitle} before accessing this exam.`)\r\n                    }\r\n                }\r\n            }\r\n\r\n            // 4. Fetch Sections with Questions and Options\r\n            const { data: sections, error: sectionsError } = await supabase\r\n                .from(\"sections\")\r\n                .select(\"*, questions(*, options(*))\")\r\n                .eq(\"exam_id\", examId)\r\n                .order(\"section_order\")\r\n\r\n            if (sectionsError) throw sectionsError\r\n\r\n            // 5. Find or Create Attempt\r\n            let attempt: Attempt | null = null\r\n\r\n            const { data: existingAttempts, error: attemptsError } = await supabase\r\n                .from(\"exam_attempts\")\r\n                .select(\"*\")\r\n                .eq(\"exam_id\", examId)\r\n                .eq(\"student_id\", userId)\r\n                .order(\"created_at\", { ascending: false })\r\n\r\n            if (attemptsError) throw attemptsError\r\n\r\n            // Check if there's an in-progress attempt\r\n            const inProgressAttempt = existingAttempts?.find(a => a.status === \"in_progress\")\r\n            const submittedAttempts = existingAttempts?.filter(a => a.status === \"submitted\") || []\r\n\r\n\r\n\r\n            if (inProgressAttempt) {\r\n                attempt = inProgressAttempt\r\n            } else {\r\n\r\n\r\n                // Check if there are submitted attempts and NOT retaking\r\n                if (submittedAttempts.length > 0 && retakeAttempt === 0) {\r\n                    throw new Error(\"This exam has already been submitted. Please return to the test series page to retake the exam.\")\r\n                }\r\n\r\n                const maxAttempts = (exam as any).max_attempts\r\n                const hasAttemptsRemaining = !maxAttempts || submittedAttempts.length < maxAttempts\r\n\r\n                if (hasAttemptsRemaining) {\r\n                    const { data: newAttempt, error: createError } = await supabase\r\n                        .from(\"exam_attempts\")\r\n                        .insert({ exam_id: examId, student_id: userId, status: \"in_progress\", total_time_spent: 0 })\r\n                        .select()\r\n                        .single()\r\n\r\n                    if (createError) throw createError\r\n                    attempt = newAttempt\r\n                } else {\r\n                    throw new Error(`You have reached the maximum number of attempts (${maxAttempts}) for this exam.`)\r\n                }\r\n            }\r\n\r\n            // 4. Fetch Existing Responses\r\n            let previousResponses: Record<string, any> = {}\r\n            if (attempt) {\r\n                const { data: responses, error: respError } = await supabase\r\n                    .from(\"responses\")\r\n                    .select(\"question_id, student_answer\")\r\n                    .eq(\"attempt_id\", attempt.id)\r\n\r\n                if (respError) throw respError\r\n\r\n                if (responses) {\r\n                    responses.forEach((r) => {\r\n                        try {\r\n                            // Try to parse if it's JSON (for arrays/MSQ), otherwise keep as is\r\n                            const parsed = JSON.parse(r.student_answer)\r\n                            previousResponses[r.question_id] = parsed\r\n                        } catch {\r\n                            previousResponses[r.question_id] = r.student_answer\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n\r\n            return {\r\n                exam: exam as Exam,\r\n                sections: sections as Section[],\r\n                attempt: attempt as Attempt,\r\n                previousResponses\r\n            }\r\n        },\r\n        enabled: !!examId && !!userId && enabled,\r\n        staleTime: 0, // Always refetch to ensure fresh data, especially for retakes\r\n        refetchOnWindowFocus: false,\r\n    })\r\n}\r\n\r\nexport function useUpdateTimer() {\r\n    const supabase = createClient()\r\n    return useMutation({\r\n        mutationFn: async ({ attemptId, timeSpent }: { attemptId: string, timeSpent: number }) => {\r\n            const { error } = await supabase\r\n                .from(\"exam_attempts\")\r\n                .update({ total_time_spent: timeSpent })\r\n                .eq(\"id\", attemptId)\r\n            if (error) throw error\r\n        }\r\n    })\r\n}\r\n\r\nexport function useSubmitExam() {\r\n    const supabase = createClient()\r\n    const queryClient = useQueryClient()\r\n\r\n    return useMutation({\r\n        mutationFn: async ({\r\n            attemptId,\r\n            examId,\r\n            responses,\r\n            sections, // Unused in RPC but kept for signature compatibility if needed\r\n            totalMarks // Unused in RPC\r\n        }: {\r\n            attemptId: string\r\n            examId: string\r\n            responses: Record<string, any>\r\n            sections: Section[]\r\n            totalMarks: number\r\n        }) => {\r\n\r\n            // 1. Ensure all local responses are synced one last time (Optimization)\r\n            // Although we auto-saved, sending final state is safer.\r\n            // However, for pure speed, we assume auto-save worked or we do a bulk upsert here first.\r\n\r\n            const entries = Object.entries(responses).map(([qid, ans]) => ({\r\n                attempt_id: attemptId,\r\n                question_id: qid,\r\n                student_answer: Array.isArray(ans) ? JSON.stringify(ans) : String(ans),\r\n                updated_at: new Date().toISOString(),\r\n            }))\r\n\r\n            if (entries.length > 0) {\r\n                const { error: respError } = await supabase.from(\"responses\").upsert(entries, {\r\n                    onConflict: \"attempt_id,question_id\",\r\n                })\r\n                if (respError) {\r\n                    throw new Error(`Failed to sync responses: ${respError.message}`)\r\n                }\r\n            }\r\n\r\n            // 2. Call the Secure RPC\r\n            const { data: resultData, error: rpcError } = await supabase\r\n                .rpc('submit_exam_attempt', { p_attempt_id: attemptId, p_exam_id: examId })\r\n\r\n            if (rpcError) {\r\n                // Handle duplicate submission gracefully\r\n                if (rpcError.message.includes(\"already submitted\")) {\r\n                    toast.info(\"Exam was already submitted.\")\r\n                    // Fetch existing result\r\n                    const { data: existing } = await supabase.from(\"results\").select(\"*\").eq(\"attempt_id\", attemptId).single()\r\n                    return existing\r\n                }\r\n                throw rpcError\r\n            }\r\n\r\n            // If RPC returned an error object inside JSON\r\n            if (resultData && (resultData as any).error) {\r\n                throw new Error((resultData as any).error)\r\n            }\r\n\r\n            return resultData\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"test-series-details\"] })\r\n            queryClient.invalidateQueries({ queryKey: [\"exam-attempts\"] })\r\n            toast.success(\"Exam submitted successfully!\")\r\n        },\r\n        onError: (error: any) => {\r\n            toast.error(error.message || \"Failed to submit exam.\")\r\n        }\r\n    })\r\n}\r\n\r\nexport function useSaveAnswer() {\r\n    const supabase = createClient()\r\n    return useMutation({\r\n        mutationFn: async ({ attemptId, questionId, answer }: { attemptId: string, questionId: string, answer: any }) => {\r\n            const { error } = await supabase.from(\"responses\").upsert({\r\n                attempt_id: attemptId,\r\n                question_id: questionId,\r\n                student_answer: Array.isArray(answer) ? JSON.stringify(answer) : String(answer),\r\n                updated_at: new Date().toISOString(),\r\n            }, { onConflict: \"attempt_id,question_id\" })\r\n            if (error) throw error\r\n        }\r\n    })\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1723, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/responseCleanup.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/client';\r\n\r\n/**\r\n * Check if responses are expired (older than 30 days)\r\n */\r\nexport function isResponseExpired(submittedAt: string | Date): boolean {\r\n    const submittedDate = new Date(submittedAt);\r\n    const now = new Date();\r\n    const daysDiff = Math.floor((now.getTime() - submittedDate.getTime()) / (1000 * 60 * 60 * 24));\r\n    return daysDiff >= 30;\r\n}\r\n\r\n/**\r\n * Get days remaining until responses expire\r\n */\r\nexport function getDaysUntilExpiry(submittedAt: string | Date): number {\r\n    const submittedDate = new Date(submittedAt);\r\n    const now = new Date();\r\n    const daysDiff = Math.floor((now.getTime() - submittedDate.getTime()) / (1000 * 60 * 60 * 24));\r\n    return Math.max(0, 30 - daysDiff);\r\n}\r\n\r\n/**\r\n * Cleanup expired responses for a specific attempt using database function\r\n * This is called when user views exam results\r\n */\r\nexport async function cleanupAttemptResponses(attemptId: string) {\r\n    const supabase = createClient();\r\n\r\n    try {\r\n        const { data, error } = await supabase.rpc('cleanup_attempt_responses', {\r\n            p_attempt_id: attemptId\r\n        });\r\n\r\n        if (error) {\r\n            console.error('Error cleaning up responses:', error);\r\n            return { success: false, error: error.message };\r\n        }\r\n\r\n        return {\r\n            success: true,\r\n            deleted: data?.[0]?.deleted || false,\r\n            daysOld: data?.[0]?.days_old || 0\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error cleaning up responses:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Cleanup all expired responses (admin function)\r\n * Can be called manually or periodically\r\n */\r\nexport async function cleanupAllExpiredResponses() {\r\n    const supabase = createClient();\r\n\r\n    try {\r\n        const { data, error } = await supabase.rpc('cleanup_expired_responses');\r\n\r\n        if (error) {\r\n            console.error('Error cleaning up all responses:', error);\r\n            return { success: false, error: error.message };\r\n        }\r\n\r\n        return {\r\n            success: true,\r\n            deletedCount: data?.[0]?.deleted_count || 0\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error cleaning up all responses:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAKO,SAAS,kBAAkB,WAA0B;IACxD,MAAM,gBAAgB,IAAI,KAAK;IAC/B,MAAM,MAAM,IAAI;IAChB,MAAM,WAAW,KAAK,KAAK,CAAC,CAAC,IAAI,OAAO,KAAK,cAAc,OAAO,EAAE,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;IAC5F,OAAO,YAAY;AACvB;AAKO,SAAS,mBAAmB,WAA0B;IACzD,MAAM,gBAAgB,IAAI,KAAK;IAC/B,MAAM,MAAM,IAAI;IAChB,MAAM,WAAW,KAAK,KAAK,CAAC,CAAC,IAAI,OAAO,KAAK,cAAc,OAAO,EAAE,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;IAC5F,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK;AAC5B;AAMO,eAAe,wBAAwB,SAAiB;IAC3D,MAAM,WAAW,IAAA,iJAAY;IAE7B,IAAI;QACA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,6BAA6B;YACpE,cAAc;QAClB;QAEA,IAAI,OAAO;YACP,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO;gBAAE,SAAS;gBAAO,OAAO,MAAM,OAAO;YAAC;QAClD;QAEA,OAAO;YACH,SAAS;YACT,SAAS,MAAM,CAAC,EAAE,EAAE,WAAW;YAC/B,SAAS,MAAM,CAAC,EAAE,EAAE,YAAY;QACpC;IACJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAClD;AACJ;AAMO,eAAe;IAClB,MAAM,WAAW,IAAA,iJAAY;IAE7B,IAAI;QACA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC;QAE3C,IAAI,OAAO;YACP,QAAQ,KAAK,CAAC,oCAAoC;YAClD,OAAO;gBAAE,SAAS;gBAAO,OAAO,MAAM,OAAO;YAAC;QAClD;QAEA,OAAO;YACH,SAAS;YACT,cAAc,MAAM,CAAC,EAAE,EAAE,iBAAiB;QAC9C;IACJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAClD;AACJ"}},
    {"offset": {"line": 1800, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/hooks/useExamResult.ts"],"sourcesContent":["\"use client\"\r\nimport { useQuery } from \"@tanstack/react-query\"\r\nimport { createClient } from \"@/lib/supabase/client\"\r\n\r\nexport async function fetchExamResult(attemptId: string) {\r\n  const supabase = createClient()\r\n\r\n  try {\r\n    // 1. Fetch attempt info\r\n    const { data: attempt, error: attemptError } = await supabase\r\n      .from(\"exam_attempts\")\r\n      .select(\"*, exams(title, id, result_visibility, result_release_time, show_answers)\")\r\n      .eq(\"id\", attemptId)\r\n      .single()\r\n\r\n    if (attemptError) {\r\n      throw attemptError\r\n    }\r\n    if (!attempt) throw new Error(\"Attempt not found\")\r\n\r\n    const examId = attempt.exam_id\r\n\r\n    // Auto-cleanup expired responses (calls database function)\r\n    // This runs in background and doesn't block the query\r\n    const { cleanupAttemptResponses } = await import('@/lib/responseCleanup');\r\n    cleanupAttemptResponses(attemptId).catch(err => {\r\n      console.warn('Background cleanup failed:', err);\r\n    });\r\n\r\n    // 2. Fetch all responses for this attempt\r\n    const { data: responses, error: responsesError } = await supabase\r\n      .from(\"responses\")\r\n      .select(\"*\")\r\n      .eq(\"attempt_id\", attemptId)\r\n\r\n    if (responsesError) {\r\n      throw responsesError\r\n    }\r\n\r\n    const responseMap: Record<string, any> = {}\r\n    responses?.forEach((r: any) => {\r\n      if (!r.student_answer) {\r\n        // No answer provided\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // Try to parse as JSON first (for arrays and objects)\r\n        const parsed = JSON.parse(r.student_answer)\r\n        responseMap[r.question_id] = parsed\r\n      } catch {\r\n        // If parsing fails, use the raw value (for strings/numbers)\r\n        // Remove quotes if it's a quoted string\r\n        let value = r.student_answer\r\n        if (typeof value === 'string') {\r\n          // Remove surrounding quotes if present\r\n          value = value.replace(/^[\"']|[\"']$/g, '')\r\n        }\r\n        responseMap[r.question_id] = value\r\n      }\r\n    })\r\n\r\n    // 3. Fetch ALL sections for this exam\r\n    const { data: sections, error: sectionsError } = await supabase\r\n      .from(\"sections\")\r\n      .select(\"*\")\r\n      .eq(\"exam_id\", examId)\r\n      .order(\"section_order\")\r\n\r\n    if (sectionsError) {\r\n      throw sectionsError\r\n    }\r\n    if (!sections?.length) throw new Error(\"Sections not found\")\r\n\r\n    // 4. Fetch ALL questions for these sections\r\n    const sectionIds = sections.map((s) => s.id)\r\n    const { data: questions, error: questionsError } = await supabase\r\n      .from(\"questions\")\r\n      .select(\"*, options(*)\")\r\n      .in(\"section_id\", sectionIds)\r\n\r\n    if (questionsError) {\r\n      throw questionsError\r\n    }\r\n    if (!questions?.length) throw new Error(\"Questions not found\")\r\n\r\n    // 5. Fetch result summary\r\n    const { data: resultSummary, error: resultError } = await supabase\r\n      .from(\"results\")\r\n      .select(\"*\")\r\n      .eq(\"attempt_id\", attemptId)\r\n      .single()\r\n\r\n    if (resultError && resultError.code !== 'PGRST116') {\r\n      // Silently ignore - result may not exist yet\r\n    }\r\n\r\n    // 6. Fetch section results\r\n    let sectionResults: any[] = []\r\n    if (resultSummary) {\r\n      const { data: secResults, error: secError } = await supabase\r\n        .from(\"section_results\")\r\n        .select(\"*\")\r\n        .eq(\"result_id\", resultSummary.id)\r\n\r\n      if (secResults) sectionResults = secResults\r\n    }\r\n\r\n    // 7. Structure the data by sections\r\n    const structured = sections.map((s) => ({\r\n      ...s,\r\n      questions: questions.filter((q) => q.section_id === s.id),\r\n      result: sectionResults.find(sr => sr.section_id === s.id)\r\n    }))\r\n\r\n    return { attempt, responseMap, structured, result: resultSummary }\r\n  } catch (error) {\r\n    throw error\r\n  }\r\n}\r\n\r\nexport function useExamResult(attemptId: string) {\r\n  return useQuery({\r\n    queryKey: [\"exam-result\", attemptId],\r\n    queryFn: () => fetchExamResult(attemptId),\r\n    enabled: !!attemptId,\r\n    staleTime: 1000 * 60 * 2,\r\n    retry: 1,\r\n  })\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1909, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/renderWithLatex.tsx"],"sourcesContent":["import { MathJax } from \"better-react-mathjax\";\r\n\r\nexport function renderWithLatex(text: string ) {\r\n  return (\r\n    <MathJax inline dynamic>\r\n      {text}\r\n    </MathJax>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAEO,SAAS,gBAAgB,IAAY;IAC1C,qBACE,kMAAC,gOAAO;QAAC,MAAM;QAAC,OAAO;kBACpB;;;;;;AAGP"}},
    {"offset": {"line": 1932, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/ui/alert.tsx"],"sourcesContent":["import * as React from 'react'\r\nimport { cva, type VariantProps } from 'class-variance-authority'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst alertVariants = cva(\r\n  'relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current',\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: 'bg-card text-card-foreground',\r\n        destructive:\r\n          'text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90',\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: 'default',\r\n    },\r\n  },\r\n)\r\n\r\nfunction Alert({\r\n  className,\r\n  variant,\r\n  ...props\r\n}: React.ComponentProps<'div'> & VariantProps<typeof alertVariants>) {\r\n  return (\r\n    <div\r\n      data-slot=\"alert\"\r\n      role=\"alert\"\r\n      className={cn(alertVariants({ variant }), className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction AlertTitle({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"alert-title\"\r\n      className={cn(\r\n        'col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction AlertDescription({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"alert-description\"\r\n      className={cn(\r\n        'text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Alert, AlertTitle, AlertDescription }\r\n"],"names":[],"mappings":";;;;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,+KAAG,EACvB,qOACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,GAAG,OAC8D;IACjE,qBACE,kMAAC;QACC,aAAU;QACV,MAAK;QACL,WAAW,IAAA,0HAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,kMAAC;QACC,aAAU;QACV,WAAW,IAAA,0HAAE,EACX,+DACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,iBAAiB,EACxB,SAAS,EACT,GAAG,OACyB;IAC5B,qBACE,kMAAC;QACC,aAAU;QACV,WAAW,IAAA,0HAAE,EACX,kGACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1998, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/exam/ResponseExpiryWarning.tsx"],"sourcesContent":["import { AlertCircle, Clock, CheckCircle } from 'lucide-react';\r\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\r\nimport { getDaysUntilExpiry } from '@/lib/responseCleanup';\r\n\r\ninterface ResponseExpiryWarningProps {\r\n    submittedAt: string | Date;\r\n}\r\n\r\nexport function ResponseExpiryWarning({ submittedAt }: ResponseExpiryWarningProps) {\r\n    const daysRemaining = getDaysUntilExpiry(submittedAt);\r\n\r\n    // Expired - no answers available\r\n    if (daysRemaining === 0) {\r\n        return (\r\n            <Alert variant=\"destructive\" className=\"mb-6\">\r\n                <AlertCircle className=\"h-4 w-4\" />\r\n                <AlertTitle>Response Review Period Expired</AlertTitle>\r\n                <AlertDescription>\r\n                    Your selected answers have been automatically deleted after 30 days.\r\n                    You can still view your results and question analysis.\r\n                </AlertDescription>\r\n            </Alert>\r\n        );\r\n    }\r\n\r\n    // Urgent - less than 7 days remaining\r\n    if (daysRemaining <= 7) {\r\n        return (\r\n            <Alert className=\"mb-6 border-orange-200 bg-orange-50 dark:bg-orange-950/20 dark:border-orange-800\">\r\n                <Clock className=\"h-4 w-4 text-orange-600 dark:text-orange-400\" />\r\n                <AlertTitle className=\"text-orange-900 dark:text-orange-400\">\r\n                    âš ï¸ Review Your Answers Soon\r\n                </AlertTitle>\r\n                <AlertDescription className=\"text-orange-800 dark:text-orange-300\">\r\n                    You have <strong>{daysRemaining} {daysRemaining === 1 ? 'day' : 'days'}</strong> remaining to review your selected answers.\r\n                    After that, only results and analysis will be available.\r\n                </AlertDescription>\r\n            </Alert>\r\n        );\r\n    }\r\n\r\n    // Active - more than 7 days remaining\r\n    return (\r\n        <Alert className=\"mb-6 border-blue-200 bg-blue-50 dark:bg-blue-950/20 dark:border-blue-800\">\r\n            <CheckCircle className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\r\n            <AlertTitle className=\"text-blue-900 dark:text-blue-400\">\r\n                Review Period Active\r\n            </AlertTitle>\r\n            <AlertDescription className=\"text-blue-800 dark:text-blue-300\">\r\n                You can review your answers for the next <strong>{daysRemaining} days</strong>.\r\n                After 30 days, selected answers will be automatically removed.\r\n            </AlertDescription>\r\n        </Alert>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AAAA;AAAA;AACA;AACA;;;;;AAMO,SAAS,sBAAsB,EAAE,WAAW,EAA8B;IAC7E,MAAM,gBAAgB,IAAA,oJAAkB,EAAC;IAEzC,iCAAiC;IACjC,IAAI,kBAAkB,GAAG;QACrB,qBACI,kMAAC,2IAAK;YAAC,SAAQ;YAAc,WAAU;;8BACnC,kMAAC,2OAAW;oBAAC,WAAU;;;;;;8BACvB,kMAAC,gJAAU;8BAAC;;;;;;8BACZ,kMAAC,sJAAgB;8BAAC;;;;;;;;;;;;IAM9B;IAEA,sCAAsC;IACtC,IAAI,iBAAiB,GAAG;QACpB,qBACI,kMAAC,2IAAK;YAAC,WAAU;;8BACb,kMAAC,qNAAK;oBAAC,WAAU;;;;;;8BACjB,kMAAC,gJAAU;oBAAC,WAAU;8BAAuC;;;;;;8BAG7D,kMAAC,sJAAgB;oBAAC,WAAU;;wBAAuC;sCACtD,kMAAC;;gCAAQ;gCAAc;gCAAE,kBAAkB,IAAI,QAAQ;;;;;;;wBAAgB;;;;;;;;;;;;;IAKhG;IAEA,sCAAsC;IACtC,qBACI,kMAAC,2IAAK;QAAC,WAAU;;0BACb,kMAAC,kPAAW;gBAAC,WAAU;;;;;;0BACvB,kMAAC,gJAAU;gBAAC,WAAU;0BAAmC;;;;;;0BAGzD,kMAAC,sJAAgB;gBAAC,WAAU;;oBAAmC;kCAClB,kMAAC;;4BAAQ;4BAAc;;;;;;;oBAAc;;;;;;;;;;;;;AAK9F"}},
    {"offset": {"line": 2148, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/exam/ExamTimer.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useEffect, useState, useRef, memo } from \"react\"\r\nimport { Clock } from \"lucide-react\"\r\n\r\ninterface ExamTimerProps {\r\n    initialSeconds: number\r\n    onTimeUp: () => void\r\n    timeRef: React.MutableRefObject<number>\r\n    isActive: boolean\r\n}\r\n\r\nfunction ExamTimerComponent({ initialSeconds, onTimeUp, timeRef, isActive }: ExamTimerProps) {\r\n    const [secondsLeft, setSecondsLeft] = useState(initialSeconds)\r\n    const onTimeUpRef = useRef(onTimeUp)\r\n\r\n    useEffect(() => {\r\n        setSecondsLeft(initialSeconds)\r\n        timeRef.current = initialSeconds\r\n    }, [initialSeconds, timeRef])\r\n\r\n    useEffect(() => {\r\n        onTimeUpRef.current = onTimeUp\r\n    }, [onTimeUp])\r\n\r\n    useEffect(() => {\r\n        if (!isActive || secondsLeft <= 0) return\r\n\r\n        const timer = setInterval(() => {\r\n            setSecondsLeft((prev) => {\r\n                if (prev <= 1) {\r\n                    clearInterval(timer)\r\n                    onTimeUpRef.current()\r\n                    return 0\r\n                }\r\n                const newVal = prev - 1\r\n                timeRef.current = newVal\r\n                return newVal\r\n            })\r\n        }, 1000)\r\n\r\n        return () => clearInterval(timer)\r\n    }, [isActive, timeRef])\r\n\r\n    // Monitor for finish (if loaded with 0/negative)\r\n    // Monitor for finish (if loaded with 0/negative)\r\n    useEffect(() => {\r\n        // Guard against race condition where secondsLeft is 0 (from initial state)\r\n        // but initialSeconds is > 0 (new prop received but effect hasn't synced state yet)\r\n        if (initialSeconds > 0 && secondsLeft === 0) return\r\n\r\n        if (secondsLeft <= 0 && isActive) {\r\n            onTimeUpRef.current()\r\n        }\r\n    }, [secondsLeft, isActive, initialSeconds])\r\n\r\n\r\n    const formatTime = (s: number) => {\r\n        const h = Math.floor(s / 3600)\r\n        const m = Math.floor((s % 3600) / 60).toString().padStart(2, \"0\")\r\n        const sec = (s % 60).toString().padStart(2, \"0\")\r\n        return h > 0 ? `${h}:${m}:${sec}` : `${m}:${sec}`\r\n    }\r\n\r\n    const isCritical = secondsLeft < 300 // 5 mins\r\n\r\n    return (\r\n        <div className={`flex items-center gap-1 md:gap-2 px-2 md:px-3 py-1 rounded-full border text-xs md:text-sm transition-colors duration-300 ${isCritical ? 'bg-rose-500/10 text-rose-500 border-rose-500/30 animate-pulse' : 'bg-emerald-500/10 text-emerald-500 border-emerald-500/30'}`}>\r\n            <Clock className={`w-3 h-3 md:w-4 md:h-4 ${isCritical ? 'text-rose-500' : 'text-emerald-500'}`} />\r\n            <div className=\"font-semibold tabular-nums\">{formatTime(secondsLeft)}</div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport const ExamTimer = memo(ExamTimerComponent)\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAYA,SAAS,mBAAmB,EAAE,cAAc,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAkB;IACvF,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,8KAAQ,EAAC;IAC/C,MAAM,cAAc,IAAA,4KAAM,EAAC;IAE3B,IAAA,+KAAS,EAAC;QACN,eAAe;QACf,QAAQ,OAAO,GAAG;IACtB,GAAG;QAAC;QAAgB;KAAQ;IAE5B,IAAA,+KAAS,EAAC;QACN,YAAY,OAAO,GAAG;IAC1B,GAAG;QAAC;KAAS;IAEb,IAAA,+KAAS,EAAC;QACN,IAAI,CAAC,YAAY,eAAe,GAAG;QAEnC,MAAM,QAAQ,YAAY;YACtB,eAAe,CAAC;gBACZ,IAAI,QAAQ,GAAG;oBACX,cAAc;oBACd,YAAY,OAAO;oBACnB,OAAO;gBACX;gBACA,MAAM,SAAS,OAAO;gBACtB,QAAQ,OAAO,GAAG;gBAClB,OAAO;YACX;QACJ,GAAG;QAEH,OAAO,IAAM,cAAc;IAC/B,GAAG;QAAC;QAAU;KAAQ;IAEtB,iDAAiD;IACjD,iDAAiD;IACjD,IAAA,+KAAS,EAAC;QACN,2EAA2E;QAC3E,mFAAmF;QACnF,IAAI,iBAAiB,KAAK,gBAAgB,GAAG;QAE7C,IAAI,eAAe,KAAK,UAAU;YAC9B,YAAY,OAAO;QACvB;IACJ,GAAG;QAAC;QAAa;QAAU;KAAe;IAG1C,MAAM,aAAa,CAAC;QAChB,MAAM,IAAI,KAAK,KAAK,CAAC,IAAI;QACzB,MAAM,IAAI,KAAK,KAAK,CAAC,AAAC,IAAI,OAAQ,IAAI,QAAQ,GAAG,QAAQ,CAAC,GAAG;QAC7D,MAAM,MAAM,CAAC,IAAI,EAAE,EAAE,QAAQ,GAAG,QAAQ,CAAC,GAAG;QAC5C,OAAO,IAAI,IAAI,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,KAAK,GAAG,GAAG,EAAE,CAAC,EAAE,KAAK;IACrD;IAEA,MAAM,aAAa,cAAc,IAAI,SAAS;;IAE9C,qBACI,kMAAC;QAAI,WAAW,CAAC,yHAAyH,EAAE,aAAa,kEAAkE,4DAA4D;;0BACnR,kMAAC,qNAAK;gBAAC,WAAW,CAAC,sBAAsB,EAAE,aAAa,kBAAkB,oBAAoB;;;;;;0BAC9F,kMAAC;gBAAI,WAAU;0BAA8B,WAAW;;;;;;;;;;;;AAGpE;AAEO,MAAM,0BAAY,IAAA,0KAAI,EAAC"}},
    {"offset": {"line": 2245, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/exam/QuestionDisplay.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { memo } from \"react\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { ArrowLeft, Flag } from \"lucide-react\"\r\nimport { renderWithLatex } from \"@/lib/renderWithLatex\"\r\n\r\ninterface QuestionDisplayProps {\r\n    question: any\r\n    activeQuestionIdx: number\r\n    response: any\r\n    isMarked: boolean\r\n    onSave: (qid: string, ans: any) => void\r\n    onMark: (qid: string) => void\r\n    onNext: () => void\r\n    onPrev: () => void\r\n    onClear: () => void\r\n    isFirst: boolean\r\n    isLast: boolean\r\n}\r\n\r\nfunction QuestionDisplayComponent({\r\n    question,\r\n    activeQuestionIdx,\r\n    response,\r\n    isMarked,\r\n    onSave,\r\n    onMark,\r\n    onNext,\r\n    onPrev,\r\n    onClear,\r\n    isFirst,\r\n    isLast\r\n}: QuestionDisplayProps) {\r\n\r\n    if (!question) return null\r\n\r\n    return (\r\n        <AnimatePresence mode=\"wait\">\r\n            <motion.div\r\n                key={question.id}\r\n                initial={{ opacity: 0, x: 10 }}\r\n                animate={{ opacity: 1, x: 0 }}\r\n                exit={{ opacity: 0, x: -10 }}\r\n                transition={{ duration: 0.2 }}\r\n                className=\"flex-1 flex flex-col min-h-0 bg-card rounded-2xl shadow-sm border border-border overflow-hidden\"\r\n            >\r\n                {/* Scrollable Content Area */}\r\n                <div className=\"flex-1 overflow-y-auto p-4 md:p-6 custom-scrollbar\">\r\n                    <div className=\"flex justify-between items-start mb-4 flex-wrap gap-2\">\r\n                        <div className=\"text-xs md:text-sm font-medium text-muted-foreground bg-muted px-2 py-1 rounded\">\r\n                            Question {activeQuestionIdx + 1}\r\n                        </div>\r\n                        <div className=\"text-xs md:text-sm text-muted-foreground\">\r\n                            Marks: <span className=\"font-semibold text-emerald-500\">+{question.marks}</span> |\r\n                            Negative: <span className=\"font-semibold text-rose-500\">-{question.negative_marks}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"text-base md:text-lg font-medium mb-6 leading-relaxed text-foreground select-none\">\r\n                        {renderWithLatex(question.question_text)}\r\n                    </div>\r\n\r\n                    {/* OPTIONS */}\r\n                    <div className=\"space-y-3 pb-4\">\r\n                        {question.question_type === \"MCQ\" &&\r\n                            question.options?.map((opt: any, idx: number) => {\r\n                                const chosen = response === opt.id\r\n                                const optionLabel = String.fromCharCode(65 + idx)\r\n                                return (\r\n                                    <button\r\n                                        key={opt.id}\r\n                                        onClick={() => onSave(question.id, opt.id)}\r\n                                        className={`w-full text-left p-3 md:p-4 rounded-xl border transition-all duration-200 flex items-center gap-3 md:gap-4 group ${chosen\r\n                                            ? \"bg-primary/10 border-primary shadow-sm ring-1 ring-primary\"\r\n                                            : \"bg-muted/30 border-border hover:border-primary hover:bg-muted/50\"\r\n                                            }`}\r\n                                    >\r\n                                        <div\r\n                                            className={`w-7 h-7 md:w-8 md:h-8 rounded-full shrink-0 flex items-center justify-center text-xs md:text-sm font-bold transition-colors ${chosen\r\n                                                ? \"bg-primary text-primary-foreground\"\r\n                                                : \"border border-muted-foreground/30 text-muted-foreground group-hover:border-primary group-hover:text-primary\"\r\n                                                }`}\r\n                                        >\r\n                                            {optionLabel}\r\n                                        </div>\r\n                                        <span className=\"text-sm md:text-base text-foreground group-hover:text-foreground\">{renderWithLatex(opt.option_text)}</span>\r\n                                    </button>\r\n                                )\r\n                            })}\r\n\r\n                        {question.question_type === \"MSQ\" &&\r\n                            question.options?.map((opt: any, idx: number) => {\r\n                                const current = (Array.isArray(response) ? response : []) as string[]\r\n                                const checked = current.includes(opt.id)\r\n                                const optionLabel = String.fromCharCode(65 + idx)\r\n                                return (\r\n                                    <button\r\n                                        key={opt.id}\r\n                                        onClick={() => {\r\n                                            const next = checked\r\n                                                ? current.filter((x) => x !== opt.id)\r\n                                                : [...current, opt.id]\r\n                                            onSave(question.id, next)\r\n                                        }}\r\n                                        className={`w-full text-left p-3 md:p-4 rounded-xl border transition-all duration-200 flex items-center gap-3 md:gap-4 group ${checked\r\n                                            ? \"bg-amber-500/10 border-amber-500 shadow-sm ring-1 ring-amber-500\"\r\n                                            : \"bg-muted/30 border-border hover:border-amber-500 hover:bg-muted/50\"\r\n                                            }`}\r\n                                    >\r\n                                        <div\r\n                                            className={`w-6 h-6 rounded shrink-0 flex items-center justify-center text-xs md:text-sm font-bold transition-colors ${checked ? \"bg-amber-500 text-white\" : \"border border-muted-foreground/30 text-muted-foreground group-hover:border-amber-500\"\r\n                                                }`}\r\n                                        >\r\n                                            {optionLabel}\r\n                                        </div>\r\n                                        <span className=\"text-sm md:text-base text-foreground group-hover:text-foreground\">{renderWithLatex(opt.option_text)}</span>\r\n                                    </button>\r\n                                )\r\n                            })}\r\n\r\n                        {question.question_type === \"NAT\" && (\r\n                            <div className=\"mt-2\">\r\n                                <label className=\"block text-sm font-medium text-foreground mb-2\">Your Answer:</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    className=\"w-full max-w-md p-3 rounded-lg border border-border bg-background text-foreground focus:border-primary focus:ring-2 focus:ring-primary/50 outline-none transition-all text-sm md:text-base\"\r\n                                    placeholder=\"Enter numeric value...\"\r\n                                    value={response || \"\"}\r\n                                    onChange={(e) => onSave(question.id, e.target.value)}\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Fixed ACTION BUTTONS Footer */}\r\n                <div className=\"shrink-0 p-4 md:p-6 pt-4 border-t border-border bg-card/95 backdrop-blur-sm\">\r\n                    <div className=\"flex flex-wrap justify-between items-center gap-2 md:gap-3\">\r\n                        <div className=\"flex gap-2 flex-wrap\">\r\n                            <button\r\n                                onClick={onPrev}\r\n                                disabled={isFirst}\r\n                                className=\"px-3 md:px-4 py-1.5 md:py-2 border border-border text-foreground rounded-lg hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-colors text-xs md:text-sm\"\r\n                            >\r\n                                <ArrowLeft className=\"w-3 h-3 md:w-4 md:h-4\" /> Previous\r\n                            </button>\r\n                            <button\r\n                                onClick={onClear}\r\n                                disabled={!response || (Array.isArray(response) && response.length === 0)}\r\n                                className=\"px-3 md:px-4 py-1.5 md:py-2 border border-border text-foreground rounded-lg hover:bg-muted disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-xs md:text-sm\"\r\n                            >\r\n                                Clear\r\n                            </button>\r\n                            <button\r\n                                onClick={() => onMark(question.id)}\r\n                                className={`px-3 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-2 transition-colors text-xs md:text-sm ${isMarked\r\n                                    ? \"bg-amber-500 text-white hover:bg-amber-600\"\r\n                                    : \"border border-amber-500 text-amber-500 hover:bg-amber-500/10\"\r\n                                    }`}\r\n                            >\r\n                                <Flag className=\"w-3 h-3 md:w-4 md:h-4\" /> {isMarked ? \"Marked\" : \"Mark\"}\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                            <button\r\n                                onClick={onNext}\r\n                                className=\"px-4 md:px-6 py-1.5 md:py-2 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-sm transition-colors text-xs md:text-sm\"\r\n                            >\r\n                                {isLast ? \"Review\" : \"Save & Next\"}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n        </AnimatePresence>\r\n    )\r\n}\r\n\r\nexport const QuestionDisplay = memo(QuestionDisplayComponent)\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2564, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/exam/QuestionPalette.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { memo } from \"react\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { X, CheckCircle2, Bookmark, Eye } from \"lucide-react\"\r\n\r\ninterface QuestionPaletteProps {\r\n    questions: any[]\r\n    activeQuestionIdx: number\r\n    responses: Record<string, any>\r\n    marked: Record<string, boolean>\r\n    visited: Record<string, boolean>\r\n    onNavigate: (index: number) => void\r\n    onSubmit: () => void\r\n    sectionTitle?: string\r\n    isMobileOpen: boolean\r\n    onMobileClose: () => void\r\n}\r\n\r\nfunction QuestionPaletteComponent({\r\n    questions,\r\n    activeQuestionIdx,\r\n    responses,\r\n    marked,\r\n    visited,\r\n    onNavigate,\r\n    onSubmit,\r\n    sectionTitle,\r\n    isMobileOpen,\r\n    onMobileClose\r\n}: QuestionPaletteProps) {\r\n\r\n    const isAnswered = (qid: string) => {\r\n        const val = responses[qid]\r\n        return val !== undefined && val !== null && val !== \"\" && !(Array.isArray(val) && val.length === 0)\r\n    }\r\n\r\n    const getStatusClass = (qid: string, isActive: boolean) => {\r\n        let cls = \"bg-muted text-muted-foreground hover:bg-muted/80\"\r\n\r\n        if (isAnswered(qid)) {\r\n            cls = \"bg-emerald-500 text-white shadow-sm hover:bg-emerald-600\"\r\n        } else if (marked[qid]) {\r\n            cls = \"bg-amber-500 text-white shadow-sm hover:bg-amber-600\"\r\n        } else if (visited[qid]) {\r\n            cls = \"bg-primary/20 text-primary border border-primary hover:bg-primary/30\"\r\n        }\r\n\r\n        if (isActive) {\r\n            cls += \" ring-2 ring-offset-1 ring-offset-card ring-primary scale-105\"\r\n        }\r\n\r\n        return cls\r\n    }\r\n\r\n    const PaletteGrid = () => (\r\n        <div className=\"grid grid-cols-5 gap-2\">\r\n            {questions.map((q, idx) => (\r\n                <button\r\n                    key={q.id}\r\n                    onClick={() => {\r\n                        onNavigate(idx)\r\n                        if (isMobileOpen) onMobileClose()\r\n                    }}\r\n                    className={`h-10 w-full rounded-lg text-sm font-semibold transition-all duration-200 ${getStatusClass(q.id, idx === activeQuestionIdx)}`}\r\n                    aria-label={`Question ${idx + 1}`}\r\n                >\r\n                    {idx + 1}\r\n                </button>\r\n            ))}\r\n        </div>\r\n    )\r\n\r\n    // Desktop View\r\n    const DesktopView = (\r\n        <div className=\"hidden lg:flex flex-col bg-card border-l border-border overflow-hidden h-full\">\r\n            <div className=\"p-5 border-b border-border\">\r\n                <h4 className=\"font-bold text-foreground\">Question Palette</h4>\r\n                {sectionTitle && (\r\n                    <p className=\"text-sm text-muted-foreground mt-1 font-medium\">{sectionTitle}</p>\r\n                )}\r\n                <div className=\"flex gap-y-2 gap-x-4 mt-4 text-xs text-muted-foreground flex-wrap\">\r\n                    <div className=\"flex items-center gap-1\"><div className=\"w-3 h-3 rounded bg-emerald-500\"></div> Answered</div>\r\n                    <div className=\"flex items-center gap-1\"><div className=\"w-3 h-3 rounded bg-amber-500\"></div> Marked</div>\r\n                    <div className=\"flex items-center gap-1\"><div className=\"w-3 h-3 rounded bg-primary/20 border border-primary\"></div> Visited</div>\r\n                    <div className=\"flex items-center gap-1\"><div className=\"w-3 h-3 rounded bg-muted\"></div> Unvisited</div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-y-auto p-5 custom-scrollbar\">\r\n                <PaletteGrid />\r\n            </div>\r\n\r\n            <div className=\"p-5 border-t border-border bg-background\">\r\n                <button\r\n                    onClick={onSubmit}\r\n                    className=\"w-full bg-rose-600 hover:bg-rose-700 text-white py-3 rounded-xl font-bold shadow-sm transition-colors active:scale-[0.98]\"\r\n                >\r\n                    Submit Exam\r\n                </button>\r\n            </div>\r\n        </div>\r\n    )\r\n\r\n    // Mobile Drawer\r\n    const MobileView = (\r\n        <AnimatePresence>\r\n            {isMobileOpen && (\r\n                <>\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        onClick={onMobileClose}\r\n                        className=\"fixed inset-0 bg-black/60 z-40 lg:hidden backdrop-blur-sm\"\r\n                    />\r\n                    <motion.div\r\n                        initial={{ x: \"100%\" }}\r\n                        animate={{ x: 0 }}\r\n                        exit={{ x: \"100%\" }}\r\n                        transition={{ type: \"spring\", damping: 25, stiffness: 200 }}\r\n                        className=\"fixed inset-y-0 right-0 z-50 w-80 bg-card shadow-2xl border-l border-border lg:hidden flex flex-col\"\r\n                    >\r\n                        <div className=\"p-4 flex items-center justify-between border-b border-border\">\r\n                            <div>\r\n                                <h4 className=\"font-bold text-foreground\">Question Palette</h4>\r\n                                {sectionTitle && (\r\n                                    <p className=\"text-sm text-muted-foreground mt-0.5 font-medium\">{sectionTitle}</p>\r\n                                )}\r\n                            </div>\r\n                            <button onClick={onMobileClose} className=\"p-2 hover:bg-muted rounded-full transition-colors\">\r\n                                <X className=\"w-5 h-5 text-muted-foreground\" />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"flex-1 overflow-y-auto p-4 custom-scrollbar\">\r\n                            <PaletteGrid />\r\n                        </div>\r\n                        <div className=\"p-4 border-t border-border bg-background\">\r\n                            <button\r\n                                onClick={onSubmit}\r\n                                className=\"w-full bg-rose-600 text-white py-3 rounded-xl font-bold active:scale-[0.98] transition-transform\"\r\n                            >\r\n                                Submit Exam\r\n                            </button>\r\n                        </div>\r\n                    </motion.div>\r\n                </>\r\n            )}\r\n        </AnimatePresence>\r\n    )\r\n\r\n    return (\r\n        <>\r\n            {DesktopView}\r\n            {MobileView}\r\n        </>\r\n    )\r\n}\r\n\r\nexport const QuestionPalette = memo(QuestionPaletteComponent)\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2896, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/EmbeddedExam.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useEffect, useState, useRef, useCallback } from \"react\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { useQueryClient } from \"@tanstack/react-query\"\r\nimport { createClient } from \"@/lib/supabase/client\"\r\nimport { awardCoins } from \"@/app/actions/rewardActions\"\r\nimport { useExamSession, useSubmitExam, useSaveAnswer, useUpdateTimer } from \"@/hooks/student/useExamSession\"\r\nimport { useExamResult } from \"@/hooks/useExamResult\"\r\nimport { toast } from \"sonner\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport {\r\n    Clock, CheckCircle2, Loader2, ArrowLeft, Flag, TrendingUp, Award, Target, BarChart3,\r\n    Menu, AlertTriangle, Save, ListChecks, Maximize, Minimize, PauseCircle, X\r\n} from \"lucide-react\"\r\nimport { renderWithLatex } from \"@/lib/renderWithLatex\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { useLessonContext } from \"@/context/LessonContext\"\r\nimport { ResponseExpiryWarning } from \"@/components/exam/ResponseExpiryWarning\"\r\nimport { isResponseExpired } from \"@/lib/responseCleanup\"\r\nimport { ExamTimer } from \"@/components/exam/ExamTimer\"\r\nimport { QuestionDisplay } from \"@/components/exam/QuestionDisplay\"\r\nimport { QuestionPalette } from \"@/components/exam/QuestionPalette\"\r\n\r\ninterface EmbeddedExamProps {\r\n    examId: string\r\n    onExit?: () => void\r\n    isRetake?: boolean\r\n    onSuccessfulSubmit?: (attemptId: string) => void\r\n}\r\n\r\ninterface QuizResult {\r\n    id: string\r\n    score: number\r\n    total_marks: number\r\n    percentage: number\r\n    passed: boolean\r\n    time_taken: number\r\n    correct_answers: number\r\n    wrong_answers: number\r\n    unattempted: number\r\n}\r\n\r\n// Component to show detailed question analysis\r\nfunction QuestionAnalysisView({\r\n    structured,\r\n    responseMap,\r\n    onBack,\r\n    isExpired = false\r\n}: {\r\n    structured: any[],\r\n    responseMap: Record<string, any>,\r\n    onBack: () => void,\r\n    isExpired?: boolean\r\n}) {\r\n    const [activeSectionIdx, setActiveSectionIdx] = useState(0)\r\n\r\n    const allQuestions = structured.flatMap(s => s.questions)\r\n    const activeSection = structured[activeSectionIdx]\r\n\r\n    return (\r\n        <div className=\"bg-background rounded-xl border border-border overflow-hidden shadow-sm flex flex-col h-[80vh]\">\r\n            {/* Header */}\r\n            <div className=\"bg-card border-b border-border p-4 flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                <div className=\"flex items-center gap-3 w-full md:w-auto\">\r\n                    <Button variant=\"ghost\" size=\"sm\" onClick={onBack} className=\"text-muted-foreground hover:text-foreground px-0 md:px-3\">\r\n                        <ArrowLeft className=\"w-4 h-4 mr-2\" /> <span className=\"hidden md:inline\">Back to Result</span><span className=\"md:hidden\">Back</span>\r\n                    </Button>\r\n                    <h2 className=\"text-lg font-bold text-foreground truncate\">Question Analysis</h2>\r\n                </div>\r\n                <div className=\"flex gap-2 w-full md:w-auto overflow-x-auto pb-2 md:pb-0 no-scrollbar\">\r\n                    {structured.map((s, i) => (\r\n                        <button\r\n                            key={s.id}\r\n                            onClick={() => setActiveSectionIdx(i)}\r\n                            className={`px-3 py-1.5 text-xs rounded-md transition-colors whitespace-nowrap ${activeSectionIdx === i\r\n                                ? \"bg-primary text-primary-foreground\"\r\n                                : \"bg-muted text-muted-foreground hover:bg-muted/80\"\r\n                                }`}\r\n                        >\r\n                            {s.title}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 md:p-6 space-y-6\">\r\n                {activeSection?.questions.map((q: any, idx: number) => {\r\n                    // Hide user response if expired\r\n                    const userAns = isExpired ? undefined : responseMap[q.id]\r\n\r\n                    // If expired, we can't really judge Correct/Incorrect based on userAns (it's undefined).\r\n                    // But we likely want to show just the question and correct answer.\r\n                    // However, `isCorrect` logic depends on `userAns`.\r\n                    // If isExpired, isCorrect will be false (undefined ans).\r\n                    // We should probably adjust the display to generic \"View Solution\" mode.\r\n\r\n                    const isCorrect = !isExpired && checkAnswer(q, userAns)\r\n                    const isSkipped = !isExpired && (userAns === undefined || userAns === null || (Array.isArray(userAns) && userAns.length === 0))\r\n\r\n                    return (\r\n                        <div key={q.id} className={`p-4 md:p-6 rounded-xl border ${isExpired ? \"border-border bg-card\" :\r\n                            isCorrect ? \"border-emerald-500/30 bg-emerald-500/5\" :\r\n                                isSkipped ? \"border-border bg-muted/20\" :\r\n                                    \"border-rose-500/30 bg-rose-500/5\"\r\n                            }`}>\r\n                            <div className=\"flex justify-between items-start mb-4\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-sm font-medium text-muted-foreground bg-muted px-2 py-1 rounded\">\r\n                                        Q{idx + 1}\r\n                                    </span>\r\n                                    {!isExpired && isCorrect && <span className=\"text-xs font-bold text-emerald-500 flex items-center gap-1\"><CheckCircle2 className=\"w-3 h-3\" /> Correct</span>}\r\n                                    {!isExpired && !isCorrect && !isSkipped && <span className=\"text-xs font-bold text-rose-500 flex items-center gap-1\"><X className=\"w-3 h-3\" /> Incorrect</span>}\r\n                                    {!isExpired && isSkipped && <span className=\"text-xs font-bold text-muted-foreground flex items-center gap-1\"><AlertTriangle className=\"w-3 h-3\" /> Skipped</span>}\r\n                                    {isExpired && <span className=\"text-xs font-bold text-muted-foreground flex items-center gap-1\"><Clock className=\"w-3 h-3\" /> Response Expired</span>}\r\n                                </div>\r\n                                <div className=\"text-xs text-muted-foreground\">\r\n                                    Marks: {isCorrect ? `+${q.marks}` : isSkipped || isExpired ? \"0\" : `-${q.negative_marks}`}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"text-base text-foreground mb-6\">\r\n                                {renderWithLatex(q.question_text)}\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2 mb-6\">\r\n                                {q.options?.map((opt: any, optIdx: number) => {\r\n                                    const isSelected = !isExpired && isOptionSelected(q, opt.id, userAns)\r\n                                    const isRightOption = isOptionCorrect(q, opt.id)\r\n\r\n                                    let optClass = \"border-border bg-muted/30 text-muted-foreground\"\r\n                                    if (isRightOption) optClass = \"border-emerald-500 bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 ring-1 ring-emerald-500\"\r\n                                    else if (isSelected && !isRightOption) optClass = \"border-rose-500 bg-rose-500/10 text-rose-600 dark:text-rose-400 ring-1 ring-rose-500\"\r\n\r\n                                    return (\r\n                                        <div key={opt.id} className={`p-3 rounded-lg border flex items-center gap-3 ${optClass}`}>\r\n                                            <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${isRightOption ? \"bg-emerald-500 text-white\" :\r\n                                                isSelected ? \"bg-rose-500 text-white\" :\r\n                                                    \"border border-muted-foreground/30\"\r\n                                                }`}>\r\n                                                {isRightOption ? <CheckCircle2 className=\"w-3 h-3\" /> : isSelected ? <X className=\"w-3 h-3\" /> : String.fromCharCode(65 + optIdx)}\r\n                                            </div>\r\n                                            <span className=\"text-sm\">{renderWithLatex(opt.option_text)}</span>\r\n                                        </div>\r\n                                    )\r\n                                })}\r\n                                {q.question_type === \"NAT\" && (\r\n                                    <div className=\"p-3 rounded-lg border border-border bg-muted/30\">\r\n                                        <div className=\"text-sm text-muted-foreground mb-1\">Correct Answer: <span className=\"text-emerald-500 font-mono\">{q.correct_answer}</span></div>\r\n                                        {!isExpired && <div className=\"text-sm text-muted-foreground\">Your Answer: <span className={`${isCorrect ? \"text-emerald-500\" : \"text-rose-500\"} font-mono`}>{userAns ?? \"N/A\"}</span></div>}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {q.explanation && (\r\n                                <div className=\"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4\">\r\n                                    <h4 className=\"text-sm font-bold text-blue-500 mb-2 flex items-center gap-2\">\r\n                                        <TrendingUp className=\"w-4 h-4\" /> Explanation\r\n                                    </h4>\r\n                                    <div className=\"text-sm text-foreground/90\">\r\n                                        {renderWithLatex(q.explanation)}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )\r\n                })}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\n// Helper functions for analysis\r\nfunction checkAnswer(q: any, ans: any) {\r\n    if (ans === undefined || ans === null || (Array.isArray(ans) && ans.length === 0)) return false\r\n    if (q.question_type === \"NAT\") return Number(ans) === Number(q.correct_answer)\r\n    if (q.question_type === \"MCQ\") {\r\n        const correctOpt = q.options.find((o: any) => o.is_correct)?.id\r\n        return ans === correctOpt\r\n    }\r\n    if (q.question_type === \"MSQ\") {\r\n        const correctIds = q.options.filter((o: any) => o.is_correct).map((o: any) => o.id).sort()\r\n        const ansIds = (Array.isArray(ans) ? ans : [ans]).sort()\r\n        return correctIds.length === ansIds.length && correctIds.every((x: string, i: number) => x === ansIds[i])\r\n    }\r\n    return false\r\n}\r\n\r\nfunction isOptionSelected(q: any, optId: string, ans: any) {\r\n    if (!ans) return false\r\n    if (q.question_type === \"MCQ\") return ans === optId\r\n    if (q.question_type === \"MSQ\") return (Array.isArray(ans) ? ans : [ans]).includes(optId)\r\n    return false\r\n}\r\n\r\nfunction isOptionCorrect(q: any, optId: string) {\r\n    return q.options?.find((o: any) => o.id === optId)?.is_correct\r\n}\r\n\r\nexport function PreviousResultView({\r\n    examId,\r\n    userId,\r\n    onRetake,\r\n    attemptId,\r\n    initialResult,\r\n    onBack\r\n}: {\r\n    examId: string,\r\n    userId: string,\r\n    onRetake: () => void,\r\n    attemptId?: string,\r\n    initialResult?: any,\r\n    onBack?: () => void\r\n}) {\r\n    const [effectiveAttemptId, setEffectiveAttemptId] = useState<string | null>(attemptId || null)\r\n    const [showAnalysis, setShowAnalysis] = useState(false)\r\n    const supabase = createClient()\r\n\r\n    // If no attemptId provided, fetch the latest one\r\n    useEffect(() => {\r\n        if (attemptId) {\r\n            setEffectiveAttemptId(attemptId)\r\n            return\r\n        }\r\n\r\n        const fetchLatestAttempt = async () => {\r\n            const { data: attempts } = await supabase\r\n                .from(\"exam_attempts\")\r\n                .select(\"id\")\r\n                .eq(\"exam_id\", examId)\r\n                .eq(\"student_id\", userId)\r\n                .eq(\"status\", \"submitted\")\r\n                .order(\"created_at\", { ascending: false })\r\n                .limit(1)\r\n\r\n            if (attempts && attempts.length > 0) {\r\n                setEffectiveAttemptId(attempts[0].id)\r\n            }\r\n        }\r\n\r\n        fetchLatestAttempt()\r\n    }, [examId, userId, attemptId, supabase])\r\n\r\n    const { data: resultData, isLoading } = useExamResult(effectiveAttemptId || \"\")\r\n\r\n    if (isLoading || !effectiveAttemptId) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-96\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-indigo-600\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (!resultData || !resultData.result) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-96\">\r\n                <div className=\"text-center p-8 bg-card rounded-xl border border-border\">\r\n                    <h3 className=\"text-lg font-bold text-amber-500 mb-2\">Result Not Found</h3>\r\n                    <p className=\"text-muted-foreground text-sm mb-4\">Could not find the result for this attempt.</p>\r\n                    <Button onClick={onRetake} className=\"bg-primary hover:bg-primary/90\">\r\n                        Retake Quiz\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    const { result, structured, responseMap, attempt } = resultData\r\n    const passed = result.passed ?? (result.percentage >= 40)\r\n\r\n    // Check for response expiry\r\n    const isExpired = attempt?.submitted_at ? isResponseExpired(attempt.submitted_at) : false\r\n\r\n    // Check visibility settings\r\n    const examSettings = attempt?.exams\r\n    const visibility = examSettings?.result_visibility || \"immediate\"\r\n    const releaseTime = examSettings?.result_release_time\r\n    const showAnswers = examSettings?.show_answers ?? true\r\n\r\n    const isResultVisible = () => {\r\n        if (visibility === \"immediate\") return true\r\n        if (visibility === \"manual\") return false\r\n        if (visibility === \"scheduled\" && releaseTime) {\r\n            return new Date() >= new Date(releaseTime)\r\n        }\r\n        return false\r\n    }\r\n\r\n    if (!isResultVisible()) {\r\n        return (\r\n            <div className=\"bg-background rounded-xl border border-border p-8 text-center\">\r\n                <div className=\"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                    <Clock className=\"w-8 h-8 text-muted-foreground\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-bold text-foreground mb-2\">Results Not Yet Available</h3>\r\n                <p className=\"text-muted-foreground max-w-md mx-auto mb-6\">\r\n                    {visibility === \"scheduled\" && releaseTime\r\n                        ? `The results for this exam will be released on ${new Date(releaseTime).toLocaleString()}.`\r\n                        : \"The instructor has not released the results for this exam yet.\"}\r\n                </p>\r\n                <Button onClick={onRetake} variant=\"outline\" className=\"border-border text-foreground hover:bg-muted\">\r\n                    Back to Exam\r\n                </Button>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (showAnalysis) {\r\n        return <QuestionAnalysisView structured={structured} responseMap={responseMap} onBack={() => setShowAnalysis(false)} isExpired={isExpired} />\r\n    }\r\n\r\n    return (\r\n        <div className=\"bg-background rounded-xl border border-border overflow-hidden shadow-sm\">\r\n            <div className=\"bg-linear-to-r from-indigo-600 to-purple-600 text-white p-6 text-center\">\r\n                <Award className=\"w-16 h-16 mx-auto mb-4\" />\r\n                <h2 className=\"text-2xl font-bold mb-2\">Quiz Result</h2>\r\n                <p className=\"text-indigo-100\">\r\n                    Attempted on {new Date(result.created_at).toLocaleDateString()}\r\n                </p>\r\n            </div>\r\n\r\n            <div className=\"p-4 md:p-6 space-y-6\">\r\n\r\n                {attempt?.submitted_at && (\r\n                    <ResponseExpiryWarning submittedAt={attempt.submitted_at} />\r\n                )}\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4\">\r\n                    <div className=\"bg-blue-50 dark:bg-blue-900/20 p-3 md:p-4 rounded-xl border border-blue-200 dark:border-blue-800 text-center\">\r\n                        <Target className=\"w-6 h-6 md:w-8 md:h-8 mx-auto mb-2 text-blue-500 dark:text-blue-400\" />\r\n                        <div className=\"text-xl md:text-2xl font-bold text-blue-700 dark:text-blue-300\">{result.score ?? result.obtained_marks ?? 0}</div>\r\n                        <div className=\"text-xs text-blue-600 dark:text-blue-400 font-medium\">Score</div>\r\n                    </div>\r\n                    <div className=\"bg-purple-50 dark:bg-purple-900/20 p-3 md:p-4 rounded-xl border border-purple-200 dark:border-purple-800 text-center\">\r\n                        <TrendingUp className=\"w-6 h-6 md:w-8 md:h-8 mx-auto mb-2 text-purple-500 dark:text-purple-400\" />\r\n                        <div className=\"text-xl md:text-2xl font-bold text-purple-700 dark:text-purple-300\">{result.percentage?.toFixed(1) || 0}%</div>\r\n                        <div className=\"text-xs text-purple-600 dark:text-purple-400 font-medium\">Percentage</div>\r\n                    </div>\r\n                    <div className={`bg-linear-to-br p-3 md:p-4 rounded-xl border text-center col-span-2 md:col-span-1 ${passed ? 'from-emerald-500/20 to-emerald-600/20 border-emerald-500/50' : 'from-amber-500/20 to-amber-600/20 border-amber-500/50'}`}>\r\n                        {passed ? (\r\n                            <>\r\n                                <CheckCircle2 className=\"w-6 h-6 md:w-8 md:h-8 mx-auto mb-2 text-emerald-500\" />\r\n                                <div className=\"text-xl md:text-2xl font-bold text-emerald-600 dark:text-emerald-400\">Passed</div>\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                <AlertTriangle className=\"w-6 h-6 md:w-8 md:h-8 mx-auto mb-2 text-amber-500\" />\r\n                                <div className=\"text-xl md:text-2xl font-bold text-amber-600 dark:text-amber-400\">Not Passed</div>\r\n                            </>\r\n                        )}\r\n                        <div className=\"text-xs text-muted-foreground font-medium\">Status</div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Section Analysis */}\r\n                {structured && structured.length > 0 && (\r\n                    <div className=\"space-y-4\">\r\n                        <h3 className=\"text-lg font-semibold text-foreground flex items-center gap-2\">\r\n                            <BarChart3 className=\"w-5 h-5 text-primary\" />\r\n                            Section Analysis\r\n                        </h3>\r\n                        <div className=\"grid gap-4\">\r\n                            {structured.map((section: any) => {\r\n                                const secResult = section.result\r\n                                const totalQuestions = section.questions.length\r\n\r\n                                return (\r\n                                    <div key={section.id} className=\"bg-card p-4 rounded-xl border border-border\">\r\n                                        <div className=\"flex justify-between items-center mb-4\">\r\n                                            <h4 className=\"font-medium text-foreground\">{section.title}</h4>\r\n                                            <span className=\"text-xs text-muted-foreground\">{totalQuestions} Questions</span>\r\n                                        </div>\r\n\r\n                                        {secResult ? (\r\n                                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\r\n                                                <div className=\"bg-muted/50 p-2 rounded-lg border border-border\">\r\n                                                    <div className=\"text-muted-foreground text-xs\">Score</div>\r\n                                                    <div className=\"font-semibold text-blue-500\">{secResult.obtained_marks} / {secResult.total_marks}</div>\r\n                                                </div>\r\n                                                <div className=\"bg-muted/50 p-2 rounded-lg border border-border\">\r\n                                                    <div className=\"text-muted-foreground text-xs\">Correct</div>\r\n                                                    <div className=\"font-semibold text-emerald-500\">{secResult.correct_answers}</div>\r\n                                                </div>\r\n                                                <div className=\"bg-muted/50 p-2 rounded-lg border border-border\">\r\n                                                    <div className=\"text-muted-foreground text-xs\">Wrong</div>\r\n                                                    <div className=\"font-semibold text-rose-500\">{secResult.wrong_answers}</div>\r\n                                                </div>\r\n                                                <div className=\"bg-muted/50 p-2 rounded-lg border border-border\">\r\n                                                    <div className=\"text-muted-foreground text-xs\">Unanswered</div>\r\n                                                    <div className=\"font-semibold text-muted-foreground\">{secResult.unanswered}</div>\r\n                                                </div>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className=\"text-sm text-muted-foreground italic\">\r\n                                                No detailed result available for this section.\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                )\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Action Buttons */}\r\n                <div className=\"flex flex-col sm:flex-row justify-center gap-3 pt-4\">\r\n                    {showAnswers && (\r\n                        <Button\r\n                            onClick={() => setShowAnalysis(true)}\r\n                            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n                        >\r\n                            <ListChecks className=\"w-4 h-4 mr-2\" />\r\n                            Review Questions\r\n                        </Button>\r\n                    )}\r\n                    <Button\r\n                        onClick={onRetake}\r\n                        className=\"bg-primary hover:bg-primary/90 text-primary-foreground\"\r\n                    >\r\n                        <Flag className=\"w-4 w-4 mr-2\" />\r\n                        Retake Quiz\r\n                    </Button>\r\n                    {onBack && (\r\n                        <Button\r\n                            onClick={onBack}\r\n                            variant=\"outline\"\r\n                            className=\"border-border text-foreground hover:bg-muted\"\r\n                        >\r\n                            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n                            Back to Attempts\r\n                        </Button>\r\n                    )}\r\n                    <Button\r\n                        onClick={() => window.location.reload()}\r\n                        variant=\"secondary\"\r\n                        className=\"bg-secondary text-secondary-foreground hover:bg-secondary/80\"\r\n                    >\r\n                        Continue Learning\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport function EmbeddedExam({ examId, onExit, isRetake = false, onSuccessfulSubmit }: EmbeddedExamProps) {\r\n    const queryClient = useQueryClient()\r\n    const supabase = createClient()\r\n    const router = useRouter()\r\n    const examContainerRef = useRef<HTMLDivElement>(null)\r\n    const [isFullscreen, setIsFullscreen] = useState(false)\r\n    const [userId, setUserId] = useState<string | null>(null)\r\n    const [responses, setResponses] = useState<Record<string, any>>({})\r\n    const [marked, setMarked] = useState<Record<string, boolean>>({})\r\n    const [visited, setVisited] = useState<Record<string, boolean>>({})\r\n    const [activeQuestionIdx, setActiveQuestionIdx] = useState(0)\r\n\r\n    // Timer Logic - Ref to avoid re-renders\r\n    const timeRef = useRef(0)\r\n    const [initialTime, setInitialTime] = useState(0)\r\n    const [isTimerActive, setIsTimerActive] = useState(false)\r\n\r\n    const [showSubmitDialog, setShowSubmitDialog] = useState(false)\r\n    const [showResults, setShowResults] = useState(false)\r\n    const [paletteOpenMobile, setPaletteOpenMobile] = useState(false)\r\n    const [retakeAttempt, setRetakeAttempt] = useState(isRetake ? 1 : 0)\r\n    const [submittedAttemptId, setSubmittedAttemptId] = useState<string | null>(null)\r\n    const [showPauseDialog, setShowPauseDialog] = useState(false)\r\n    const [isPausing, setIsPausing] = useState(false)\r\n    const { markComplete } = useLessonContext()\r\n\r\n    // Auth check\r\n    useEffect(() => {\r\n        const checkUser = async () => {\r\n            const { data: { user } } = await supabase.auth.getUser()\r\n            if (!user) return router.push(\"/auth/login\")\r\n            setUserId(user.id)\r\n        }\r\n        checkUser()\r\n    }, [router, supabase])\r\n\r\n    const { data: sessionData, isLoading, error } = useExamSession(examId, userId, retakeAttempt, !showResults)\r\n    const { mutate: submitExam, isPending: isSubmitting } = useSubmitExam()\r\n    const { mutate: saveAnswer, isPending: isSaving } = useSaveAnswer()\r\n    const { mutate: updateTimer } = useUpdateTimer()\r\n\r\n    // Initialize session\r\n    useEffect(() => {\r\n        if (!sessionData) return\r\n\r\n        if (sessionData.previousResponses) {\r\n            setResponses(sessionData.previousResponses)\r\n            const newVisited: Record<string, boolean> = {}\r\n            Object.keys(sessionData.previousResponses).forEach(k => newVisited[k] = true)\r\n            setVisited(newVisited)\r\n        }\r\n\r\n        const totalDuration = sessionData.exam.duration_minutes * 60\r\n        const timeSpent = sessionData.attempt.total_time_spent || 0\r\n        const remaining = Math.max(0, totalDuration - timeSpent)\r\n\r\n        setInitialTime(remaining)\r\n        timeRef.current = remaining\r\n        setIsTimerActive(true)\r\n    }, [sessionData])\r\n\r\n\r\n    // Fullscreen handler\r\n    useEffect(() => {\r\n        const handleFullscreenChange = () => {\r\n            setIsFullscreen(!!document.fullscreenElement)\r\n        }\r\n        document.addEventListener('fullscreenchange', handleFullscreenChange)\r\n        return () => document.removeEventListener('fullscreenchange', handleFullscreenChange)\r\n    }, [])\r\n\r\n    const toggleFullscreen = async () => {\r\n        if (!examContainerRef.current) return\r\n\r\n        if (!document.fullscreenElement) {\r\n            try {\r\n                await examContainerRef.current.requestFullscreen()\r\n            } catch (err) {\r\n                console.error(\"Error attempting to enable fullscreen:\", err)\r\n            }\r\n        } else {\r\n            if (document.exitFullscreen) {\r\n                await document.exitFullscreen()\r\n            }\r\n        }\r\n    }\r\n\r\n    const forceExitFullscreen = async () => {\r\n        if (document.fullscreenElement && document.exitFullscreen) {\r\n            try {\r\n                await document.exitFullscreen()\r\n            } catch (err) {\r\n                console.error(\"Error exiting fullscreen:\", err)\r\n            }\r\n        }\r\n    }\r\n\r\n    const confirmPauseAndExit = async () => {\r\n        setIsPausing(true)\r\n        try {\r\n            if (sessionData?.attempt?.id) {\r\n                // Determine time spent\r\n                const currentSecondsLeft = timeRef.current\r\n                const totalDur = sessionData.exam.duration_minutes * 60\r\n                const timeSpent = Math.max(0, totalDur - currentSecondsLeft)\r\n\r\n                await new Promise<void>((resolve, reject) => {\r\n                    updateTimer(\r\n                        { attemptId: sessionData.attempt.id, timeSpent },\r\n                        {\r\n                            onSuccess: () => resolve(),\r\n                            onError: (error) => reject(error)\r\n                        }\r\n                    )\r\n                })\r\n            }\r\n\r\n            // Invalidate queries to ensure fresh data on return\r\n            await queryClient.invalidateQueries({ queryKey: [\"exam-attempts\", examId, userId] })\r\n            await queryClient.invalidateQueries({ queryKey: [\"exam-session\"] })\r\n\r\n            // Exit fullscreen if active\r\n            await forceExitFullscreen()\r\n\r\n            setShowPauseDialog(false)\r\n            if (onExit) onExit()\r\n        } catch (error) {\r\n            console.error(\"Error pausing exam:\", error)\r\n            toast.error(\"Failed to save progress\")\r\n        } finally {\r\n            setIsPausing(false)\r\n        }\r\n    }\r\n\r\n    const allQuestions = sessionData?.sections.flatMap((s) => s.questions) || []\r\n    const currentQuestion = allQuestions[activeQuestionIdx]\r\n\r\n    const isAnswered = useCallback((val: any) => {\r\n        return val !== undefined && val !== null && val !== \"\" && !(Array.isArray(val) && val.length === 0)\r\n    }, [])\r\n\r\n    const getSectionAttemptCount = useCallback((sectionId: string) => {\r\n        const section = sessionData?.sections.find(s => s.id === sectionId)\r\n        if (!section) return 0\r\n        return section.questions.filter(q => isAnswered(responses[q.id])).length\r\n    }, [sessionData, responses, isAnswered])\r\n\r\n    const currentSection = sessionData?.sections.find(s => s.id === currentQuestion?.section_id)\r\n\r\n    const handleSaveResponse = useCallback((qid: string, ans: any) => {\r\n        // Max Attempts Enforcement\r\n        if (currentSection?.max_questions_to_attempt) {\r\n            const wasAnswered = isAnswered(responses[qid])\r\n            // Check if this is a \"clearing\" action (empty string or explicit null/undefined)\r\n            const isClearing = ans === \"\" || ans === null || ans === undefined || (Array.isArray(ans) && ans.length === 0);\r\n            const willBeAnswered = isAnswered(ans)\r\n\r\n            // Only block if we are ADDING an answer (was not answered, and will be answered)\r\n            // If we are clearing (willBeAnswered is false), we should ALWAYS allow it.\r\n            if (!wasAnswered && willBeAnswered && !isClearing) {\r\n                const currentCount = getSectionAttemptCount(currentSection.id)\r\n                if (currentCount >= currentSection.max_questions_to_attempt) {\r\n                    toast.error(`Maximum attempts (${currentSection.max_questions_to_attempt}) reached for this section. Clear an existing answer to change.`)\r\n                    return // Prevent saving\r\n                }\r\n            }\r\n        }\r\n\r\n        setResponses((r) => ({ ...r, [qid]: ans }))\r\n        setVisited((v) => ({ ...v, [qid]: true }))\r\n\r\n        if (sessionData?.attempt?.id) {\r\n            saveAnswer({ attemptId: sessionData.attempt.id, questionId: qid, answer: ans })\r\n        }\r\n    }, [currentSection, getSectionAttemptCount, isAnswered, responses, sessionData?.attempt?.id, saveAnswer])\r\n\r\n\r\n    const handleMark = useCallback((qid: string) => {\r\n        setMarked((m) => ({ ...m, [qid]: !m[qid] }))\r\n    }, [])\r\n\r\n\r\n    const performSubmit = useCallback(async () => {\r\n        if (!sessionData?.attempt?.id || !sessionData?.exam) return\r\n\r\n        submitExam({\r\n            attemptId: sessionData.attempt.id,\r\n            examId: sessionData.exam.id,\r\n            responses: responses,\r\n            sections: sessionData.sections,\r\n            totalMarks: sessionData.exam.total_marks || 0\r\n        }, {\r\n            onSuccess: async (result: any) => {\r\n                // Exit Fullscreen IMMEDIATELY\r\n                await forceExitFullscreen()\r\n\r\n                toast.success(\"Quiz submitted successfully!\")\r\n                setIsTimerActive(false)\r\n\r\n                // Wait a moment for database to update\r\n                await new Promise(resolve => setTimeout(resolve, 500))\r\n\r\n                // Award coins and mark complete\r\n                if (userId) {\r\n                    try {\r\n                        const rewardRes = await awardCoins(userId, 'quiz_completion', examId, `Completed quiz: ${sessionData.exam.title}`);\r\n                        if (rewardRes.success && rewardRes.message) {\r\n                            toast.success(rewardRes.message, { icon: \"ðŸª™\" });\r\n                        }\r\n                    } catch (error) {\r\n                        // Silently fail - don't break submission if reward fails\r\n                        console.error(\"Failed to award coins:\", error);\r\n                    }\r\n\r\n                    // Mark lesson complete via context\r\n                    markComplete();\r\n                }\r\n\r\n                // Check if results should be shown immediately\r\n                let shouldShowResults = true; // Default to showing results\r\n                try {\r\n                    const { data: examData, error } = await supabase\r\n                        .from(\"exams\")\r\n                        .select(\"result_visibility\")\r\n                        .eq(\"id\", examId)\r\n                        .single()\r\n\r\n                    if (!error && examData) {\r\n                        // Only hide results if explicitly set to manual or scheduled\r\n                        shouldShowResults = examData.result_visibility === \"immediate\" || !examData.result_visibility\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"Error fetching result visibility:\", error)\r\n                    // On error, default to showing results\r\n                }\r\n\r\n                // Close the submit dialog\r\n                setShowSubmitDialog(false)\r\n\r\n                if (shouldShowResults) {\r\n                    // If onSuccessfulSubmit is provided (standalone mode), use it\r\n                    if (onSuccessfulSubmit) {\r\n                        onSuccessfulSubmit(sessionData.attempt.id)\r\n                    } else {\r\n                        // Otherwise show results inline (embedded mode)\r\n                        setSubmittedAttemptId(sessionData.attempt.id)\r\n                        setShowResults(true)\r\n                    }\r\n                } else {\r\n                    toast.info(\"Results will be available once the instructor releases them\")\r\n                    if (onExit) onExit()\r\n                }\r\n            },\r\n            onError: (error: any) => {\r\n                console.error(\"Submission error:\", error)\r\n                toast.error(\"Failed to submit quiz. Please try again.\")\r\n                setShowSubmitDialog(false)\r\n            }\r\n        })\r\n    }, [sessionData, responses, submitExam, examId, userId, awardCoins, markComplete, onExit, onSuccessfulSubmit, supabase])\r\n\r\n    const handleAutoSubmit = useCallback(() => {\r\n        toast.info(\"Time's up! Submitting quiz...\")\r\n        performSubmit()\r\n    }, [performSubmit])\r\n\r\n    const validateMinimumAttempts = () => {\r\n        if (!sessionData) return true\r\n        let isValid = true\r\n        sessionData.sections.forEach(s => {\r\n            if (s.required_attempts && getSectionAttemptCount(s.id) < s.required_attempts) {\r\n                isValid = false\r\n                toast.warning(`Section \"${s.title}\" requires at least ${s.required_attempts} attempted questions.`)\r\n            }\r\n        })\r\n        return isValid\r\n    }\r\n\r\n    if (isLoading || !userId) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-96 text-muted-foreground\">\r\n                <div className=\"flex flex-col items-center gap-3\">\r\n                    <Loader2 className=\"w-8 h-8 animate-spin text-indigo-600\" />\r\n                    <p>Loading Quiz...</p>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (error || (!sessionData && !isLoading)) {\r\n        const errorMessage = (error as Error)?.message || \"Unknown error\"\r\n        const isAlreadySubmitted = errorMessage.includes(\"already been submitted\")\r\n\r\n        if (isAlreadySubmitted && userId) {\r\n            return <PreviousResultView\r\n                examId={examId}\r\n                userId={userId}\r\n                onRetake={() => {\r\n                    queryClient.invalidateQueries({ queryKey: [\"exam-session\"] })\r\n                    setRetakeAttempt(prev => prev + 1)\r\n                }}\r\n            />\r\n        }\r\n\r\n        return (\r\n            <div className=\"flex items-center justify-center h-96\">\r\n                <div className=\"text-center p-8 bg-rose-50 dark:bg-rose-950/20 rounded-xl border border-rose-200 dark:border-rose-800\">\r\n                    <h3 className=\"text-lg font-bold text-rose-900 dark:text-rose-400 mb-2\">Failed to Load Quiz</h3>\r\n                    <p className=\"text-rose-700 dark:text-rose-500 text-sm\">{errorMessage}</p>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (showResults && submittedAttemptId && userId) {\r\n        return (\r\n            <PreviousResultView\r\n                examId={examId}\r\n                userId={userId}\r\n                attemptId={submittedAttemptId}\r\n                onRetake={() => {\r\n                    setRetakeAttempt(prev => {\r\n                        const newRetakeAttempt = prev + 1\r\n                        queryClient.invalidateQueries({ queryKey: [\"exam-session\", examId, userId, prev] })\r\n                        queryClient.invalidateQueries({ queryKey: [\"exam-session\", examId, userId, newRetakeAttempt] })\r\n                        return newRetakeAttempt\r\n                    })\r\n                    setShowResults(false)\r\n                    setSubmittedAttemptId(null)\r\n                }}\r\n                onBack={onExit ? () => onExit() : undefined}\r\n            />\r\n        )\r\n    }\r\n\r\n    if (!sessionData) return null\r\n\r\n    return (\r\n        <div ref={examContainerRef} className=\"grid grid-cols-1 lg:grid-cols-[1fr_360px] bg-background text-foreground rounded-xl overflow-hidden border border-border h-full\">\r\n            {/* LEFT PANEL */}\r\n            <div className=\"flex flex-col min-h-0 p-3 md:p-6 relative bg-background\">\r\n                {/* HEADER NAV */}\r\n                <div className=\"flex-shrink-0 bg-card border border-border py-3 px-3 md:px-4 rounded-xl flex flex-wrap items-center justify-between gap-2 md:gap-3 shadow-sm mb-4\">\r\n                    <div className=\"flex flex-col flex-1 min-w-0\">\r\n                        <div className=\"flex flex-wrap items-center gap-2\">\r\n                            <h2 className=\"text-base md:text-lg font-bold text-primary truncate\">{sessionData.exam.title}</h2>\r\n                            {currentSection && (\r\n                                <div className=\"text-xs font-semibold px-2 py-0.5 rounded border border-border bg-muted/50 text-muted-foreground ml-2\">\r\n                                    Attempted: <span className={`${(currentSection.max_questions_to_attempt && getSectionAttemptCount(currentSection.id) >= currentSection.max_questions_to_attempt) ? \"text-rose-500\" : \"text-foreground\"}`}>{getSectionAttemptCount(currentSection.id)}</span>\r\n                                    {currentSection.required_attempts ? ` / Min ${currentSection.required_attempts}` : \"\"}\r\n                                    {currentSection.max_questions_to_attempt ? ` / Max ${currentSection.max_questions_to_attempt}` : \"\"}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"flex gap-2 mt-2 overflow-x-auto pb-1\">\r\n                            {sessionData.sections.map((s, i) => {\r\n                                const startIdx = sessionData.sections.slice(0, i).reduce((a, b) => a + b.questions.length, 0)\r\n                                const isActive = activeQuestionIdx >= startIdx && activeQuestionIdx < startIdx + s.questions.length\r\n                                return (\r\n                                    <button\r\n                                        key={s.id}\r\n                                        onClick={() => setActiveQuestionIdx(startIdx)}\r\n                                        className={`px-2 md:px-3 py-1 text-xs rounded-md whitespace-nowrap transition-colors ${isActive\r\n                                            ? \"bg-primary text-primary-foreground shadow-md\"\r\n                                            : \"bg-muted text-muted-foreground hover:bg-muted/80\"\r\n                                            }`}\r\n                                    >\r\n                                        {s.title}\r\n                                    </button>\r\n                                )\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-2 md:gap-3\">\r\n                        {/* Saving Indicator */}\r\n                        <div className=\"hidden md:flex items-center gap-2 text-xs text-muted-foreground font-medium\">\r\n                            {isSaving ? (\r\n                                <>\r\n                                    <Loader2 className=\"w-3 h-3 animate-spin\" />\r\n                                    Saving...\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <Save className=\"w-3 h-3\" />\r\n                                    Saved\r\n                                </>\r\n                            )}\r\n                        </div>\r\n\r\n                        <ExamTimer\r\n                            key={initialTime}\r\n                            initialSeconds={initialTime}\r\n                            isActive={isTimerActive}\r\n                            onTimeUp={handleAutoSubmit}\r\n                            timeRef={timeRef}\r\n                        />\r\n\r\n                        <button\r\n                            onClick={() => {\r\n                                if (validateMinimumAttempts()) {\r\n                                    setShowSubmitDialog(true)\r\n                                } else {\r\n                                    setShowSubmitDialog(true)\r\n                                }\r\n                            }}\r\n                            className=\"hidden sm:block bg-rose-600 hover:bg-rose-700 text-white px-3 md:px-4 py-1.5 md:py-2 rounded-md text-xs md:text-sm font-medium transition-colors shadow-sm\"\r\n                        >\r\n                            Submit\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setShowPauseDialog(true)}\r\n                            className=\"flex items-center gap-2 bg-muted hover:bg-muted/80 text-muted-foreground px-3 md:px-4 py-1.5 md:py-2 rounded-md text-xs md:text-sm font-medium transition-colors shadow-sm\"\r\n                        >\r\n                            <PauseCircle className=\"w-4 h-4\" />\r\n                            <span className=\"hidden lg:inline\">Pause & Exit</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={toggleFullscreen}\r\n                            className=\"p-2 rounded-md bg-muted text-muted-foreground hover:bg-muted/80 transition-colors\"\r\n                            title={isFullscreen ? \"Exit Fullscreen\" : \"Enter Fullscreen\"}\r\n                        >\r\n                            {isFullscreen ? <Minimize className=\"w-4 h-4\" /> : <Maximize className=\"w-4 h-4\" />}\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setPaletteOpenMobile(true)}\r\n                            className=\"block lg:hidden bg-primary text-primary-foreground px-2 md:px-3 py-1.5 md:py-2 rounded-md text-sm\"\r\n                        >\r\n                            <Menu className=\"w-4 h-4\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* QUESTION CARD */}\r\n                <QuestionDisplay\r\n                    question={currentQuestion}\r\n                    activeQuestionIdx={activeQuestionIdx}\r\n                    response={responses[currentQuestion?.id]}\r\n                    isMarked={marked[currentQuestion?.id] || false}\r\n                    onSave={handleSaveResponse}\r\n                    onMark={handleMark}\r\n                    onNext={() => {\r\n                        if (activeQuestionIdx < allQuestions.length - 1) setActiveQuestionIdx(i => i + 1)\r\n                    }}\r\n                    onPrev={() => {\r\n                        if (activeQuestionIdx > 0) setActiveQuestionIdx(i => i - 1)\r\n                    }}\r\n                    onClear={() => handleSaveResponse(currentQuestion.id, \"\")}\r\n                    isFirst={activeQuestionIdx === 0}\r\n                    isLast={activeQuestionIdx === allQuestions.length - 1}\r\n                />\r\n            </div>\r\n\r\n            {/* RIGHT PALETTE (Desktop & Mobile handled by component) */}\r\n            <QuestionPalette\r\n                questions={allQuestions}\r\n                activeQuestionIdx={activeQuestionIdx}\r\n                responses={responses}\r\n                marked={marked}\r\n                visited={visited}\r\n                onNavigate={(idx) => setActiveQuestionIdx(idx)}\r\n                onSubmit={() => setShowSubmitDialog(true)}\r\n                sectionTitle={currentSection?.title}\r\n                isMobileOpen={paletteOpenMobile}\r\n                onMobileClose={() => setPaletteOpenMobile(false)}\r\n            />\r\n\r\n            {/* SUBMIT CONFIRMATION DIALOG */}\r\n            <AnimatePresence>\r\n                {showSubmitDialog && (\r\n                    <>\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            onClick={() => setShowSubmitDialog(false)}\r\n                            className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4\"\r\n                        >\r\n                            <motion.div\r\n                                initial={{ scale: 0.95, opacity: 0 }}\r\n                                animate={{ scale: 1, opacity: 1 }}\r\n                                exit={{ scale: 0.95, opacity: 0 }}\r\n                                onClick={(e) => e.stopPropagation()}\r\n                                className=\"bg-card w-full max-w-md rounded-2xl border border-border shadow-2xl overflow-hidden\"\r\n                            >\r\n                                <div className=\"p-6 text-center\">\r\n                                    <div className=\"w-16 h-16 bg-rose-500/10 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                                        <AlertTriangle className=\"w-8 h-8 text-rose-500\" />\r\n                                    </div>\r\n                                    <h3 className=\"text-xl font-bold text-foreground mb-2\">Submit Exam?</h3>\r\n                                    <p className=\"text-muted-foreground mb-6\">\r\n                                        Are you sure you want to submit? You won't be able to change your answers after this.\r\n                                    </p>\r\n\r\n                                    <div className=\"bg-muted/50 rounded-lg p-4 mb-6 text-sm\">\r\n                                        <div className=\"flex justify-between mb-2\">\r\n                                            <span className=\"text-muted-foreground\">Answered</span>\r\n                                            <span className=\"text-emerald-500 font-semibold\">\r\n                                                {Object.values(responses).filter(v => v !== null && (Array.isArray(v) ? v.length > 0 : true)).length}\r\n                                            </span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between mb-2\">\r\n                                            <span className=\"text-muted-foreground\">Marked for Review</span>\r\n                                            <span className=\"text-amber-500 font-semibold\">\r\n                                                {Object.values(marked).filter(Boolean).length}\r\n                                            </span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between\">\r\n                                            <span className=\"text-muted-foreground\">Unanswered</span>\r\n                                            <span className=\"text-foreground font-semibold\">\r\n                                                {allQuestions.length - Object.values(responses).filter(v => v !== null && (Array.isArray(v) ? v.length > 0 : true)).length}\r\n                                            </span>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex gap-3\">\r\n                                        <button\r\n                                            onClick={() => setShowSubmitDialog(false)}\r\n                                            className=\"flex-1 py-2.5 rounded-xl border border-border text-foreground hover:bg-muted font-medium transition-colors\"\r\n                                        >\r\n                                            Cancel\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={performSubmit}\r\n                                            disabled={isSubmitting}\r\n                                            className=\"flex-1 py-2.5 rounded-xl bg-rose-600 hover:bg-rose-700 text-white font-medium shadow-lg shadow-rose-900/20 transition-colors flex items-center justify-center gap-2\"\r\n                                        >\r\n                                            {isSubmitting ? (\r\n                                                <>\r\n                                                    <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                                                    Submitting...\r\n                                                </>\r\n                                            ) : (\r\n                                                \"Submit Now\"\r\n                                            )}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </motion.div>\r\n                        </motion.div>\r\n                    </>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* PAUSE CONFIRMATION DIALOG */}\r\n            <AnimatePresence>\r\n                {showPauseDialog && (\r\n                    <>\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            onClick={() => setShowPauseDialog(false)}\r\n                            className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4\"\r\n                        >\r\n                            <motion.div\r\n                                initial={{ scale: 0.95, opacity: 0 }}\r\n                                animate={{ scale: 1, opacity: 1 }}\r\n                                exit={{ scale: 0.95, opacity: 0 }}\r\n                                onClick={(e) => e.stopPropagation()}\r\n                                className=\"bg-card w-full max-w-md rounded-2xl border border-border shadow-2xl overflow-hidden\"\r\n                            >\r\n                                <div className=\"p-6 text-center\">\r\n                                    <div className=\"w-16 h-16 bg-amber-500/10 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                                        <PauseCircle className=\"w-8 h-8 text-amber-500\" />\r\n                                    </div>\r\n                                    <h3 className=\"text-xl font-bold text-foreground mb-2\">Pause & Exit?</h3>\r\n                                    <p className=\"text-muted-foreground mb-6\">\r\n                                        Your progress will be saved and you can resume this exam later.\r\n                                    </p>\r\n\r\n                                    <div className=\"flex gap-3\">\r\n                                        <button\r\n                                            onClick={() => setShowPauseDialog(false)}\r\n                                            className=\"flex-1 py-2.5 rounded-xl border border-border text-foreground hover:bg-muted font-medium transition-colors\"\r\n                                        >\r\n                                            Cancel\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={confirmPauseAndExit}\r\n                                            disabled={isPausing}\r\n                                            className=\"flex-1 py-2.5 rounded-xl bg-amber-500 hover:bg-amber-600 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium shadow-lg shadow-amber-900/20 transition-colors flex items-center justify-center gap-2\"\r\n                                        >\r\n                                            {isPausing ? (\r\n                                                <>\r\n                                                    <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                                                    Saving...\r\n                                                </>\r\n                                            ) : (\r\n                                                <>\r\n                                                    <PauseCircle className=\"w-4 h-4\" />\r\n                                                    Pause & Exit\r\n                                                </>\r\n                                            )}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </motion.div>\r\n                        </motion.div>\r\n                    </>\r\n                )}\r\n            </AnimatePresence>\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4991, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/examAccess.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/client\"\r\nimport { ExamAccessStatus } from \"@/components/ExamAccessChecker\"\r\n\r\n/**\r\n * Check if a student can access an exam based on scheduling and prerequisites\r\n * @param examId - The ID of the exam to check\r\n * @param userId - The ID of the student\r\n * @returns ExamAccessStatus object with accessibility information\r\n */\r\nexport async function checkExamAccess(\r\n    examId: string,\r\n    userId: string\r\n): Promise<ExamAccessStatus> {\r\n    const supabase = createClient()\r\n\r\n    try {\r\n        // Fetch exam details\r\n        const { data: exam, error: examError } = await supabase\r\n            .from(\"exams\")\r\n            .select(\"*\")\r\n            .eq(\"id\", examId)\r\n            .single()\r\n\r\n        if (examError || !exam) {\r\n            return {\r\n                accessible: false,\r\n                reason: undefined,\r\n                message: \"Exam not found\"\r\n            }\r\n        }\r\n\r\n        const examData = exam as any\r\n        const now = new Date()\r\n\r\n        // Check start time\r\n        if (examData.start_time) {\r\n            const startTime = new Date(examData.start_time)\r\n            if (now < startTime) {\r\n                return {\r\n                    accessible: false,\r\n                    reason: \"upcoming\",\r\n                    message: `This exam will be available starting ${startTime.toLocaleString()}`,\r\n                    startTime\r\n                }\r\n            }\r\n        }\r\n\r\n        // Check end time\r\n        if (examData.end_time) {\r\n            const endTime = new Date(examData.end_time)\r\n            if (now > endTime) {\r\n                return {\r\n                    accessible: false,\r\n                    reason: \"expired\",\r\n                    message: `This exam ended on ${endTime.toLocaleString()}`,\r\n                    endTime\r\n                }\r\n            }\r\n        }\r\n\r\n        // Check LESSON-based prerequisite (quiz lessons only)\r\n        // 1. Find the lesson containing this exam\r\n        const { data: currentLesson } = await supabase\r\n            .from(\"lessons\")\r\n            .select(\"id, title, prerequisite_lesson_id, sequential_unlock_enabled, content_type, exam_id\")\r\n            .eq(\"exam_id\", examId)\r\n            .eq(\"content_type\", \"quiz\")\r\n            .limit(1)\r\n            .maybeSingle()\r\n\r\n        // If exam is not in a quiz lesson, or lesson doesn't exist, allow access\r\n        if (!currentLesson) {\r\n            return {\r\n                accessible: true,\r\n                reason: \"accessible\"\r\n            }\r\n        }\r\n\r\n        // 2. Check if this lesson has sequential unlock enabled and a prerequisite\r\n        // SAFEGUARD: Ignore if prerequisite is the lesson itself (prevent infinite lock)\r\n        if (currentLesson.sequential_unlock_enabled &&\r\n            currentLesson.prerequisite_lesson_id &&\r\n            currentLesson.prerequisite_lesson_id !== currentLesson.id) {\r\n\r\n            // 3. Get the prerequisite lesson and its exam\r\n            const { data: prereqLesson } = await supabase\r\n                .from(\"lessons\")\r\n                .select(\"id, title, exam_id\")\r\n                .eq(\"id\", currentLesson.prerequisite_lesson_id)\r\n                .single()\r\n\r\n            if (prereqLesson && prereqLesson.exam_id) {\r\n                // Safeguard: If the prerequisite points to the SAME exam, ignore it (deadlock prevention)\r\n                if (prereqLesson.exam_id === examId) {\r\n                    return {\r\n                        accessible: true,\r\n                        reason: \"accessible\"\r\n                    }\r\n                }\r\n\r\n                // 4. Check if student has completed the prerequisite lesson's exam\r\n                const { data: prerequisiteAttempts } = await supabase\r\n                    .from(\"exam_attempts\")\r\n                    .select(\"id, status\")\r\n                    .eq(\"exam_id\", prereqLesson.exam_id)\r\n                    .eq(\"student_id\", userId)\r\n                    .eq(\"status\", \"submitted\")\r\n\r\n                if (!prerequisiteAttempts || prerequisiteAttempts.length === 0) {\r\n                    return {\r\n                        accessible: false,\r\n                        reason: \"prerequisite\",\r\n                        message: \"You must complete the previous quiz first\",\r\n                        prerequisiteTitle: prereqLesson.title || \"Previous Quiz\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Exam is accessible\r\n        return {\r\n            accessible: true,\r\n            reason: \"accessible\"\r\n        }\r\n    } catch (error) {\r\n        console.error(\"âŒ Error checking exam access:\", error)\r\n        // Return accessible on error to avoid blocking students\r\n        return {\r\n            accessible: true,\r\n            reason: \"accessible\"\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AASO,eAAe,gBAClB,MAAc,EACd,MAAc;IAEd,MAAM,WAAW,IAAA,iJAAY;IAE7B,IAAI;QACA,qBAAqB;QACrB,MAAM,EAAE,MAAM,IAAI,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAC1C,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,QACT,MAAM;QAEX,IAAI,aAAa,CAAC,MAAM;YACpB,OAAO;gBACH,YAAY;gBACZ,QAAQ;gBACR,SAAS;YACb;QACJ;QAEA,MAAM,WAAW;QACjB,MAAM,MAAM,IAAI;QAEhB,mBAAmB;QACnB,IAAI,SAAS,UAAU,EAAE;YACrB,MAAM,YAAY,IAAI,KAAK,SAAS,UAAU;YAC9C,IAAI,MAAM,WAAW;gBACjB,OAAO;oBACH,YAAY;oBACZ,QAAQ;oBACR,SAAS,CAAC,qCAAqC,EAAE,UAAU,cAAc,IAAI;oBAC7E;gBACJ;YACJ;QACJ;QAEA,iBAAiB;QACjB,IAAI,SAAS,QAAQ,EAAE;YACnB,MAAM,UAAU,IAAI,KAAK,SAAS,QAAQ;YAC1C,IAAI,MAAM,SAAS;gBACf,OAAO;oBACH,YAAY;oBACZ,QAAQ;oBACR,SAAS,CAAC,mBAAmB,EAAE,QAAQ,cAAc,IAAI;oBACzD;gBACJ;YACJ;QACJ;QAEA,sDAAsD;QACtD,0CAA0C;QAC1C,MAAM,EAAE,MAAM,aAAa,EAAE,GAAG,MAAM,SACjC,IAAI,CAAC,WACL,MAAM,CAAC,uFACP,EAAE,CAAC,WAAW,QACd,EAAE,CAAC,gBAAgB,QACnB,KAAK,CAAC,GACN,WAAW;QAEhB,yEAAyE;QACzE,IAAI,CAAC,eAAe;YAChB,OAAO;gBACH,YAAY;gBACZ,QAAQ;YACZ;QACJ;QAEA,2EAA2E;QAC3E,iFAAiF;QACjF,IAAI,cAAc,yBAAyB,IACvC,cAAc,sBAAsB,IACpC,cAAc,sBAAsB,KAAK,cAAc,EAAE,EAAE;YAE3D,8CAA8C;YAC9C,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,WACL,MAAM,CAAC,sBACP,EAAE,CAAC,MAAM,cAAc,sBAAsB,EAC7C,MAAM;YAEX,IAAI,gBAAgB,aAAa,OAAO,EAAE;gBACtC,0FAA0F;gBAC1F,IAAI,aAAa,OAAO,KAAK,QAAQ;oBACjC,OAAO;wBACH,YAAY;wBACZ,QAAQ;oBACZ;gBACJ;gBAEA,mEAAmE;gBACnE,MAAM,EAAE,MAAM,oBAAoB,EAAE,GAAG,MAAM,SACxC,IAAI,CAAC,iBACL,MAAM,CAAC,cACP,EAAE,CAAC,WAAW,aAAa,OAAO,EAClC,EAAE,CAAC,cAAc,QACjB,EAAE,CAAC,UAAU;gBAElB,IAAI,CAAC,wBAAwB,qBAAqB,MAAM,KAAK,GAAG;oBAC5D,OAAO;wBACH,YAAY;wBACZ,QAAQ;wBACR,SAAS;wBACT,mBAAmB,aAAa,KAAK,IAAI;oBAC7C;gBACJ;YACJ;QACJ;QAEA,qBAAqB;QACrB,OAAO;YACH,YAAY;YACZ,QAAQ;QACZ;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,wDAAwD;QACxD,OAAO;YACH,YAAY;YACZ,QAAQ;QACZ;IACJ;AACJ"}},
    {"offset": {"line": 5088, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/hooks/useExamAccess.ts"],"sourcesContent":["import { useQuery } from \"@tanstack/react-query\";\r\nimport { checkExamAccess } from \"@/lib/examAccess\";\r\nimport { ExamAccessStatus } from \"@/components/ExamAccessChecker\";\r\n\r\n/**\r\n * Hook to check exam access with caching for instant subsequent loads\r\n * \r\n * First visit: Checks access and caches result (~50ms)\r\n * Return visits: Uses cached result (0ms instant)\r\n * \r\n * This eliminates loading spinner delays on exam navigation\r\n */\r\nexport function useExamAccess(examId: string, userId: string) {\r\n    return useQuery<ExamAccessStatus>({\r\n        queryKey: ['exam-access', examId, userId],\r\n        queryFn: () => checkExamAccess(examId, userId),\r\n        staleTime: 1000 * 60 * 5, // 5 minutes - access rules don't change often\r\n        gcTime: 1000 * 60 * 10,    // 10 minutes - keep in memory\r\n        retry: 1, // Fail fast\r\n        // Return cached data instantly while revalidating in background\r\n        refetchOnMount: false, // Don't refetch on component mount if data exists\r\n        refetchOnWindowFocus: false, // Don't refetch on window focus\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAWO,SAAS,cAAc,MAAc,EAAE,MAAc;IACxD,OAAO,IAAA,+LAAQ,EAAmB;QAC9B,UAAU;YAAC;YAAe;YAAQ;SAAO;QACzC,SAAS,IAAM,IAAA,4IAAe,EAAC,QAAQ;QACvC,WAAW,OAAO,KAAK;QACvB,QAAQ,OAAO,KAAK;QACpB,OAAO;QACP,gEAAgE;QAChE,gBAAgB;QAChB,sBAAsB;IAC1B;AACJ"}},
    {"offset": {"line": 5116, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/ExamAccessChecker.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState } from \"react\"\r\nimport { Lock, Clock, CheckCircle, AlertCircle, ExternalLink, AlertTriangle, ShieldCheck, Calendar, Info, CheckCircle2, BookOpen } from \"lucide-react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nexport interface ExamAccessStatus {\r\n    accessible: boolean\r\n    reason?: \"upcoming\" | \"expired\" | \"prerequisite\" | \"accessible\"\r\n    message?: string\r\n    startTime?: Date\r\n    endTime?: Date\r\n    prerequisiteTitle?: string\r\n}\r\n\r\ninterface ExamAccessCheckerProps {\r\n    status: ExamAccessStatus\r\n    onStartExam?: () => void\r\n    className?: string\r\n}\r\n\r\nexport function ExamAccessChecker({ status, onStartExam, className }: ExamAccessCheckerProps) {\r\n    const [countdown, setCountdown] = useState<string>(\"\")\r\n\r\n    // Countdown timer for upcoming exams\r\n    useEffect(() => {\r\n        if (status.reason === \"upcoming\" && status.startTime) {\r\n            const updateCountdown = () => {\r\n                const now = new Date()\r\n                const diff = status.startTime!.getTime() - now.getTime()\r\n\r\n                if (diff <= 0) {\r\n                    setCountdown(\"Starting now...\")\r\n                    // Refresh to update access status\r\n                    setTimeout(() => window.location.reload(), 1000)\r\n                    return\r\n                }\r\n\r\n                const days = Math.floor(diff / (1000 * 60 * 60 * 24))\r\n                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))\r\n                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))\r\n                const seconds = Math.floor((diff % (1000 * 60)) / 1000)\r\n\r\n                if (days > 0) {\r\n                    setCountdown(`${days}d ${hours}h ${minutes}m`)\r\n                } else if (hours > 0) {\r\n                    setCountdown(`${hours}h ${minutes}m ${seconds}s`)\r\n                } else if (minutes > 0) {\r\n                    setCountdown(`${minutes}m ${seconds}s`)\r\n                } else {\r\n                    setCountdown(`${seconds}s`)\r\n                }\r\n            }\r\n\r\n            updateCountdown()\r\n            const interval = setInterval(updateCountdown, 1000)\r\n            return () => clearInterval(interval)\r\n        }\r\n    }, [status.reason, status.startTime])\r\n\r\n    // 1. Ready to Start State\r\n    if (status.accessible) {\r\n        return (\r\n            <div className={cn(\"max-w-md mx-auto p-1 bg-white dark:bg-slate-900 rounded-[2rem] border border-green-100 dark:border-green-900/30 transition-all duration-300\", className)}>\r\n                <div className=\"p-6 sm:p-8 space-y-6\">\r\n                    <div className=\"flex items-center justify-center gap-2.5 px-4 py-1.5 rounded-full bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 text-[10px] font-black uppercase tracking-widest border border-green-100 dark:border-green-800/50 w-fit mx-auto\">\r\n                        <CheckCircle className=\"w-3.5 h-3.5\" />\r\n                        System Ready\r\n                    </div>\r\n\r\n                    <div className=\"text-center space-y-2\">\r\n                        <h3 className=\"text-2xl font-black text-slate-900 dark:text-white tracking-tight\">Exam is Ready</h3>\r\n                        <p className=\"text-sm text-slate-500 dark:text-slate-400 font-medium\">Your credentials have been verified. You may now enter the secure examination area.</p>\r\n                    </div>\r\n\r\n                    {onStartExam && (\r\n                        <Button\r\n                            onClick={onStartExam}\r\n                            className=\"w-full py-6 text-lg shadow-lg shadow-green-200 dark:shadow-none\"\r\n                            variant=\"ghost\"\r\n                            size=\"lg\"\r\n                        >\r\n                            Start Exam Now\r\n                        </Button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 2. Upcoming exam\r\n    if (status.reason === \"upcoming\") {\r\n        return (\r\n            <div className={cn(\"min-h-screen bg-slate-50 dark:bg-slate-950 p-4 flex items-center justify-center font-sans transition-colors duration-300\", className)}>\r\n                <div className=\"w-full max-w-2xl space-y-4 relative z-10\">\r\n\r\n                    <div className=\"bg-white dark:bg-slate-900 rounded-3xl p-6 sm:p-8 border border-slate-200 dark:border-slate-800 relative overflow-hidden transition-colors duration-300\">\r\n                        {/* Top Badge */}\r\n                        <div className=\"flex justify-center mb-6\">\r\n                            <div className=\"flex items-center gap-2 px-3 py-1 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 text-[10px] font-bold tracking-wider uppercase transition-colors\">\r\n                                <div className=\"relative flex h-1.5 w-1.5\">\r\n                                    <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75\"></span>\r\n                                    <span className=\"relative inline-flex rounded-full h-1.5 w-1.5 bg-amber-500\"></span>\r\n                                </div>\r\n                                Access Restricted\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"text-center mb-8 space-y-2\">\r\n                            <h3 className=\"text-2xl sm:text-3xl font-black text-slate-900 dark:text-white tracking-tight transition-colors\">\r\n                                Exam Not Yet Started\r\n                            </h3>\r\n                            <p className=\"text-slate-500 dark:text-slate-400 font-medium text-sm sm:text-base max-w-md mx-auto leading-relaxed transition-colors\">\r\n                                {status.message}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Compact Countdown Module */}\r\n                        {countdown && (\r\n                            <div className=\"relative mb-8\">\r\n                                <div className=\"bg-slate-50 dark:bg-slate-800/40 border border-slate-100 dark:border-slate-800 rounded-2xl p-6 text-center transition-colors\">\r\n                                    <div className=\"text-[9px] font-black uppercase tracking-[0.2em] text-indigo-600 dark:text-indigo-400 mb-2 transition-colors\">Launch Sequence In</div>\r\n                                    <div className=\"text-4xl sm:text-5xl font-mono font-bold tracking-tighter text-slate-900 dark:text-white tabular-nums transition-colors\">\r\n                                        {countdown}\r\n                                    </div>\r\n                                    <div className=\"flex justify-center gap-8 mt-2 text-[8px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-widest transition-colors\">\r\n                                        <span>Hours</span>\r\n                                        <span>Minutes</span>\r\n                                        <span>Seconds</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Detail Grid */}\r\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-8\">\r\n                            <div className=\"flex items-center gap-3 p-3 rounded-2xl bg-slate-50/50 dark:bg-slate-800/30 border border-slate-100 dark:border-slate-800/50 transition-colors\">\r\n                                <div className=\"flex-shrink-0 w-10 h-10 rounded-xl bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 flex items-center justify-center text-indigo-600 dark:text-indigo-400 transition-colors\">\r\n                                    <Calendar size={18} strokeWidth={2.5} />\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"text-[9px] text-slate-400 dark:text-slate-500 font-black uppercase tracking-wider transition-colors\">Scheduled Date</div>\r\n                                    <div className=\"text-sm font-bold text-slate-800 dark:text-slate-200 transition-colors\">\r\n                                        {status.startTime?.toLocaleString()}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-3 p-3 rounded-2xl bg-slate-50/50 dark:bg-slate-800/30 border border-slate-100 dark:border-slate-800/50 transition-colors\">\r\n                                <div className=\"flex-shrink-0 w-10 h-10 rounded-xl bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 flex items-center justify-center text-indigo-600 dark:text-indigo-400 transition-colors\">\r\n                                    <ShieldCheck size={18} strokeWidth={2.5} />\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"text-[9px] text-slate-400 dark:text-slate-500 font-black uppercase tracking-wider transition-colors\">Environment</div>\r\n                                    <div className=\"text-sm font-bold text-slate-800 dark:text-slate-200 transition-colors text-nowrap\">Secure Portal</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <Button\r\n                                disabled\r\n                                className=\"w-full py-5 text-base bg-slate-50 dark:bg-slate-800 text-slate-400 dark:text-slate-500 border border-slate-200 dark:border-slate-700 flex items-center justify-center gap-3 cursor-not-allowed transition-colors\"\r\n                            >\r\n                                <Lock size={18} strokeWidth={2.5} />\r\n                                Awaiting Scheduled Start\r\n                            </Button>\r\n\r\n                            <div className=\"flex items-center justify-center gap-2 text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-widest transition-colors\">\r\n                                <Info size={12} />\r\n                                Unlocks at {status.startTime?.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                        <div className=\"bg-white dark:bg-slate-900 rounded-3xl p-5 border border-slate-200 dark:border-slate-800 transition-colors\">\r\n                            <div className=\"flex items-center gap-2 mb-3\">\r\n                                <AlertTriangle size={16} className=\"text-amber-500\" />\r\n                                <h3 className=\"font-black text-slate-800 dark:text-slate-100 text-xs uppercase tracking-wider transition-colors\">Key Rules</h3>\r\n                            </div>\r\n                            <ul className=\"space-y-2\">\r\n                                {[\r\n                                    \"No external applications.\",\r\n                                    \"System clock must be synced.\",\r\n                                    \"120 minutes total duration.\"\r\n                                ].map((rule, i) => (\r\n                                    <li key={i} className=\"flex items-start gap-2 text-[11px] text-slate-600 dark:text-slate-400 font-medium transition-colors\">\r\n                                        <CheckCircle2 size={12} className=\"mt-0.5 text-slate-300 dark:text-slate-700 shrink-0 transition-colors\" />\r\n                                        {rule}\r\n                                    </li>\r\n                                ))}\r\n                            </ul>\r\n                        </div>\r\n\r\n                        <div className=\"bg-indigo-600 dark:bg-indigo-900 rounded-3xl p-6 text-white flex flex-col justify-between relative overflow-hidden transition-colors\">\r\n                            <div className=\"relative z-10\">\r\n                                <div className=\"flex justify-between items-start mb-1\">\r\n                                    <h3 className=\"font-black text-sm\">Need Help?</h3>\r\n                                    <ExternalLink size={16} className=\"text-indigo-200 opacity-60\" />\r\n                                </div>\r\n                                <p className=\"text-[10px] text-indigo-100 dark:text-indigo-200/80 font-medium leading-relaxed transition-colors\">\r\n                                    Support available 24/7 for troubleshooting.\r\n                                </p>\r\n                            </div>\r\n                            <button className=\"relative z-10 w-full mt-4 text-[10px] font-black uppercase tracking-widest bg-white text-indigo-600 hover:bg-indigo-50 dark:bg-indigo-800 dark:text-white dark:hover:bg-indigo-700 py-2.5 rounded-xl transition-all active:scale-95 shadow-sm border border-transparent dark:border-indigo-700/50\">\r\n                                Connect Support\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 3. Expired exam\r\n    if (status.reason === \"expired\") {\r\n        return (\r\n            <div className={cn(\"max-w-md mx-auto bg-white dark:bg-slate-900 rounded-[2.5rem] p-8 border border-amber-100 dark:border-amber-900/30 transition-all duration-300\", className)}>\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"flex justify-center\">\r\n                        <div className=\"flex items-center gap-2 px-4 py-1.5 rounded-full bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-400 text-[10px] font-black uppercase tracking-widest border border-amber-100 dark:border-amber-800/50\">\r\n                            <AlertCircle size={14} />\r\n                            Session Expired\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"text-center space-y-2\">\r\n                        <h3 className=\"text-2xl font-black text-slate-900 dark:text-white tracking-tight\">Exam Has Ended</h3>\r\n                        <p className=\"text-sm text-slate-500 dark:text-slate-400 font-medium leading-relaxed\">\r\n                            {status.message || \"This examination period has concluded and is no longer accepting submissions.\"}\r\n                        </p>\r\n                    </div>\r\n\r\n                    {status.endTime && (\r\n                        <div className=\"bg-slate-50 dark:bg-slate-800/50 rounded-2xl p-4 flex items-center justify-center gap-3 border border-slate-100 dark:border-slate-800\">\r\n                            <Clock className=\"w-4 h-4 text-slate-400\" />\r\n                            <span className=\"text-xs font-bold text-slate-500 dark:text-slate-400\">\r\n                                Closed on {status.endTime.toLocaleString([], { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}\r\n                            </span>\r\n                        </div>\r\n                    )}\r\n\r\n                    <Button\r\n                        disabled\r\n                        className=\"w-full py-5 bg-slate-100 dark:bg-slate-800 text-slate-400 dark:text-slate-500 border border-slate-200 dark:border-slate-700 cursor-not-allowed\"\r\n                        size=\"lg\"\r\n                    >\r\n                        <Lock className=\"w-4 h-4 mr-2\" />\r\n                        Exam Closed\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 4. Prerequisite locked\r\n    if (status.reason === \"prerequisite\") {\r\n        return (\r\n            <div className={cn(\"max-w-md mx-auto bg-white dark:bg-slate-900 rounded-[2.5rem] p-8 border border-purple-100 dark:border-purple-900/30 transition-all duration-300\", className)}>\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"flex justify-center\">\r\n                        <div className=\"flex items-center gap-2 px-4 py-1.5 rounded-full bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 text-[10px] font-black uppercase tracking-widest border border-purple-100 dark:border-purple-800/50\">\r\n                            <Lock size={14} />\r\n                            Prerequisite Required\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"text-center space-y-2\">\r\n                        <h3 className=\"text-2xl font-black text-slate-900 dark:text-white tracking-tight\">Access Locked</h3>\r\n                        <p className=\"text-sm text-slate-500 dark:text-slate-400 font-medium leading-relaxed\">\r\n                            {status.message || \"You must successfully complete the prerequisite assessment to unlock this exam.\"}\r\n                        </p>\r\n                    </div>\r\n\r\n                    {status.prerequisiteTitle && (\r\n                        <div className=\"p-4 rounded-2xl bg-purple-50/50 dark:bg-purple-900/10 border border-purple-100 dark:border-purple-900/20 flex items-start gap-4\">\r\n                            <div className=\"p-2 bg-white dark:bg-slate-800 rounded-lg shadow-sm\">\r\n                                <BookOpen size={18} className=\"text-purple-500\" />\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"text-[9px] font-black text-purple-400 uppercase tracking-widest mb-1\">Required Task</div>\r\n                                <div className=\"text-sm font-bold text-purple-900 dark:text-purple-100\">\r\n                                    {status.prerequisiteTitle}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <Button\r\n                        disabled\r\n                        className=\"w-full py-5 bg-slate-100 dark:bg-slate-800 text-slate-400 dark:text-slate-500 border border-slate-200 dark:border-slate-700 cursor-not-allowed\"\r\n                        size=\"lg\"\r\n                    >\r\n                        <Lock className=\"w-4 h-4 mr-2\" />\r\n                        Complete Task First\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Default locked state\r\n    return (\r\n        <div className={cn(\"space-y-4 p-6 rounded-xl border-2 border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950/30\", className)}>\r\n            <div className=\"flex items-start gap-3\">\r\n                <div className=\"p-2 rounded-lg bg-slate-100 dark:bg-slate-900/50\">\r\n                    <Lock className=\"w-6 h-6 text-slate-600 dark:text-slate-400\" />\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                    <h3 className=\"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-1\">\r\n                        Exam Locked\r\n                    </h3>\r\n                    <p className=\"text-sm text-slate-700 dark:text-slate-300\">\r\n                        {status.message || \"This exam is currently not accessible.\"}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n            <Button\r\n                disabled\r\n                className=\"w-full\"\r\n                size=\"lg\"\r\n            >\r\n                <Lock className=\"w-4 h-4 mr-2\" />\r\n                Exam Locked\r\n            </Button>\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6025, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/QuizPlayer.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { EmbeddedExam, PreviousResultView } from \"@/components/EmbeddedExam\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Clock, FileQuestion, ListChecks, Trophy, Play, RotateCcw, ChevronRight, History } from \"lucide-react\"\r\nimport { useQuery } from \"@tanstack/react-query\"\r\nimport { createClient } from \"@/lib/supabase/client\"\r\nimport { useExamAccess } from \"@/hooks/useExamAccess\"\r\nimport { ExamAccessChecker } from \"@/components/ExamAccessChecker\"\r\nimport { Loader2 } from \"lucide-react\"\r\n\r\ninterface QuizPlayerProps {\r\n    exam: {\r\n        id: string\r\n        title: string\r\n        duration_minutes: number\r\n        total_marks: number\r\n        description?: string\r\n        max_attempts?: number\r\n    }\r\n    attempts: any[]\r\n    userId: string\r\n    questionsCount: number\r\n    maxAttempts?: number\r\n}\r\n\r\nexport function QuizPlayer({ exam, attempts, userId, questionsCount, maxAttempts = 1 }: QuizPlayerProps) {\r\n    const [view, setView] = useState<\"landing\" | \"exam\" | \"result\">(\"landing\")\r\n    const [selectedAttempt, setSelectedAttempt] = useState<any>(null)\r\n\r\n    // âš¡ INSTANT CACHED ACCESS: Use React Query for access check\r\n    // First visit: Checks access (~50ms), caches result\r\n    // Return visits: Uses cached result (0ms instant!)\r\n    const { data: accessStatus, isPending: isCheckingAccess } = useExamAccess(exam.id, userId)\r\n\r\n    // Fetch attempts with React Query\r\n    const { data: attemptsData, refetch } = useQuery({\r\n        queryKey: [\"exam-attempts\", exam.id, userId],\r\n        queryFn: async () => {\r\n            const supabase = createClient()\r\n            const { data } = await supabase\r\n                .from(\"exam_attempts\")\r\n                .select(\"*, result:results(*)\")\r\n                .eq(\"exam_id\", exam.id)\r\n                .eq(\"student_id\", userId)\r\n                .order(\"created_at\", { ascending: false })\r\n            return data || []\r\n        },\r\n        initialData: attempts,\r\n        staleTime: 0,\r\n        refetchOnMount: true,\r\n        refetchOnWindowFocus: true\r\n    })\r\n\r\n    const completedAttempts = (attemptsData || []).filter((a: any) => a.status === 'submitted')\r\n    const limit = exam.max_attempts !== undefined ? exam.max_attempts : maxAttempts\r\n    const attemptsLeft = limit !== null && limit !== undefined ? Math.max(0, limit - completedAttempts.length) : Infinity\r\n    const activeAttempt = (attemptsData || []).find((a: any) => a.status !== 'submitted')\r\n    const hasAttempted = completedAttempts.length > 0 || !!activeAttempt\r\n\r\n    const handleStart = () => {\r\n        setView(\"exam\")\r\n    }\r\n\r\n    const handleViewResult = (attempt: any) => {\r\n        setSelectedAttempt(attempt)\r\n        setView(\"result\")\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (view === \"landing\") {\r\n            refetch()\r\n        }\r\n    }, [view, refetch])\r\n\r\n    // âš¡ INSTANT STATE: Show skeleton ONLY while checking access for first time\r\n    // Cached access status returns instantly (0ms), no spinner!\r\n    if (isCheckingAccess && !accessStatus) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    // Access denied / locked state\r\n    if (accessStatus && !accessStatus.accessible) {\r\n        return (\r\n\r\n            <ExamAccessChecker status={accessStatus} />\r\n\r\n        )\r\n    }\r\n\r\n    if (view === \"exam\") {\r\n        return <EmbeddedExam examId={exam.id} onExit={() => setView(\"landing\")} isRetake={hasAttempted && !activeAttempt} />\r\n    }\r\n\r\n    if (view === \"result\") {\r\n        return (\r\n            <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    onClick={() => setView(\"landing\")}\r\n                    className=\"pl-0 hover:pl-2 transition-all gap-2\"\r\n                >\r\n                    <ChevronRight className=\"h-4 w-4 rotate-180\" /> Back to Quiz Overview\r\n                </Button>\r\n                <div className=\"rounded-xl overflow-hidden border border-border shadow-sm\">\r\n                    <PreviousResultView\r\n                        examId={exam.id}\r\n                        userId={userId}\r\n                        onRetake={() => setView(\"exam\")}\r\n                        attemptId={selectedAttempt?.id}\r\n                        initialResult={selectedAttempt?.result}\r\n                    />\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-6xl mx-auto bg-app transition-theme\">\r\n            {/* Main Info Card with watercolor effect */}\r\n            <div className=\"lg:col-span-2 relative\">\r\n                <Card className=\"relative border-none border-border shadow-xl bg-card overflow-hidden z-10 transition-theme\">\r\n                    <CardHeader className=\"pb-2 pt-8 text-center\">\r\n                        <CardTitle className=\"text-4xl font-serif font-medium mb-3 tracking-wide text-foreground\">\r\n                            {exam.title}\r\n                        </CardTitle>\r\n                        <CardDescription className=\"text-base text-muted-foreground max-w-xl mx-auto\">\r\n                            {exam.description || 'This exam covers the comprehensive syllabus including Algebra, Calculus, and more.'}\r\n                        </CardDescription>\r\n                    </CardHeader>\r\n\r\n                    <CardContent className=\"space-y-10 px-6 py-8\">\r\n                        {/* Stats Grid */}\r\n                        <div className=\"grid grid-cols-3 gap-4 md:gap-6\">\r\n                            {/* Questions */}\r\n                            <div className=\"p-4 py-8 rounded-xl border border-border flex flex-col items-center justify-center text-center shadow-sm transition-theme\"\r\n                                style={{\r\n                                    background: 'linear-gradient(180deg, rgba(59,130,246,0.06), transparent)',\r\n                                }}>\r\n                                <div className=\"p-2.5 rounded-full mb-3\" style={{ background: 'rgba(59,130,246,0.12)' }}>\r\n                                    <FileQuestion className=\"w-6 h-6 text-blue-700 dark:text-blue-300\" />\r\n                                </div>\r\n                                <span className=\"text-2xl font-bold text-foreground min-w-[2ch]\">{questionsCount}</span>\r\n                                <span className=\"text-[10px] md:text-xs text-muted-foreground font-bold uppercase tracking-widest mt-1\">\r\n                                    Questions\r\n                                </span>\r\n                            </div>\r\n\r\n                            {/* Duration */}\r\n                            <div className=\"p-4 py-8 rounded-xl border border-border flex flex-col items-center justify-center text-center shadow-sm transition-theme\"\r\n                                style={{\r\n                                    background: 'linear-gradient(180deg, rgba(249,115,22,0.06), transparent)',\r\n                                }}>\r\n                                <div className=\"p-2.5 rounded-full mb-3\" style={{ background: 'rgba(249,115,22,0.12)' }}>\r\n                                    <Clock className=\"w-6 h-6 text-orange-700 dark:text-orange-300\" />\r\n                                </div>\r\n                                <span className=\"text-2xl font-bold text-foreground min-w-[2ch]\">{exam.duration_minutes ?? 0}m</span>\r\n                                <span className=\"text-[10px] md:text-xs text-muted-foreground font-bold uppercase tracking-widest mt-1\">\r\n                                    Duration\r\n                                </span>\r\n                            </div>\r\n\r\n                            {/* Attempts */}\r\n                            <div className=\"p-4 py-8 rounded-xl border border-border flex flex-col items-center justify-center text-center shadow-sm transition-theme\"\r\n                                style={{\r\n                                    background: 'linear-gradient(180deg, rgba(16,185,129,0.06), transparent)',\r\n                                }}>\r\n                                <div className=\"p-2.5 rounded-full mb-3\" style={{ background: 'rgba(16,185,129,0.12)' }}>\r\n                                    <ListChecks className=\"w-6 h-6 text-emerald-700 dark:text-emerald-300\" />\r\n                                </div>\r\n                                <span className=\"text-2xl font-bold text-foreground min-w-[2ch]\">\r\n                                    {limit === null || limit === undefined ? 'âˆž' : attemptsLeft}\r\n                                </span>\r\n                                <span className=\"text-[10px] md:text-xs text-muted-foreground font-bold uppercase tracking-widest mt-1\">\r\n                                    Attempts Left\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </CardContent>\r\n\r\n                    <CardFooter className=\"pb-8 px-6\">\r\n                        {(limit === null || limit === undefined || attemptsLeft > 0 || activeAttempt) ? (\r\n                            <Button\r\n                                onClick={handleStart}\r\n                                size=\"lg\"\r\n                                className=\"w-full text-base font-bold uppercase tracking-wider py-6 bg-linear-to-r from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600 text-white shadow-lg shadow-orange-500/20 border-0 rounded-lg transition-all transform hover:scale-[1.01]\"\r\n                            >\r\n                                {activeAttempt ? (\r\n                                    <>\r\n                                        <Play className=\"w-5 h-5 mr-2\" /> Resume Quiz\r\n                                    </>\r\n                                ) : hasAttempted ? (\r\n                                    <>\r\n                                        <RotateCcw className=\"w-5 h-5 mr-2\" /> Retake Quiz\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <Play className=\"w-5 h-5 mr-2\" /> Start Quiz\r\n                                    </>\r\n                                )}\r\n                            </Button>\r\n                        ) : (\r\n                            <Button disabled size=\"lg\" className=\"w-full py-6 text-base uppercase font-bold tracking-wider\">\r\n                                No Attempts Remaining\r\n                            </Button>\r\n                        )}\r\n                    </CardFooter>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Sidebar / History */}\r\n            <div className=\"space-y-6\">\r\n                <Card className=\"border-none border-border shadow-md bg-card h-full min-h-[400px] transition-theme\">\r\n                    <CardHeader className=\"pb-4 border-b border-border/50\">\r\n                        <CardTitle className=\"text-xl font-serif tracking-wide text-foreground flex items-center gap-2\">\r\n                            HISTORY\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n\r\n                    <CardContent className=\"pt-6 relative\">\r\n                        {/* Decorative Top Accent */}\r\n                        <div className=\"absolute top-0 left-0 right-0 h-1 bg-linear-to-r from-blue-500 via-purple-500 to-pink-500\" />\r\n\r\n                        {/* Timeline Line */}\r\n                        <div className=\"absolute left-[38px] top-6 bottom-6 w-0.5 bg-border z-0\" />\r\n\r\n                        <div className=\"space-y-6 relative z-10\">\r\n                            {(completedAttempts.length === 0 && !activeAttempt) && (\r\n                                <p className=\"text-sm text-muted-foreground pl-4\">No history yet.</p>\r\n                            )}\r\n\r\n                            {activeAttempt && (\r\n                                <div className=\"flex gap-4 items-start group\">\r\n                                    <div className=\"w-4 h-4 rounded-full bg-orange-500 border-4 border-orange-100 dark:border-orange-900 mt-1 relative z-10 shadow-sm\" />\r\n                                    <div className=\"flex-1 -mt-0.5\">\r\n                                        <div className=\"flex justify-between items-start\">\r\n                                            <h4 className=\"font-bold text-sm text-foreground\">In Progress</h4>\r\n                                            <span className=\"text-xs text-muted-foreground whitespace-nowrap\">Just now</span>\r\n                                        </div>\r\n                                        <p className=\"text-xs font-medium text-muted-foreground mt-1\">Attempt #{completedAttempts.length + 1}</p>\r\n                                        <Button\r\n                                            variant=\"link\"\r\n                                            onClick={handleStart}\r\n                                            className=\"p-0 h-auto text-xs text-orange-600 font-semibold mt-1 hover:text-orange-700\"\r\n                                        >\r\n                                            Resume\r\n                                        </Button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {completedAttempts.map((attempt: any, idx: number) => {\r\n                                const result = Array.isArray(attempt.result) ? attempt.result[0] : attempt.result;\r\n                                const score = result?.score ?? result?.obtained_marks ?? 0;\r\n                                return (\r\n                                    <div key={attempt.id} className=\"flex gap-4 items-start group\">\r\n                                        <div className=\"w-3 h-3 rounded-full bg-muted-foreground/30 group-hover:bg-primary transition-colors mt-1.5 relative z-10\" />\r\n                                        <div className=\"flex-1 -mt-0.5\">\r\n                                            <div className=\"flex justify-between items-start\">\r\n                                                <h4 className=\"font-semibold text-sm text-foreground group-hover:text-primary transition-colors\">\r\n                                                    Attempt #{completedAttempts.length - idx}\r\n                                                </h4>\r\n                                                <span className=\"text-xs text-muted-foreground font-bold\">\r\n                                                    {score}/{exam.total_marks ?? '-'}\r\n                                                </span>\r\n                                            </div>\r\n\r\n                                            <div className=\"flex justify-between items-center mt-1\">\r\n                                                <span className=\"text-xs text-muted-foreground\">\r\n                                                    {attempt.submitted_at ? new Date(attempt.submitted_at).toLocaleDateString() : '-'}\r\n                                                </span>\r\n                                                <Button\r\n                                                    size=\"sm\"\r\n                                                    variant=\"ghost\"\r\n                                                    className=\"h-6 px-2 text-[10px] uppercase font-bold tracking-wider opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                                    onClick={() => handleViewResult(attempt)}\r\n                                                >\r\n                                                    View Result\r\n                                                </Button>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6689, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/CustomPDFViewer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Download, ZoomIn, ZoomOut, Maximize2, Minimize2 } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\ninterface CustomPDFViewerProps {\r\n    url: string;\r\n    title?: string;\r\n    // keep flag but you should pass false if you want to block download\r\n    allowDownload?: boolean;\r\n}\r\n\r\nexport default function CustomPDFViewer({\r\n    url,\r\n    title,\r\n    allowDownload = false,\r\n}: CustomPDFViewerProps) {\r\n    const [scale, setScale] = useState<number>(1);\r\n    const [isFullscreen, setIsFullscreen] = useState(false);\r\n\r\n    // ðŸ”’ Block Ctrl+P / Cmd+P and PrintScreen (best-effort)\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            // Ctrl+P / Cmd+P\r\n            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === \"p\") {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                alert(\"Printing is disabled for this protected document.\");\r\n            }\r\n\r\n            // PrintScreen key (some browsers will still ignore this)\r\n            if (e.key === \"PrintScreen\") {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                // Optional: you could also briefly hide content here\r\n            }\r\n        };\r\n\r\n        window.addEventListener(\"keydown\", handleKeyDown);\r\n        return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n    }, []);\r\n\r\n    const handleDownload = () => {\r\n        if (allowDownload && url) {\r\n            window.open(url, \"_blank\");\r\n        }\r\n    };\r\n\r\n    const zoomOut = () => setScale((prev) => Math.max(prev - 0.1, 0.5));\r\n    const zoomIn = () => setScale((prev) => Math.min(prev + 0.2, 2));\r\n    const toggleFullscreen = () => setIsFullscreen((prev) => !prev);\r\n\r\n    return (\r\n        <div\r\n            id=\"protected-pdf-viewer\"\r\n            className={\r\n                \"flex flex-col gap-4 w-full transition-all duration-300 \" +\r\n                (isFullscreen\r\n                    ? \"fixed inset-0 z-[100] bg-slate-900/90 p-4 md:p-6\"\r\n                    : \"\")\r\n            }\r\n            // ðŸ”’ Block right-click on our app area\r\n            onContextMenu={(e) => e.preventDefault()}\r\n        >\r\n            {/* Header */}\r\n            <div className=\"flex flex-wrap items-center justify-between gap-3\">\r\n                <div className=\"flex flex-col\">\r\n                    {title && (\r\n                        <h2 className=\"text-base md:text-lg font-semibold tracking-tight\">\r\n                            {title}\r\n                        </h2>\r\n                    )}\r\n                    <p className=\"text-xs md:text-sm text-muted-foreground\">\r\n                        Secured PDF viewer â€¢ Watermarked by{\" \"}\r\n                        <span className=\"font-semibold\">math4code</span>\r\n                    </p>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                    {/* Zoom Controls */}\r\n                    <div className=\"flex items-center gap-1 rounded-md border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 px-2 py-1\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"icon\"\r\n                            className=\"h-7 w-7\"\r\n                            onClick={zoomOut}\r\n                        >\r\n                            <ZoomOut className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        <span className=\"text-xs font-medium w-10 text-center\">\r\n                            {Math.round(scale * 100)}%\r\n                        </span>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"icon\"\r\n                            className=\"h-7 w-7\"\r\n                            onClick={zoomIn}\r\n                        >\r\n                            <ZoomIn className=\"h-4 w-4\" />\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {/* Fullscreen toggle */}\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"icon\"\r\n                        className=\"h-8 w-8\"\r\n                        onClick={toggleFullscreen}\r\n                    >\r\n                        {isFullscreen ? (\r\n                            <Minimize2 className=\"h-4 w-4\" />\r\n                        ) : (\r\n                            <Maximize2 className=\"h-4 w-4\" />\r\n                        )}\r\n                    </Button>\r\n\r\n                    {/* Download button â€“ only if you REALLY want to allow it */}\r\n                    {allowDownload && (\r\n                        <Button\r\n                            variant=\"secondary\"\r\n                            size=\"sm\"\r\n                            className=\"gap-1\"\r\n                            onClick={handleDownload}\r\n                        >\r\n                            <Download className=\"h-4 w-4\" />\r\n                            <span className=\"hidden sm:inline\">Download</span>\r\n                        </Button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Viewer container */}\r\n            <div\r\n                className={\r\n                    \"relative w-full rounded-2xl border border-slate-200 dark:border-slate-800 bg-slate-100/70 dark:bg-slate-950/70 overflow-hidden \" +\r\n                    (isFullscreen ? \"flex-1\" : \"min-h-[450px] md:min-h-[550px]\")\r\n                }\r\n            >\r\n                {/* Background gradient */}\r\n                <div className=\"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(59,130,246,0.12),_transparent_60%),_radial-gradient(circle_at_bottom,_rgba(56,189,248,0.10),_transparent_55%)]\" />\r\n\r\n                {/* PDF viewport with scaling */}\r\n                <div className=\"relative w-full h-full flex items-center justify-center overflow-auto p-4 md:p-6\">\r\n                    <div\r\n                        className=\"relative shadow-2xl rounded-lg overflow-hidden bg-white origin-top\"\r\n                        style={{\r\n                            transform: `scale(${scale})`,\r\n                            transformOrigin: \"top center\",\r\n                            minWidth: \"70%\",\r\n                        }}\r\n                    >\r\n                        {/* The actual PDF, via iframe */}\r\n                        <iframe\r\n                            // toolbar=0 & navpanes=0 -> hides default PDF viewer UI (download/print buttons)\r\n                            src={`${url}#toolbar=0&navpanes=0&scrollbar=1`}\r\n                            className=\"w-[800px] max-w-full h-[1000px] border-none\"\r\n                            title={title ?? \"PDF Document\"}\r\n                        />\r\n\r\n                        {/* Watermark overlay */}\r\n                        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\r\n                            <div className=\"absolute inset-0 opacity-[0.11]\">\r\n                                <div className=\"w-full h-full bg-[radial-gradient(circle_at_center,_rgba(15,23,42,0.08),_transparent_60%)]\" />\r\n                            </div>\r\n\r\n                            {/* Big diagonal brand text */}\r\n                            <div className=\"absolute inset-0 flex items-center justify-center overflow-hidden\">\r\n                                <div className=\"text-5xl md:text-7xl font-extrabold tracking-[0.3em] uppercase text-slate-900/5 dark:text-white/5 -rotate-30 select-none\">\r\n                                    math4code\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Repeated small watermarks */}\r\n                            <div className=\"absolute inset-4 grid grid-cols-3 grid-rows-3 gap-6 opacity-30\">\r\n                                {Array.from({ length: 9 }).map((_, i) => (\r\n                                    <div\r\n                                        key={i}\r\n                                        className=\"flex items-center justify-center rotate-[-18deg]\"\r\n                                    >\r\n                                        <span className=\"text-xs md:text-sm font-semibold tracking-widest text-slate-500/70\">\r\n                                            math4code â€¢ do not share\r\n                                        </span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Bottom subtle bar */}\r\n                <div className=\"absolute bottom-0 inset-x-0 h-8 bg-linear-to-t from-slate-950/40 to-transparent pointer-events-none\" />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7027, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/ui/skeleton.tsx"],"sourcesContent":["import { cn } from '@/lib/utils'\r\n\r\nfunction Skeleton({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"skeleton\"\r\n      className={cn('bg-accent animate-pulse rounded-md', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Skeleton }\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAEA,SAAS,SAAS,EAAE,SAAS,EAAE,GAAG,OAAoC;IACpE,qBACE,kMAAC;QACC,aAAU;QACV,WAAW,IAAA,0HAAE,EAAC,sCAAsC;QACnD,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 7051, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/skeletons/LessonSkeletons.tsx"],"sourcesContent":["\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\n\r\nexport function VideoSkeleton() {\r\n    return (\r\n        <div className=\"flex-1 flex flex-col min-h-0 bg-background animate-in fade-in duration-300\">\r\n            {/* Video Placeholder */}\r\n            <div className=\"w-full bg-black/5 relative shadow-sm z-20 shrink-0\">\r\n                <div className=\"w-full h-auto aspect-video max-h-[70vh] mx-auto bg-muted/50 flex items-center justify-center\">\r\n                    <Skeleton className=\"w-16 h-16 rounded-full opacity-20\" />\r\n                </div>\r\n            </div>\r\n            {/* Tabs & Content */}\r\n            <div className=\"flex-1 bg-background\">\r\n                <div className=\"max-w-7xl mx-auto px-4 md:px-6 py-6 space-y-8\">\r\n                    <div className=\"flex gap-2 mb-6\">\r\n                        <Skeleton className=\"h-9 w-24 rounded-md\" />\r\n                        <Skeleton className=\"h-9 w-24 rounded-md\" />\r\n                        <Skeleton className=\"h-9 w-24 rounded-md\" />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                        <div className=\"lg:col-span-2 space-y-4\">\r\n                            <Skeleton className=\"h-6 w-48 mb-4\" />\r\n                            <Skeleton className=\"h-4 w-full\" />\r\n                            <Skeleton className=\"h-4 w-[90%]\" />\r\n                            <Skeleton className=\"h-4 w-[95%]\" />\r\n                        </div>\r\n                        <div className=\"space-y-4\">\r\n                            <Skeleton className=\"h-32 w-full rounded-xl\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function QuizSkeleton() {\r\n    return (\r\n        <div className=\"flex-1 flex flex-col min-h-0 bg-slate-50 dark:bg-background animate-in fade-in duration-300\">\r\n            <div className=\"relative z-10 max-w-6xl mx-auto px-4 md:px-8 py-8 md:py-12 w-full\">\r\n                <div className=\"bg-white/90 dark:bg-card/90 backdrop-blur-sm rounded-3xl shadow-xl shadow-slate-200/60 dark:shadow-none border border-slate-200/80 dark:border-border overflow-hidden h-[600px] flex flex-col\">\r\n                    <div className=\"h-2 bg-muted w-full\" />\r\n                    <div className=\"p-8 flex-1 flex flex-col\">\r\n                        <div className=\"flex justify-between items-center mb-8\">\r\n                            <Skeleton className=\"h-8 w-64 rounded-lg\" />\r\n                            <Skeleton className=\"h-10 w-32 rounded-lg\" />\r\n                        </div>\r\n                        <div className=\"flex gap-6 h-full\">\r\n                            {/* Question Area */}\r\n                            <div className=\"flex-1 space-y-6\">\r\n                                <Skeleton className=\"h-24 w-full rounded-xl\" />\r\n                                <div className=\"space-y-3\">\r\n                                    <Skeleton className=\"h-14 w-full rounded-lg\" />\r\n                                    <Skeleton className=\"h-14 w-full rounded-lg\" />\r\n                                    <Skeleton className=\"h-14 w-full rounded-lg\" />\r\n                                    <Skeleton className=\"h-14 w-full rounded-lg\" />\r\n                                </div>\r\n                            </div>\r\n                            {/* Sidebar Area */}\r\n                            <div className=\"w-72 hidden lg:block space-y-4\">\r\n                                <Skeleton className=\"h-full w-full rounded-xl\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function TextSkeleton() {\r\n    return (\r\n        <div className=\"flex-1 flex flex-col min-h-0 bg-background animate-in fade-in duration-300\">\r\n            <div className=\"w-full max-w-4xl mx-auto p-6 md:p-10 space-y-12\">\r\n                <div className=\"space-y-4 text-center border-b border-border pb-8\">\r\n                    <Skeleton className=\"h-6 w-24 rounded-full mx-auto\" />\r\n                    <Skeleton className=\"h-12 w-3/4 mx-auto\" />\r\n                    <div className=\"flex justify-center gap-4\">\r\n                        <Skeleton className=\"h-4 w-32\" />\r\n                        <Skeleton className=\"h-4 w-20\" />\r\n                    </div>\r\n                </div>\r\n                <div className=\"space-y-6\">\r\n                    <Skeleton className=\"h-4 w-full\" />\r\n                    <Skeleton className=\"h-4 w-[98%]\" />\r\n                    <Skeleton className=\"h-4 w-[95%]\" />\r\n                    <Skeleton className=\"h-4 w-[90%]\" />\r\n                    <Skeleton className=\"h-4 w-[92%]\" />\r\n                    <div className=\"py-4\">\r\n                        <Skeleton className=\"h-64 w-full rounded-xl\" />\r\n                    </div>\r\n                    <Skeleton className=\"h-4 w-full\" />\r\n                    <Skeleton className=\"h-4 w-[96%]\" />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;AACA;;;AAEO,SAAS;IACZ,qBACI,kMAAC;QAAI,WAAU;;0BAEX,kMAAC;gBAAI,WAAU;0BACX,cAAA,kMAAC;oBAAI,WAAU;8BACX,cAAA,kMAAC,iJAAQ;wBAAC,WAAU;;;;;;;;;;;;;;;;0BAI5B,kMAAC;gBAAI,WAAU;0BACX,cAAA,kMAAC;oBAAI,WAAU;;sCACX,kMAAC;4BAAI,WAAU;;8CACX,kMAAC,iJAAQ;oCAAC,WAAU;;;;;;8CACpB,kMAAC,iJAAQ;oCAAC,WAAU;;;;;;8CACpB,kMAAC,iJAAQ;oCAAC,WAAU;;;;;;;;;;;;sCAExB,kMAAC;4BAAI,WAAU;;8CACX,kMAAC;oCAAI,WAAU;;sDACX,kMAAC,iJAAQ;4CAAC,WAAU;;;;;;sDACpB,kMAAC,iJAAQ;4CAAC,WAAU;;;;;;sDACpB,kMAAC,iJAAQ;4CAAC,WAAU;;;;;;sDACpB,kMAAC,iJAAQ;4CAAC,WAAU;;;;;;;;;;;;8CAExB,kMAAC;oCAAI,WAAU;8CACX,cAAA,kMAAC,iJAAQ;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOhD;AAEO,SAAS;IACZ,qBACI,kMAAC;QAAI,WAAU;kBACX,cAAA,kMAAC;YAAI,WAAU;sBACX,cAAA,kMAAC;gBAAI,WAAU;;kCACX,kMAAC;wBAAI,WAAU;;;;;;kCACf,kMAAC;wBAAI,WAAU;;0CACX,kMAAC;gCAAI,WAAU;;kDACX,kMAAC,iJAAQ;wCAAC,WAAU;;;;;;kDACpB,kMAAC,iJAAQ;wCAAC,WAAU;;;;;;;;;;;;0CAExB,kMAAC;gCAAI,WAAU;;kDAEX,kMAAC;wCAAI,WAAU;;0DACX,kMAAC,iJAAQ;gDAAC,WAAU;;;;;;0DACpB,kMAAC;gDAAI,WAAU;;kEACX,kMAAC,iJAAQ;wDAAC,WAAU;;;;;;kEACpB,kMAAC,iJAAQ;wDAAC,WAAU;;;;;;kEACpB,kMAAC,iJAAQ;wDAAC,WAAU;;;;;;kEACpB,kMAAC,iJAAQ;wDAAC,WAAU;;;;;;;;;;;;;;;;;;kDAI5B,kMAAC;wCAAI,WAAU;kDACX,cAAA,kMAAC,iJAAQ;4CAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQpD;AAEO,SAAS;IACZ,qBACI,kMAAC;QAAI,WAAU;kBACX,cAAA,kMAAC;YAAI,WAAU;;8BACX,kMAAC;oBAAI,WAAU;;sCACX,kMAAC,iJAAQ;4BAAC,WAAU;;;;;;sCACpB,kMAAC,iJAAQ;4BAAC,WAAU;;;;;;sCACpB,kMAAC;4BAAI,WAAU;;8CACX,kMAAC,iJAAQ;oCAAC,WAAU;;;;;;8CACpB,kMAAC,iJAAQ;oCAAC,WAAU;;;;;;;;;;;;;;;;;;8BAG5B,kMAAC;oBAAI,WAAU;;sCACX,kMAAC,iJAAQ;4BAAC,WAAU;;;;;;sCACpB,kMAAC,iJAAQ;4BAAC,WAAU;;;;;;sCACpB,kMAAC,iJAAQ;4BAAC,WAAU;;;;;;sCACpB,kMAAC,iJAAQ;4BAAC,WAAU;;;;;;sCACpB,kMAAC,iJAAQ;4BAAC,WAAU;;;;;;sCACpB,kMAAC;4BAAI,WAAU;sCACX,cAAA,kMAAC,iJAAQ;gCAAC,WAAU;;;;;;;;;;;sCAExB,kMAAC,iJAAQ;4BAAC,WAAU;;;;;;sCACpB,kMAAC,iJAAQ;4BAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;AAKxC"}},
    {"offset": {"line": 7481, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/lesson/LessonContentClient.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useLessonData } from \"@/hooks/useLessonData\";\r\nimport { PlayCircle, FileText, Users, Clock, Target, Zap, CheckCircle, Sparkles, RefreshCw } from \"lucide-react\";\r\nimport VideoPlayer from \"@/components/VideoPlayer\";\r\nimport { BunnyPlayer } from \"@/components/BunnyPlayer\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { QuizPlayer } from \"@/components/QuizPlayer\";\r\nimport CustomPDFViewer from \"@/components/CustomPDFViewer\";\r\nimport { CommunityButton } from \"@/components/CommunityButton\";\r\nimport { QuizSkeleton, VideoSkeleton, TextSkeleton } from \"@/components/skeletons/LessonSkeletons\";\r\n\r\nexport default function LessonContentClient({\r\n    lessonId,\r\n    courseId,\r\n    user,\r\n    contentType // Optional: Use for showing specific skeleton\r\n}: {\r\n    lessonId: string;\r\n    courseId: string;\r\n    user: any;\r\n    contentType?: 'video' | 'quiz' | 'text' | 'pdf';\r\n}) {\r\n    // âš¡ GUARD: Prevent query with invalid lessonId\r\n    // Show skeleton while parent component determines the correct lesson\r\n    if (!lessonId) {\r\n        if (contentType === 'video') return <VideoSkeleton />;\r\n        if (contentType === 'quiz') return <QuizSkeleton />;\r\n        return <TextSkeleton />;\r\n    }\r\n\r\n    // âš¡ CRITICAL: Use isPending AND check for data existence\r\n    // isPending = true only on FIRST load (no data at all)\r\n    // isLoading = true even when showing placeholder data\r\n    // This ensures we show previous lesson instantly while fetching new one\r\n    const { data: fullData, isPending, isError, isFetching } = useLessonData(lessonId, courseId);\r\n\r\n    // Only show skeleton if BOTH conditions are true:\r\n    // 1. isPending (no query has run yet)\r\n    // 2. No data exists (not even placeholder/cached data)\r\n    if (isPending && !fullData) {\r\n        if (contentType === 'video') return <VideoSkeleton />;\r\n        if (contentType === 'quiz') return <QuizSkeleton />;\r\n        return <TextSkeleton />;\r\n    }\r\n\r\n    if (isError || !fullData || fullData.error) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center h-full p-8 text-center animate-in fade-in\">\r\n                <div className=\"bg-destructive/10 border border-destructive/20 p-8 rounded-2xl shadow-sm max-w-md\">\r\n                    <h3 className=\"text-xl font-bold mb-2 text-destructive\">Failed to Load Content</h3>\r\n                    <p className=\"text-muted-foreground mb-6\">We couldn't load the lesson content. Please try again.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const { lesson, exam, attempts, questionsCount, author } = fullData;\r\n    const isQuiz = lesson.content_type === \"quiz\";\r\n    const isVideo = lesson.content_type === \"video\";\r\n    const isPdf = lesson.content_type === \"pdf\";\r\n    const isText = lesson.content_type === \"text\";\r\n\r\n\r\n    // âš¡ INSTANT TRANSITIONS: Detect stale data from keepPreviousData\r\n    // When navigating Lesson 1 â†’ Lesson 2, fullData still contains Lesson 1 briefly\r\n    // Show skeleton instead of wrong content for instant, correct display\r\n\r\n    // Check for stale data for ALL lesson types\r\n    if (lesson.id !== lessonId) {\r\n        if (isQuiz) return <QuizSkeleton />;\r\n        if (isVideo) return <VideoSkeleton />;\r\n        // PDF and text both use TextSkeleton\r\n        if (isPdf || isText) return <TextSkeleton />;\r\n    }\r\n\r\n    if (isVideo) {\r\n        return (\r\n            <div className=\"flex-1 flex flex-col min-h-0 overflow-y-auto bg-background animate-in fade-in slide-in-from-right-4 duration-500\">\r\n                {/* Video Section */}\r\n                <div className=\"w-full bg-black relative shadow-lg z-20 shrink-0\">\r\n                    <div className=\"w-full h-auto aspect-video max-h-[70vh] mx-auto bg-black flex items-center justify-center\">\r\n                        {lesson.content_url || lesson.bunny_video_id || lesson.bunny_stream_id ? (\r\n                            <>\r\n                                {lesson.video_provider === 'bunny' && (lesson.bunny_video_id || lesson.bunny_stream_id) ? (\r\n                                    <BunnyPlayer\r\n                                        videoId={lesson.bunny_video_id || lesson.bunny_stream_id || ''}\r\n                                        libraryId={lesson.bunny_library_id || ''}\r\n                                        videoType={lesson.video_type || 'vod'}\r\n                                        videoStatus={lesson.video_status}\r\n                                        className=\"w-full h-full\"\r\n                                    />\r\n                                ) : (\r\n                                    <VideoPlayer url={lesson.content_url} />\r\n                                )}\r\n                            </>\r\n                        ) : (\r\n                            <div className=\"flex flex-col items-center justify-center text-white/50\">\r\n                                <PlayCircle className=\"h-16 w-16 mb-2 opacity-50\" />\r\n                                <span className=\"text-sm\">Video content unavailable</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Tabs & Details */}\r\n                <div className=\"flex-1 bg-background\">\r\n                    <div className=\"max-w-7xl mx-auto px-4 md:px-6 py-6\">\r\n                        <Tabs defaultValue=\"overview\" className=\"w-full\">\r\n                            <TabsList className=\"bg-muted/50 p-1 h-auto rounded-lg mb-6 inline-flex flex-wrap gap-1\">\r\n                                <TabsTrigger value=\"overview\" className=\"px-4 py-1.5 text-sm rounded-md font-medium data-[state=active]:bg-background data-[state=active]:shadow-sm\">Overview</TabsTrigger>\r\n                                <TabsTrigger value=\"resources\" className=\"px-4 py-1.5 text-sm rounded-md font-medium data-[state=active]:bg-background data-[state=active]:shadow-sm\">Resources</TabsTrigger>\r\n                                <TabsTrigger value=\"discussion\" className=\"px-4 py-1.5 text-sm rounded-md font-medium data-[state=active]:bg-background data-[state=active]:shadow-sm\">Discussion</TabsTrigger>\r\n                            </TabsList>\r\n\r\n                            <TabsContent value=\"overview\" className=\"space-y-8 animate-in fade-in-50 duration-300\">\r\n                                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                                    <div className=\"lg:col-span-2 space-y-6\">\r\n                                        <div className=\"prose dark:prose-invert max-w-none\">\r\n                                            <h3 className=\"text-lg font-semibold mb-2\">About this lesson</h3>\r\n                                            {lesson.description ? (\r\n                                                <p className=\"text-muted-foreground leading-relaxed\">\r\n                                                    {lesson.description}\r\n                                                </p>\r\n                                            ) : (\r\n                                                <p className=\"text-muted-foreground italic\">No description available.</p>\r\n                                            )}\r\n                                        </div>\r\n                                        {lesson.content_text && (\r\n                                            <div className=\"mt-8 pt-8 border-t border-border\">\r\n                                                <h3 className=\"text-lg font-semibold mb-4\">Lesson Transcript / Notes</h3>\r\n                                                <div\r\n                                                    dangerouslySetInnerHTML={{ __html: lesson.content_text }}\r\n                                                    className=\"rich-text-content prose dark:prose-invert max-w-none text-sm text-muted-foreground\"\r\n                                                />\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"space-y-6\">\r\n                                        <div className=\"rounded-xl border border-border bg-card p-5 shadow-sm\">\r\n                                            <div className=\"flex items-center gap-3 mb-4\">\r\n                                                <Avatar className=\"h-10 w-10 border border-border\">\r\n                                                    <AvatarImage src={author?.avatar_url || \"\"} />\r\n                                                    <AvatarFallback>IN</AvatarFallback>\r\n                                                </Avatar>\r\n                                                <div>\r\n                                                    <p className=\"text-sm font-medium leading-none\">{author?.full_name || 'Instructor'}</p>\r\n                                                    <p className=\"text-xs text-muted-foreground mt-1\">Instructor</p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"text-xs text-muted-foreground space-y-2\">\r\n                                                <div className=\"flex justify-between\">\r\n                                                    <span>Duration</span>\r\n                                                    <span>{Math.round((lesson.duration || 300) / 60)} mins</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </TabsContent>\r\n                            <TabsContent value=\"resources\" className=\"animate-in fade-in-50 duration-300\">\r\n                                <div className=\"p-12 border border-dashed border-border rounded-xl text-center bg-muted/20\">\r\n                                    <FileText className=\"h-12 w-12 mx-auto text-muted-foreground/50 mb-3\" />\r\n                                    <h3 className=\"text-lg font-medium\">No Resources</h3>\r\n                                    <p className=\"text-muted-foreground\">There are no additional resources attached to this lesson.</p>\r\n                                </div>\r\n                            </TabsContent>\r\n                            <TabsContent value=\"discussion\" className=\"animate-in fade-in-50 duration-300\">\r\n                                <div className=\"max-w-2xl mx-auto text-center py-12\">\r\n                                    <div className=\"bg-emerald-100 dark:bg-emerald-900/20 p-4 rounded-full inline-flex mb-6\">\r\n                                        <Users className=\"h-8 w-8 text-emerald-600 dark:text-emerald-400\" />\r\n                                    </div>\r\n                                    <h3 className=\"text-xl font-bold mb-3\">Join the Conversation</h3>\r\n                                    <p className=\"text-muted-foreground mb-8\">\r\n                                        Connect with fellow students, ask questions, and share insights about this lesson.\r\n                                    </p>\r\n                                    <CommunityButton />\r\n                                </div>\r\n                            </TabsContent>\r\n                        </Tabs>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (isQuiz) {\r\n        return (\r\n            <div className=\"flex-1 flex flex-col min-h-0 overflow-y-auto relative bg-slate-50 dark:bg-background animate-in fade-in slide-in-from-right-4 duration-500\">\r\n                {/* Main Content Area */}\r\n                <div className=\"relative z-10 max-w-6xl mx-auto px-4 md:px-8 py-8 md:py-12 w-full\">\r\n\r\n                    {lesson.exam_id && exam ? (\r\n                        <div className=\"animate-in fade-in zoom-in-95 duration-500 ease-out\">\r\n                            {/* Quiz Player Container - Premium Card Design */}\r\n                            <div className=\"bg-white/90 dark:bg-card/90 backdrop-blur-sm rounded-3xl shadow-xl shadow-slate-200/60 dark:shadow-none border border-slate-200/80 dark:border-border overflow-hidden\">\r\n                                <QuizPlayer\r\n                                    key={exam.id}\r\n                                    exam={exam}\r\n                                    attempts={attempts || []}\r\n                                    userId={user.id}\r\n                                    questionsCount={questionsCount || 0}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        /* Empty State - Enhanced \"Coming Soon\" Design */\r\n                        <div className=\"flex flex-col items-center justify-center min-h-[500px] animate-in fade-in zoom-in-95 duration-500\">\r\n                            <div className=\"w-full max-w-xl bg-white/95 dark:bg-card/95 backdrop-blur-sm p-12 rounded-3xl border border-slate-200/80 dark:border-border shadow-2xl shadow-slate-300/40 dark:shadow-none text-center relative overflow-hidden\">\r\n\r\n                                {/* Decorative Top Accent */}\r\n                                <div className=\"absolute top-0 left-0 right-0 h-1 bg-linear-to-r from-blue-500 via-purple-500 to-pink-500\" />\r\n\r\n                                {/* Icon Container - Multi-layer Design */}\r\n                                <div className=\"relative inline-flex items-center justify-center mb-8\">\r\n                                    {/* Outer glow */}\r\n                                    <div className=\"absolute inset-0 bg-linear-to-br from-orange-400 to-amber-500 rounded-2xl blur-2xl opacity-20 animate-pulse\" />\r\n                                    {/* Main icon background */}\r\n                                    <div className=\"relative w-20 h-20 bg-linear-to-br from-orange-500 to-amber-600 rounded-2xl flex items-center justify-center shadow-lg transform hover:scale-105 transition-transform duration-300\">\r\n                                        <Clock className=\"h-10 w-10 text-white\" strokeWidth={2.5} />\r\n                                    </div>\r\n                                    {/* Sparkle accent */}\r\n                                    <div className=\"absolute -top-1 -right-1\">\r\n                                        <Sparkles className=\"h-6 w-6 text-yellow-400 animate-pulse\" />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Heading with Gradient */}\r\n                                <h3 className=\"text-2xl md:text-3xl font-bold mb-4 bg-linear-to-r from-slate-900 via-slate-800 to-slate-900 dark:from-slate-100 dark:via-slate-200 dark:to-slate-100 bg-clip-text text-transparent\">\r\n                                    Test in Preparation\r\n                                </h3>\r\n\r\n                                {/* Description */}\r\n                                <p className=\"text-slate-600 dark:text-slate-400 text-base leading-relaxed mb-8 max-w-md mx-auto\">\r\n                                    Our team is crafting engaging questions to help you master this lesson.\r\n                                    <br className=\"hidden sm:block\" />\r\n                                    Check back soon or continue exploring other lessons.\r\n                                </p>\r\n\r\n                                {/* Feature Highlights */}\r\n                                <div className=\"flex flex-wrap items-center justify-center gap-3 mb-8\">\r\n                                    <div className=\"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 dark:bg-blue-500/10 border border-blue-200 dark:border-blue-500/20 rounded-full\">\r\n                                        <Target className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\r\n                                        <span className=\"text-sm font-medium text-blue-700 dark:text-blue-400\">Comprehensive</span>\r\n                                    </div>\r\n                                    <div className=\"inline-flex items-center gap-2 px-4 py-2 bg-purple-50 dark:bg-purple-500/10 border border-purple-200 dark:border-purple-500/20 rounded-full\">\r\n                                        <Zap className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\r\n                                        <span className=\"text-sm font-medium text-purple-700 dark:text-purple-400\">Interactive</span>\r\n                                    </div>\r\n                                    <div className=\"inline-flex items-center gap-2 px-4 py-2 bg-green-50 dark:bg-green-500/10 border border-green-200 dark:border-green-500/20 rounded-full\">\r\n                                        <CheckCircle className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\r\n                                        <span className=\"text-sm font-medium text-green-700 dark:text-green-400\">Validated</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Status Badge with Pulse */}\r\n                                <div className=\"inline-flex items-center gap-2 px-5 py-2.5 bg-amber-50 dark:bg-amber-500/10 border border-amber-200 dark:border-amber-500/20 rounded-full mb-8\">\r\n                                    <div className=\"w-2 h-2 bg-amber-500 rounded-full animate-pulse\" />\r\n                                    <span className=\"text-sm font-semibold text-amber-700 dark:text-amber-400 tracking-wide\">IN PROGRESS</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // STANDARD LAYOUT (Text, PDF)\r\n    return (\r\n        <div className=\"flex-1 flex flex-col min-h-0 overflow-y-auto bg-background animate-in fade-in slide-in-from-right-4 duration-500\">\r\n            <div className=\"w-full max-w-4xl mx-auto p-6 md:p-10 space-y-8\">\r\n                {/* Content Title / Metadata */}\r\n                <div className=\"space-y-4 text-center border-b border-border pb-8\">\r\n                    <Badge variant=\"secondary\" className=\"bg-primary/10 text-primary hover:bg-primary/20 rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-wider\">\r\n                        {lesson.content_type} Lesson\r\n                    </Badge>\r\n                    <h1 className=\"text-3xl md:text-4xl font-bold tracking-tight text-foreground\">{lesson.title}</h1>\r\n                    <div className=\"flex items-center justify-center gap-4 text-sm text-muted-foreground\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Avatar className=\"h-6 w-6 border border-border\">\r\n                                <AvatarImage src={author?.avatar_url || \"\"} />\r\n                                <AvatarFallback>IN</AvatarFallback>\r\n                            </Avatar>\r\n                            <span className=\"font-medium text-foreground\">{author?.full_name || \"Instructor\"}</span>\r\n                        </div>\r\n                        <span>â€¢</span>\r\n                        <span>{lesson.duration ? `${Math.round(lesson.duration / 60)} min read` : \"5 min read\"}</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Main Content Area */}\r\n                <div className=\"space-y-8\">\r\n                    {lesson.content_type === \"pdf\" && (\r\n                        <div className=\"rounded-xl border border-border overflow-hidden bg-muted/20 shadow-sm\">\r\n                            {lesson?.content_url ? (\r\n                                <div className=\"aspect-4/3 w-full\">\r\n                                    <CustomPDFViewer\r\n                                        url={lesson.content_url}\r\n                                        title={lesson.title}\r\n                                        allowDownload={lesson.is_downloadable ?? true}\r\n                                    />\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"flex flex-col items-center justify-center py-20 text-muted-foreground\">\r\n                                    <FileText className=\"h-16 w-16 opacity-20 mb-4\" />\r\n                                    <span className=\"text-lg font-medium\">PDF Content Not Available</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {lesson.content_type === \"text\" && (\r\n                        <div className=\"prose dark:prose-invert max-w-none prose-lg\">\r\n                            {lesson.content_text ? (\r\n                                <>\r\n                                    <style>{`\r\n                                        .rich-text-content { font-size: 1.125rem; line-height: 1.8; }\r\n                                        .rich-text-content h1, .rich-text-content h2 { color: var(--foreground); margin-top: 2em; margin-bottom: 1em; }\r\n                                        .rich-text-content p { margin-bottom: 1.5em; color: var(--muted-foreground); }\r\n                                        .rich-text-content strong { color: var(--foreground); font-weight: 700; }\r\n                                        .rich-text-content ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1.5em; }\r\n                                        .rich-text-content blockquote { border-left: 4px solid var(--primary); padding-left: 1em; font-style: italic; color: var(--muted-foreground); }\r\n                                        .rich-text-content code { background: var(--muted); padding: 0.2em 0.4em; rounded: 0.25em; font-size: 0.9em; }\r\n                                    `}</style>\r\n                                    <div dangerouslySetInnerHTML={{ __html: lesson.content_text }} className=\"rich-text-content\" />\r\n                                </>\r\n                            ) : (\r\n                                <div className=\"flex flex-col items-center justify-center py-20 text-muted-foreground border border-dashed border-border rounded-xl\">\r\n                                    <FileText className=\"h-20 w-20 opacity-20 mb-4\" />\r\n                                    <span className=\"text-lg font-medium\">Text Content Not Available</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer Section */}\r\n                <div className=\"pt-8 border-t border-border mt-12 flex flex-col items-center gap-4\">\r\n                    <p className=\"text-muted-foreground italic text-center text-sm\">\r\n                        End of lesson. Mark as complete to continue.\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8514, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/actions/rewardActions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\ntype ActionType = 'login' | 'video_watch' | 'lesson_completion' | 'quiz_completion' | 'module_completion' | 'referral' | 'bonus' | 'mission_complete';\r\n\r\nconst REWARD_RULES = {\r\n    login: { coins: 5, limit: 1 },\r\n    video_watch: { coins: 10, limit: 10 },\r\n    lesson_completion: { coins: 10, limit: 20 }, // Generic lesson completion\r\n    quiz_completion: { coins: 15, limit: 10 },\r\n    quiz_bonus: { coins: 10, limit: 10 },\r\n    module_completion: { coins: 50, limit: 5 },\r\n    referral: { coins: 100, limit: 10 },\r\n    streak_3: { coins: 10, limit: 1 },\r\n    streak_7: { coins: 30, limit: 1 },\r\n    streak_30: { coins: 100, limit: 1 },\r\n    mission_complete: { coins: 20, limit: 3 }\r\n};\r\n\r\nconst DAILY_COIN_CAP = 100;\r\n\r\nexport async function getRewardStatus(userId: string) {\r\n    const supabase = await createClient();\r\n    let { data } = await supabase\r\n        .from(\"user_rewards\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", userId)\r\n        .single();\r\n\r\n    if (!data) {\r\n        // Initialize if not exists\r\n        const { data: newData, error } = await supabase\r\n            .from(\"user_rewards\")\r\n            .insert({ user_id: userId })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) {\r\n            if (error.code === '23505') {\r\n                const { data: retryData } = await supabase\r\n                    .from(\"user_rewards\")\r\n                    .select(\"*\")\r\n                    .eq(\"user_id\", userId)\r\n                    .single();\r\n                data = retryData;\r\n            } else {\r\n                console.error(\"Error creating user_rewards in getRewardStatus:\", error);\r\n                return null;\r\n            }\r\n        } else {\r\n            data = newData;\r\n        }\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\nexport async function checkStreak(userId: string) {\r\n    const supabase = await createClient();\r\n\r\n    // Just fetch the current status to display to the user\r\n    // The actual update happens when 'login' reward is awarded below\r\n    const { data: rewardStatus } = await supabase\r\n        .from(\"user_rewards\")\r\n        .select(\"current_streak, longest_streak, last_activity_date\")\r\n        .eq(\"user_id\", userId)\r\n        .single();\r\n\r\n    if (!rewardStatus) return { streak: 0, message: null };\r\n\r\n    // We can infer if they are on a streak or if it's broken based on the date,\r\n    // but primarily we just want to show the current value.\r\n    // The DB trigger updates this immediately upon the 'login' transaction insertion.\r\n\r\n    return {\r\n        streak: rewardStatus.current_streak,\r\n        message: null\r\n    };\r\n}\r\n\r\nexport async function awardCoins(\r\n    userId: string,\r\n    action: ActionType,\r\n    entityId?: string,\r\n    description?: string\r\n) {\r\n    const supabase = await createClient();\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    // 1. Check strict duplicate rules (Client-Side Protection)\r\n    // We don't want to spam the DB trigger with 'login' events every refresh\r\n    if (action === 'login') {\r\n        entityId = today; // Force entityId to be date for login\r\n    }\r\n\r\n    if (entityId) {\r\n        const { data: existing } = await supabase\r\n            .from(\"reward_transactions\")\r\n            .select(\"id\")\r\n            .eq(\"user_id\", userId)\r\n            .eq(\"action_type\", action)\r\n            .eq(\"entity_id\", entityId)\r\n            .gte(\"created_at\", `${today}T00:00:00`)\r\n            .single();\r\n\r\n        if (existing) {\r\n            return { success: false, message: \"Already rewarded for this today!\" };\r\n        }\r\n    }\r\n\r\n    // 2. Define Amount (We still define it here to pass to DB, or DB could handle default)\r\n    let coins = 0;\r\n    switch (action) {\r\n        case 'login': coins = REWARD_RULES.login.coins; break;\r\n        case 'video_watch': coins = REWARD_RULES.video_watch.coins; break;\r\n        case 'lesson_completion': coins = REWARD_RULES.lesson_completion.coins; break;\r\n        case 'quiz_completion': coins = REWARD_RULES.quiz_completion.coins; break;\r\n        case 'module_completion': coins = REWARD_RULES.module_completion.coins; break;\r\n        case 'referral': coins = REWARD_RULES.referral.coins; break;\r\n        case 'mission_complete': coins = REWARD_RULES.mission_complete.coins; break;\r\n        case 'bonus': coins = 10; break;\r\n        default: coins = 0;\r\n    }\r\n\r\n    // 3. Insert Transaction (The DB Trigger takes it from here!)\r\n    // It will: Update Coins, XP, Level, and Streak (if login)\r\n    const { error } = await supabase.from(\"reward_transactions\").insert({\r\n        user_id: userId,\r\n        amount: coins,\r\n        action_type: action,\r\n        entity_id: entityId,\r\n        description: description || `Reward for ${action}`\r\n    });\r\n\r\n    if (error) {\r\n        console.error(\"Reward Insert Error:\", error);\r\n        return { success: false, message: \"Failed to process reward.\" };\r\n    }\r\n\r\n    // 4. Post-Process (Optional Notifications or Revalidation)\r\n    revalidatePath(\"/student\");\r\n\r\n    if (action === 'login') {\r\n        // Special message for login\r\n        return { success: true, coins, message: \"Daily Reward Claimed!\" };\r\n    }\r\n\r\n    return { success: true, coins, message: `â­ +${coins} coins!` };\r\n}\r\n\r\nexport async function getLeaderboard(type: 'weekly' | 'all_time' = 'all_time', limit: number = 10) {\r\n    const supabase = await createClient();\r\n\r\n    const sortColumn = type === 'weekly' ? 'weekly_xp' : 'total_coins'; // or xp\r\n\r\n    const { data } = await supabase\r\n        .from(\"user_rewards\")\r\n        .select(`\r\n            total_coins,\r\n            xp,\r\n            weekly_xp,\r\n            level,\r\n            current_streak,\r\n            user_id,\r\n            profiles:user_id (\r\n                full_name,\r\n                avatar_url\r\n            )\r\n        `)\r\n        .order(sortColumn, { ascending: false })\r\n        .limit(limit);\r\n\r\n    return data?.map((entry: any) => ({\r\n        ...entry,\r\n        profiles: Array.isArray(entry.profiles) ? entry.profiles[0] : entry.profiles\r\n    })) || [];\r\n}\r\n\r\nexport async function checkModuleCompletion(userId: string, moduleId: string) {\r\n    const supabase = await createClient();\r\n    const { data: lessons } = await supabase.from(\"lessons\").select(\"id\").eq(\"module_id\", moduleId);\r\n    if (!lessons || lessons.length === 0) return;\r\n\r\n    const { data: completed } = await supabase\r\n        .from(\"lesson_progress\")\r\n        .select(\"lesson_id\")\r\n        .eq(\"user_id\", userId)\r\n        .eq(\"completed\", true)\r\n        .in(\"lesson_id\", lessons.map(l => l.id));\r\n\r\n    const completedCount = completed?.length || 0;\r\n    if (completedCount === lessons.length) {\r\n        return await awardCoins(userId, 'module_completion', moduleId, 'Completed a module!');\r\n    }\r\n    return null;\r\n}\r\n\r\nexport async function checkFirstLessonReward(userId: string) {\r\n    const supabase = await createClient();\r\n    const { count } = await supabase\r\n        .from(\"lesson_progress\")\r\n        .select(\"*\", { count: 'exact', head: true })\r\n        .eq(\"user_id\", userId)\r\n        .eq(\"completed\", true);\r\n\r\n    if (count !== 1) return;\r\n\r\n    const { data: profile } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"referred_by\")\r\n        .eq(\"id\", userId)\r\n        .single();\r\n\r\n    if (!profile?.referred_by) return;\r\n\r\n    const referrerId = profile.referred_by;\r\n    const { data: existing } = await supabase\r\n        .from(\"reward_transactions\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", referrerId)\r\n        .eq(\"action_type\", 'referral')\r\n        .eq(\"entity_id\", userId)\r\n        .single();\r\n\r\n    if (existing) return;\r\n\r\n    // Award referrer\r\n    await awardCoins(referrerId, 'referral', userId, `Referral bonus for user ${userId}`);\r\n\r\n    // Check Badge for Referrer\r\n    await checkBadgeUnlock(referrerId, 'social_butterfly');\r\n}\r\n\r\n// --- NEW GAMIFICATION FUNCTIONS ---\r\n\r\nexport async function getDailyMissions(userId: string) {\r\n    const supabase = await createClient();\r\n\r\n    // Use RPC function to get or create missions\r\n    const { data, error } = await supabase.rpc('get_or_create_daily_missions', {\r\n        p_user_id: userId\r\n    });\r\n\r\n    if (error) {\r\n        console.error(\"Error fetching daily missions:\", error);\r\n        return [];\r\n    }\r\n\r\n    return data || [];\r\n}\r\n\r\n\r\nexport async function updateMissionProgress(userId: string, type: 'login' | 'quiz' | 'video') {\r\n    const supabase = await createClient();\r\n\r\n    // Use RPC function to update mission progress\r\n    const { data, error } = await supabase.rpc('update_mission_progress', {\r\n        p_user_id: userId,\r\n        p_mission_type: type\r\n    });\r\n\r\n    if (error) {\r\n        console.error(\"Error updating mission progress:\", error);\r\n        return;\r\n    }\r\n\r\n    // Check if any mission was completed\r\n    const missions = data || [];\r\n    const completedMission = missions.find((m: any) =>\r\n        m.id === type && m.completed && m.progress === m.goal\r\n    );\r\n\r\n    if (completedMission) {\r\n        // Award mission bonus\r\n        const today = new Date().toISOString().split('T')[0];\r\n        await awardCoins(userId, 'mission_complete', `${today}-${type}`, `Mission Complete: ${completedMission.title}`);\r\n    }\r\n\r\n    revalidatePath(\"/student\");\r\n}\r\n\r\n\r\nexport async function checkBadgeUnlock(userId: string, badgeId: string) {\r\n    const supabase = await createClient();\r\n\r\n    // Check if already has badge\r\n    const { data: existing } = await supabase\r\n        .from(\"user_badges\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", userId)\r\n        .eq(\"badge_id\", badgeId)\r\n        .single();\r\n\r\n    if (existing) return;\r\n\r\n    // Logic to verify if they actually earned it could go here, \r\n    // but usually we call this function when we KNOW they met the condition.\r\n\r\n    await supabase.from(\"user_badges\").insert({\r\n        user_id: userId,\r\n        badge_id: badgeId\r\n    });\r\n\r\n    // Could return a notification object\r\n}\r\n\r\nexport async function getUserBadges(userId: string) {\r\n    const supabase = await createClient();\r\n    const { data } = await supabase\r\n        .from(\"user_badges\")\r\n        .select(\"badge_id, earned_at\")\r\n        .eq(\"user_id\", userId);\r\n    return data || [];\r\n}\r\n\r\nexport async function getStreakHistory(userId: string) {\r\n    const supabase = await createClient();\r\n\r\n    // Fetch dates from reward_transactions\r\n    const { data } = await supabase\r\n        .from(\"reward_transactions\")\r\n        .select(\"created_at\")\r\n        .eq(\"user_id\", userId)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n    if (!data) return [];\r\n\r\n    // Extract unique dates (YYYY-MM-DD)\r\n    const uniqueDates = new Set(\r\n        data.map(item => item.created_at.split('T')[0])\r\n    );\r\n\r\n    return Array.from(uniqueDates);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;IAoLsB,wBAAA,WAAA,GAAA,IAAA,kOAAA,EAAA,8CAAA,4LAAA,EAAA,KAAA,GAAA,gNAAA,EAAA"}},
    {"offset": {"line": 8529, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/actions/rewardActions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\ntype ActionType = 'login' | 'video_watch' | 'lesson_completion' | 'quiz_completion' | 'module_completion' | 'referral' | 'bonus' | 'mission_complete';\r\n\r\nconst REWARD_RULES = {\r\n    login: { coins: 5, limit: 1 },\r\n    video_watch: { coins: 10, limit: 10 },\r\n    lesson_completion: { coins: 10, limit: 20 }, // Generic lesson completion\r\n    quiz_completion: { coins: 15, limit: 10 },\r\n    quiz_bonus: { coins: 10, limit: 10 },\r\n    module_completion: { coins: 50, limit: 5 },\r\n    referral: { coins: 100, limit: 10 },\r\n    streak_3: { coins: 10, limit: 1 },\r\n    streak_7: { coins: 30, limit: 1 },\r\n    streak_30: { coins: 100, limit: 1 },\r\n    mission_complete: { coins: 20, limit: 3 }\r\n};\r\n\r\nconst DAILY_COIN_CAP = 100;\r\n\r\nexport async function getRewardStatus(userId: string) {\r\n    const supabase = await createClient();\r\n    let { data } = await supabase\r\n        .from(\"user_rewards\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", userId)\r\n        .single();\r\n\r\n    if (!data) {\r\n        // Initialize if not exists\r\n        const { data: newData, error } = await supabase\r\n            .from(\"user_rewards\")\r\n            .insert({ user_id: userId })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) {\r\n            if (error.code === '23505') {\r\n                const { data: retryData } = await supabase\r\n                    .from(\"user_rewards\")\r\n                    .select(\"*\")\r\n                    .eq(\"user_id\", userId)\r\n                    .single();\r\n                data = retryData;\r\n            } else {\r\n                console.error(\"Error creating user_rewards in getRewardStatus:\", error);\r\n                return null;\r\n            }\r\n        } else {\r\n            data = newData;\r\n        }\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\nexport async function checkStreak(userId: string) {\r\n    const supabase = await createClient();\r\n\r\n    // Just fetch the current status to display to the user\r\n    // The actual update happens when 'login' reward is awarded below\r\n    const { data: rewardStatus } = await supabase\r\n        .from(\"user_rewards\")\r\n        .select(\"current_streak, longest_streak, last_activity_date\")\r\n        .eq(\"user_id\", userId)\r\n        .single();\r\n\r\n    if (!rewardStatus) return { streak: 0, message: null };\r\n\r\n    // We can infer if they are on a streak or if it's broken based on the date,\r\n    // but primarily we just want to show the current value.\r\n    // The DB trigger updates this immediately upon the 'login' transaction insertion.\r\n\r\n    return {\r\n        streak: rewardStatus.current_streak,\r\n        message: null\r\n    };\r\n}\r\n\r\nexport async function awardCoins(\r\n    userId: string,\r\n    action: ActionType,\r\n    entityId?: string,\r\n    description?: string\r\n) {\r\n    const supabase = await createClient();\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    // 1. Check strict duplicate rules (Client-Side Protection)\r\n    // We don't want to spam the DB trigger with 'login' events every refresh\r\n    if (action === 'login') {\r\n        entityId = today; // Force entityId to be date for login\r\n    }\r\n\r\n    if (entityId) {\r\n        const { data: existing } = await supabase\r\n            .from(\"reward_transactions\")\r\n            .select(\"id\")\r\n            .eq(\"user_id\", userId)\r\n            .eq(\"action_type\", action)\r\n            .eq(\"entity_id\", entityId)\r\n            .gte(\"created_at\", `${today}T00:00:00`)\r\n            .single();\r\n\r\n        if (existing) {\r\n            return { success: false, message: \"Already rewarded for this today!\" };\r\n        }\r\n    }\r\n\r\n    // 2. Define Amount (We still define it here to pass to DB, or DB could handle default)\r\n    let coins = 0;\r\n    switch (action) {\r\n        case 'login': coins = REWARD_RULES.login.coins; break;\r\n        case 'video_watch': coins = REWARD_RULES.video_watch.coins; break;\r\n        case 'lesson_completion': coins = REWARD_RULES.lesson_completion.coins; break;\r\n        case 'quiz_completion': coins = REWARD_RULES.quiz_completion.coins; break;\r\n        case 'module_completion': coins = REWARD_RULES.module_completion.coins; break;\r\n        case 'referral': coins = REWARD_RULES.referral.coins; break;\r\n        case 'mission_complete': coins = REWARD_RULES.mission_complete.coins; break;\r\n        case 'bonus': coins = 10; break;\r\n        default: coins = 0;\r\n    }\r\n\r\n    // 3. Insert Transaction (The DB Trigger takes it from here!)\r\n    // It will: Update Coins, XP, Level, and Streak (if login)\r\n    const { error } = await supabase.from(\"reward_transactions\").insert({\r\n        user_id: userId,\r\n        amount: coins,\r\n        action_type: action,\r\n        entity_id: entityId,\r\n        description: description || `Reward for ${action}`\r\n    });\r\n\r\n    if (error) {\r\n        console.error(\"Reward Insert Error:\", error);\r\n        return { success: false, message: \"Failed to process reward.\" };\r\n    }\r\n\r\n    // 4. Post-Process (Optional Notifications or Revalidation)\r\n    revalidatePath(\"/student\");\r\n\r\n    if (action === 'login') {\r\n        // Special message for login\r\n        return { success: true, coins, message: \"Daily Reward Claimed!\" };\r\n    }\r\n\r\n    return { success: true, coins, message: `â­ +${coins} coins!` };\r\n}\r\n\r\nexport async function getLeaderboard(type: 'weekly' | 'all_time' = 'all_time', limit: number = 10) {\r\n    const supabase = await createClient();\r\n\r\n    const sortColumn = type === 'weekly' ? 'weekly_xp' : 'total_coins'; // or xp\r\n\r\n    const { data } = await supabase\r\n        .from(\"user_rewards\")\r\n        .select(`\r\n            total_coins,\r\n            xp,\r\n            weekly_xp,\r\n            level,\r\n            current_streak,\r\n            user_id,\r\n            profiles:user_id (\r\n                full_name,\r\n                avatar_url\r\n            )\r\n        `)\r\n        .order(sortColumn, { ascending: false })\r\n        .limit(limit);\r\n\r\n    return data?.map((entry: any) => ({\r\n        ...entry,\r\n        profiles: Array.isArray(entry.profiles) ? entry.profiles[0] : entry.profiles\r\n    })) || [];\r\n}\r\n\r\nexport async function checkModuleCompletion(userId: string, moduleId: string) {\r\n    const supabase = await createClient();\r\n    const { data: lessons } = await supabase.from(\"lessons\").select(\"id\").eq(\"module_id\", moduleId);\r\n    if (!lessons || lessons.length === 0) return;\r\n\r\n    const { data: completed } = await supabase\r\n        .from(\"lesson_progress\")\r\n        .select(\"lesson_id\")\r\n        .eq(\"user_id\", userId)\r\n        .eq(\"completed\", true)\r\n        .in(\"lesson_id\", lessons.map(l => l.id));\r\n\r\n    const completedCount = completed?.length || 0;\r\n    if (completedCount === lessons.length) {\r\n        return await awardCoins(userId, 'module_completion', moduleId, 'Completed a module!');\r\n    }\r\n    return null;\r\n}\r\n\r\nexport async function checkFirstLessonReward(userId: string) {\r\n    const supabase = await createClient();\r\n    const { count } = await supabase\r\n        .from(\"lesson_progress\")\r\n        .select(\"*\", { count: 'exact', head: true })\r\n        .eq(\"user_id\", userId)\r\n        .eq(\"completed\", true);\r\n\r\n    if (count !== 1) return;\r\n\r\n    const { data: profile } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"referred_by\")\r\n        .eq(\"id\", userId)\r\n        .single();\r\n\r\n    if (!profile?.referred_by) return;\r\n\r\n    const referrerId = profile.referred_by;\r\n    const { data: existing } = await supabase\r\n        .from(\"reward_transactions\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", referrerId)\r\n        .eq(\"action_type\", 'referral')\r\n        .eq(\"entity_id\", userId)\r\n        .single();\r\n\r\n    if (existing) return;\r\n\r\n    // Award referrer\r\n    await awardCoins(referrerId, 'referral', userId, `Referral bonus for user ${userId}`);\r\n\r\n    // Check Badge for Referrer\r\n    await checkBadgeUnlock(referrerId, 'social_butterfly');\r\n}\r\n\r\n// --- NEW GAMIFICATION FUNCTIONS ---\r\n\r\nexport async function getDailyMissions(userId: string) {\r\n    const supabase = await createClient();\r\n\r\n    // Use RPC function to get or create missions\r\n    const { data, error } = await supabase.rpc('get_or_create_daily_missions', {\r\n        p_user_id: userId\r\n    });\r\n\r\n    if (error) {\r\n        console.error(\"Error fetching daily missions:\", error);\r\n        return [];\r\n    }\r\n\r\n    return data || [];\r\n}\r\n\r\n\r\nexport async function updateMissionProgress(userId: string, type: 'login' | 'quiz' | 'video') {\r\n    const supabase = await createClient();\r\n\r\n    // Use RPC function to update mission progress\r\n    const { data, error } = await supabase.rpc('update_mission_progress', {\r\n        p_user_id: userId,\r\n        p_mission_type: type\r\n    });\r\n\r\n    if (error) {\r\n        console.error(\"Error updating mission progress:\", error);\r\n        return;\r\n    }\r\n\r\n    // Check if any mission was completed\r\n    const missions = data || [];\r\n    const completedMission = missions.find((m: any) =>\r\n        m.id === type && m.completed && m.progress === m.goal\r\n    );\r\n\r\n    if (completedMission) {\r\n        // Award mission bonus\r\n        const today = new Date().toISOString().split('T')[0];\r\n        await awardCoins(userId, 'mission_complete', `${today}-${type}`, `Mission Complete: ${completedMission.title}`);\r\n    }\r\n\r\n    revalidatePath(\"/student\");\r\n}\r\n\r\n\r\nexport async function checkBadgeUnlock(userId: string, badgeId: string) {\r\n    const supabase = await createClient();\r\n\r\n    // Check if already has badge\r\n    const { data: existing } = await supabase\r\n        .from(\"user_badges\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", userId)\r\n        .eq(\"badge_id\", badgeId)\r\n        .single();\r\n\r\n    if (existing) return;\r\n\r\n    // Logic to verify if they actually earned it could go here, \r\n    // but usually we call this function when we KNOW they met the condition.\r\n\r\n    await supabase.from(\"user_badges\").insert({\r\n        user_id: userId,\r\n        badge_id: badgeId\r\n    });\r\n\r\n    // Could return a notification object\r\n}\r\n\r\nexport async function getUserBadges(userId: string) {\r\n    const supabase = await createClient();\r\n    const { data } = await supabase\r\n        .from(\"user_badges\")\r\n        .select(\"badge_id, earned_at\")\r\n        .eq(\"user_id\", userId);\r\n    return data || [];\r\n}\r\n\r\nexport async function getStreakHistory(userId: string) {\r\n    const supabase = await createClient();\r\n\r\n    // Fetch dates from reward_transactions\r\n    const { data } = await supabase\r\n        .from(\"reward_transactions\")\r\n        .select(\"created_at\")\r\n        .eq(\"user_id\", userId)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n    if (!data) return [];\r\n\r\n    // Extract unique dates (YYYY-MM-DD)\r\n    const uniqueDates = new Set(\r\n        data.map(item => item.created_at.split('T')[0])\r\n    );\r\n\r\n    return Array.from(uniqueDates);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;IAuMsB,yBAAA,WAAA,GAAA,IAAA,kOAAA,EAAA,8CAAA,4LAAA,EAAA,KAAA,GAAA,gNAAA,EAAA"}},
    {"offset": {"line": 8544, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/LessonTracker.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState, useCallback } from \"react\"\r\nimport { useMarkLessonComplete } from \"@/hooks/student/useLessonProgress\"\r\nimport { createClient } from \"@/lib/supabase/client\"\r\nimport { checkModuleCompletion, checkFirstLessonReward } from \"@/app/actions/rewardActions\"\r\n// Force HMR Update\r\nimport { toast } from \"sonner\"\r\nimport LessonContext from \"@/context/LessonContext\"\r\n\r\ninterface LessonTrackerProps {\r\n    lessonId: string\r\n    courseId: string\r\n    moduleId?: string\r\n    contentType?: \"video\" | \"text\" | \"pdf\" | \"quiz\"\r\n    children: React.ReactNode\r\n}\r\n\r\nexport function LessonTracker({ lessonId, courseId, moduleId, contentType = \"text\", children }: LessonTrackerProps) {\r\n    const { mutate: markCompleteMutation } = useMarkLessonComplete()\r\n    const [isCompleted, setIsCompleted] = useState(false)\r\n\r\n    const handleMarkComplete = useCallback(() => {\r\n        if (isCompleted) return\r\n\r\n        const supabase = createClient()\r\n        supabase.auth.getUser().then(async ({ data: { user } }) => {\r\n            if (user && lessonId) {\r\n                markCompleteMutation({\r\n                    userId: user.id,\r\n                    lessonId,\r\n                    courseId,\r\n                }, {\r\n                    onSuccess: async () => {\r\n                        setIsCompleted(true)\r\n                        if (moduleId) {\r\n                            const res = await checkModuleCompletion(user.id, moduleId)\r\n                            if (res?.success && res.message) {\r\n                                toast.success(res.message, { icon: \"ðŸª™\" })\r\n                            }\r\n                        }\r\n                        // Check for first lesson reward (referral)\r\n                        await checkFirstLessonReward(user.id)\r\n                    }\r\n                })\r\n            }\r\n        })\r\n    }, [isCompleted, lessonId, courseId, moduleId, markCompleteMutation])\r\n\r\n    useEffect(() => {\r\n        // Reset completion state when lesson changes\r\n        setIsCompleted(false)\r\n\r\n        // Strict Rules for Text/PDF: 5 minutes timer\r\n        if (contentType === \"text\" || contentType === \"pdf\") {\r\n            const timer = setTimeout(() => {\r\n                handleMarkComplete()\r\n            }, 5 * 60 * 1000) // 5 minutes\r\n\r\n            return () => clearTimeout(timer)\r\n        }\r\n    }, [lessonId, contentType, handleMarkComplete])\r\n\r\n    return (\r\n        <LessonContext.Provider value={{ markComplete: handleMarkComplete, isCompleted }}>\r\n            {children}\r\n        </LessonContext.Provider>\r\n    )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AACA,mBAAmB;AACnB;AACA;AARA;;;;;;;;AAkBO,SAAS,cAAc,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,cAAc,MAAM,EAAE,QAAQ,EAAsB;IAC9G,MAAM,EAAE,QAAQ,oBAAoB,EAAE,GAAG,IAAA,sKAAqB;IAC9D,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,8KAAQ,EAAC;IAE/C,MAAM,qBAAqB,IAAA,iLAAW,EAAC;QACnC,IAAI,aAAa;QAEjB,MAAM,WAAW,IAAA,iJAAY;QAC7B,SAAS,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE;YAClD,IAAI,QAAQ,UAAU;gBAClB,qBAAqB;oBACjB,QAAQ,KAAK,EAAE;oBACf;oBACA;gBACJ,GAAG;oBACC,WAAW;wBACP,eAAe;wBACf,IAAI,UAAU;4BACV,MAAM,MAAM,MAAM,IAAA,uLAAqB,EAAC,KAAK,EAAE,EAAE;4BACjD,IAAI,KAAK,WAAW,IAAI,OAAO,EAAE;gCAC7B,yJAAK,CAAC,OAAO,CAAC,IAAI,OAAO,EAAE;oCAAE,MAAM;gCAAK;4BAC5C;wBACJ;wBACA,2CAA2C;wBAC3C,MAAM,IAAA,wLAAsB,EAAC,KAAK,EAAE;oBACxC;gBACJ;YACJ;QACJ;IACJ,GAAG;QAAC;QAAa;QAAU;QAAU;QAAU;KAAqB;IAEpE,IAAA,+KAAS,EAAC;QACN,6CAA6C;QAC7C,eAAe;QAEf,6CAA6C;QAC7C,IAAI,gBAAgB,UAAU,gBAAgB,OAAO;YACjD,MAAM,QAAQ,WAAW;gBACrB;YACJ,GAAG,IAAI,KAAK,MAAM,YAAY;;YAE9B,OAAO,IAAM,aAAa;QAC9B;IACJ,GAAG;QAAC;QAAU;QAAa;KAAmB;IAE9C,qBACI,kMAAC,4IAAa,CAAC,QAAQ;QAAC,OAAO;YAAE,cAAc;YAAoB;QAAY;kBAC1E;;;;;;AAGb"}},
    {"offset": {"line": 8633, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/data/lesson.ts"],"sourcesContent":["import { SupabaseClient } from \"@supabase/supabase-js\";\r\n\r\nexport async function fetchLessonDetailedData(\r\n    supabase: SupabaseClient,\r\n    lessonId: string,\r\n    courseId: string,\r\n    userId?: string\r\n) {\r\n    // 1. Get Core Lesson Details\r\n    const { data: lesson, error } = await supabase\r\n        .from(\"lessons\")\r\n        .select(\"*\")\r\n        .eq(\"id\", lessonId)\r\n        .single();\r\n\r\n    if (error || !lesson) {\r\n        console.error(\"Lesson fetch error:\", error);\r\n        return { error: \"Lesson not found\" };\r\n    }\r\n\r\n    const result: any = { lesson };\r\n\r\n    // 2. Fetch Additional Type-Specific Data\r\n    try {\r\n        if (lesson.content_type === 'quiz' && lesson.exam_id) {\r\n            // Fetch Exam Data\r\n            const [examResult, sectionsResult] = await Promise.all([\r\n                supabase.from(\"exams\").select(\"*\").eq(\"id\", lesson.exam_id).single(),\r\n                supabase.from(\"sections\").select(\"id, questions:questions(id)\").eq(\"exam_id\", lesson.exam_id)\r\n            ]);\r\n\r\n            result.exam = examResult.data;\r\n\r\n            // Calculate Question Count\r\n            const sections = sectionsResult.data || [];\r\n            result.questionsCount = sections.reduce((acc: number, section: any) => acc + (section.questions?.length || 0), 0);\r\n\r\n            // Fetch User Attempts\r\n            if (userId) {\r\n                const { data: attempts } = await supabase\r\n                    .from(\"exam_attempts\")\r\n                    .select(\"*\")\r\n                    .eq(\"exam_id\", lesson.exam_id)\r\n                    .eq(\"student_id\", userId);\r\n                result.attempts = attempts || [];\r\n            }\r\n        }\r\n\r\n        // 3. Fetch Course/Author Context (optional, don't fail if this errors)\r\n        if (courseId) {\r\n            try {\r\n                const { data: course } = await supabase\r\n                    .from(\"courses\")\r\n                    .select(\"user_id\")\r\n                    .eq(\"id\", courseId)\r\n                    .single();\r\n\r\n                if (course?.user_id) {\r\n                    const { data: author } = await supabase\r\n                        .from(\"profiles\")\r\n                        .select(\"*\")\r\n                        .eq(\"id\", course.user_id)\r\n                        .single();\r\n                    result.author = author;\r\n                }\r\n            } catch (authorError) {\r\n                // Ignore author fetch errors - not critical\r\n                console.warn(\"Could not fetch author:\", authorError);\r\n            }\r\n        }\r\n\r\n        return result;\r\n\r\n    } catch (e) {\r\n        console.error(\"Error fetching detailed lesson data:\", e);\r\n        return { error: \"Failed to load lesson details\" };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAEO,eAAe,wBAClB,QAAwB,EACxB,QAAgB,EAChB,QAAgB,EAChB,MAAe;IAEf,6BAA6B;IAC7B,MAAM,EAAE,MAAM,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACjC,IAAI,CAAC,WACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,UACT,MAAM;IAEX,IAAI,SAAS,CAAC,QAAQ;QAClB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;YAAE,OAAO;QAAmB;IACvC;IAEA,MAAM,SAAc;QAAE;IAAO;IAE7B,yCAAyC;IACzC,IAAI;QACA,IAAI,OAAO,YAAY,KAAK,UAAU,OAAO,OAAO,EAAE;YAClD,kBAAkB;YAClB,MAAM,CAAC,YAAY,eAAe,GAAG,MAAM,QAAQ,GAAG,CAAC;gBACnD,SAAS,IAAI,CAAC,SAAS,MAAM,CAAC,KAAK,EAAE,CAAC,MAAM,OAAO,OAAO,EAAE,MAAM;gBAClE,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC,+BAA+B,EAAE,CAAC,WAAW,OAAO,OAAO;aAC/F;YAED,OAAO,IAAI,GAAG,WAAW,IAAI;YAE7B,2BAA2B;YAC3B,MAAM,WAAW,eAAe,IAAI,IAAI,EAAE;YAC1C,OAAO,cAAc,GAAG,SAAS,MAAM,CAAC,CAAC,KAAa,UAAiB,MAAM,CAAC,QAAQ,SAAS,EAAE,UAAU,CAAC,GAAG;YAE/G,sBAAsB;YACtB,IAAI,QAAQ;gBACR,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC5B,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,OAAO,OAAO,EAC5B,EAAE,CAAC,cAAc;gBACtB,OAAO,QAAQ,GAAG,YAAY,EAAE;YACpC;QACJ;QAEA,uEAAuE;QACvE,IAAI,UAAU;YACV,IAAI;gBACA,MAAM,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,SAC1B,IAAI,CAAC,WACL,MAAM,CAAC,WACP,EAAE,CAAC,MAAM,UACT,MAAM;gBAEX,IAAI,QAAQ,SAAS;oBACjB,MAAM,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,SAC1B,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,OAAO,OAAO,EACvB,MAAM;oBACX,OAAO,MAAM,GAAG;gBACpB;YACJ,EAAE,OAAO,aAAa;gBAClB,4CAA4C;gBAC5C,QAAQ,IAAI,CAAC,2BAA2B;YAC5C;QACJ;QAEA,OAAO;IAEX,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,wCAAwC;QACtD,OAAO;YAAE,OAAO;QAAgC;IACpD;AACJ"}},
    {"offset": {"line": 8692, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/LessonAppContainer.tsx"],"sourcesContent":["/**\r\n * HYBRID SPA PATTERN - Lesson App Container\r\n * \r\n * This component handles ALL lesson navigation purely on the client.\r\n * - Uses React state for instant transitions (0ms)\r\n * - Updates URL with window.history.pushState (no server round-trip)\r\n * - Maintains browser history and shareable URLs\r\n * - Keeps sidebar and player mounted (no re-mounting)\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useSearchParams } from 'next/navigation';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport { useLessons } from '@/hooks/useLessons';\r\nimport LessonContentClient from '@/components/lesson/LessonContentClient';\r\nimport { LessonTracker } from '@/components/LessonTracker';\r\nimport { QuizSkeleton, VideoSkeleton, TextSkeleton } from '@/components/skeletons/LessonSkeletons';\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport { fetchLessonDetailedData } from '@/lib/data/lesson';\r\n\r\ninterface LessonAppContainerProps {\r\n    courseId: string;\r\n    user: any;\r\n    isEnrolled: boolean;\r\n    initialLessonId?: string;\r\n}\r\n\r\nexport function LessonAppContainer({\r\n    courseId,\r\n    user,\r\n    isEnrolled,\r\n    initialLessonId\r\n}: LessonAppContainerProps) {\r\n    const searchParams = useSearchParams();\r\n    const queryClient = useQueryClient();\r\n\r\n    // âš¡ CLIENT-SIDE STATE: The source of truth for current lesson\r\n    const [currentLessonId, setCurrentLessonId] = useState<string | null>(\r\n        searchParams.get('lessonId') || initialLessonId || null\r\n    );\r\n\r\n    // Get modules/lessons from cache (loaded by layout)\r\n    const { data: modules, isPending: isLoadingModules } = useLessons(courseId);\r\n\r\n    // Flatten lessons\r\n    const allLessons = useMemo(() => {\r\n        if (!modules) return [];\r\n        return modules.flatMap((m: any) => m.lessons);\r\n    }, [modules]);\r\n\r\n    // Get current lesson object\r\n    const currentLesson = useMemo(() => {\r\n        if (!currentLessonId || !allLessons.length) return allLessons[0] || null;\r\n        return allLessons.find((l: any) => l.id === currentLessonId) || allLessons[0];\r\n    }, [currentLessonId, allLessons]);\r\n\r\n    // âš¡ SHALLOW ROUTING: Update URL without server round-trip\r\n    const navigateToLesson = useCallback((lessonId: string) => {\r\n        // Update state (instant)\r\n        setCurrentLessonId(lessonId);\r\n\r\n        // Update URL (no server request)\r\n        const url = new URL(window.location.href);\r\n        url.searchParams.set('lessonId', lessonId);\r\n        window.history.pushState({}, '', url.toString());\r\n    }, []);\r\n\r\n    // Listen to browser back/forward buttons\r\n    useEffect(() => {\r\n        const handlePopState = () => {\r\n            const params = new URLSearchParams(window.location.search);\r\n            const lessonId = params.get('lessonId');\r\n            if (lessonId) {\r\n                setCurrentLessonId(lessonId);\r\n            }\r\n        };\r\n\r\n        window.addEventListener('popstate', handlePopState);\r\n        return () => window.removeEventListener('popstate', handlePopState);\r\n    }, []);\r\n\r\n    // Sync with URL changes (from external navigation)\r\n    useEffect(() => {\r\n        const urlLessonId = searchParams.get('lessonId');\r\n        if (urlLessonId && urlLessonId !== currentLessonId) {\r\n            setCurrentLessonId(urlLessonId);\r\n        }\r\n    }, [searchParams, currentLessonId]);\r\n\r\n    // Expose navigation function globally for sidebar to use\r\n    useEffect(() => {\r\n        (window as any).__navigateToLesson = navigateToLesson;\r\n        return () => {\r\n            delete (window as any).__navigateToLesson;\r\n        };\r\n    }, [navigateToLesson]);\r\n\r\n    // âš¡ PREDICTIVE PREFETCHING: Prefetch next lesson for instant forward navigation\r\n    useEffect(() => {\r\n        if (!currentLesson || !allLessons.length) return;\r\n\r\n        // Find next lesson\r\n        const currentIndex = allLessons.findIndex((l: any) => l.id === currentLesson.id);\r\n        const nextLesson = allLessons[currentIndex + 1];\r\n\r\n        if (nextLesson) {\r\n            // Check if already cached\r\n            const cached = queryClient.getQueryData(['lesson', nextLesson.id, courseId]);\r\n            if (cached) return; // Already prefetched\r\n\r\n            // Prefetch next lesson in background\r\n            const supabase = createClient();\r\n            supabase.auth.getUser().then(({ data: { user } }) => {\r\n                if (user) {\r\n                    queryClient.prefetchQuery({\r\n                        queryKey: ['lesson', nextLesson.id, courseId],\r\n                        queryFn: () => fetchLessonDetailedData(supabase, nextLesson.id, courseId, user.id),\r\n                        staleTime: 1000 * 60 * 10, // 10 minutes\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }, [currentLesson, allLessons, courseId, queryClient]);\r\n\r\n    // âš¡ LOADING STATE: Show skeleton while course structure loads\r\n    // This prevents \"Failed to Load Content\" error when navigating without lessonId\r\n    // Once loaded, navigation between lessons is instant (0ms) via keepPreviousData\r\n    if (isLoadingModules && !currentLesson) {\r\n        // Determine skeleton type - default to text if unknown\r\n        return <TextSkeleton />;\r\n    }\r\n\r\n    if (!currentLesson) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-full p-8\">\r\n                <div className=\"text-center\">\r\n                    <h3 className=\"text-xl font-bold mb-2\">No Lessons Available</h3>\r\n                    <p className=\"text-muted-foreground\">This course has no lessons yet.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Access control\r\n    if (!isEnrolled && !currentLesson.is_free_preview) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-full p-8\">\r\n                <div className=\"text-center\">\r\n                    <h3 className=\"text-xl font-bold mb-2\">Content Locked</h3>\r\n                    <p className=\"text-muted-foreground\">Enroll in this course to access this lesson.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Determine skeleton type\r\n    let SkeletonComponent = TextSkeleton;\r\n    if (currentLesson.content_type === 'video') SkeletonComponent = VideoSkeleton;\r\n    if (currentLesson.content_type === 'quiz') SkeletonComponent = QuizSkeleton;\r\n\r\n    return (\r\n        <>\r\n            {/* âš¡ NO KEY PROP: Keeps LessonTracker mounted for stability */}\r\n            <LessonTracker\r\n                lessonId={currentLesson.id}\r\n                courseId={courseId}\r\n                moduleId={currentLesson.module_id}\r\n                contentType={currentLesson.content_type as any}\r\n            >\r\n                {/* âš¡ NO KEY: Component stays mounted, uses keepPreviousData for instant transitions */}\r\n                <LessonContentClient\r\n                    lessonId={currentLesson.id}\r\n                    courseId={courseId}\r\n                    user={user}\r\n                    contentType={currentLesson.content_type as any}\r\n                />\r\n            </LessonTracker>\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}