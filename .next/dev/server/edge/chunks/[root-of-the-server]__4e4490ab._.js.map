{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/supabase/middleware.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\r\nimport { NextResponse, type NextRequest } from \"next/server\"\r\n\r\nexport async function updateSession(request: NextRequest) {\r\n  let supabaseResponse = NextResponse.next({\r\n    request,\r\n  })\r\n\r\n  const supabase = createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return request.cookies.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          cookiesToSet.forEach(({ name, value }) => request.cookies.set(name, value))\r\n          supabaseResponse = NextResponse.next({\r\n            request,\r\n          })\r\n          cookiesToSet.forEach(({ name, value, options }) => supabaseResponse.cookies.set(name, value, options))\r\n        },\r\n      },\r\n    },\r\n  )\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (\r\n    request.nextUrl.pathname !== \"/\" &&\r\n    !request.nextUrl.pathname.startsWith(\"/courses\") &&\r\n    !request.nextUrl.pathname.startsWith(\"/test-series\") &&\r\n    !request.nextUrl.pathname.startsWith(\"/api\") &&\r\n    !request.nextUrl.pathname.startsWith(\"/about\") && // Allow access to /about\r\n    !request.nextUrl.pathname.startsWith(\"/contact\") && // Allow access to /contact\r\n    !request.nextUrl.pathname.startsWith(\"/privacy-policy\") && // Allow access to /privacy-policy\r\n    !request.nextUrl.pathname.startsWith(\"/terms-of-use\") && // Allow access to /terms-of-use\r\n    !request.nextUrl.pathname.startsWith(\"/refund-policy\") && // Allow access to /refund-policy\r\n    !user &&\r\n    !request.nextUrl.pathname.startsWith(\"/auth\")\r\n  ) {\r\n    const url = request.nextUrl.clone()\r\n    url.pathname = \"/auth/login\"\r\n    url.searchParams.set(\"next\", request.nextUrl.pathname + request.nextUrl.search)\r\n    return NextResponse.redirect(url)\r\n  }\r\n\r\n  if (user && request.nextUrl.pathname.startsWith(\"/auth\")) {\r\n    // Fetch user role to redirect to appropriate dashboard\r\n    const { data: profile } = await supabase\r\n      .from(\"profiles\")\r\n      .select(\"role\")\r\n      .eq(\"id\", user.id)\r\n      .single()\r\n\r\n    const url = request.nextUrl.clone()\r\n    if (profile?.role === \"admin\") {\r\n      url.pathname = \"/admin/dashboard\"\r\n    } else {\r\n      // Default to student dashboard for all other cases\r\n      url.pathname = \"/student/dashboard\"\r\n    }\r\n    return NextResponse.redirect(url)\r\n  }\r\n\r\n  return supabaseResponse\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,cAAc,OAAoB;IACtD,IAAI,mBAAmB,gMAAY,CAAC,IAAI,CAAC;QACvC;IACF;IAEA,MAAM,WAAW,IAAA,uMAAkB,sUAGjC;QACE,SAAS;YACP;gBACE,OAAO,QAAQ,OAAO,CAAC,MAAM;YAC/B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GAAK,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBACpE,mBAAmB,gMAAY,CAAC,IAAI,CAAC;oBACnC;gBACF;gBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAC/F;QACF;IACF;IAGF,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IACE,QAAQ,OAAO,CAAC,QAAQ,KAAK,OAC7B,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,eACrC,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,mBACrC,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,WACrC,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,yBAAyB;IAC3E,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,eAAe,2BAA2B;IAC/E,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,sBAAsB,kCAAkC;IAC7F,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,oBAAoB,gCAAgC;IACzF,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,qBAAqB,iCAAiC;IAC3F,CAAC,QACD,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,UACrC;QACA,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,IAAI,YAAY,CAAC,GAAG,CAAC,QAAQ,QAAQ,OAAO,CAAC,QAAQ,GAAG,QAAQ,OAAO,CAAC,MAAM;QAC9E,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,IAAI,QAAQ,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,UAAU;QACxD,uDAAuD;QACvD,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,SAAS,SAAS,SAAS;YAC7B,IAAI,QAAQ,GAAG;QACjB,OAAO;YACL,mDAAmD;YACnD,IAAI,QAAQ,GAAG;QACjB;QACA,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,OAAO;AACT"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { updateSession } from \"@/lib/supabase/middleware\"\nimport type { NextRequest } from \"next/server\"\nimport { NextResponse } from \"next/server\"\nimport { createServerClient } from \"@supabase/ssr\"\n\nexport async function middleware(request: NextRequest) {\n  const { pathname, search } = request.nextUrl\n\n  // ১. পারফরম্যান্স অপ্টিমাইজেশন: Static files, API routes এবং RSC requests দ্রুত স্কিপ করুন\n  // এটি ১০,০০০+ ইউজার হ্যান্ডেল করার সময় সার্ভারের লোড কমাবে\n  if (\n    pathname.startsWith('/_next') ||\n    pathname.startsWith('/api') ||\n    pathname.includes('.') ||\n    search.includes('_rsc=') // ⚡ RSC requests skip করুন (এটাই মূল fix)\n  ) {\n    return NextResponse.next()\n  }\n\n  // ২. সেশন আপডেট করা (Supabase Auth এর জন্য)\n  let response = await updateSession(request)\n\n  // ৩. কাস্টম হেডার সেট করা (যাতে Server Components ইউআরএল দেখতে পায়)\n  const requestHeaders = new Headers(request.headers)\n  requestHeaders.set(\"x-url\", pathname)\n\n  // ৪. অ্যাডমিন রুট প্রোটেকশন\n  if (pathname.startsWith('/admin')) {\n    const supabase = createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          getAll() { return request.cookies.getAll() },\n          setAll(cookiesToSet) {\n            cookiesToSet.forEach(({ name, value }) => request.cookies.set(name, value))\n          },\n        },\n      }\n    )\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser()\n\n      if (!user) {\n        const redirectUrl = request.nextUrl.clone()\n        redirectUrl.pathname = '/login'\n        return NextResponse.redirect(redirectUrl)\n      }\n\n      // রোল চেক করার জন্য ডাটাবেস কল (এটি শুধুমাত্র /admin রুটে হবে)\n      const { data: profile } = await supabase\n        .from('profiles')\n        .select('role')\n        .eq('id', user.id)\n        .single()\n\n      if (profile?.role !== 'admin' && profile?.role !== 'creator') {\n        const redirectUrl = request.nextUrl.clone()\n        redirectUrl.pathname = '/student/dashboard'\n        return NextResponse.redirect(redirectUrl)\n      }\n    } catch (error) {\n      console.error('Middleware auth error:', error)\n    }\n  }\n\n  return response\n}\n\n// ৫. গুরুত্বপূর্ণ: Matcher কনফিগারেশন\nexport const config = {\n  matcher: [\n    /*\n     * এই প্যাটার্নটি নিশ্চিত করে যে:\n     * - api রুটগুলো মিডলওয়্যার দ্বারা ব্লক হবে না (POST 404 ফিক্স করবে)\n     * - সব স্ট্যাটিক ফাইল (images, css) স্কিপ হবে\n     */\n    '/((?!api|_next/static|_next/image|favicon.ico|manifest.json|.*\\\\..*).*)',\n  ],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AAAA;AACA;AAAA;;;;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,QAAQ,OAAO;IAE5C,2FAA2F;IAC3F,4DAA4D;IAC5D,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,WACpB,SAAS,QAAQ,CAAC,QAClB,OAAO,QAAQ,CAAC,SAAS,0CAA0C;MACnE;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,4CAA4C;IAC5C,IAAI,WAAW,MAAM,IAAA,sJAAa,EAAC;IAEnC,qEAAqE;IACrE,MAAM,iBAAiB,IAAI,QAAQ,QAAQ,OAAO;IAClD,eAAe,GAAG,CAAC,SAAS;IAE5B,4BAA4B;IAC5B,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,MAAM,WAAW,IAAA,uMAAkB,sUAGjC;YACE,SAAS;gBACP;oBAAW,OAAO,QAAQ,OAAO,CAAC,MAAM;gBAAG;gBAC3C,QAAO,YAAY;oBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GAAK,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBACtE;YACF;QACF;QAGF,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;YAEtD,IAAI,CAAC,MAAM;gBACT,MAAM,cAAc,QAAQ,OAAO,CAAC,KAAK;gBACzC,YAAY,QAAQ,GAAG;gBACvB,OAAO,gMAAY,CAAC,QAAQ,CAAC;YAC/B;YAEA,+DAA+D;YAC/D,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;YAET,IAAI,SAAS,SAAS,WAAW,SAAS,SAAS,WAAW;gBAC5D,MAAM,cAAc,QAAQ,OAAO,CAAC,KAAK;gBACzC,YAAY,QAAQ,GAAG;gBACvB,OAAO,gMAAY,CAAC,QAAQ,CAAC;YAC/B;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,0BAA0B;QAC1C;IACF;IAEA,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;;;;KAIC,GACD;KACD;AACH"}}]
}